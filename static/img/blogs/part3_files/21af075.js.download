(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{3472:function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));var o=n(2),r=(n(11),n(6),n(16),n(22),n(12),n(13),n(8),n(4),n(7),n(294)),l=n(48),c=n(1),d=n(95);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={data:function(){return{list:[]}},watch:{aiPhotoTrainList:{handler:function(t){this.list=t},immediate:!0,deep:!0},list:{handler:function(t){Object(l.q)()&&((t||[]).filter((function(t){return[1,2,"1","2"].includes(t.state)})).map((function(t){return t.id})).length&&this.mockProcessTask())},immediate:!0,deep:!0},userInfo:{handler:function(t){var e=(t||{}).id;!(void 0===e?"":e)&&this.endPoll()},immediate:!0,deep:!0}},computed:f(f({},Object(c.e)("user",["userInfo"])),Object(c.c)("creation",["aiPhotoTrainList"])),mounted:function(){var t=this;this.pollingMiddleware=new r.default(3e4,(function(){t.fetchTaskData()}))},beforeDestroy:function(){this.pollingMiddleware&&this.pollingMiddleware.stop(),this.pollingMiddleware=null},methods:f(f({},Object(c.b)("creation",["setAiPhotographyTrainList"])),{},{mockProcessTask:function(){var t=this.list.filter((function(t){return[1,2,"1","2"].includes(t.state)})).map((function(t){return t.id}));t.length?this.startPoll(t):this.endPoll()},startPoll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.pollingMiddleware&&this.pollingMiddleware.checkStart(t)},endPoll:function(){this.pollingMiddleware&&this.pollingMiddleware.stop()},fetchTaskData:function(){var t=this.list.filter((function(t){return[1,2,"1","2"].includes(t.state)})).map((function(t){return t.id}));t.length?this.getTaskInfo(t):this.endPoll()},getTaskInfo:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={};return n.ids=e,Object(d.o)(n).then((function(e){var n=(e&&e.data?e.data:{}).items;((void 0===n?[]:n)||[]).forEach((function(e){if(t.$EventBus.$emit("updateAiPhotographyDigitalCloneList",e),t.$EventBus.$emit("updateAiPhotographyDigitalCloneItem",e),e&&[3].includes(e.state))return t.$set(t,"showStep","success"),t.visible=!0,void t.endPoll();t.updateData(e,e.id)}))}))},updateData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;this.list.forEach((function(o){if(n===o.id){if([4,"4"].includes(e.state)&&0===e.process)return t.$set(o,"state",e.state),t.$set(o,"state_desc",e.state_desc),t.$set(t,"showStep","failed"),t.visible=!0,t.$EventBus.$emit("updateAiPhotographyDigitalCloneList",o),t.$EventBus.$emit("updateAiPhotographyDigitalCloneItem",o),void t.endPoll();if(![0,100].includes(e.process)&&o.process>=e.process)return t.$set(o,"state",e.state),void t.$set(o,"state_desc",e.state_desc);t.$set(o,"process",e.process>100?100:e.process),t.$set(o,"state",e.state),t.$set(o,"data_set_no",null==e?void 0:e.data_set_no),t.$set(o,"rank",(null==e?void 0:e.rank)||0),t.$set(o,"time_left",(null==e?void 0:e.time_left)||0),t.$set(o,"state_desc",e.state_desc)}})),this.$store.dispatch("creation/setAiPhotographyTrainList",this.list)}})}}}]);