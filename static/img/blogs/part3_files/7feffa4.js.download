(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{2861:function(e,t,n){e.exports={}},2862:function(e,t,n){e.exports={}},2863:function(e,t,n){e.exports={}},2864:function(e,t,n){e.exports={}},2865:function(e,t,n){e.exports={}},2866:function(e,t,n){e.exports={}},2867:function(e,t,n){e.exports={}},2868:function(e,t,n){e.exports={}},2869:function(e,t,n){e.exports={}},2870:function(e,t,n){e.exports={}},2871:function(e,t,n){e.exports={}},2872:function(e,t,n){e.exports={}},2873:function(e,t,n){e.exports={}},2874:function(e,t,n){e.exports={}},2875:function(e,t,n){e.exports={}},2876:function(e,t,n){e.exports={}},2877:function(e,t,n){e.exports={}},2878:function(e,t,n){e.exports={}},2879:function(e,t,n){e.exports={}},2880:function(e,t,n){e.exports={}},2881:function(e,t,n){e.exports={}},2882:function(e,t,n){e.exports={}},2883:function(e,t,n){e.exports={}},2884:function(e,t,n){e.exports={}},2885:function(e,t,n){e.exports={}},2887:function(e,t,n){e.exports={}},2888:function(e,t,n){e.exports={}},2889:function(e,t,n){e.exports={}},2890:function(e,t,n){e.exports={}},2891:function(e,t,n){e.exports={}},2892:function(e,t,n){e.exports={}},2893:function(e,t,n){e.exports={}},2894:function(e,t,n){e.exports={}},2895:function(e,t,n){e.exports={}},2896:function(e,t,n){e.exports={}},2897:function(e,t,n){e.exports={}},2898:function(e,t,n){e.exports={}},2899:function(e,t,n){e.exports={}},2900:function(e,t,n){e.exports={}},2901:function(e,t,n){e.exports={}},2902:function(e,t,n){e.exports={}},2903:function(e,t,n){e.exports={}},2904:function(e,t,n){e.exports={}},2905:function(e,t,n){e.exports={}},2906:function(e,t,n){e.exports={}},5439:function(e,t,n){"use strict";n(2861)},5440:function(e,t,n){"use strict";n(2862)},5441:function(e,t,n){"use strict";n(2863)},5442:function(e,t,n){"use strict";n(2864)},5443:function(e,t,n){"use strict";n(2865)},5444:function(e,t,n){"use strict";n(2866)},5445:function(e,t,n){"use strict";n(2867)},5446:function(e,t,n){"use strict";n(2868)},5448:function(e,t,n){"use strict";n(2869)},5449:function(e,t,n){"use strict";n(2870)},5450:function(e,t,n){"use strict";n(2871)},5451:function(e,t,n){"use strict";n(2872)},5452:function(e,t,n){"use strict";n(2873)},5453:function(e,t,n){"use strict";n(2874)},5454:function(e,t,n){"use strict";n(2875)},5455:function(e,t,n){"use strict";n(2876)},5456:function(e,t,n){"use strict";n(2877)},5457:function(e,t,n){"use strict";n(2878)},5459:function(e,t,n){"use strict";n(2879)},5460:function(e,t,n){"use strict";n(2880)},5463:function(e,t,n){"use strict";n(2881)},5464:function(e,t,n){"use strict";n(2882)},5465:function(e,t,n){"use strict";n(2883)},5466:function(e,t,n){"use strict";n(2884)},5467:function(e,t,n){"use strict";n(2885)},5469:function(e,t,n){"use strict";n(2887)},5470:function(e,t,n){"use strict";n(2888)},5471:function(e,t,n){"use strict";n(2889)},5472:function(e,t,n){"use strict";n(2890)},5473:function(e,t,n){"use strict";n(2891)},5474:function(e,t,n){"use strict";n(2892)},5475:function(e,t,n){"use strict";n(2893)},5476:function(e,t,n){"use strict";n(2894)},5477:function(e,t,n){"use strict";n(2895)},5478:function(e,t,n){"use strict";n(2896)},5480:function(e,t,n){"use strict";n(2897)},5481:function(e,t,n){"use strict";n(2898)},5482:function(e,t,n){"use strict";n(2899)},5483:function(e,t,n){"use strict";n(2900)},5484:function(e,t,n){"use strict";n(2901)},5485:function(e,t,n){"use strict";n(2902)},5486:function(e,t,n){"use strict";n(2903)},5487:function(e,t,n){"use strict";n(2904)},5488:function(e,t,n){"use strict";n(2905)},5489:function(e,t,n){"use strict";n(2906)},5719:function(e,t,n){"use strict";n.r(t);n(11),n(6),n(12),n(13),n(8),n(7);var o=n(14),r=n(3),l=n(2),d=(n(20),n(19),n(50),n(16),n(4),n(43),n(21),n(40),n(41),n(18),n(30)),c=(n(32),n(49),n(28),n(151),n(141),n(142),n(109),n(1)),v=n(202),m=(n(26),n(10)),h=n(54),f=(n(24),{props:{title:{type:String,default:""},showFooter:{type:Boolean,default:!0}},data:function(){return{}},methods:{handleConfirm:function(){this.$emit("confirm")},close:function(){this.$emit("close")}}}),_=(n(5439),n(0)),y=Object(_.a)(f,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"crop-modal"},[t("div",{staticClass:"crop-modal-container"},[t("div",{staticClass:"crop-modal-header"},[t("div",{staticClass:"border-bottom"},[t("h3",{staticClass:"title"},[e._v(e._s(e.title||e.$t("crop")))]),e._v(" "),t("i",{staticClass:"iconfont icon-close",on:{click:e.close}})])]),e._v(" "),t("div",{staticClass:"crop-modal-content"},[e._t("default")],2),e._v(" "),e.showFooter?t("div",{staticClass:"crop-modal-footer"},[t("div",{staticClass:"crop-modal-footer-button",on:{click:e.handleConfirm}},[e._v(e._s(e.$t("completeEditing")))])]):e._e()])])}),[],!1,null,"6c629f2a",null).exports,C={props:{cover:{type:String,default:""},status:{type:Number,default:0},process:{type:Number,default:0}},components:{CropModal:y},data:function(){return{}},methods:{close:function(){this.$emit("close")}}};n(5440);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x={components:{ExportProgress:Object(_.a)(C,(function(){var e=this,t=e._self._c;return t("CropModal",{attrs:{title:e.$t("exportVideo"),"show-footer":!1},on:{close:e.close}},[t("div",{staticClass:"export-progress",style:{backgroundImage:"url(".concat(e.cover,")")}},[t("div",{staticClass:"progress-container"},[e.process<100?[t("el-progress",{attrs:{type:"circle",width:50,percentage:e.process,color:"#ffffff","define-back-color":"#5B5E65","text-color":"#ffffff"}})]:[t("img",{staticClass:"export-progress-success",attrs:{src:n(1460),alt:""}})],e._v(" "),t("div",{staticClass:"export-progress-text"},[e._v(e._s(e.process<100?e.$t("exportSetting"):e.$t("exportSuccess")))]),e._v(" "),e.process<100?t("div",{staticClass:"close-btn",on:{click:e.close}},[e._v("\n        "+e._s(e.$t("Cancel"))+"\n      ")]):e._e()],2)])])}),[],!1,null,"42eff298",null).exports},data:function(){return{visible:!1,formatNumberForeign:m.p,coins:[{name:"credit",icon:n(169),type:"calculateCoins",desc:"new_credit_desc"},{name:"stamina",icon:n(397),type:"tempCoins",desc:"new_stamina_desc",default:this.isLoggedIn?0:150}],exportForm:!1,form:{file_name:this.projectTitle,format:"mp4"},isShow:!1,exportStatus:0,clearInterval:null,isPost:!1,process:0}},computed:w(w(w(w(w({},Object(c.c)("user",["isCompanyAccount","isLoggedIn"])),Object(c.e)("payment",["paymentInfo"])),Object(c.e)("user",["token"])),Object(c.e)("videoEditor",["projectTitle","projectId","mirrorList","audioList"])),{},{getCoinTitle:function(){var e=this;return function(t){return e.$t(t.type)+"："+e.$t("balance")+" "+(e.paymentInfo[t.type]||0)+", "+e.$t(t.desc)}},cover:function(){var e;return(null===(e=this.mirrorList[0])||void 0===e?void 0:e.cover)||""}}),mounted:function(){},methods:w(w({},Object(c.b)("videoEditor",["setViewZoom"])),{},{handleVisibleChange:function(e){this.visible=e},toMall:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.token)return this.$EventBus.$emit("openLoginDialog",{callBack:function(){var e="".concat(location.origin,"/mall?openTab=Credit");window.open(e,"_blank")},dot:!1}),void this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});this.$logEvent("log_actions",{operation:"subscription_page_show",behavior_info:null!=e&&e.name?e.name:location.href});var t="".concat(location.origin,"/mall?openTab=Credit");window.open(t,"_blank")},handlePost:function(){this.exportForm=!0,this.isPost=!0},handleExport:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.mirrorList.length||0!==e.audioList.length){t.next=3;break}return e.$message.warning("addMirrorOrAudio"),t.abrupt("return");case 3:return e.$refs.exportDropdown.hide(),e.exportForm=!1,t.next=7,Object(v.exportVideo)({workspace_id:e.projectId,file_name:e.form.file_name,format:e.form.format});case 7:1e4===(n=t.sent).status.code&&(e.isShow=!0,o=!1,l=function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(){var r,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(v.getExportProgress)({task_id:n.data.task_id});case 2:r=t.sent,e.exportStatus=r.data.status,0===r.data.status?e.process=Math.floor(r.data.process):1!==r.data.status||o?(l={2:e.$t("exportFailed"),3:e.$t("exportExpired"),4:e.$t("exportSystemError")},e.$message.error(l[r.data.status]),e.isShow=!1,e.process=0,e.exportStatus=0,e.clearInterval&&clearInterval(e.clearInterval)):(o=!0,e.process=100,e.isShow=!1,e.process=0,e.exportStatus=0,clearInterval(e.clearInterval),e.handleDownload(r.data.url),e.isPost&&(e.isPost=!1,e.$EventBus.$emit("openContribution",{types:[h.CONTRIBUTION_TYPE_ENUM.LOCAL_VIDEO],source:"video_editor"})));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),l(),e.clearInterval=setInterval(l,5e3));case 9:case"end":return t.stop()}}),t)})))()},handleDownload:function(e){var link=document.createElement("a");link.href=e,link.download=this.form.file_name||e.split("/").pop(),document.body.appendChild(link),link.click(),setTimeout((function(){document.body.removeChild(link)}),1e3)},handleClose:function(){var e=this;0===this.exportStatus&&this.$confirm(this.$t("exportTips"),this.$t("exportCancel"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel")}).then((function(){e.isShow=!1,e.clearInterval&&clearInterval(e.clearInterval)}))},handleCommand:function(e){this.setViewZoom(e)}}),beforeDestroy:function(){this.clearInterval&&clearInterval(this.clearInterval)}},S=x,I=(n(5441),n(5442),Object(_.a)(S,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"view-zoom"},[e.isCompanyAccount?e._e():t("div",{staticClass:"coin-btn"},[e._l(e.coins,(function(n){return[t("el-tooltip",{key:n.name,attrs:{"popper-class":"custom-tips-popper",effect:"light",content:e.getCoinTitle(n),placement:"bottom"}},[t("div",{key:n.name,staticClass:"item-coin",class:n.name,on:{click:function(t){return e.toMall(n)}}},[t("img",{staticClass:"icon",attrs:{src:n.icon,alt:n.name}}),e._v(" "),t("div",{staticClass:"number"},[e._v("\n            "+e._s(e.formatNumberForeign(e.paymentInfo[n.type])||0)+"\n          ")])])])]}))],2),e._v(" "),t("div",{staticClass:"export"},[t("el-dropdown",{ref:"exportDropdown",attrs:{trigger:"click","hide-on-click":!1}},[t("div",{staticClass:"export-btn",class:{"is-disabled":!e.projectId}},[e._v(e._s(e.$t("leadingOut")))]),e._v(" "),t("el-dropdown-menu",{staticClass:"export-menu",attrs:{slot:"dropdown"},slot:"dropdown"},[e.exportForm?t("el-dropdown-item",{staticClass:"export-setting"},[t("div",{staticClass:"export-title"},[t("img",{attrs:{src:n(747),alt:""},on:{click:function(t){e.exportForm=!1}}}),e._v(" "),t("span",[e._v(e._s(e.$t("exportSetting")))])]),e._v(" "),t("el-form",{ref:"form",staticClass:"export-form",attrs:{model:e.form,"label-position":"top"},on:{click:function(e){e.stopPropagation()}}},[t("el-form-item",{attrs:{label:e.$t("trainName")}},[t("el-input",{attrs:{type:"text",placeholder:e.$t("enterName"),maxlength:"50","show-word-limit":""},model:{value:e.form.file_name,callback:function(t){e.$set(e.form,"file_name",t)},expression:"form.file_name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:e.$t("exportFormat")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{"popper-class":"video-editor-export-select","popper-append-to-body":!1,"append-to-body":!1},model:{value:e.form.format,callback:function(t){e.$set(e.form,"format",t)},expression:"form.format"}},[t("el-option",{attrs:{value:"mp4",label:"MP4"}}),e._v(" "),t("el-option",{attrs:{value:"mov",label:"MOV"}})],1)],1),e._v(" "),t("div",{staticClass:"btn-export",on:{click:e.handleExport}},[e._v(e._s(e.$t("leadingOut")))])],1)],1):t("el-dropdown-item",{staticClass:"export-item-container"},[t("div",{staticClass:"export-title"},[e._v(e._s(e.$t("leadingOut")))]),e._v(" "),t("div",{staticClass:"export-list"},[t("div",{staticClass:"export-item",on:{click:function(t){e.exportForm=!0}}},[t("i",{staticClass:"iconfont icon-a-ExporttoFilm"}),e._v(" "),t("div",{staticClass:"export-item-content"},[t("span",[e._v(e._s(e.$t("exportVideo")))]),e._v(" "),t("span",[e._v(e._s(e.$t("exportVideoDesc")))])]),e._v(" "),t("img",{staticClass:"export-item-img",attrs:{src:n(747)}})]),e._v(" "),t("div",{staticClass:"export-item",on:{click:e.handlePost}},[t("i",{staticClass:"iconfont icon-icon-Menu-Post-default"}),e._v(" "),t("div",{staticClass:"export-item-content"},[t("span",[e._v(e._s(e.$t("exportVideoAndPost")))]),e._v(" "),t("span",[e._v(e._s(e.$t("exportVideoAndPostDesc")))])]),e._v(" "),t("img",{staticClass:"export-item-img",attrs:{src:n(747)}})])])])],1)],1)],1),e._v(" "),e.isShow?t("ExportProgress",{attrs:{cover:e.cover,process:e.process},on:{close:e.handleClose}}):e._e()],1)}),[],!1,null,"c4f0a3ca",null).exports);n(31);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M={name:"HistoricalRecords",data:function(){return{currentIndex:-1,historyStack:[],maxHistoryLength:25,isApplyingHistory:!1,isInitialLoad:!0,lastRecord:null,debounceTimer:null,isDraggingAudio:!1}},computed:k({canUndo:function(){return this.currentIndex>0},canRedo:function(){return this.currentIndex<this.historyStack.length-1}},Object(c.e)("videoEditor",["currentRatio","mirrorList","audioList","mirrorLoading"])),mounted:function(){this.$EventBus.$on("editor-data-loaded",this.handleEditorDataLoaded),this.$EventBus.$on("audio-drag-start",this.handleAudioDragStart),this.$EventBus.$on("audio-drag-end",this.handleAudioDragEnd),this.$EventBus.$on("audio-resize-start",this.handleAudioDragStart),this.$EventBus.$on("audio-resize-end",this.handleAudioDragEnd)},beforeDestroy:function(){this.$EventBus.$off("editor-data-loaded",this.handleEditorDataLoaded),this.$EventBus.$off("audio-drag-start",this.handleAudioDragStart),this.$EventBus.$off("audio-drag-end",this.handleAudioDragEnd),this.$EventBus.$off("audio-resize-start",this.handleAudioDragStart),this.$EventBus.$off("audio-resize-end",this.handleAudioDragEnd)},methods:k(k({},Object(c.b)("videoEditor",["setCurrentRatio","setMirrorList","setAudioList","setCurrentMirror","setSaving"])),{},{handleAudioDragStart:function(){this.isDraggingAudio=!0},handleAudioDragEnd:function(){this.isDraggingAudio=!1,this.recordCurrentState("audio-drag")},handleEditorDataLoaded:function(){this.addInitialHistory(),this.isInitialLoad=!1},addInitialHistory:function(){if(0===this.historyStack.length){var e={type:"initial",ratio:this.currentRatio,mirrors:JSON.parse(JSON.stringify(this.mirrorList)),audios:JSON.parse(JSON.stringify(this.audioList)),timestamp:Date.now()};this.historyStack.push(e),this.currentIndex=0,this.lastRecord=e}},recordCurrentState:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user-action";this.isDraggingAudio&&"audio-drag"!==t||(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((function(){if(!(e.isApplyingHistory||e.isInitialLoad||e.mirrorLoading)){var n={type:t,ratio:e.currentRatio,mirrors:JSON.parse(JSON.stringify(e.mirrorList)),audios:JSON.parse(JSON.stringify(e.audioList)),currentMirror:e.currentMirror?JSON.parse(JSON.stringify(e.currentMirror)):null,timestamp:Date.now()};e.lastRecord&&e.isStateEqual(n,e.lastRecord)||(e.addHistory(n),e.lastRecord=n)}}),100))},isStateEqual:function(e,t){return!(!e||!t)&&(e.ratio===t.ratio&&(JSON.stringify(e.mirrors)===JSON.stringify(t.mirrors)&&JSON.stringify(e.audios)===JSON.stringify(t.audios)))},addHistory:function(e){this.currentIndex<this.historyStack.length-1&&(this.historyStack=this.historyStack.slice(0,this.currentIndex+1)),this.historyStack.push(e),this.historyStack.length>this.maxHistoryLength?(this.historyStack.shift(),this.currentIndex=Math.max(0,this.currentIndex-1)):this.currentIndex++},handleUndo:function(){var e=this;if(this.canUndo){this.setSaving(!1),this.isApplyingHistory=!0,this.currentIndex--;var t=this.historyStack[this.currentIndex];this.applyHistory(t),setTimeout((function(){e.isApplyingHistory=!1}),50)}},handleRedo:function(){var e=this;if(this.canRedo){this.setSaving(!1),this.isApplyingHistory=!0,this.currentIndex++;var t=this.historyStack[this.currentIndex];this.applyHistory(t),setTimeout((function(){e.isApplyingHistory=!1}),50)}},applyHistory:function(e){if(void 0!==e.ratio&&this.setCurrentRatio(e.ratio),void 0!==e.mirrors&&(this.setMirrorList(JSON.parse(JSON.stringify(e.mirrors))),e.mirrors.length>0)){var t=e.currentMirror&&e.mirrors.find((function(t){return t.key===e.currentMirror.key}))||e.mirrors[0];this.setCurrentMirror(t)}void 0!==e.audios&&this.setAudioList(JSON.parse(JSON.stringify(e.audios)))},recordRatioChange:function(e,t){this.recordCurrentState("ratio")},recordMirrorChange:function(e,t){this.recordCurrentState("mirror")},recordAudioChange:function(e,t){this.isDraggingAudio||this.recordCurrentState("audio")}}),watch:{currentRatio:{handler:function(e,t){e===t||this.isApplyingHistory||this.isInitialLoad||this.mirrorLoading||this.recordRatioChange(e,t)}},mirrorList:{handler:function(e,t){JSON.stringify(e)===JSON.stringify(t)||this.isApplyingHistory||this.isInitialLoad||this.mirrorLoading||this.recordMirrorChange(e,t)},deep:!0},audioList:{handler:function(e,t){JSON.stringify(e)===JSON.stringify(t)||this.isApplyingHistory||this.isInitialLoad||this.mirrorLoading||this.recordAudioChange(e,t)},deep:!0}}},P=M;n(5443);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E={components:{ViewZoom:I,HistoricalRecords:Object(_.a)(P,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"editor-history-record"},[t("i",{staticClass:"iconfont icon-Previous",class:{disabled:!e.canUndo},on:{click:e.handleUndo}}),e._v(" "),t("i",{staticClass:"iconfont icon-next",class:{disabled:!e.canRedo},on:{click:e.handleRedo}})])}),[],!1,null,"273880a6",null).exports},data:function(){return{popoverVisible:!1,createProjectLoading:!1,projectList:[],localProjectId:"",projectName:"",originalProjectName:""}},computed:j(j(j({},Object(c.e)("videoEditor",["currentRatio","currentRatioIndex","ratioList","isSaving","projectId","mirrorList","currentMirror"])),Object(c.c)("user",["isLoggedIn"])),Object(c.c)("videoEditor",["getCurrentRatioIndex"])),mounted:function(){var e=this;this.isLoggedIn&&this.getProjectList(),this.$nextTick((function(){e.adjustInputWidth()})),document.addEventListener("click",this.handleOutsideClick)},beforeDestroy:function(){document.removeEventListener("click",this.handleOutsideClick)},watch:{projectName:function(){var e=this;this.$nextTick((function(){e.adjustInputWidth()}))},mirrorList:{handler:function(e){this.setProjectCoverIfNeeded(e)},deep:!0},popoverVisible:function(e){e&&this.setIsPlaying(!1)},getCurrentRatioIndex:function(e){this.SET_CURRENT_RATIO_INDEX(e)},projectId:function(e,t){!t&&e&&(this.updateProject(e),this.getProjectList())}},methods:j(j(j({},Object(c.d)("videoEditor",["SET_CURRENT_RATIO","SET_CURRENT_RATIO_INDEX"])),Object(c.b)("videoEditor",["createProject","getOrCreateProject","setSaving","saveVideoEditorData","updateProjectTitle","setIsPlaying","setCurrentMirror","setRefreshProject","setMirrorList","setAudioList","setIsCreateNewProject","setEditorId","setProjectId","setMirrorLoading"])),{},{handleOutsideClick:function(e){if(this.popoverVisible){var t=this.$refs.ratioPopover.$el,n=this.$refs.ratioPopover.referenceElm;t&&n&&(t.contains(e.target)||n.contains(e.target)||(this.popoverVisible=!1))}},handleAllProjectsClick:function(){this.$router.push(this.localePath("/personal?tab=Film"))},updateProject:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.$store.commit("videoEditor/SET_PROJECT_ID",e),e)if(this.localProjectId=e,this.updateRouteQuery(e),null!==t)this.updateProjectName(t);else if(this.projectList&&this.projectList.length>0){var n=this.projectList.find((function(t){return t.id==e}));n?this.updateProjectName(n.workspace_name):this.getProjectNameById(e)}else this.getProjectNameById(e)},ensureProject:function(){var e=arguments,t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.length>0&&void 0!==e[0]?e[0]:null,t.localProjectId){n.next=14;break}return n.prev=2,n.next=5,t.getOrCreateProject(o);case 5:return r=n.sent,l=r.projectId,n.abrupt("return",l);case 10:return n.prev=10,n.t0=n.catch(2),console.error("创建项目失败",n.t0),n.abrupt("return",null);case 14:return n.abrupt("return",t.localProjectId);case 15:case"end":return n.stop()}}),n,null,[[2,10]])})))()},getProjectNameById:function(e){var t=this;this.updateProjectName(),Object(v.getProjectList)({page:1,page_size:1e3}).then((function(n){var o=(n.data.list||[]).find((function(t){return t.id==e})),r=t.projectList.findIndex((function(t){return t.id==e}));if(r>-1){var l=t.projectList.splice(r,1),c=Object(d.a)(l,1)[0];t.projectList.unshift(c)}o&&t.updateProjectName(o.workspace_name)})).catch((function(){t.updateProjectName()}))},updateProjectName:function(e){var t=this;this.projectName=e||this.$t("video_material_$10"),this.originalProjectName=this.projectName,this.$store.commit("videoEditor/SET_PROJECT_TITLE",e),this.$nextTick((function(){t.adjustInputWidth()}))},updateRouteQuery:function(e){if(this.$route.query.project_id!==e){var t=new URL(window.location.href);e?t.searchParams.set("project_id",e):t.searchParams.delete("project_id");var n=t.pathname+t.search+t.hash;window.history.replaceState(j(j({},history.state),{},{project_id:e}),"",n),this.$router.history.current.query.project_id=e}},goBack:function(){try{window.history.length>1?this.$router.go(-1):this.$router.push(this.localePath("/"))}catch(e){this.$router.push(this.localePath("/"))}},handleRatioClick:function(e){this.SET_CURRENT_RATIO_INDEX(e)},handleCheckBtnClick:function(){this.SET_CURRENT_RATIO(this.ratioList[this.currentRatioIndex].value),this.popoverVisible=!1,this.saveVideoEditorData()},handleProjectsClick:function(e){this.setMirrorList([],!1),this.setAudioList([],!1),this.setEditorId(null),this.updateProject(e.id,e.workspace_name),this.setRefreshProject()},handleCreateProjectClick:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.createProjectLoading){t.next=2;break}return t.abrupt("return");case 2:return e.createProjectLoading=!0,e.setProjectId(null),e.setMirrorList([],!1),e.setAudioList([],!1),e.setEditorId(null),e.setCurrentMirror(null),t.prev=8,e.setIsCreateNewProject(!0),t.next=12,e.createProject();case 12:n=t.sent,o=n.projectId,e.updateProject(o),e.getProjectList(),r={customType:"empty_mirror",duration:3,clipInfo:{startTime:0,endTime:3},key:(new Date).getTime()},e.setCurrentMirror(r),e.setMirrorList([r]),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(8),console.error("创建项目失败",t.t0);case 24:return t.prev=24,e.createProjectLoading=!1,t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[8,21,24,27]])})))()},getProjectList:function(){var e=this;Object(v.getProjectList)({page:1,page_size:1e3}).then((function(t){if(e.projectList=t.data.list||[],e.$route.query.project_id){var n=e.$route.query.project_id;if(e.localProjectId===n){var o=e.projectList.find((function(e){return e.id==n}));o&&e.updateProjectName(o.workspace_name);var r=e.projectList.findIndex((function(e){return e.id==n}));if(r>2){var l=e.projectList.splice(r,1),c=Object(d.a)(l,1)[0];e.projectList.unshift(c)}return}var v=e.projectList.findIndex((function(e){return e.id==n}));if(v>-1){var m=e.projectList.splice(v,1),h=Object(d.a)(m,1)[0];e.projectList.unshift(h)}e.updateProject(n)}else e.updateProjectName()})).catch((function(t){var n=e.$route.query.project_id;n&&e.updateProject(n),e.updateProjectName()}))},handleProjectsNameBlur:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.projectName!==e.originalProjectName&&e.projectName){t.next=2;break}return t.abrupt("return");case 2:if(e.localProjectId){t.next=6;break}return t.next=5,e.ensureProject(e.projectName);case 5:return t.abrupt("return");case 6:return t.next=8,e.ensureProject();case 8:if(t.sent){t.next=11;break}return t.abrupt("return");case 11:e.updateProjectInfo({workspace_name:e.projectName});case 12:case"end":return t.stop()}}),t)})))()},handleEnterPress:function(){this.$refs.projectNameInput.blur()},adjustInputWidth:function(){if(this.$refs.projectNameInput){var input=this.$refs.projectNameInput,e=document.createElement("span");e.style.visibility="hidden",e.style.position="absolute",e.style.whiteSpace="pre",e.style.font=window.getComputedStyle(input).font,e.textContent=this.projectName||this.$t("video_material_$10"),document.body.appendChild(e);var t=e.getBoundingClientRect().width;document.body.removeChild(e);var n=document.activeElement===input?8:0;input.style.width=t+5+n+"px"}},setProjectCoverIfNeeded:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.next=2;break;case 2:if(e&&e.length&&t.localProjectId){n.next=4;break}return n.abrupt("return");case 4:if(!(o=t.projectList.find((function(e){return e.id==t.localProjectId})))||!o.cover){n.next=7;break}return n.abrupt("return");case 7:if(r=e.find((function(e){return e.url||e.cover||e.original}))){n.next=10;break}return n.abrupt("return");case 10:if(t.setSaving(!0),n.prev=11,1!==r.type){n.next=21;break}return n.next=15,t.getVideoFirstFrame(r.url);case 15:if(!(l=n.sent)){n.next=19;break}return n.next=19,t.updateProjectInfo({cover:l});case 19:n.next=24;break;case 21:return d=r.url||r.cover||r.original,n.next=24,t.updateProjectInfo({cover:d});case 24:n.next=29;break;case 26:n.prev=26,n.t0=n.catch(11),console.error("设置项目封面失败",n.t0);case 29:return n.prev=29,t.setSaving(!1),n.finish(29);case 32:case"end":return n.stop()}}),n,null,[[11,26,29,32]])})))()},getVideoFirstFrame:function(e){return new Promise((function(t,n){var video=document.createElement("video");video.crossOrigin="anonymous",video.src=e,video.muted=!0;var o=0;function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],canvas=document.createElement("canvas");canvas.width=video.videoWidth,canvas.height=video.videoHeight;var n=canvas.getContext("2d");n.drawImage(video,0,0,canvas.width,canvas.height);for(var data=n.getImageData(0,0,canvas.width,canvas.height).data,o=!0,r=data.length/4,i=0;i<10;i++){var l=4*Math.floor(Math.random()*r),d=data[l],g=data[l+1],b=data[l+2];if(d>10||g>10||b>10){o=!1;break}}if(!o||e){var c=canvas.toDataURL("image/jpeg",.8);video.pause(),t(c)}}video.addEventListener("loadedmetadata",(function(){video.play().catch((function(e){console.error("视频播放失败",e),n(e)}))})),video.addEventListener("timeupdate",(function(){o>=30?r(!0):(o++,r())})),video.addEventListener("error",(function(e){console.error("视频加载失败",e),n(e)}))}))},updateProjectCover:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.localProjectId&&e){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,t.updateProjectInfo({cover:e});case 5:n.next=11;break;case 7:throw n.prev=7,n.t0=n.catch(2),console.error("更新项目封面失败",n.t0),n.t0;case 11:case"end":return n.stop()}}),n,null,[[2,7]])})))()},updateProjectInfo:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.localProjectId){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,o=t.projectList.find((function(e){return e.id==t.localProjectId})),r=j({workspace_id:t.localProjectId,workspace_name:t.projectName||(null==o?void 0:o.workspace_name),cover:null==o?void 0:o.cover},e),t.setSaving(!0),n.next=8,Object(v.editProject)(r);case 8:return t.setSaving(!1),(l=t.projectList.findIndex((function(e){return e.id==t.localProjectId})))>-1&&Object.keys(e).forEach((function(n){t.$set(t.projectList[l],"workspace_name"===n?"workspace_name":n,e[n])})),e.workspace_name&&t.updateProjectName(e.workspace_name),n.abrupt("return",!0);case 15:throw n.prev=15,n.t0=n.catch(2),console.error("更新项目信息失败",n.t0),n.t0;case 19:case"end":return n.stop()}}),n,null,[[2,15]])})))()}})},$=E,D=(n(5444),n(5445),Object(_.a)($,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"editor-header"},[t("div",{staticClass:"editor-header-left"},[t("div",{staticClass:"go-back",on:{click:e.goBack}},[t("i",{staticClass:"iconfont icon-goBack top-bar-left-icon"})]),e._v(" "),t("img",{staticClass:"editor-header-left-logo",attrs:{src:n(315),alt:"logo"}}),e._v(" "),t("div",{staticClass:"action-container"},[t("div",{staticClass:"action-item"},[t("div",{staticClass:"projects"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.projectName,expression:"projectName"}],ref:"projectNameInput",attrs:{type:"text",maxlength:20},domProps:{value:e.projectName},on:{input:[function(t){t.target.composing||(e.projectName=t.target.value)},e.adjustInputWidth],blur:e.handleProjectsNameBlur,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleEnterPress.apply(null,arguments)}}}),e._v(" "),t("el-popover",{attrs:{placement:"bottom",trigger:"hover","popper-class":"filter-popover",disabled:e.isSaving}},[t("div",{staticClass:"popover-content"},[e._l(e.projectList.filter((function(e,i){return i<3})),(function(n){return t("div",{key:n.id,staticClass:"item hover",on:{click:function(t){return e.handleProjectsClick(n)}}},[t("div",{staticClass:"item-content"},[t("div",{staticClass:"item-content-img"},[n.cover?t("img",{attrs:{src:n.cover,alt:""}}):e._e()]),e._v(" "),t("span",[e._v(e._s(n.workspace_name?n.workspace_name:e.$t("video_material_$10")))])]),e._v(" "),n.id==e.localProjectId?t("i",{staticClass:"iconfont icon-yiguanzhu"}):e._e()])})),e._v(" "),t("div",{staticClass:"item hover",on:{click:e.handleAllProjectsClick}},[t("div",{staticClass:"item-content"},[t("div",{staticClass:"item-content-img iconBox"},[t("i",{staticClass:"iconfont icon-a-AllProjects"})]),e._v(" "),t("span",[e._v(e._s(e.$t("video_material_$11")))])])]),e._v(" "),t("div",{staticClass:"item hover",on:{click:e.handleCreateProjectClick}},[t("div",{staticClass:"item-content"},[t("div",{staticClass:"item-content-img iconBox"},[t("i",{staticClass:"iconfont icon-jia"})]),e._v(" "),t("span",[e._v(e._s(e.$t("create_project")))])])])],2),e._v(" "),t("i",{staticClass:"iconfont icon-a-dropdown",attrs:{slot:"reference"},slot:"reference"})])],1)]),e._v(" "),t("div",{staticClass:"line"}),e._v(" "),e.localProjectId||e.isSaving?t("div",{staticClass:"action-item"},[t("div",{staticClass:"text"},[e._v(e._s(e.isSaving?e.$t("video_material_$8"):e.$t("video_material_$9")))])]):e._e()])]),e._v(" "),t("div",{staticClass:"editor-header-center"},[t("div",{staticClass:"editor-ratio"},[t("el-popover",{ref:"ratioPopover",attrs:{"popper-class":"editor-ratio-popover",placement:"bottom","visible-arrow":!1,width:"290",trigger:"manual"},model:{value:e.popoverVisible,callback:function(t){e.popoverVisible=t},expression:"popoverVisible"}},[t("div",{staticClass:"ratio-content"},[t("div",{staticClass:"ratio-title"},[e._v("\n            "+e._s(e.$t("GlobalScale"))+"\n          ")]),e._v(" "),t("div",{staticClass:"editor-ratio-list"},e._l(e.ratioList,(function(n,o){return t("div",{key:n.name,staticClass:"editor-ratio-list-item",class:{"is-active":e.currentRatioIndex===o},on:{click:function(t){return e.handleRatioClick(o)}}},[t("div",{staticClass:"editor-ratio-list-item-icon"},[t("i",{staticClass:"iconfont",class:n.icon})]),e._v(" "),t("span",{staticClass:"editor-ratio-list-item-name"},[e._v(e._s(n.name))])])})),0),e._v(" "),t("div",{staticClass:"check-btn",on:{click:e.handleCheckBtnClick}},[e._v("\n            "+e._s(e.$t("Apply"))+"\n          ")])]),e._v(" "),t("div",{staticClass:"editor-ratio-reference",class:{"is-active":e.popoverVisible},attrs:{slot:"reference"},on:{click:function(t){e.popoverVisible=!0}},slot:"reference"},[t("span",[e._v(e._s(e.currentRatio))]),e._v(" "),t("i",{staticClass:"iconfont icon-a-dropdown"})])])],1),e._v(" "),t("div",{staticClass:"editor-header-center-divider"}),e._v(" "),t("HistoricalRecords")],1),e._v(" "),t("div",{staticClass:"editor-header-right"},[t("ViewZoom")],1)])}),[],!1,null,"69a68134",null)),R=D.exports;n(22);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var A={data:function(){return{btnConfig:{upscale:{name:"OriginalityUpscale",icon:"icon-u1",key:"upscale"},variation:{name:"Variations",icon:"icon-v",key:"variation"},extraUpscale:{name:"taskTabUpscale",icon:"icon-icon-HD",key:"extraUpscale"},img2video:{name:"ImageToVideo",icon:"icon-a-icon-VideoGeneration",key:"img2video"},videoExtend:{name:"videoProlong",icon:"icon-a-Videoextension",key:"videoExtend"}},btnList:[]}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(c.e)("videoEditor",["currentMirror"])),watch:{currentMirror:function(e){var t=this;if(!e||!e.operation_labels)return this.btnList=[];this.btnList=e.operation_labels.map((function(label){return t.btnConfig[label]})).filter(Boolean)}},methods:{handleItemClick:function(e){this.$emit("btnClick",e.key,this.currentMirror)}}},N=A,z=(n(5446),Object(_.a)(N,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"editor-btn-box-container"},e._l(e.btnList,(function(n){return t("div",{key:n.name,staticClass:"editor-btn-box-container-item",on:{click:function(t){return e.handleItemClick(n)}}},[t("i",{staticClass:"iconfont",class:n.icon}),e._v(" "),t("span",[e._v(e._s(e.$t(n.name)))])])})),0)}),[],!1,null,"6df4f1aa",null).exports),F=n(5447);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G={name:"PreviewImageContainer",computed:B(B({},Object(c.e)("videoEditor",["currentRatio","mirrorList","isPlaying","currentTime","audioList","currentMirror","projectId","canvasLoading","isUserSelectedMirror"])),Object(c.c)("videoEditor",["totalDuration"])),data:function(){return{containerWidth:0,currentItemIndex:0,mediaPlayer:null,widthRetryCount:0,rendererInitialized:!1,timeUpdateTimer:null,transitionEnabled:!0,pendingRender:null,renderState:{isRenderingMirror:!1,pendingMirrorIndex:null,lastRenderedMirrorIndex:-1,renderLock:!1,lastRenderTime:0,storeAsLastFrame:!1}}},watch:{projectId:function(e,t){e!==t&&this.handleProjectChange()},currentRatio:function(){var e=this;this.$nextTick((function(){return e.updateContainerWidth()}))},mirrorList:{handler:function(e){if(!e||0===e.length)return this.setCurrentMirror(null),this.stopPlayback(),void this.safeCleanCanvas();this.rendererInitialized&&this.mediaPlayer?this.updateMediaItems():!this.rendererInitialized&&e.length>0&&this.initializeMediaPlayer()},deep:!0,immediate:!0},audioList:{handler:function(){this.rendererInitialized&&this.mediaPlayer&&(this.setIsPlaying(!1),this.mediaPlayer.updateAudioPlayback(),this.updateMediaDuration(),this.isPlaying&&this.mediaPlayer.resetAudioState())},deep:!0},isPlaying:function(e){e?this.startPlayback():this.pausePlayback()},currentTime:function(e){var t=this;this.mediaPlayer&&this.rendererInitialized&&!this.isPlaying&&(this.pendingRender&&clearTimeout(this.pendingRender),this.pendingRender=setTimeout((function(){t.mediaPlayer.seekTo(e,!0),t.pendingRender=null}),50))},currentMirror:{handler:function(e){var t=this;if(e&&this.mirrorList&&this.mediaPlayer&&this.rendererInitialized){var n=this.mirrorList.findIndex((function(t){return t.key===e.key}));-1!==n&&(this.isUserSelectedMirror?(console.log("[PreviewImage] 用户选择分镜变更，立即渲染"),this.renderState.renderLock=!1,setTimeout((function(){var e=t.mediaPlayer.enableTransition;t.mediaPlayer.enableTransition=!1,setTimeout((function(){t.mediaPlayer.enableTransition=e}),100),t.renderState.lastRenderedMirrorIndex=n,t.renderState.lastRenderTime=Date.now(),setTimeout((function(){t.isUserSelectedMirror&&(t.setIsUserSelectedMirror(!1),console.log("[PreviewImage] 清除用户选择分镜标记"))}),1e3)}),10)):this.scheduleRenderMirror(n))}},deep:!0,immediate:!0}},mounted:function(){window.addEventListener("resize",this.updateContainerWidth),this.updateContainerWidth(),this.startTimeUpdateTimer()},beforeDestroy:function(){window.removeEventListener("resize",this.updateContainerWidth),this.stopTimeUpdateTimer(),this.pendingRender&&clearTimeout(this.pendingRender),this.releaseResources()},methods:B(B(B({},Object(c.d)("videoEditor",["SET_IS_PLAYING"])),Object(c.b)("videoEditor",["setCurrentTime","updateTotalDuration","setCurrentMirror","setIsUserSelectedMirror","setIsPlaying"])),{},{handleProjectChange:function(){var e=this;this.stopPlayback(),this.safeCleanCanvas(),this.$nextTick((function(){e.releaseResources(),e.mirrorList&&e.mirrorList.length>0&&e.initializeMediaPlayer()}))},safeCleanCanvas:function(){var e=this;if(this.renderState.renderLock)setTimeout((function(){return e.safeCleanCanvas()}),50);else{this.renderState.renderLock=!0;try{if(this.mediaPlayer)this.mediaPlayer.clearCanvas();else if(this.$refs.canvas){this.$refs.canvas.getContext("2d").clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height)}}finally{this.renderState.renderLock=!1}}},releaseResources:function(){this.renderState.renderLock=!0;try{this.mediaPlayer&&(this.mediaPlayer.pause(),this.mediaPlayer.stopAllAudio(),this.mediaPlayer.dispose(),this.mediaPlayer=null,this.setCurrentTime(0),this.SET_IS_PLAYING(!1),this.rendererInitialized=!1)}finally{this.renderState={isRenderingMirror:!1,pendingMirrorIndex:null,lastRenderedMirrorIndex:-1,renderLock:!1,lastRenderTime:0,storeAsLastFrame:!1}}this.cleanupResources()},cleanupResources:function(){return Object(r.a)(regeneratorRuntime.mark((function e(){var t,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.resolve().then(n.bind(null,267));case 3:return t=e.sent,o=t.cleanupUnusedResources,e.next=7,o();case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("资源清理失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},updateContainerWidth:function(){var e=this;if(this.$refs.container){var t=this.$refs.container.clientWidth;if(t<=0)return this.widthRetryCount++,void(this.widthRetryCount<5?setTimeout((function(){return e.updateContainerWidth()}),100):(this.containerWidth=1,this.$nextTick((function(){return e.updateLayout()}))));this.widthRetryCount=0,this.containerWidth=t,this.$nextTick((function(){return e.updateLayout()}))}},updateLayout:function(){var e=this;if(this.$refs.canvas&&this.$refs.previewImage){var t=this.$refs.previewImage,canvas=this.$refs.canvas;requestAnimationFrame((function(){if(t&&canvas){var n=t.getBoundingClientRect(),o=Math.max(Math.round(n.width),1),r=Math.max(Math.round(n.height),1);o>5&&r>5&&(canvas.width!==o||canvas.height!==r)&&(canvas.width=o,canvas.height=r,e.mediaPlayer&&e.rendererInitialized?(e.mediaPlayer.containerWidth=o,e.mediaPlayer.containerHeight=r,e.scheduleRender()):e.mirrorList&&e.mirrorList.length>0&&e.initializeMediaPlayer())}}))}},initializeMediaPlayer:function(){var e=this;!this.rendererInitialized&&this.$refs.canvas&&(this.mediaPlayer=new F.a(this.$store),this.mediaPlayer.enableTransition=this.transitionEnabled,this.mediaPlayer.transitionDuration=300,this.mediaPlayer.initialize(this.$refs.canvas,this.$refs.canvas.width,this.$refs.canvas.height)?(this.rendererInitialized=!0,this.mediaPlayer.onPlaybackComplete=this.handlePlaybackComplete,this.updateMediaItems(),this.scheduleRender(),setTimeout((function(){e.mirrorList&&e.mirrorList.length>0&&e.forceRenderFirstMirror()}),300)):setTimeout((function(){e.rendererInitialized||e.initializeMediaPlayer()}),500))},forceRenderFirstMirror:function(){var e=this;if(this.isUserSelectedMirror)console.log("[PreviewImage] 用户已选择分镜，跳过强制渲染第一帧");else if(this.mediaPlayer&&this.rendererInitialized&&this.mirrorList&&0!==this.mirrorList.length&&(!this.currentMirror||"empty_mirror"!==this.currentMirror.customType)){var t=this.renderState.lastRenderedMirrorIndex;if(!(t>=0&&t<this.mirrorList.length&&"empty_mirror"===this.mirrorList[t].customType)){var n=this.mediaPlayer.enableTransition;this.mediaPlayer.enableTransition=!1,this.mediaPlayer.forceRenderMirror(0,!1),setTimeout((function(){e.mediaPlayer.enableTransition=n}),100)}}},handlePlaybackComplete:function(){if(this.SET_IS_PLAYING(!1),this.totalDuration>0){var e=this.mirrorList.length-1;this.mediaPlayer.stopAllAudio(),e>=0&&this.scheduleRenderMirror(e,!0,!0),this.setCurrentTime(this.totalDuration)}},scheduleRender:function(){var e=this;if(this.mediaPlayer&&this.rendererInitialized)if(this.isUserSelectedMirror&&this.renderState.renderLock)console.log("[PreviewImage] 用户已选择分镜且正在渲染中，跳过自动渲染");else{if(this.currentMirror&&this.mirrorList&&this.mirrorList.length>0){var t=this.mirrorList.findIndex((function(t){return t.key===e.currentMirror.key}));if(t>=0)return"empty_mirror"===this.currentMirror.customType||this.isUserSelectedMirror,void this.scheduleRenderMirror(t)}if(this.isUserSelectedMirror)console.log("[PreviewImage] 用户已选择分镜，跳过自动渲染第一个分镜");else if(this.mirrorList&&this.mirrorList.length>0&&!this.renderState.renderLock){var n=this.renderState.lastRenderedMirrorIndex;if(n>=0&&n<this.mirrorList.length&&"empty_mirror"===this.mirrorList[n].customType)return;this.scheduleRenderMirror(0)}else this.executeRender((function(){e.mediaPlayer.renderFrameAtTime(e.currentTime,!0)}))}},scheduleRenderMirror:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(!this.mediaPlayer||!this.rendererInitialized||e<0||!this.mirrorList||e>=this.mirrorList.length)){var r=this.mirrorList[e];if(r){if(this.isUserSelectedMirror&&this.currentMirror){var l=this.mirrorList.findIndex((function(e){return e.key===t.currentMirror.key}));if(-1!==l&&l!==e)return void console.log("[PreviewImage] 用户选择的分镜优先，拒绝自动渲染其他分镜")}var d=Date.now();if(!(this.renderState.lastRenderedMirrorIndex===e&&d-this.renderState.lastRenderTime<300)||o)if(this.renderState.renderLock)this.isUserSelectedMirror?(console.log("[PreviewImage] 用户选择分镜被锁，设置高优先级待处理"),this.renderState.pendingMirrorIndex=e,this.renderState.storeAsLastFrame=o,setTimeout((function(){t.renderState.renderLock=!1}),10)):(this.renderState.pendingMirrorIndex=e,this.renderState.storeAsLastFrame=o);else{if("empty_mirror"===r.customType&&(this.renderState.lastRenderedMirrorIndex=e),n&&this.mediaPlayer.timeOffsets&&e<this.mediaPlayer.timeOffsets.length){var c=this.mediaPlayer.timeOffsets[e];this.setCurrentTime(c)}this.executeRender((function(){if("empty_mirror"===r.customType)t.mediaPlayer.clearCanvas(),t.renderState.lastRenderedMirrorIndex=e,t.renderState.lastRenderTime=Date.now(),t.renderState.renderLock=!0,setTimeout((function(){t.renderState.renderLock=!1}),200);else{var n=t.mediaPlayer.enableTransition;t.isUserSelectedMirror&&(t.mediaPlayer.enableTransition=!1),t.mediaPlayer.forceRenderMirror(e,o),t.mediaPlayer.enableTransition=n}t.renderState.lastRenderedMirrorIndex=e,t.renderState.lastRenderTime=Date.now(),t.renderState.storeAsLastFrame=o}))}}}},executeRender:function(e){var t=this;if(!this.renderState.renderLock){this.renderState.renderLock=!0;try{e()}catch(e){console.error("渲染错误:",e)}finally{setTimeout((function(){if(t.renderState.renderLock=!1,null!==t.renderState.pendingMirrorIndex){var e=t.renderState.pendingMirrorIndex,n=t.renderState.storeAsLastFrame||!1;t.renderState.pendingMirrorIndex=null,t.renderState.storeAsLastFrame=!1,t.scheduleRenderMirror(e,!0,n)}}),50)}}},updateMediaItems:function(){var e=this;if(this.mediaPlayer&&this.rendererInitialized)if(this.mediaPlayer.enableTransition=this.transitionEnabled,this.mediaPlayer.setMediaItems(this.mirrorList||[]),this.updateMediaDuration(),this.scheduleRender(),this.isUserSelectedMirror)console.log("[PreviewImage] 用户已选择分镜，updateMediaItems中跳过自动渲染第一帧");else{var t=this.isUserSelectedMirror;!(this.mirrorList&&this.mirrorList.length>0)||this.currentMirror&&"empty_mirror"===this.currentMirror.customType||t||setTimeout((function(){e.isUserSelectedMirror?console.log("[PreviewImage] 用户已选择分镜，取消延迟的自动渲染第一帧"):e.currentMirror&&"empty_mirror"===e.currentMirror.customType||e.isUserSelectedMirror}),200)}},updateMediaDuration:function(){if(this.mediaPlayer&&this.rendererInitialized){var e=this.mediaPlayer.recalculateTotalDuration();e!==this.totalDuration&&this.updateTotalDuration(e)}},startPlayback:function(){this.mediaPlayer&&this.rendererInitialized&&this.isPlaying&&(this.updateMediaDuration(),this.mediaPlayer.updateAudioPlayback(),this.mediaPlayer.enableTransition=this.transitionEnabled,this.mediaPlayer.play(this.currentTime),this.startTimeUpdateTimer())},pausePlayback:function(){this.mediaPlayer&&this.rendererInitialized&&(this.mediaPlayer.pause(),this.updateCurrentMirrorByTime(this.currentTime))},stopPlayback:function(){this.mediaPlayer&&this.rendererInitialized&&(this.mediaPlayer.stop(),this.setCurrentTime(0))},renderCurrentFrame:function(){this.mediaPlayer&&this.rendererInitialized?(this.updateLayout(),this.scheduleRender()):this.initializeMediaPlayer()},smoothRenderWithResize:function(e,t){if(this.$refs.canvas){var canvas=this.$refs.canvas;if(canvas.width!==e||canvas.height!==t){var n=document.createElement("canvas"),o=n.getContext("2d");n.width=canvas.width,n.height=canvas.height,o.drawImage(canvas,0,0),canvas.width=e,canvas.height=t;var r=canvas.getContext("2d");if(r.clearRect(0,0,e,t),n.width>0&&n.height>0){var l,d,c=n.width/n.height,v=0,m=0;e/t>c?v=(e-(l=(d=t)*c))/2:m=(t-(d=(l=e)/c))/2,r.drawImage(n,v,m,l,d)}this.mediaPlayer&&this.rendererInitialized&&(this.mediaPlayer.containerWidth=e,this.mediaPlayer.containerHeight=t)}}},setAudioMute:function(e,t){this.mediaPlayer&&this.rendererInitialized&&this.mediaPlayer.setAudioMute(e,t)},setAudioVolume:function(e,t){this.mediaPlayer&&this.rendererInitialized&&this.mediaPlayer.setAudioVolume(e,t)},startTimeUpdateTimer:function(){var e=this;this.stopTimeUpdateTimer(),this.timeUpdateTimer=setInterval((function(){if(e.mediaPlayer&&e.rendererInitialized&&e.isPlaying){var t=e.mediaPlayer.currentTime;Math.abs(t-e.currentTime)>.05&&e.setCurrentTime(t)}}),50)},stopTimeUpdateTimer:function(){this.timeUpdateTimer&&(clearInterval(this.timeUpdateTimer),this.timeUpdateTimer=null)},updateCurrentMirrorByTime:function(time){if(this.mediaPlayer&&this.rendererInitialized&&this.mirrorList&&0!==this.mirrorList.length){var e=this.mediaPlayer.getMirrorIndexAtTime(time);if(-1!==e&&e<this.mirrorList.length){var t=this.mirrorList[e];!t||this.currentMirror&&this.currentMirror.key===t.key||this.setCurrentMirror(t)}}}})},H=G,J=(n(5448),Object(_.a)(H,(function(){var e,t=this,n=t._self._c;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.canvasLoading,expression:"canvasLoading"}],ref:"container",staticClass:"preview-image-container"},[!t.projectId||null!==(e=t.currentMirror)&&void 0!==e&&e.id?t._e():n("div",{staticClass:"preview-image-container-title"},[t._v(t._s(t.$t("selectMirror")))]),t._v(" "),n("div",{ref:"previewImage",staticClass:"preview-image"}),t._v(" "),n("canvas",{ref:"canvas",staticClass:"preview-image-canvas"})])}),[],!1,null,"1b470708",null).exports),W=(n(65),n(277)),K=n.n(W),X={name:"MirrorItemActions",props:{item:{type:Object,required:!0},activePopoverId:{type:[Number,String],default:null}},data:function(){return{actionList:[{title:"canvas_tailor_hover",type:"Cropping"},{title:"leadingOut",type:"Export"},{title:"CopyPrompts",type:"Copy"},{title:"canvas_delete_hover",type:"Delete"}],visiblePopover:!1}},computed:{newActionList:function(){return"empty_mirror"===this.item.customType?[{title:"canvas_delete_hover",type:"Delete"}]:2===this.item.material_type?this.actionList.filter((function(e){return"Export"!==e.type})):this.actionList}},watch:{activePopoverId:function(e){e!==this.item.key&&(this.visiblePopover=!1,this.visiblePopover=!1)}},methods:{handleAction:function(e){this.$emit("action",e)},onPopoverShow:function(){this.$emit("popover-show",this.item.key)}}},Y=(n(5449),n(5450),Object(_.a)(X,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"mirror-item-actions"},[t("el-popover",{attrs:{trigger:"click","popper-class":"editor-action-pop",placement:"top",width:"160"},on:{show:e.onPopoverShow},model:{value:e.visiblePopover,callback:function(t){e.visiblePopover=t},expression:"visiblePopover"}},[t("div",{staticClass:"action-list"},e._l(e.newActionList,(function(n){return t("div",{key:n.type,staticClass:"action-item",on:{click:function(t){return e.handleAction(n.type)}}},[e._v("\n        "+e._s(e.$t(n.title))+"\n      ")])})),0),e._v(" "),t("div",{staticClass:"more-action",attrs:{slot:"reference"},slot:"reference"},[t("i",{staticClass:"iconfont icon-more1"})])])],1)}),[],!1,null,"a14f47be",null).exports),Q=(n(77),{name:"TimeSlider",props:{item:{type:Object,required:!0},totalTime:{type:Number,required:!0}},components:{VueRangeSlider:function(){return n.e(182).then(n.bind(null,6394))}},data:function(){return{value:[this.item.clipInfo.startTime,this.item.clipInfo.endTime]}},mounted:function(){Promise.all([n.e(2),n.e(4),n.e(1),n.e(15),n.e(11),n.e(10),n.e(13),n.e(0),n.e(7),n.e(14),n.e(3),n.e(5),n.e(6),n.e(12),n.e(9),n.e(8),n.e(16)]).then(n.t.bind(null,5717,7))},methods:{getTimeDiff:function(){return(this.value[1]-this.value[0]).toFixed(1)},handleSlideEnd:function(e){this.value=e,this.value[1]-this.value[0]==0&&(this.value[0]>=this.totalTime?this.value[0]=this.totalTime-1:(this.value[1]=this.value[0]+1,this.value[1]>this.totalTime&&(this.value[1]=this.totalTime,this.value[0]=this.totalTime-1))),this.$emit("update:value",this.value)}}}),Z=(n(5451),Object(_.a)(Q,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"time-slider"},[t("div",{staticClass:"time-slider-container"},[t("div",{staticClass:"frames-container"},[e._t("default")],2),e._v(" "),t("vue-range-slider",{attrs:{value:e.value,min:0,max:e.totalTime,interval:.1,enableCross:!0,tooltip:"always"},on:{"slide-end":e.handleSlideEnd}},[t("div",{staticClass:"diy-tooltip",attrs:{slot:"tooltip"},slot:"tooltip"},[e._v(e._s(e.getTimeDiff())+"s")])])],1)])}),[],!1,null,"3c153392",null).exports),ee={components:{CropModal:y,TimeSlider:Z},props:{item:{type:Object,required:!0}},data:function(){return{startTime:this.item.clipInfo.startTime,endTime:this.item.clipInfo.endTime}},methods:{handleTimeChange:function(e){var t=Object(d.a)(e,2),n=t[0],o=t[1];this.startTime=n,this.endTime=o},formatTime:function(e){if(!e&&0!==e)return"00:00";var t=Math.floor(e/60),n=Math.floor(e%60);return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))},handleConfirm:function(){this.$emit("confirm",{startTime:0,endTime:this.endTime-this.startTime,item:this.item})},handleClose:function(){this.$emit("close")}}},te=(n(5452),Object(_.a)(ee,(function(){var e=this,t=e._self._c;return t("CropModal",{on:{confirm:e.handleConfirm,close:e.handleClose}},[t("div",{staticClass:"preview-image"},[t("img",{attrs:{src:e.item.cover,alt:""}})]),e._v(" "),t("TimeSlider",{attrs:{item:e.item,"total-time":0==e.item.duration?3:5*e.item.duration},on:{"update:value":e.handleTimeChange}},[t("div",{staticClass:"video-frames",style:{backgroundImage:"url(".concat(e.item.cover,")")}})])],1)}),[],!1,null,"104dc40e",null).exports),ie=(n(69),n(122),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),{components:{CropModal:y,TimeSlider:Z},props:{item:{type:Object,required:!0},frames:{type:Array,required:!0},blobUrl:{type:String,required:!0}},data:function(){return{startTime:this.item.clipInfo.startTime,endTime:this.item.clipInfo.endTime,isPlaying:!1,currentTime:"00:00:00"}},computed:{totalDuration:function(){var e=this.endTime-this.startTime,t=Math.round(100*e),n=Math.floor(t/36e4),o=Math.floor(t%36e4/6e3),r=Math.floor(t%6e3/100),l=t%100;return this.formatTimeDisplay(n,o,r,l)}},mounted:function(){var e=this;this.$nextTick((function(){var video=e.$refs.videoPreview;video.currentTime=e.startTime,video.addEventListener("timeupdate",e.handleTimeUpdate),video.addEventListener("ended",e.handleVideoEnded),video.addEventListener("loadedmetadata",e.handleVideoMetadataLoaded)}))},beforeDestroy:function(){var video=this.$refs.videoPreview;video&&(video.removeEventListener("timeupdate",this.handleTimeUpdate),video.removeEventListener("ended",this.handleVideoEnded),video.removeEventListener("loadedmetadata",this.handleVideoMetadataLoaded))},methods:{formatTimeDisplay:function(e,t,n,o){return e>0?"".concat(e.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0"))},handleVideoMetadataLoaded:function(){this.drawFramesToCanvas(this.$refs.canvasFrames)},drawFramesToCanvas:function(canvas){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,l,d,video,c,v,m,h,f,_,y,i,C,T,w,x,S,img,I,O,k,M,P;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(canvas&&canvas instanceof HTMLCanvasElement){t.next=2;break}return t.abrupt("return");case 2:if(n=canvas.parentElement.clientWidth||640,r=56,l=window.devicePixelRatio||1,canvas.style.width="".concat(n,"px"),canvas.style.height="".concat(r,"px"),canvas.width=Math.round(n*l),canvas.height=Math.round(r*l),(d=canvas.getContext("2d")).clearRect(0,0,canvas.width,canvas.height),d.scale(l,l),d.imageSmoothingEnabled=!1,d.fillStyle="#10151f",d.fillRect(0,0,n,r),video=e.$refs.videoPreview){t.next=18;break}return t.abrupt("return");case 18:if(c=video.videoWidth&&video.videoHeight?video.videoWidth/video.videoHeight:16/9,v=Math.round(r*c),t.prev=20,0!==(m=e.frames.length)){t.next=24;break}return t.abrupt("return");case 24:if(h=Math.ceil(n/v),f=Math.max(1,Math.min(m,h+1)),_=[],m<=f)_=Array.from({length:m},(function(e,i){return i}));else{if(_.push(0),f>2)for(y=(m-2)/(f-2),i=1;i<f-1;i++)C=Math.round(1+i*y),_.push(C);f>1&&_.push(m-1)}return _=Object(o.a)(new Set(_)).sort((function(a,b){return a-b})),T=_.map((function(t){return new Promise((function(n){var img=new Image;img.onload=function(){return n({img:img,index:t})},img.onerror=function(){n({img:null,index:t})},img.src=e.frames[t]}))})),t.next=32,Promise.all(T);case 32:w=t.sent,x=0;case 34:if(!(x<w.length)){t.next=45;break}if(S=w[x],img=S.img,S.index,img){t.next=38;break}return t.abrupt("continue",42);case 38:if(!((I=x*v)>n+v)){t.next=41;break}return t.abrupt("break",45);case 41:d.drawImage(img,0,0,img.width,img.height,I,0,v,r);case 42:x++,t.next=34;break;case 45:(O=w.length-1)>=0&&(k=O*v,(M=Math.min(n-v,k+v))>=0&&M<n&&(P=w[O].img)&&d.drawImage(P,0,0,P.width,P.height,M,0,v,r)),t.next=52;break;case 49:t.prev=49,t.t0=t.catch(20),console.error("绘制视频帧时出错:",t.t0);case 52:case"end":return t.stop()}}),t,null,[[20,49]])})))()},handleTimeChange:function(e){var t=Object(d.a)(e,2),n=t[0],o=t[1];this.startTime=n,this.endTime=o;var video=this.$refs.videoPreview;video&&(video.currentTime=this.startTime,this.isPlaying&&(video.pause(),this.isPlaying=!1))},handleTimeUpdate:function(){var video=this.$refs.videoPreview;if(video.currentTime>=this.endTime-.05)return video.pause(),this.isPlaying=!1,void(this.currentTime=this.totalDuration);var e=video.currentTime-this.startTime,t=Math.round(100*e),n=Math.floor(t/36e4),o=Math.floor(t%36e4/6e3),r=Math.floor(t%6e3/100),l=t%100;this.currentTime=this.formatTimeDisplay(n,o,r,l)},handleVideoEnded:function(){this.$refs.videoPreview.currentTime=this.startTime,this.isPlaying=!1},handleConfirm:function(){this.$emit("confirm",{startTime:this.startTime,endTime:this.endTime,item:this.item})},handleClose:function(){this.$emit("close")},handlePlay:function(){this.isPlaying=!this.isPlaying;var video=this.$refs.videoPreview;this.isPlaying?((video.currentTime<this.startTime||video.currentTime>=this.endTime)&&(video.currentTime=this.startTime),video.play()):video.pause()}}}),ne=(n(5453),Object(_.a)(ie,(function(){var e=this,t=e._self._c;return t("CropModal",{on:{confirm:e.handleConfirm,close:e.handleClose}},[t("div",{staticClass:"preview-image"},[t("video",{ref:"videoPreview",staticClass:"video-preview",attrs:{src:e.blobUrl,controls:!1,autoplay:!1}})]),e._v(" "),t("div",{staticClass:"video-controls"},[t("i",{staticClass:"iconfont",class:{"icon-zanting1":!e.isPlaying,"icon-bofangz":e.isPlaying},on:{click:e.handlePlay}}),e._v(" "),t("div",{staticClass:"time"},[t("span",{staticClass:"current-time"},[e._v(e._s(e.currentTime))]),e._v(" "),t("span",{staticClass:"separator"},[e._v("|")]),e._v(" "),t("span",{staticClass:"total-time"},[e._v(e._s(e.totalDuration))])])]),e._v(" "),t("TimeSlider",{attrs:{item:e.item,"total-time":e.item.duration},on:{"update:value":e.handleTimeChange}},[t("canvas",{ref:"canvasFrames",staticClass:"video-frames"})])],1)}),[],!1,null,"285f3976",null).exports),oe=n(161),ae=n(83),re=n(267),se=n(516),le=n(631);function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ue={name:"MirrorList",components:{draggable:K.a,MirrorItemActions:Y,HyUploadMoald:ae.default},mixins:[se.a],data:function(){return{localMirrorList:[],btnConfig:{upscale:{name:"OriginalityUpscale",icon:"icon-u1",key:"upscale"},variation:{name:"Variations",icon:"icon-v",key:"variation"},extraUpscale:{name:"taskTabUpscale",icon:"icon-icon-HD",key:"extraUpscale"},img2video:{name:"ImageToVideo",icon:"icon-a-icon-VideoGeneration",key:"img2video"},videoExtend:{name:"videoProlong",icon:"icon-a-Videoextension",key:"videoExtend"}},selectItem:null,framesCache:{},activePopoverId:null,scrollIntervalId:null}},computed:ce({},Object(c.e)("videoEditor",["currentMirror","mirrorLoading","isLeavingPage"])),watch:{mirrorList:{handler:function(e){var t=this;e&&e.length>0?(this.localMirrorList=Object(o.a)(e),this.currentMirror&&this.localMirrorList.some((function(e){return t.currentMirror.key===e.key}))||this.setCurrentMirror(e[0])):(this.localMirrorList=[],this.setCurrentMirror(null))},deep:!0,immediate:!0}},methods:ce(ce({},Object(c.b)("videoEditor",["setCurrentMirror","setIsPlaying","setCurrentTime","setMirrorLoading","setIsUserSelectedMirror"])),{},{handlePopoverShow:function(e){this.activePopoverId=e},generateBtn:function(e){var t,n=this,o=e.operation_labels.filter((function(label){return n.btnConfig[label]}));return this.$t(null===(t=this.btnConfig[o[0]])||void 0===t?void 0:t.name)||""},getBtnList:function(e){var t=this;return e.operation_labels.filter((function(label){return t.btnConfig[label]}))},handleDragEnd:function(){var e=this;(this.setMirrorList(Object(o.a)(this.localMirrorList)),this.clearScrollInterval(),this.currentMirror)&&(-1!==this.localMirrorList.findIndex((function(t){return t.key===e.currentMirror.key}))&&this.setCurrentTime(this.calculateStartTime(this.currentMirror)))},handleMove:function(e){var t=this,n=document.querySelector(".scrollbar-container");if(!n)return!0;var o=e.originalEvent.clientX,r=n.getBoundingClientRect(),l=200,d=o-r.left,c=r.right-o;if(this.scrollIntervalId&&(clearInterval(this.scrollIntervalId),this.scrollIntervalId=null),d<l){var v=120+240*Math.pow(1-d/l,1.2);n.scrollLeft-=v;this.scrollIntervalId=requestAnimationFrame((function e(){n.scrollLeft-=v,n.scrollLeft-=v,t.scrollIntervalId&&(t.scrollIntervalId=requestAnimationFrame(e))}))}else if(c<l){var m=120+240*Math.pow(1-c/l,1.2);n.scrollLeft+=m;this.scrollIntervalId=requestAnimationFrame((function e(){n.scrollLeft+=m,n.scrollLeft+=m,t.scrollIntervalId&&(t.scrollIntervalId=requestAnimationFrame(e))}))}return!0},clearScrollInterval:function(){this.scrollIntervalId&&(cancelAnimationFrame(this.scrollIntervalId),this.scrollIntervalId=null)},diffTime:function(e){if(!e)return"00:00";var t=e.startTime||0,n=(e.endTime||0)-t,o=Math.floor(n/3600),r=Math.floor(n%3600/60),l=Math.floor(n%60),d=function(e){return e<10?"0".concat(e):"".concat(e)};return o>0?"".concat(d(o),":").concat(d(r),":").concat(d(l)):"".concat(d(r),":").concat(d(l))},handleClickItem:function(e){this.activePopoverId=e.key,this.setCurrentMirror(e),this.setIsPlaying(!1),this.setCurrentTime(this.calculateStartTime(e))},calculateStartTime:function(e){var t=this.localMirrorList.findIndex((function(t){return t===e}));return this.localMirrorList.slice(0,t).reduce((function(e,t){return e+(t.clipInfo.endTime-t.clipInfo.startTime)}),0)},handleCreateMirror:function(){var e=this,t={customType:"empty_mirror",duration:3,clipInfo:{startTime:0,endTime:3},key:(new Date).getTime().toString()};this.localMirrorList.push(t),this.$nextTick((function(){e.setMirrorList(Object(o.a)(e.localMirrorList)),e.setCurrentMirror(t)}))},handleAction:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function l(){var d;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:d={Cropping:function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){var r,l,d,c,v,m,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],l="","video"!==t.type){e.next=22;break}return e.next=5,Object(re.getResourceFromIndexedDB)(t.original);case 5:if(d=e.sent){e.next=8;break}return e.abrupt("return");case 8:if(l=URL.createObjectURL(d.blob),c=window.innerWidth,v="".concat(t.original,"_").concat(t.duration,"_").concat(c),!n.framesCache[v]){e.next=15;break}r=n.framesCache[v],e.next=22;break;case 15:return e.next=17,n.calculateOptimalFrameCount(l);case 17:return m=e.sent,e.next=20,Object(re.extractFrames)(l,m,t.duration);case 20:r=e.sent,n.framesCache[v]=r;case 22:h=Object(oe.a)({cached:!1,render:function(e){return e("video"===t.type?ne:te,{props:{item:t,frames:r,blobUrl:l},on:{confirm:function(e){var r=e.startTime,l=e.endTime,d=ce(ce({},t),{},{duration:"video"===t.type?t.duration:Number((l-r).toFixed(1)),clipInfo:{startTime:r,endTime:l}});n.setCurrentMirror(d),n.localMirrorList[n.localMirrorList.findIndex((function(e){return e===t}))]=d,n.setMirrorList(Object(o.a)(n.localMirrorList)),h.close()},close:function(){h.close()}}})}},n);case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Export:function(){fetch(t.original).then((function(e){return e.blob()})).then((function(e){var n=window.URL.createObjectURL(e),a=document.createElement("a");a.style.display="none",a.href=n,a.download=t.title||"download",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a)})).catch((function(e){console.error("下载失败:",e)}))},Copy:function(){var e=JSON.parse(JSON.stringify(t));e.visibility=!1,e.key=(new Date).getTime().toString();var r=n.localMirrorList.findIndex((function(e){return e===t}));r>-1&&(n.localMirrorList.splice(r+1,0,e),n.setCurrentMirror(e),n.setMirrorList(Object(o.a)(n.localMirrorList)))},Delete:function(){var e=n.localMirrorList.findIndex((function(e){return e===t}));e>-1&&(n.localMirrorList.splice(e,1),n.setCurrentMirror(n.localMirrorList[e-1]),n.setMirrorList(Object(o.a)(n.localMirrorList)))}},d[e]();case 2:case"end":return l.stop()}}),l)})))()},handleOpenUploadModal:function(e){this.selectItem=e,this.$refs.hyUploadMoald.openModal()},handleConfirmResult:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,l,d,c,m,h,f,_,y,C,T,w,x;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.setMirrorLoading(!0),n.prev=1,n.next=4,t.ensureMediaServiceInitialized();case 4:if(r=e[0],l=7===r.info.sub_obj_type?"video":"image",7!==r.info.sub_obj_type){n.next=12;break}return n.next=9,Object(re.getVideoDuration)(r.url);case 9:n.t0=n.sent,n.next=13;break;case 12:n.t0=3;case 13:return d=n.t0,c="artwork"===r.info.channel?"artwork_id":"",m={workspace_id:t.projectId,material:[{uri:r.url,duration:d,category:"image"===l?2:8}]},c&&(m.material[0][c]=r.info.obj_parent_no||r.id),n.next=19,Object(v.syncMaterialToPersonalCenter)(m);case 19:if(1e4!==(h=n.sent).status.code){n.next=37;break}return _=null==h||null===(f=h.data)||void 0===f?void 0:f.items[0],y=null==_?void 0:_.components[0],C=(new Date).getTime().toString(),T={key:(new Date).getTime().toString(),id:C,type:l,duration:d,original:r.url,cover:"video"===l?r.info.cover.url:null==y?void 0:y.preview_url,customType:"material",material_type:null==_?void 0:_.material_type,clipInfo:{startTime:0,endTime:d},title:(null==y?void 0:y.title)||"",material_id:(null==y?void 0:y.id)||"",task_id:(null==_?void 0:_.id)||"",operation_labels:(null==y?void 0:y.operation_labels)||[]},-1!==(w=t.mirrorList.findIndex((function(e){return e.key===t.currentMirror.key})))&&((x=Object(o.a)(t.mirrorList))[w]=T,t.setMirrorList(x),t.setCurrentMirror(T),t.setIsUserSelectedMirror(!0)),n.prev=27,n.next=30,le.default.storeResource(r.url,l,{source:"upload",duration:d,addedAt:(new Date).toISOString()});case 30:if("video"!==l||!T.cover){n.next=33;break}return n.next=33,le.default.storeResource(T.cover,"image",{source:"cover",parentUrl:r.url,addedAt:(new Date).toISOString()});case 33:n.next=37;break;case 35:n.prev=35,n.t1=n.catch(27);case 37:n.next=41;break;case 39:n.prev=39,n.t2=n.catch(1);case 41:return n.prev=41,t.setMirrorLoading(!1),n.finish(41);case 44:case"end":return n.stop()}}),n,null,[[1,39,41,44],[27,35]])})))()},handleItemBtnClick:function(e,t){("remix"!==t||e.operation_labels.includes("supportRetry"))&&this.$emit("action",t,e)},calculateOptimalFrameCount:function(e){return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var video=document.createElement("video");video.style.display="none",document.body.appendChild(video),video.onloadedmetadata=function(){var e=video.videoWidth/video.videoHeight,n=.6*window.innerWidth-80,o=56*e,r=Math.ceil(n/o);document.body.removeChild(video),t(Math.max(r,10))},video.onerror=function(){document.body.removeChild(video),t(20)},video.src=e,video.load()})));case 1:case"end":return t.stop()}}),t)})))()}}),beforeDestroy:function(){this.clearScrollInterval()}},ve=ue,me=(n(5454),Object(_.a)(ve,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.mirrorLoading,expression:"mirrorLoading"}],staticClass:"editor-footer-mirror"},[t("div",{staticClass:"mirror-list"},[e.localMirrorList.length>0?t("draggable",{staticClass:"draggable-container",attrs:{scroll:!0,disabled:e.localMirrorList.length<2,"force-fallback":!0,animation:1e3,delay:0,"fallback-tolerance":50,move:e.handleMove},on:{end:e.handleDragEnd},model:{value:e.localMirrorList,callback:function(t){e.localMirrorList=t},expression:"localMirrorList"}},[t("transition-group",{staticClass:"mirror-list-item-container",attrs:{tag:"div",name:"mirror-list"}},e._l(e.localMirrorList,(function(n,o){return t("div",{key:n.key,staticClass:"mirror-list-item",class:{"is-active":e.currentMirror&&e.currentMirror.key===n.key},on:{click:function(t){return t.stopPropagation(),e.handleClickItem(n)}}},[t("div",{staticClass:"mirror-inner"},[t("div",{staticClass:"mirror-top"},[n.cover?t("div",{staticClass:"mirror-material"},[t("img",{attrs:{src:n.cover,alt:""}})]):e._e(),e._v(" "),n.cover?e._e():t("div",{staticClass:"empty-icon"},[t("i",{staticClass:"iconfont icon-a-addimg"})]),e._v(" "),t("div",{staticClass:"mirror-info"},[t("div",{staticClass:"info-item"},[e._v(e._s(e.$t("Storyboard"))+e._s(o+1))]),e._v(" "),"video"===n.type?t("div",{staticClass:"info-item"},[e._v("\n                  "+e._s(e.diffTime(n.clipInfo))+"\n                ")]):e._e()]),e._v(" "),t("mirror-item-actions",{attrs:{item:n,activePopoverId:e.activePopoverId},on:{action:function(t){return e.handleAction(t,n)},"popover-show":e.handlePopoverShow}})],1),e._v(" "),"empty_mirror"===n.customType?t("div",{staticClass:"select-material",on:{click:function(t){return e.handleOpenUploadModal(n)}}},[e._v("\n              "+e._s(e.$t("SelectMaterials"))+"\n            ")]):t("div",{staticClass:"btn-box"},[t("div",{staticClass:"btn remix-btn",class:{"remix-btn-disabled":!n.operation_labels.includes("supportRetry")},on:{click:function(t){return e.handleItemBtnClick(n,"remix")}}},[e._v("\n                "+e._s(e.$t("Remix"))+"\n              ")]),e._v(" "),n.operation_labels.length>1?t("div",{staticClass:"btn",on:{click:function(t){e.handleItemBtnClick(n,e.getBtnList(n)[0])}}},[t("span",[e._v(e._s(e.generateBtn(n)))])]):e._e()])])])})),0)],1):e._e(),e._v(" "),e.localMirrorList.length<20?t("div",{staticClass:"mirror-list-item create-empty-mirror",on:{click:e.handleCreateMirror}},[e._m(0)]):e._e()],1),e._v(" "),t("HyUploadMoald",{ref:"hyUploadMoald",attrs:{isSingleSelect:"",category:2,videoCategory:61,"file-types":["image","video"],uploadObj:{limit:1,multiple:!1},"before-upload":e.handleBeforeUpload},on:{onConfirm:e.handleConfirmResult}})],1)}),[function(){var e=this._self._c;return e("div",{staticClass:"create-empty-mirror-icon"},[e("i",{staticClass:"iconfont icon-add-icon"})])}],!1,null,"55d1d20c",null).exports),pe=n(3479);function he(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?he(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge={name:"PlaybackControls",computed:fe(fe({},Object(c.e)("videoEditor",["isPlaying","currentTime","audioLoading","mirrorList","mirrorLoading"])),Object(c.c)("videoEditor",["totalDuration"])),methods:fe(fe({},Object(c.b)("videoEditor",["setIsPlaying"])),{},{handlePlay:function(){this.mirrorLoading||this.audioLoading||(this.setIsPlaying(!this.isPlaying),this.$logEvent("log_actions",{operation:"click_play_video",behavior_info:"on_video_edit_createflow_page",behavior_info_sub:"on_buttom"}))},formatTime:pe.b})},_e=(n(5455),Object(_.a)(ge,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"playback-controls"},[t("div",{staticClass:"control-btn",class:{disabled:e.totalDuration<=0||e.mirrorLoading||e.audioLoading},on:{click:e.handlePlay}},[t("i",{staticClass:"iconfont",class:{"icon-zanting1":!e.isPlaying,"icon-bofangz":e.isPlaying}})]),e._v(" "),t("div",{staticClass:"time"},[t("span",{staticClass:"current-time"},[e._v(e._s(e.formatTime(e.currentTime)))]),e._v(" "),t("span",{staticClass:"total-time"},[e._v("/ "+e._s(e.formatTime(e.totalDuration)))])])])}),[],!1,null,"6037f362",null).exports),be=n(584);function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Te={name:"UploadTools",components:{HyUploadMoald:ae.default},mixins:[se.a],data:function(){return{mediaServiceInitialized:!1}},computed:Ce({},Object(c.e)("videoEditor",["audioList"])),methods:Ce(Ce({},Object(c.b)("videoEditor",["setAudioList","setAudioLoading","setIsPlaying"])),{},{ensureMediaServiceInitialized:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.mediaServiceInitialized){t.next=10;break}return t.prev=1,t.next=4,le.default.init();case 4:e.mediaServiceInitialized=!0,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),console.error("初始化媒体资源服务失败:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[1,7]])})))()},handleUpload:function(){this.setIsPlaying(!1),this.mirrorList.length>=20?this.$message.warning(this.$t("maxUploadCount")):(this.$refs.hyUploadMoald.openModal(),this.$logEvent("log_actions",{operation:"click_add_resource",behavior_info:"on_video_edit_createflow_page",behavior_info_sub:"on_buttom"}))},handleConfirmResult:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.mirrorList.length+e.length>20)){n.next=3;break}return t.$message.warning(t.$t("maxUploadCount")),n.abrupt("return");case 3:return o=t.$store.state.videoEditor.currentMirror,n.next=6,t.handleConfirm(e);case 6:null!=o&&o.key&&(r=t.$store.state.videoEditor.mirrorList.find((function(e){return e.key===o.key})))&&t.$store.dispatch("videoEditor/setCurrentMirror",r);case 7:case"end":return n.stop()}}),n)})))()},handleAudioUpload:function(){this.setIsPlaying(!1),this.$logEvent("log_actions",{operation:"click_add_voice",behavior_info:"on_video_edit_createflow_page",behavior_info_sub:"on_buttom"})},handleAudioChange:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,l,d,c,m,h,f,_,y,C,T,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.audioList.length>=3)){n.next=3;break}return t.$message.warning(t.$t("maxUploadAudioCount")),n.abrupt("return");case 3:return n.next=5,Object(re.getAudioDuration)(e);case 5:if(!((r=n.sent)>900)){n.next=9;break}return t.$message.warning(t.$t("maxUploadAudioDuration")),n.abrupt("return");case 9:return t.setAudioLoading(!0),n.prev=10,n.next=13,t.ensureMediaServiceInitialized();case 13:return l=new be.a({file:e,category:59,maxSize:157286400}),n.next=16,l.beforeUpload();case 16:return d=n.sent,c=d.url,m=void 0===c?"":c,n.next=21,Object(v.syncMaterialToPersonalCenter)({workspace_id:t.projectId,material:[{uri:m,duration:r,category:59,mime_type:e.type,name:e.name}]});case 21:if(1e4!==(h=n.sent).status.code){n.next=36;break}return _=null==h||null===(f=h.data)||void 0===f?void 0:f.items[0],y=null==_?void 0:_.components[0],C={id:(new Date).getTime().toString(),name:e.name,type:"audio",original:m,blob:m,duration:r,originalDuration:r,isMute:!1,title:(null==y?void 0:y.title)||"",material_id:(null==y?void 0:y.id)||"",task_id:(null==_?void 0:_.id)||"",startTime:0,clipInfo:{startTime:0,endTime:r}},T=t.audioList||[],w=[].concat(Object(o.a)(T),[C]),t.setAudioList(w),n.prev=29,n.next=32,le.default.storeResource(m,"audio",{source:"audio-upload",fileName:e.name,duration:r,addedAt:(new Date).toISOString()});case 32:n.next=36;break;case 34:n.prev=34,n.t0=n.catch(29);case 36:n.next=41;break;case 38:n.prev=38,n.t1=n.catch(10),t.$message.error(t.$t("AudioProcessFailed"));case 41:return n.prev=41,t.setAudioLoading(!1),n.finish(41);case 44:case"end":return n.stop()}}),n,null,[[10,38,41,44],[29,34]])})))()}})},we=(n(5456),Object(_.a)(Te,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"upload-tools"},[t("div",{staticClass:"upload-item",class:{disabled:e.mirrorList.length>=20},attrs:{"data-event":"video_editor_upload_img"},on:{click:e.handleUpload}},[t("i",{staticClass:"iconfont icon-a-addimg"}),e._v(" "),t("span",[e._v(e._s(e.$t("AddMaterials")))])]),e._v(" "),t("div",{staticClass:"upload-item",class:{disabled:e.audioList.length>=3},attrs:{"data-event":"video_editor_upload_audio"},on:{click:e.handleAudioUpload}},[t("el-upload",{ref:"audioUpload",staticClass:"upload",attrs:{action:"","before-upload":e.handleAudioChange,"show-file-list":!1,accept:".mp3,.wav,.flac,.aac,.m4a,.ogg,.webm"}},[t("i",{staticClass:"iconfont icon-a-addaudio"}),e._v(" "),t("span",[e._v(e._s(e.$t("AddAudio")))])])],1),e._v(" "),t("HyUploadMoald",{ref:"hyUploadMoald",attrs:{isMultiSelect:"",category:2,videoCategory:61,"file-types":["image","video"],uploadObj:{limit:5,multiple:!0},"before-upload":e.handleBeforeUpload},on:{onConfirm:e.handleConfirmResult}})],1)}),[],!1,null,"02697b98",null).exports),xe=(n(92),{props:{side:{type:String,required:!0,validator:function(e){return["left","right"].includes(e)}},disabled:{type:Boolean,default:!1},dragDirection:{type:String,default:"both",validator:function(e){return["left","right","both","none"].includes(e)}}},computed:{handleClass:function(){return"".concat(this.side,"-handle")},cursorStyle:function(){if(this.disabled)return{cursor:"not-allowed"};var cursor="default";return("left"===this.side||"right"===this.side)&&("left"===this.dragDirection?cursor="w-resize":"right"===this.dragDirection?cursor="e-resize":"both"===this.dragDirection&&(cursor="ew-resize")),{cursor:cursor}}},methods:{handleMouseDown:function(e){this.disabled||(e.stopPropagation(),this.$emit("mousedown",e))}}}),Se=(n(5457),Object(_.a)(xe,(function(){var e=this;return(0,e._self._c)("div",{staticClass:"resize-handle",class:[e.handleClass,{disabled:e.disabled}],style:e.cursorStyle,on:{mousedown:e.handleMouseDown}})}),[],!1,null,"1137a80e",null).exports),Ie=(n(72),n(89),n(5458));function Oe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,a){if(e){if("string"==typeof e)return ke(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ke(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,l=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function ke(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=Array(a);t<a;t++)n[t]=e[t];return n}var Me={props:{audio:{type:Object,required:!0},index:{type:Number,required:!0}},data:function(){return{observer:null,lastWidth:0}},mounted:function(){this.initWaveform(),this.setupResizeObserver()},beforeDestroy:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},updated:function(){this.initWaveform()},methods:{initWaveform:function(){var canvas=this.$refs["audioCanvas".concat(this.index)];canvas&&(this.lastWidth=canvas.offsetWidth,Object(Ie.a)(canvas,this.audio))},setupResizeObserver:function(){var e=this;if(window.ResizeObserver){this.observer=new ResizeObserver((function(t){var n,o=Oe(t);try{for(o.s();!(n=o.n()).done;){var r=n.value.contentRect.width;Math.abs(r-e.lastWidth)>2&&(e.lastWidth=r,e.initWaveform())}}catch(e){o.e(e)}finally{o.f()}}));var canvas=this.$refs["audioCanvas".concat(this.index)];canvas&&this.observer.observe(canvas)}}},watch:{audio:{handler:function(){var e=this;this.$nextTick((function(){e.initWaveform()}))},deep:!0}}},Pe=(n(5459),Object(_.a)(Me,(function(){return(0,this._self._c)("canvas",{ref:"audioCanvas".concat(this.index),staticClass:"audio-waveform"})}),[],!1,null,"a39c4f56",null).exports),Le=n(432);function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e={components:{ResizeHandle:Se,AudioWaveform:Pe},props:{audio:{type:Object,required:!0},index:{type:Number,required:!0},isDragging:{type:Boolean,default:!1},isResizing:{type:Boolean,default:!1},minAudioWidth:{type:Number,default:1},maxAudioWidth:{type:Number,default:1/0},widthPerSecond:{type:Number,default:20}},data:function(){return{relatedMirrorInfo:{mirror:null,mirrorElement:null},audioStartTime:0,audioEndTime:0,audioManager:null}},computed:Ee(Ee({},Object(c.e)("videoEditor",["mirrorList","isPlaying","currentTime","totalDuration"])),{},{mirrorListTimes:function(){return this.mirrorList.map((function(e){var t=0;return e.clipInfo&&(t=parseFloat(e.clipInfo.endTime)-parseFloat(e.clipInfo.startTime)||0),t}))},itemStyle:function(){var e,t,n=(null===(e=this.audio.position)||void 0===e?void 0:e.x)||0;return{left:n+"px",top:((null===(t=this.audio.position)||void 0===t?void 0:t.y)||0)+"px",width:Object(Le.a)(this.mirrorListTimes,this.audio.duration||0,n,10,227)+"px"}},itemClass:function(){return{"is-dragging":this.isDragging,"is-resizing":this.isResizing,"is-clipped":this.showClipIndicator,"can-resize":this.canResize,"cannot-resize":!this.canResize}},showClipIndicator:function(){return this.audio.clipInfo&&(this.audio.clipInfo.startTime>0||this.audio.clipInfo.endTime<this.audio.duration)},startClipWidth:function(){return this.audio.clipInfo.startTime/this.audio.duration*100+"%"},endClipWidth:function(){return(this.audio.duration-this.audio.clipInfo.endTime)/this.audio.duration*100+"%"},audioName:function(){return Object(Le.f)(this.audio)},formattedDuration:function(){return Object(Le.d)(Object(Le.e)(this.audio))},muteIconClass:function(){return this.audio.isMute?"icon-jingyin":"icon-sound1"},showResizeHandles:function(){var e;return(this.audio._lastCalculatedWidth||Object(Le.a)(this.mirrorListTimes,this.audio.duration||0,(null===(e=this.audio.position)||void 0===e?void 0:e.x)||0,10,227))>5},canResize:function(){var e;return!!this.audio&&!((this.audio._lastCalculatedWidth||Object(Le.a)(this.mirrorListTimes,this.audio.duration||0,(null===(e=this.audio.position)||void 0===e?void 0:e.x)||0,10,227))<=5)},canResizeLeft:function(){var e,t;if(!this.audio)return!1;var n=(null===(e=this.audio.clipInfo)||void 0===e?void 0:e.startTime)||0;return!(((null===(t=this.audio.clipInfo)||void 0===t?void 0:t.endTime)||this.audio.duration)-n<=1)||n>0},canResizeRight:function(){var e,t;if(!this.audio)return!1;var n=(null===(e=this.audio.clipInfo)||void 0===e?void 0:e.startTime)||0,o=(null===(t=this.audio.clipInfo)||void 0===t?void 0:t.endTime)||this.audio.duration,r=o-n,l=this.audio.originalDuration||this.audio.duration;return!(r<=1)||o<l},audioId:function(){return this.audio.id||this.audio.original},leftHandleDragDirection:function(){var e,t;if(!this.audio||!this.canResizeLeft)return"none";var n=(null===(e=this.audio.clipInfo)||void 0===e?void 0:e.startTime)||0,o=((null===(t=this.audio.clipInfo)||void 0===t?void 0:t.endTime)||this.audio.duration)-n;this.audio.originalDuration||this.audio.duration;return o<=1?"left":n<=0?"right":"both"},rightHandleDragDirection:function(){var e,t;if(!this.audio||!this.canResizeRight)return"none";var n=(null===(e=this.audio.clipInfo)||void 0===e?void 0:e.startTime)||0,o=(null===(t=this.audio.clipInfo)||void 0===t?void 0:t.endTime)||this.audio.duration,r=o-n,l=this.audio.originalDuration||this.audio.duration;return r<=1?"right":o>=l?"left":"both"}}),watch:{"audio.isMute":{handler:function(e){this.audioManager}},"audio.clipInfo":{handler:function(){},deep:!0}},beforeDestroy:function(){this.audioManager&&this.audioManager.dispose()},methods:Ee(Ee({},Object(c.b)("videoEditor",["setCurrentAudio"])),{},{onMouseDown:function(e){2!==e.button&&(this.isResizing||e.target.closest(".audio-item-info-mute")||e.target.closest(".resize-handle")||e.target.closest(".audio-test-button")||(e.stopPropagation(),e.preventDefault(),this.$emit("start-drag",e,this.index)))},onResizeStart:function(e,t){e.stopPropagation(),"left"===t&&!this.canResizeLeft||"right"===t&&!this.canResizeRight||this.$emit("start-resize",e,this.index,t)},showContextMenu:function(e){this.contextMenuX=e.clientX,this.contextMenuY=e.clientY,this.$root.$emit("show-global-right-menu",{x:this.contextMenuX,y:this.contextMenuY,items:[{label:this.$t("Delete"),icon:"iconfont icon-icon-delete",action:"delete"}],onSelect:this.handleContextMenuClick})},handleContextMenuClick:function(e){if("delete"===e.action)this.$emit("delete",this.audio)}})},De=(n(5460),Object(_.a)($e,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"audio-item",class:e.itemClass,style:e.itemStyle,on:{mousedown:e.onMouseDown,contextmenu:function(t){return t.preventDefault(),e.showContextMenu.apply(null,arguments)}}},[e.showResizeHandles?t("resize-handle",{attrs:{side:"left",disabled:!e.canResizeLeft,"drag-direction":e.leftHandleDragDirection},on:{mousedown:function(t){return e.onResizeStart(t,"left")}}}):e._e(),e._v(" "),t("div",{staticClass:"audio-item-background"},[t("audio-waveform",{attrs:{audio:e.audio,index:e.index}})],1),e._v(" "),t("div",{staticClass:"audio-item-info"},[t("i",{staticClass:"iconfont icon-audio-m"}),e._v(" "),t("div",{staticClass:"audio-item-info-name"},[e._v(e._s(e.audioName))]),e._v(" "),t("div",{staticClass:"audio-item-info-duration"},[e._v(e._s(e.formattedDuration))]),e._v(" "),t("i",{staticClass:"iconfont audio-item-info-mute",class:e.muteIconClass,on:{click:function(t){return t.stopPropagation(),e.$emit("toggle-mute",e.index)}}})]),e._v(" "),e.showResizeHandles?t("resize-handle",{attrs:{side:"right",disabled:!e.canResizeRight,"drag-direction":e.rightHandleDragDirection},on:{mousedown:function(t){return e.onResizeStart(t,"right")}}}):e._e()],1)}),[],!1,null,"4488f9d6",null)),Re=De.exports,Ve=n(5461),Ae=n(5462);function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fe={name:"AudioList",components:{AudioItem:Re},mixins:[Ve.a,Ae.a],data:function(){return{containerHeight:40,audioItemHeight:32,audioItemSpacing:8,minAudioWidth:1,maxAudioWidth:1/0,widthPerSecond:75.67}},computed:ze(ze(ze({},Object(c.e)("videoEditor",["audioList","mirrorList","audioLoading","isLeavingPage"])),Object(c.c)("videoEditor",["getMirrorListDuration"])),{},{mirrorListTimes:function(){return this.mirrorList.map((function(e){var t=0;if(e.clipInfo&&"number"==typeof e.clipInfo.endTime&&"number"==typeof e.clipInfo.startTime)t=e.clipInfo.endTime-e.clipInfo.startTime;else if(e.duration)if("number"==typeof e.duration)t=e.duration;else if("string"==typeof e.duration)if(e.duration.includes(":")){var n=e.duration.split(":");if(2===n.length)t=60*parseFloat(n[0].trim())+parseFloat(n[1].trim())}else t=parseFloat(e.duration)||0;return Math.max(.1,t)}))},getLoadingStyle:function(){var e=this.audioList.reduce((function(e,t){return Math.max(e,t.position.y)}),0);return{top:"".concat(0!==e||this.audioList.length?e+50:0,"px"),height:"40px"}}}),watch:{audioList:{handler:function(){var e=this;this.isResizing||this.isDragging||this.initAudioPositions(),this.$nextTick((function(){e.updateContainerHeight()}))},immediate:!0,deep:!0},getMirrorListDuration:{handler:function(e){var t=this;if(!this.isResizing&&!this.isDragging&&this.audioList&&0!==this.audioList.length){var n=Object(o.a)(this.audioList),r=!1;n.forEach((function(e,o){if(e.position){var l={x:Object(Le.a)(t.mirrorList.map((function(e){return e.clipInfo.endTime-e.clipInfo.startTime})),e.startTime,0,10,227),y:e.position.y};l.x!==e.position.x&&(n[o]=ze(ze({},e),{},{position:l,_lastCalculatedWidth:null}),r=!0)}})),r&&this.setAudioList(n),this.$nextTick((function(){t.updateContainerHeight()}))}},deep:!0}},mounted:function(){this.initAudioPositions(),this.updateContainerHeight()},methods:ze(ze({},Object(c.b)("videoEditor",["setAudioList"])),{},{initAudioPositions:function(){var e=this;if(this.audioList&&0!==this.audioList.length){var t=Object(o.a)(this.audioList),n=!1,r=0;t.forEach((function(e){e.position&&e.position.y>r&&(r=e.position.y)})),t.forEach((function(o,l){if(!o.position){var d={x:0,y:0===t.filter((function(audio){return audio.position})).length?0:r+e.audioItemHeight+e.audioItemSpacing};t[l]=ze(ze({},o),{},{position:d}),r=d.y,n=!0}o.clipInfo||(t[l]=ze(ze({},t[l]),{},{clipInfo:{startTime:0,endTime:o.duration||0}}),n=!0);var c=t[l].clipInfo;c&&(c.endTime<=c.startTime||c.startTime<0)&&(t[l]=ze(ze({},t[l]),{},{clipInfo:{startTime:0,endTime:o.duration||0}}),n=!0)})),n&&this.setAudioList(t)}},findAvailablePosition:function(e){var t=0;return e.length>0?(e.forEach((function(e){e.y>t&&(t=e.y)})),{x:0,y:t+this.audioItemHeight+this.audioItemSpacing}):{x:0,y:0}},updateContainerHeight:function(){var e=this;if(!this.audioList||0===this.audioList.length)return this.containerHeight=40,this.$refs.audioListInnerContainer.style.width="100%",void(this.$refs.audioListContainer.style.minWidth="100%");var t=0,n=0;this.audioList.forEach((function(o){if(o.position&&o.position.y>t&&(t=o.position.y),o.position){var r=o._lastCalculatedWidth||Object(Le.g)(o,{minWidth:e.minAudioWidth,maxWidth:e.maxAudioWidth,widthPerSecond:e.widthPerSecond},e.mirrorListTimes),l=o.position.x+r;l>n&&(n=l)}}));var o=this.audioItemHeight,r=t+this.audioItemHeight+6;this.containerHeight=Math.max(o,r),this.$nextTick((function(){if(e.$refs.audioListInnerContainer&&n>0){var t=n+0+32;e.$refs.audioListInnerContainer.style.width="".concat(n,"px"),e.$refs.audioListContainer&&(e.$refs.audioListContainer.style.minWidth="".concat(t,"px"))}}))},toggleMute:function(e){var t=Object(o.a)(this.audioList);t[e]=ze(ze({},t[e]),{},{isMute:!t[e].isMute}),this.setAudioList(t)},updateAudio:function(e,audio){var t=Object(o.a)(this.audioList);t[e]=ze(ze({},t[e]),audio),this.setAudioList(t)},deleteAudio:function(audio){var e=Object(o.a)(this.audioList),t=e.findIndex((function(e){return e.original===audio.original}));e.splice(t,1),this.setAudioList(e)}})},Ue=(n(5463),Object(_.a)(Fe,(function(){var e=this,t=e._self._c;return t("div",{ref:"audioListContainer",staticClass:"audio-list",style:{height:e.containerHeight+"px"}},[t("div",{ref:"audioListInnerContainer",staticClass:"audio-list-container"},e._l(e.audioList,(function(n,o){return t("audio-item",{key:"".concat(n.original,"-").concat(o),attrs:{audio:n,index:o,"is-dragging":e.currentDragIndex===o,"is-resizing":e.isResizing&&e.currentDragIndex===o,"min-audio-width":e.minAudioWidth,"max-audio-width":e.maxAudioWidth,"width-per-second":e.widthPerSecond},on:{"start-drag":e.startDrag,"start-resize":e.startResize,"toggle-mute":e.toggleMute,"update:audio":function(t){return e.updateAudio(o,t)},delete:e.deleteAudio}})})),1),e._v(" "),e.audioLoading?t("div",{staticClass:"audio-list-loading",style:e.getLoadingStyle},[e._m(0)]):e._e()])}),[function(){var e=this._self._c;return e("div",{staticClass:"loading-spinner"},[e("i",{staticClass:"el-icon-loading"})])}],!1,null,"60f8c92a",null).exports);function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var He={data:function(){return{barPosition:16,containerWidth:0,basePixelsPerSecond:50,isPlayingFinished:!1,isResettingScroll:!1}},computed:Ge(Ge(Ge({},Object(c.e)("videoEditor",["isPlaying","currentTime","mirrorList","audioList"])),Object(c.c)("videoEditor",["totalDuration"])),{},{shouldShowTimeLine:function(){return this.isPlaying&&!this.isPlayingFinished}}),watch:{currentTime:function(e){this.isPlaying&&(this.updateBarPosition(e),e<.1&&this.$refs.scrollbarContainer&&(this.$refs.scrollbarContainer.scrollLeft=0)),this.totalDuration>0&&e>=this.totalDuration-.05?this.isPlaying&&(this.isPlayingFinished=!0,this.setIsPlaying(!1)):e<this.totalDuration-.1&&(this.isPlayingFinished=!1)},isPlaying:function(e){var t=this;e?(this.isPlayingFinished=!1,this.currentTime<.1&&this.$refs.scrollbarContainer&&(this.isResettingScroll=!0,this.$refs.scrollbarContainer.scrollLeft=0,setTimeout((function(){t.isResettingScroll=!1}),100))):this.isResettingScroll=!1},mirrorList:{handler:function(){var e=this;this.$nextTick((function(){e.updateBarPosition(e.currentTime)}))},deep:!0}},mounted:function(){var e=this;this.updateContainerWidth(),window.addEventListener("resize",this.updateContainerWidth),this.$nextTick((function(){e.updateBarPosition(e.currentTime)}))},beforeDestroy:function(){window.removeEventListener("resize",this.updateContainerWidth)},methods:Ge(Ge({},Object(c.b)("videoEditor",["setIsPlaying","updateCurrentTime"])),{},{updateBarPosition:function(e){var t=this;this.barPosition=16+Object(re.getIndicatorPosition)(this.mirrorList,e,void 0,void 0,void 0,this.audioList),this.$nextTick((function(){if(t.$refs.scrollbarContainer&&!t.isResettingScroll){var e=t.$refs.scrollbarContainer,n=e.getBoundingClientRect().width;t.barPosition-e.scrollLeft>n-80&&e.scrollTo({left:e.scrollLeft+861,behavior:"smooth"})}}))},updateContainerWidth:function(){this.$refs.timelineContainer&&(this.containerWidth=this.$refs.timelineContainer.clientWidth)}})},Je=(n(5464),Object(_.a)(He,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"time-line"},[t("div",{ref:"scrollbarContainer",staticClass:"scrollbar-container"},[t("div",{staticClass:"time-line-container-wrapper"},[t("div",{staticClass:"time-line-container"},[e._t("default")],2),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.shouldShowTimeLine,expression:"shouldShowTimeLine"}],staticClass:"time-line-bar",style:{left:"".concat(e.barPosition,"px")}},[t("svg-icon",{staticClass:"time-line-bar-icon",attrs:{"icon-class":"time_line_bar"}}),e._v(" "),t("div",{staticClass:"time-line-bar-line"})],1)])])])}),[],!1,null,"15e80ba9",null)),We=Je.exports;installComponents(Je,{SvgIcon:n(115).default});var Ke={name:"GlobalRightMenu",data:function(){return{visible:!1,menuItems:[],x:0,y:0,onSelect:null,menuWidth:120,menuHeight:0}},computed:{menuStyle:function(){var e=window.innerWidth,t=window.innerHeight,n=this.x,o=this.y,r=n+this.menuWidth>e,l=o+this.menuHeight>t;return r&&(n=e-this.menuWidth),l&&(o=t-this.menuHeight),n=Math.max(0,n),o=Math.max(0,o),{left:"".concat(n,"px"),top:"".concat(o,"px")}}},mounted:function(){document.addEventListener("click",this.handleGlobalClick),this.$root.$on("show-global-right-menu",this.showMenu),document.body.appendChild(this.$el)},beforeDestroy:function(){document.removeEventListener("click",this.handleGlobalClick),this.$root.$off("show-global-right-menu",this.showMenu),this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},methods:{showMenu:function(e){var t=this;this.x=e.x,this.y=e.y,this.menuItems=e.items,this.onSelect=e.onSelect,this.visible=!0,this.$nextTick((function(){var menu=t.$el;menu&&(t.menuWidth=menu.offsetWidth,t.menuHeight=menu.offsetHeight)}))},handleClick:function(e){this.onSelect&&"function"==typeof this.onSelect&&this.onSelect(e),this.visible=!1},handleGlobalClick:function(){this.visible=!1}}},Xe=(n(5465),Object(_.a)(Ke,(function(){var e=this,t=e._self._c;return e.visible?t("div",{staticClass:"global-right-menu",style:e.menuStyle,on:{click:function(e){e.stopPropagation()}}},e._l(e.menuItems,(function(n,o){return t("div",{key:o,staticClass:"global-right-menu-item",on:{click:function(t){return e.handleClick(n)}}},[n.icon?t("i",{class:n.icon}):e._e(),e._v(" "),t("span",[e._v(e._s(n.label))])])})),0):e._e()}),[],!1,null,"1afee194",null).exports),qe={name:"EditorFooter",props:{isCollapsed:{type:Boolean,default:!1}},components:{MirrorList:me,PlaybackControls:_e,UploadTools:we,AudioList:Ue,TimeLine:We,GlobalRightMenu:Xe},data:function(){return{footerHeight:0}},methods:{toggleMirrorList:function(){this.$emit("toggleAnimation")}}},Ye=(n(5466),Object(_.a)(qe,(function(){var e=this,t=e._self._c;return t("div",{ref:"editorFooter",staticClass:"editor-footer"},[t("div",{staticClass:"editor-footer-toggle-btn",on:{click:e.toggleMirrorList}},[t("i",{staticClass:"iconfont icon-a-dropdown",class:{"icon-up":e.isCollapsed}})]),e._v(" "),t("div",{staticClass:"editor-footer-content"},[t("time-line",[t("mirror-list",e._g({key:"mirror-list"},e.$listeners)),e._v(" "),t("audio-list",{key:"audio-list"})],1)],1),e._v(" "),t("div",{staticClass:"footer"},[t("div",{staticClass:"footer-left"},[t("upload-tools")],1),e._v(" "),t("div",{staticClass:"footer-center"},[t("playback-controls")],1),e._v(" "),t("div",{staticClass:"footer-right"})]),e._v(" "),t("global-right-menu")],1)}),[],!1,null,"65df2f21",null).exports),Qe=n(46),Ze=n(29),et=n(9),tt=n(57),it=n(922),nt=n(1153);function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var st={mixins:[nt.a],components:{EditorBtnBoxContainer:z,PreviewImageContainer:J,EditorFooter:Ye,ProlongVideoPop:it.a},data:function(){return{previewImageHeight:0,params:{id:"",source:40001,channel_id:"",model_no:"",model_ver_no:"",components:[],meta:{prompt:"",generate:{gen_mode:0},n_iter:1,aspect_ratio:"9:16",width:480,height:848,generate_video:{img_generate_mode:"img",prompt_magic_mode:2,generate_video_duration:5,relevance:.5,camera_control_option:{mode:"Camera Movement",offset:0},image_opts:[{mode:"first_frame",url:"",width:0,height:0},{mode:"last_frame",url:"",width:0,height:0}],quality_mode:"360p",motion_mode:"",style:""},seed:0,negative_prompt:""}}}},computed:at({},Object(c.e)("videoEditor",["projectId","isCreateNewProject"])),watch:{projectId:function(){this.getEditorInfo()}},mounted:function(){this.getEditorInfo()},methods:at(at({},Object(c.b)("videoEditor",["setEditorId","setCurrentRatio","setMirrorList","setAudioList","setMirrorLoading","setIsCreateNewProject"])),{},{getEditorInfo:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r,l,d,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isCreateNewProject){t.next=3;break}return e.setIsCreateNewProject(!1),t.abrupt("return");case 3:return e.setMirrorLoading(!0),t.next=6,Object(v.getEditorInfo)({workspace_id:e.projectId});case 6:if(1e4!==(n=t.sent).status.code){t.next=33;break}if(!n.data.id){t.next=28;break}if(e.setEditorId(n.data.id),e.setCurrentRatio(n.data.canvas.aspect_ratio||"16:9"),l=(null===(o=n.data.editor_info.storyboards)||void 0===o?void 0:o.map((function(e){return JSON.parse(e.clip_info)})))||[],e.setMirrorList(l),d=(null===(r=n.data.editor_info.audios)||void 0===r?void 0:r.map((function(e){return JSON.parse(e.clip_info)})))||[],e.setAudioList(d),!(0===l.length||1===l.length&&"empty_mirror"===l[0].customType)||0!==d.length){t.next=19;break}return e.setMirrorLoading(!1),t.abrupt("return");case 19:return c=[],l.forEach((function(e){e.original&&c.push(Object(re.storeResourceToIndexedDB)(e.original,e.type)),"video"===e.type&&c.push(Object(re.storeResourceToIndexedDB)(e.cover,"image"))})),d.forEach((function(e){c.push(Object(re.storeResourceToIndexedDB)(e.original,e.type))})),t.next=24,Promise.all(c).catch((function(e){console.error("Error storing resources:",e)}));case 24:e.setMirrorLoading(!1),e.$nextTick((function(){e.$EventBus.$emit("editor-data-loaded")})),t.next=31;break;case 28:e.setMirrorLoading(!1),e.setMirrorList([]),e.setAudioList([]);case 31:t.next=36;break;case 33:e.setMirrorLoading(!1),e.setMirrorList([]),e.setAudioList([]);case 36:case"end":return t.stop()}}),t)})))()},hadnleClick:function(e,t){var n=this;console.log("type",e);var o,l,d={extraUpscale:function(){n.$EventBus.$emit("remixClick",{task_id:t.task_id,action:6,data:{imageUrl:t.cover}})},img2video:function(){n.$EventBus.$emit("openVideoEditorRecModal",t.cover),n.$emit("openCreate")},videoExtend:(l=Object(r.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.handleVideoExpendParams(t);case 2:(o=e.sent)&&n.$refs.prolongVideoPop.open(o);case 4:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),variation:function(){n.$EventBus.$emit("remixClick",{task_id:t.task_id,action:3,init_images:[t.cover]}),n.$emit("openCreate")},upscale:(o=Object(r.a)(regeneratorRuntime.mark((function e(){var o,r,l,d,c,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.$store.dispatch("videoEditor/setCanvasLoading",!0),e.next=3,n.getDetail(t.task_id);case 3:if(!(o=e.sent)){e.next=17;break}return l={channel_id:"",model_no:null==o?void 0:o.art_model_no,model_ver_no:null==o?void 0:o.art_model_ver_no,speed_type:2,meta:(null==o?void 0:o.meta)||{}},d=(null===et.L||void 0===et.L?void 0:et.L.flux)||[],c=d.includes(null==o||null===(r=o.art_model)||void 0===r?void 0:r.base_model),l.source=40001,l.channel_id=n.projectId,l.meta.seed=Object(tt.getRandomSeed)(c),l.meta.init_images=[t.original],e.next=14,Object(Qe.easyImageUpscale)(l);case 14:1e4===(v=e.sent).status.code&&(n.$message.success(n.$t("CreateSuccess")),n.$emit("addTask",v.data)),n.$store.dispatch("videoEditor/setCanvasLoading",!1);case 17:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),remix:function(){t&&t.task_id&&(n.$EventBus.$emit("remixClick",{action:1,task_id:t.task_id,data:{creativity:t.creativity?t.creativity:null}}),n.$emit("openCreate"))}};d[e]()},getDetail:function(e){return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Ze.getMetaInfo)({id:e});case 2:if(1e4!==(n=t.sent).status.code){t.next=5;break}return t.abrupt("return",n.data);case 5:return t.abrupt("return",null);case 6:case"end":return t.stop()}}),t)})))()},handleProlongParams:function(e){var t=JSON.parse(JSON.stringify(this.params));return this.mergeDeep(t.meta,e.meta),t},mergeDeep:function(e,source){for(var t in source)t in e&&(source[t]instanceof Object?this.mergeDeep(e[t],source[t]):!source[t]&&e[t]instanceof Object||(e[t]=source[t]))},handleVideoExpendParams:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getDetail(e.task_id);case 2:return o=n.sent,t.params.channel_id=t.projectId,t.params.model_no=o.model_no,t.params.model_ver_no=o.model_ver_no,t.params.meta.prompt=o.meta.prompt,t.params.meta.generate_video.generate_video_duration=o.meta.generate_video.generate_video_duration,t.params.components=[at(at({},o.img_uris[0]),{},{cover_url:e.cover})],t.params.id=o.id,n.abrupt("return",t.params);case 11:case"end":return n.stop()}}),n)})))()},addTask:function(e){this.$emit("addTask",e.data)}})},lt=st,ct=(n(5467),Object(_.a)(lt,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"editor-main"},[t("EditorBtnBoxContainer",{on:{btnClick:e.hadnleClick}}),e._v(" "),t("PreviewImageContainer",{ref:"previewInstance"}),e._v(" "),t("EditorFooter",{ref:"footerInstance",attrs:{isCollapsed:e.isCollapsed},on:{action:e.hadnleClick,toggleAnimation:e.toggleAnimation}}),e._v(" "),t("prolong-video-pop",{ref:"prolongVideoPop",attrs:{getParams:e.handleProlongParams},on:{change:e.addTask}})],1)}),[],!1,null,"3e3d4fc0",null).exports),ut=n(68),vt=(n(243),n(378),n(44),n(113),n(288)),mt=n(814),pt=n(856),ht=n(97),ft=n(3397),gt=n(406),_t=n(33),bt=n(433),yt=n(80);function Ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wt={name:"EasyModelPanel",props:["value","menuIndex"],inject:["easyTop"],components:{EasyStyleModal:vt.default,SelectModelConfirmModal:pt.default,commonConfirmModal:ht.default,changeVerNew:gt.default,RecommendModal:ft.default},data:function(){return{extraModelList:[],selectModelType:"Checkpoint",selectIds:[],visible:!1}},mounted:function(){var e=this;this.$EventBus.$on("selectModel",(function(t,n){return e.handleSelectModel2(t,n)}))},beforeDestroy:function(){this.$EventBus.$off("selectModel"),this.$EventBus.$off("closeAllGeneratePopup")},computed:Tt(Tt({},Object(c.c)("creation",["taskBaseModels","v2_sd_xl_ctr_units","v2_ctr_units"])),{},{taskModules:function(){var e;return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},getTaskUnitsDiffList:function(){var e=this.v2_sd_xl_ctr_units.map((function(e){return null==e?void 0:e.type})),t=this.v2_ctr_units.map((function(e){return null==e?void 0:e.type}));return Object(mt.difference)(e,t)},hideModel:function(){return["none"]},modelsList:function(){var e=this.value,t=e.art_work_no,n=e.art_model_no,r=e.art_model_ver_no,l=void 0===r?"":r,d=this.taskBaseModels.map((function(e){var o=e.artwork,r=e.name,d=e.id,c=e.model_ver_no,v=void 0===c?"":c,m=o?null==o?void 0:o.id:"";return{workId:t!==m&&n===d?t:m,name:r,id:d,art_model_ver_no:v||l,banner:{url:e.cover||""},version_name:(null==e?void 0:e.model_ver_name)||"",base_model_type:(null==e?void 0:e.base_model)||"",base_model:(null==e?void 0:e.base_model)||"",modelTags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]}}));return[].concat(Object(o.a)(this.extraModelList),Object(o.a)(d))},currentEffect:function(){var e;return(null==this||null===(e=this.value)||void 0===e?void 0:e.SpecialEffectsAppInfo)||{}},modelInfo:function(){var e,t,n,o,r;return this.isEffectTab?{art_model_no:"",banner:{url:(null==this||null===(n=this.currentEffect)||void 0===n||null===(n=n.cover)||void 0===n?void 0:n.url)||""},name:(null==this||null===(o=this.currentEffect)||void 0===o?void 0:o.title)||"",id:(null==this||null===(r=this.currentEffect)||void 0===r?void 0:r.id)||""}:{art_model_no:this.value.art_model_no,art_model_ver_no:this.value.art_model_ver_no,name:this.value.modelName,is_agency_fee:this.value.is_agency_fee||this.value.agency_fee>0,agency_fee:this.value.agency_fee,banner:{url:this.value.model_cover||""},version_name:this.value.art_model_ver_no_name||"",base_model_type:this.value.base_model_type||"",base_model:this.value.base_model_type||"",modelTags:Array.isArray(null===(e=this.value)||void 0===e?void 0:e.modelTags)?null===(t=this.value)||void 0===t?void 0:t.modelTags:[],id:this.value.art_model_no,version_no:this.value.art_model_ver_no}},isVideoBanner:function(){var e,t=null===(e=this.modelInfo)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.url;return[".mp4",".mkv",".webm",".avi",".mov",".flv",".wmv"].some((function(e){return(t||"").toLowerCase().endsWith(e)}))},isEffectTab:function(){var e;return"video"===this.menuIndex&&"effect"===(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.activeVideoInputTab)},getCardTypeText:function(){return this.isEffectTab?this.$t("VideoEffect"):this.$t("Model")}}),methods:Tt(Tt({},Object(c.b)("creation",["setCombinedDialogStatus"])),{},{handleJumpDetail:function(){var e,t=window.location.origin,n=null==this||null===(e=this.modelInfo)||void 0===e?void 0:e.art_model_no;n&&window.open(t+this.localePath("/models/detail/".concat(n)),"_blank")},handleChangeModelVersion:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(n);var o=JSON.parse(JSON.stringify(this.value));o.art_model_ver_no=null==n?void 0:n.model_ver_id,o.model_cover=(null==n||null===(e=n.sample)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.url)||"",o.art_model_ver_no_name=(null==n?void 0:n.version_no)||(null==n?void 0:n.model_ver_id),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(o)},openStyleModal:function(){this.isEffectTab?this.openEffectSelectModal():(this.selectIds=[{id:this.value.art_model_no,art_model_ver_no_name:this.value.art_model_ver_no_name,model_cover:this.value.model_cover}],"Checkpoint"===this.selectModelType?this.setCombinedDialogStatus({visible:!0,instanceId:"easyGenerate"}):this.$refs.easyStyleModal.openModal(this.selectModelType))},openEffectSelectModal:function(){var e=this,t=Object(oe.a)({cached:!0,cacheKey:"taskSelectEffect",render:function(n){return n(bt.default,{props:{effect:e.currentEffect},on:{selectEffect:function(n){e.handleSelectEffect(n),t.close()},cancel:function(){t.close()}}})}},this)},handleSelectEffect:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(yt.h)({template_id:null==e?void 0:e.id});case 2:r=n.sent,l=Tt(Tt({},e),{},{templateInfo:(null==r?void 0:r.data)||{}}),null==t||null===(o=t.easyTop)||void 0===o||o.updateConfig({SpecialEffectsAppInfo:l},"video");case 5:case"end":return n.stop()}}),n)})))()},updateModelPresetParams:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},source=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log("更新预设模型的预设参数",source),t.cfg_scale=source.cfg_scale||7,t.clip_skip=source.clip_skip||2,t.negative_prompt=source.negative_prompt||"",["",null,void 0].includes(null==this||null===(e=this.value)||void 0===e?void 0:e.prompt)&&(t.prompt=(null==source?void 0:source.positive_prompt)||""),t.sampler_name=source.sampler_name||"DPM++ 2M Karras",t.vae=source.vae||"vae-ft-mse-840000-ema-pruned",t.steps=source.steps||20,t.lcm_mode="LCM"===t.sampler_name?1:0,t},resetModelBaseParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(console.log("resetModelBaseParams--",t),"FLUX"===t?(e.cfg_scale=3.5,e.steps=30,e.clip_skip=2,e.sampler_name="Euler",e.denoising_strength=.5):(e.cfg_scale=7,e.clip_skip=2,e.sampler_name="DPM++ 2M Karras",e.vae="SDXL"===t?"None":"vae-ft-mse-840000-ema-pruned",e.steps=t.includes("SD 3.5")?25:20),Object(_t.checkIsVideoModel)(n)){var o,r=null==this||null===(o=this.easyTop)||void 0===o?void 0:o.initVideoModelDefaultParams(n);Object.assign(e,r)}return e.lcm_mode="LCM"===(null==e?void 0:e.sampler_name)?1:0,e},handleSelectModel:function(){var e=arguments,t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c,v,m,h,f,_,y,C,T,w,x,S,I,O,k,M,P,L,j,E,$,D,R,V,A;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return h=e.length>0&&void 0!==e[0]?e[0]:{},f=e.length>2&&void 0!==e[2]?e[2]:"",_=e.length>3&&void 0!==e[3]&&e[3],n.next=6,t.getModelInfo(h);case 6:if(y=n.sent,t.modelsList.some((function(e){return e.id===y.id}))||(t.extraModelList=[y]),C=[],Array.isArray(null==y?void 0:y.modelTags)&&null!=y&&null!==(o=y.modelTags)&&void 0!==o&&o.length&&(C=null==y?void 0:y.modelTags),Array.isArray(null==y?void 0:y.tags)&&null!=y&&null!==(r=y.tags)&&void 0!==r&&r.length&&(C=null==y?void 0:y.tags),T={art_work_no:y.sample_ids?y.sample_ids[0]:y.workId,modelName:y.name,art_model_no:y.id,art_model_ver_no:h.art_model_ver_no||h.model_ver_no||"",agency_fee:(null==h?void 0:h.agency_fee)||0,model_cover:(null==y||null===(l=y.banner)||void 0===l?void 0:l.url)||(null==h||null===(d=h.banner)||void 0===d?void 0:d.url)||"",art_model_ver_no_name:y.version_name||h.version_name,base_model_type:y.base_model,modelTags:C},w=!1,!t.checkShowIpMainTips(T)){n.next=18;break}return n.next=18,null===(x=t.$refs)||void 0===x||null===(x=x.customConfirmModal)||void 0===x?void 0:x.show({subTitle:"newGenerate65"}).then((function(e){T.ipList=[],T.styleReferenceList=[],w=!1})).catch((function(e){w=!0}));case 18:if(!w){n.next=20;break}return n.abrupt("return");case 20:if("preset"===f&&_&&(T=t.updateModelPresetParams(T,h),t.$EventBus.$emit("resetInputPackUpStatus")),S=null===(c=t.easyTop)||void 0===c?void 0:c.getCurrentModelType(y.base_model),I=(null==t||null===(v=t.easyTop)||void 0===v?void 0:v.isSd35Model)||et.L.sd35.includes(h.base_model)||(h.base_model||"").includes("SD 3.5")||!1,O="FLUX"===S,k="SDXL"===S,M="SD"===S,P=null===(m=t.easyTop)||void 0===m?void 0:m.getCurrentModelType(t.value.base_model_type),Object(_t.checkIsVideoModel)(y.base_model)||(T.imageToVideoList=[]),"preset"!==f&&P!==S&&(t.resetModelBaseParams(T,S,y.base_model),P!==S&&!Object(_t.checkIsVideoModel)(y.base_model)&&Object(_t.checkIsVideoModel)(t.value.base_model_type)&&(T.width=688,T.height=1024,T.imageToVideoList=[],1===(null==t||null===(L=t.value)||void 0===L?void 0:L.n_iter)&&(T.n_iter=2))),!O&&!I){n.next=51;break}if($=($=JSON.parse(JSON.stringify(t.value.controlnet_units))).map((function(e){return e.type})),null!==(j=$)&&void 0!==j&&j.length){n.next=39;break}return t.$refs.easyStyleModal.handleClose(),T.controlnet_units=[],T.enableNegativePrompts=!1,T.negative_prompt="",t.changeConfig(T),n.abrupt("return");case 39:if(!(_t.ENABLE_FLUX_STYLE_REFERENCE&&O&&null!==(E=$)&&void 0!==E&&E.length)){n.next=48;break}return D=JSON.parse(JSON.stringify(t.value.controlnet_units)),R=["canny","depth","ip_adapter"],t.$refs.easyStyleModal.handleClose(),T.controlnet_units=D.filter((function(e){return R.includes(null==e?void 0:e.type)})).slice(0,1),T.enableNegativePrompts=!1,T.negative_prompt="",t.changeConfig(T),n.abrupt("return");case 48:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:$||[]}),t.$refs.confirmModal.show().then((function(){t.$refs.easyStyleModal.handleClose(),T.controlnet_units=[],T.enableNegativePrompts=!1,T.negative_prompt="",t.changeConfig(T)})),n.abrupt("return");case 51:if(P===S||!k&&!M){n.next=60;break}if((V=t.checkNeedTips(y)).length){n.next=57;break}return t.$refs.easyStyleModal.handleClose(),t.changeConfig(T),n.abrupt("return");case 57:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:V||[]}),t.$refs.confirmModal.show(V).then((function(){t.$refs.easyStyleModal.handleClose();var e=JSON.parse(JSON.stringify(t.value));e.controlnet_units=(e.controlnet_units||[]).filter((function(e){return!V.includes(null==e?void 0:e.type)})),T.controlnet_units=e.controlnet_units,t.changeConfig(T)})),n.abrupt("return");case 60:P!==S&&(null==t||null===(A=t.easyTop)||void 0===A||A.adjustControlNetWeight(O)),t.$refs.easyStyleModal.handleClose(),t.changeConfig(T);case 63:case"end":return n.stop()}}),n)})))()},handleSelectModel2:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c,v,m,h,f,_,y,C,T,w,x,S,I,O,k,M,P,L,j,E,$,D,R,V,A,N,z,F,U,B,G,H,J,W,K,X,Y,Q,Z,ee,te,ie,ne,oe,ae,re,se;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((null==t||null===(o=t.easyTop)||void 0===o?void 0:o.currentTab)===(null==t?void 0:t.menuIndex)){n.next=3;break}return n.abrupt("return");case 3:return f=e.model,_=void 0===f?{}:f,y=e.model_type,C=e.isPreset,T=void 0===C?"":C,w=e.usePreset,x=void 0!==w&&w,n.next=6,t.getModelInfo(_,"preset"===T);case 6:if(S=n.sent,t.modelsList.some((function(e){return e.id===S.id}))||(t.extraModelList=[S]),I=[],Array.isArray(null==S?void 0:S.modelTags)&&null!=S&&null!==(r=S.modelTags)&&void 0!==r&&r.length&&(I=null==S?void 0:S.modelTags),Array.isArray(null==S?void 0:S.tags)&&null!=S&&null!==(l=S.tags)&&void 0!==l&&l.length&&(I=null==S?void 0:S.tags),O={art_work_no:S.sample_ids?S.sample_ids[0]:S.workId,modelName:S.name,art_model_no:S.id,art_model_ver_no:_.art_model_ver_no||_.model_ver_no||"",agency_fee:(null==_?void 0:_.agency_fee)||0,model_cover:(null==S||null===(d=S.banner)||void 0===d?void 0:d.url)||(null==_||null===(c=_.banner)||void 0===c?void 0:c.url)||"",art_model_ver_no_name:S.version_name||_.version_name,base_model_type:S.base_model||_.base_model||"",modelTags:I},k=!1,!t.checkShowIpMainTips(O)){n.next=18;break}return n.next=18,null===(M=t.$refs)||void 0===M||null===(M=M.customConfirmModal)||void 0===M?void 0:M.show({subTitle:"newGenerate65"}).then((function(e){O.ipList=[],O.styleReferenceList=[],k=!1})).catch((function(e){k=!0}));case 18:if(!k){n.next=20;break}return n.abrupt("return");case 20:if("preset"===T&&x&&(O=t.updateModelPresetParams(O,S),t.$EventBus.$emit("resetInputPackUpStatus")),P=null===(v=t.easyTop)||void 0===v?void 0:v.getCurrentModelType(S.base_model),L=(null==t||null===(m=t.easyTop)||void 0===m?void 0:m.isSd35Model)||et.L.sd35.includes(_.base_model)||(_.base_model||"").includes("SD 3.5")||!1,j="FLUX"===P,E="SDXL"===P,$="SD"===P,D=null===(h=t.easyTop)||void 0===h?void 0:h.getCurrentModelType(t.value.base_model_type),Object(_t.checkIsVideoModel)(S.base_model)||(console.log("是否是因为不是视频模型而清空特效参数----"),O.imageToVideoList=[],O.SpecialEffectsAppInfo=null,O.specialEffectsImageList=JSON.parse(JSON.stringify((null===_t.AI_VIDEO_GENERATE_PARAMS||void 0===_t.AI_VIDEO_GENERATE_PARAMS?void 0:_t.AI_VIDEO_GENERATE_PARAMS.specialEffectsImageList)||[])),O.currentVideoInputToolTab="img2video",!Object(_t.checkIsVideoModel)(S.base_model)&&Object(_t.checkIsVideoModel)(t.value.base_model_type)&&(console.log("清空提示词---3"),null!==(R=O)&&void 0!==R&&R.prompt||(O.prompt=""))),"preset"===T&&("preset"!==T||x)||D===P||t.resetModelBaseParams(O,P,S.base_model),!j&&!L){n.next=51;break}if(N=(N=JSON.parse(JSON.stringify(t.value.controlnet_units))).map((function(e){return e.type})),null!==(V=N)&&void 0!==V&&V.length){n.next=39;break}return t.$refs.easyStyleModal.handleClose(),O.controlnet_units=[],O.enableNegativePrompts=!1,O.negative_prompt="",t.changeConfig(O),n.abrupt("return");case 39:if(!(_t.ENABLE_FLUX_STYLE_REFERENCE&&j&&null!==(A=N)&&void 0!==A&&A.length)){n.next=48;break}return z=JSON.parse(JSON.stringify(t.value.controlnet_units)),F=["canny","depth","ip_adapter"],t.$refs.easyStyleModal.handleClose(),O.controlnet_units=z.filter((function(e){return F.includes(null==e?void 0:e.type)})).slice(0,1),O.enableNegativePrompts=!1,O.negative_prompt="",t.changeConfig(O),n.abrupt("return");case 48:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:N||[]}),t.$refs.confirmModal.show(N).then((function(){t.$refs.easyStyleModal.handleClose(),O.controlnet_units=[],O.enableNegativePrompts=!1,O.negative_prompt="",t.changeConfig(O)})),n.abrupt("return");case 51:if(D===P||!E&&!$){n.next=60;break}if((U=t.checkNeedTips(S)).length){n.next=57;break}return t.$refs.easyStyleModal.handleClose(),t.changeConfig(O),n.abrupt("return");case 57:return t.$logEvent("log_actions",{operation:"model_incompatibility_popup_show",behavior_info:"on_new_create_flow_page",behavior_info_sub:U||[]}),t.$refs.confirmModal.show(U).then((function(){t.$refs.easyStyleModal.handleClose();var e=JSON.parse(JSON.stringify(t.value));e.controlnet_units=(e.controlnet_units||[]).filter((function(e){return!U.includes(null==e?void 0:e.type)})),O.controlnet_units=e.controlnet_units,t.changeConfig(O)})),n.abrupt("return");case 60:D!==P&&(null==t||null===(B=t.easyTop)||void 0===B||B.adjustControlNetWeight(j)),t.$refs.easyStyleModal.handleClose(),console.log(Object(_t.checkIsVideoModel)(S.base_model),"切换后是否是视频模型"),Object(_t.checkIsVideoModel)(S.base_model)&&(console.log("视频模型切换----"),W=Object(_t.checkIsVideoModel)(S.base_model),K=Object(_t.checkIsVideoModel)(t.value.base_model_type),X=W&&K,Y=null==t||null===(G=t.easyTop)||void 0===G?void 0:G.initVideoModelDefaultParams(S.base_model,X),console.log(Y,S.base_model,"参数-----"),O=Object.assign(O,Y),(Q=null==t||null===(H=t.easyTop)||void 0===H?void 0:H.updateVideoInputSelectTab(null===(J=O)||void 0===J?void 0:J.base_model_type))&&(O.currentVideoInputToolTab=Q),Q||(O.currentVideoInputToolTab=(null==t||null===(Z=t.easyTop)||void 0===Z||null===(Z=Z.config)||void 0===Z||null===(Z=Z.textToImage)||void 0===Z?void 0:Z.currentVideoInputToolTab)||(null===(ee=O)||void 0===ee?void 0:ee.currentVideoInputToolTab))),te=!Object(_t.checkIsVideoModel)(S.base_model),ie=Object(_t.checkIsVideoModel)(t.value.base_model_type),console.log("切换后不是视频模型:".concat(te),"切换前是视频模型".concat(ie),"89888"),te&&ie&&(console.log("清空提示词---1"),O.width=688,O.height=1024,O.imageToVideoList=[],console.log(null===(ne=t.easyTop)||void 0===ne?void 0:ne.defaultInter,"defaultInter"),O.n_iter=null===(oe=t.easyTop)||void 0===oe?void 0:oe.defaultInter,null!==(ae=O)&&void 0!==ae&&ae.prompt||(O.prompt="")),Object(_t.checkIsVideoModel)(S.base_model)&&!Object(_t.checkIsVideoModel)(t.value.base_model_type)&&(O.n_iter=null===(re=t.easyTop)||void 0===re?void 0:re.defaultInter,console.log("清空提示词---2"),null!==(se=O)&&void 0!==se&&se.prompt||(O.prompt="")),console.log(O,"handleSelectModel2:updateInfo"),t.changeConfig(O);case 71:case"end":return n.stop()}}),n)})))()},checkNeedTips:function(e){var t,n=this,o="SDXL"===(null===(t=this.easyTop)||void 0===t?void 0:t.getCurrentModelType(e.base_model)),r=JSON.parse(JSON.stringify(this.value.controlnet_units));r=r.map((function(e){return e.type}));var l=[],d=this.v2_sd_xl_ctr_units.map((function(e){return null==e?void 0:e.type})),c=this.v2_ctr_units.map((function(e){return null==e?void 0:e.type}));return l=(o?d:c).filter((function(e){return!n.hideModel.includes(e)&&r.includes(e)})),r.filter((function(e){return!l.includes(e)}))},checkShowIpMainTips:function(e){var t,n,o,r=(null===et.L||void 0===et.L?void 0:et.L.flux)||[],l="FLUX"===(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.currentModelType),d=!r.includes(null==e?void 0:e.base_model_type),c=(null==this||null===(n=this.easyTop)||void 0===n||null===(n=n.config)||void 0===n||null===(n=n.textToImage)||void 0===n||null===(n=n.styleReferenceList)||void 0===n?void 0:n.length)||(null==this||null===(o=this.easyTop)||void 0===o?void 0:o.hasIpMaintain);return l&&d&&c},getModelInfo:function(e){var t=arguments,n=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var r,l,d,c,v,m,h,f,_,y,C,T,w,meta,x,S;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(r=t.length>1&&void 0!==t[1]&&t[1],!("object"===Object(ut.a)(e))){o.next=32;break}if(!(null!=e&&e.sample_ids||2===(null==e?void 0:e.publish_status))){o.next=7;break}return o.abrupt("return",e);case 7:if(1!==(null==e?void 0:e.publish_status)||null!=e&&e.sample_ids||r){o.next=9;break}return o.abrupt("return",e);case 9:return l={art_model_ver_no:e.model_ver_no,task_flow_version:"v2"},r&&(l.source=6),o.next=13,Object(Ze.getTaskConfig)(l);case 13:if(d=o.sent,c=d.data,m=(v=void 0===c?{}:c).art_model,h=m.id,f=m.name,_=m.version_name,y=m.base_model,C=m.model_ver_no,T=v.art_work_no,w=v.meta,meta=void 0===w?{}:w,x=v.local_prompt,S=void 0===x?"":x,!r||!meta){o.next=31;break}return o.abrupt("return",Tt(Tt({id:h,name:f,version_name:_,workId:T,art_model_ver_no:e.model_ver_no||C,base_model:e.base_model||y,tags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]},meta),{},{prompt:S||meta.prompt||""}));case 31:return o.abrupt("return",{id:h,name:f,version_name:_,workId:T,art_model_ver_no:e.model_ver_no||C,base_model:e.base_model||y,tags:Array.isArray(null==e?void 0:e.tags)?null==e?void 0:e.tags:[]});case 32:return o.abrupt("return",n.modelsList.find((function(t){return t.id===e})));case 33:case"end":return o.stop()}}),o)})))()},changeConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));t&&(o[t]=e),o=Tt(Tt({},o),e),console.log(o,"changeConfig:val"),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)},handleCreate:function(e){var t,n,o,r;this.handleSelectModel2({model:{id:e.id,model_ver_no:e.model_ver_no,banner:{url:null===(t=e.banner)||void 0===t?void 0:t.url,width:null===(n=e.banner)||void 0===n?void 0:n.width,height:null===(o=e.banner)||void 0===o?void 0:o.height}}}),this.visible=!1,null==this||null===(r=this.easyTop)||void 0===r||r.updateConfig({currentVideoInputToolTab:"img2video"})}})},xt=wt,St=(n(5469),n(5470),Object(_.a)(xt,(function(){var e,t,n,o,r,l,d,c,v=this,m=v._self._c;return m("el-popover",{ref:"modelPopover",attrs:{"popper-class":"recommend-model-popover",placement:"right","visible-arrow":!1,width:"328",trigger:"manual"},model:{value:v.visible,callback:function(e){v.visible=e},expression:"visible"}},[m("div",{staticClass:"c-easy-model-panel",attrs:{slot:"reference"},on:{click:function(e){return e.stopPropagation(),v.openStyleModal.apply(null,arguments)}},slot:"reference"},[m("div",{staticClass:"background-media"},[!v.isVideoBanner&&null!==(e=v.modelInfo)&&void 0!==e&&null!==(e=e.banner)&&void 0!==e&&e.url?m("img",{attrs:{src:null===(t=v.modelInfo)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.url}}):v.isVideoBanner&&null!==(n=v.modelInfo)&&void 0!==n&&null!==(n=n.banner)&&void 0!==n&&n.url?m("video",{attrs:{src:null===(o=v.modelInfo)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.url,loop:"",muted:"",autoplay:"",playsinline:""},domProps:{muted:!0}}):v._e()]),v._v(" "),m("div",{staticClass:"model-panel-card",attrs:{"data-event":"video_editor_model_panel_card"}},[m("div",{staticClass:"model-panel-card-left"},[m("div",{staticClass:"model-panel-card-left-box"},[m("span",{staticClass:"model-panel-card-left-tag"},[v._v(v._s(v.getCardTypeText))])]),v._v(" "),m("div",{staticClass:"model-panel-card-left-text-box"},[m("span",{staticClass:"model-panel-card-left-text"},[v._v(v._s(null===(r=v.modelInfo)||void 0===r?void 0:r.name))]),v._v(" "),m("i",{directives:[{name:"show",rawName:"v-show",value:null===(l=v.modelInfo)||void 0===l?void 0:l.art_model_no,expression:"modelInfo?.art_model_no"}],staticClass:"iconfont icon-icon-xinxi",on:{click:function(e){return e.stopPropagation(),v.handleJumpDetail.apply(null,arguments)}}})]),v._v(" "),m("change-ver-new",{directives:[{name:"show",rawName:"v-show",value:null===(d=v.modelInfo)||void 0===d?void 0:d.art_model_ver_no,expression:"modelInfo?.art_model_ver_no"}],attrs:{from:"styleModal",item:v.modelInfo,base_models:[null===(c=v.modelInfo)||void 0===c?void 0:c.base_model]},on:{selectItem:v.handleChangeModelVersion}})],1),v._v(" "),m("div",{staticClass:"model-panel-card-right"},[m("span",{staticClass:"iconfont icon-select-model-icon"})])]),v._v(" "),m("easy-style-modal",{ref:"easyStyleModal",attrs:{"model-type":v.selectModelType,inTask:!0,"is-studio-mode":!0,"select-list":v.selectIds},on:{selectModel:v.handleSelectModel}}),v._v(" "),m("select-model-confirm-modal",{ref:"confirmModal"}),v._v(" "),m("common-confirm-modal",{ref:"customConfirmModal"})],1)])}),[],!1,null,"14a1c67b",null)),It=St.exports;installComponents(St,{EasyStyleModal:n(288).default});var Ot=n(596),kt=n(56);function Mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mt(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Lt={name:"EasyAdditionalPanel",props:["value"],inject:["easyTop"],components:{AdditionalPanelCardItem:Ot.default,EasyStyleModal:vt.default},data:function(){return{isCollapse:!1,selectIds:[],modelDetailTrainedWords:[]}},computed:Pt(Pt(Pt({},Object(c.c)("payment",["paymentInfo"])),Object(c.c)("user",["isCompanyAccount","isLoggedIn"])),{},{showViewMore:function(){var e,t,n,o,r=!this.isCollapse&&((null===(e=this.value)||void 0===e||null===(e=e.embeddings)||void 0===e?void 0:e.length)||(null===(t=this.value)||void 0===t||null===(t=t.lora_models)||void 0===t?void 0:t.length)),l=!(null!==(n=this.value)&&void 0!==n&&null!==(n=n.lora_models)&&void 0!==n&&n.length&&null!==(o=this.easyTop)&&void 0!==o&&o.isHunyuan);return r&&l},modelInfo:function(){var e,t;return{art_model_no:this.value.art_model_no,art_model_ver_no:this.value.art_model_ver_no,name:this.value.modelName,is_agency_fee:this.value.is_agency_fee||this.value.agency_fee>0,agency_fee:this.value.agency_fee,banner:{url:this.value.model_cover||""},version_name:this.value.art_model_ver_no_name||"",base_model_type:this.value.base_model_type||"",base_model:this.value.base_model_type||"",modelTags:Array.isArray(null===(e=this.value)||void 0===e?void 0:e.modelTags)?null===(t=this.value)||void 0===t?void 0:t.modelTags:[]}},showAdd:function(){var e,t;return!(null!==(e=this.value)&&void 0!==e&&null!==(e=e.lora_models)&&void 0!==e&&e.length||null!==(t=this.value)&&void 0!==t&&null!==(t=t.embeddings)&&void 0!==t&&t.length)},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount}}),methods:{handleUpdateLoraVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=JSON.parse(JSON.stringify(this.value)).lora_models;(n||[]).forEach((function(n){var o,r;(null==n?void 0:n.id)===(null==t?void 0:t.id)&&(n.version_name=(null==e?void 0:e.version_no)||(null==e?void 0:e.model_ver_id),n.model_ver_no=null==e?void 0:e.model_ver_id,null!=e&&null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url&&(n.banner.url=(null==e||null===(r=e.sample)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.url)||""))})),this.changeConfig({lora_models:n})}catch(e){}},handleUpdateEmbeddingVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=JSON.parse(JSON.stringify(this.value)).embeddings;(n||[]).forEach((function(n){if((null==n?void 0:n.id)===(null==t?void 0:t.id)){var o,r;if(n.version_name=(null==e?void 0:e.version_no)||(null==e?void 0:e.model_ver_id),n.model_ver_no=null==e?void 0:e.model_ver_id,null!=e&&null!==(o=e.sample)&&void 0!==o&&null!==(o=o.banner)&&void 0!==o&&o.url)n.banner.url=(null==e||null===(r=e.sample)||void 0===r||null===(r=r.banner)||void 0===r?void 0:r.url)||"";n.trained_words=Array.isArray(null==e?void 0:e.trained_words)?null==e?void 0:e.trained_words:[]}})),this.changeConfig({embeddings:n})}catch(e){}},toggleFoldStatus:function(){this.isCollapse=!this.isCollapse,this.$logEvent("log_actions",{operation:"click_additional",behavior_info:"on_new_create_flow_page"})},openSelectModal:function(){this.selectIds=[].concat(Object(o.a)(this.value.lora_models),Object(o.a)(this.value.embeddings)),this.$refs.easyStyleModal.openModal("LORA"),this.$EventBus.$emit("needCheckInputPackUp","paramsPanel"),this.$logEvent("log_actions",{operation:"click_additional",behavior_info:"on_new_create_flow_page"})},handleSelectModel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e||{}).type,n=void 0===t?"":t;"TextualInversion"===n&&this.selectEmbeddingHandle(e),"LORA"===n&&this.selectLoraHandle(e),this.$refs.easyStyleModal.handleClose()},selectEmbeddingHandle:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,l,d,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.value.embeddings,l=void 0===r?[]:r,d=Pt({model_id:e.id,weight:1},e),!((null==l?void 0:l.length)>=8)){n.next=5;break}return t.$message.warning(t.$t("embedding6",{num:8})),n.abrupt("return");case 5:if(-1===(c=l.findIndex((function(e){return e.id===d.id&&(null==e?void 0:e.model_ver_no)===(null==d?void 0:d.model_ver_no)})))){n.next=12;break}return n.next=9,t.getModelDetail(null==d?void 0:d.model_id,null==d?void 0:d.model_ver_no);case 9:l[c]=Pt(Pt({},d),{},{trained_words:Object(o.a)(t.modelDetailTrainedWords)}),n.next=15;break;case 12:return n.next=14,t.getModelDetail(null==d?void 0:d.model_id,null==d?void 0:d.model_ver_no);case 14:l.push(Pt(Pt({},d),{},{trained_words:Object(o.a)(t.modelDetailTrainedWords)}));case 15:t.changeConfig({embeddings:l});case 16:case"end":return n.stop()}}),n)})))()},getModelDetail:function(){var e=this,t={id:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",version_id:arguments.length>1&&void 0!==arguments[1]?arguments[1]:""};return Object(kt.G)(t).then((function(t){var n;if(!t||1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)){var o=(t&&null!=t&&t.data?null==t?void 0:t.data:{}).trained_words,r=void 0===o?[]:o;e.modelDetailTrainedWords=Array.isArray(r)?r:[]}})).finally((function(){}))},selectLoraHandle:function(e){var t,n=this.value.lora_models,o=Pt({model_id:e.id,weight:1},e);if(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isHunyuan&&(null==n?void 0:n.length)>=1)this.$message.warning(this.$t("newGenerate50"));else if((null==n?void 0:n.length)>=5)this.$message.warning(this.$t("newGenerate50"));else{if(!this.isLoggedIn&&(null==n?void 0:n.length)>=3)return this.$EventBus.$emit("openLoginDialog",{dot:!1}),void this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});if(!this.isVipFun&&(null==n?void 0:n.length)>=3)this.$EventBus.$emit("showBreakDialog","LoRALimit5TipWeb","basic");else{var r=n.findIndex((function(e){return e.id===o.id}));-1!==r?n[r]=o:n.push(o),this.changeConfig({lora_models:n})}}},changeWeight:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=this.value,r=o.lora_models,l=o.embeddings,d=void 0===l?[]:l,c=r.findIndex((function(e){return(null==t?void 0:t.id)===e.id}));if("Embedding"===n&&(c=d.findIndex((function(e){return(null==t?void 0:t.id)===e.id}))),"LORA"===n&&-1!==c)return r[c].weight=e,void this.changeConfig({lora_models:r});"Embedding"===n&&-1!==c&&(d[c].weight=e,this.changeConfig({embeddings:d}))},deleteModel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=JSON.parse(JSON.stringify(this.value));if("LORA"===t){var o=n.lora_models.findIndex((function(t){return(null==e?void 0:e.id)===t.id}));return-1!==o&&n.lora_models.splice(o,1),void(-1!==o&&this.changeConfig({lora_models:n.lora_models}))}if("Embedding"===t){var r=n.embeddings.findIndex((function(t){return(null==e?void 0:e.id)===t.id&&(null==e?void 0:e.model_ver_no)===(null==t?void 0:t.model_ver_no)}));-1!==r&&n.embeddings.splice(r,1),-1!==r&&this.changeConfig({embeddings:n.embeddings})}},changeConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));t&&(o[t]=e),o=Pt(Pt({},o),e),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)}}},jt=Lt,Et=(n(5471),Object(_.a)(jt,(function(){var e,t,n,o,r,l,d=this,c=d._self._c;return c("div",{staticClass:"c-easy-additional-panel"},[c("div",{staticClass:"additional-panel-title",attrs:{"data-event":d.showAdd?"video_editor_additional_open_modal":"video_editor_additional_toggle_fold"},on:{click:function(e){e.stopPropagation(),d.showAdd?d.openSelectModal():d.toggleFoldStatus()}}},[c("span",{staticClass:"additional-panel-title-text"},[d._v(d._s(d.$t("newGenerate48")))]),d._v(" "),c("span",{staticClass:"additional-panel-title-icon",class:d.showAdd?"el-icon-circle-plus-outline":(d.isCollapse,"el-icon-caret-bottom"),on:{click:function(e){e.stopPropagation(),d.showAdd?d.openSelectModal():d.toggleFoldStatus()}}})]),d._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:!d.isCollapse&&(null===(e=d.value)||void 0===e||null===(e=e.lora_models)||void 0===e?void 0:e.length),expression:"!isCollapse && value?.lora_models?.length"}],staticClass:"lora-list"},[c("div",{staticClass:"lora-list-label"},[d._v(d._s(d.$t("LoRA")))]),d._v(" "),c("div",{staticClass:"lora-list-content"},[d._l((null===(t=d.value)||void 0===t?void 0:t.lora_models)||[],(function(e,t){return[c("additional-panel-card-item",{key:"lora_".concat(t),attrs:{modelInfo:e},on:{deleteItem:function(t){return d.deleteModel(e,"LORA")},updateVersion:function(t){return d.handleUpdateLoraVersion(t,e)},changeWeight:function(t){return d.changeWeight(t,e,"LORA")}}})]}))],2)]),d._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:!d.isCollapse&&(null===(n=d.value)||void 0===n||null===(n=n.embeddings)||void 0===n?void 0:n.length),expression:"!isCollapse && value?.embeddings?.length"}],staticClass:"lora-list"},[c("div",{staticClass:"lora-list-label"},[d._v(d._s(d.$t("embedding1")))]),d._v(" "),c("div",{staticClass:"lora-list-content"},[d._l((null===(o=d.value)||void 0===o?void 0:o.embeddings)||[],(function(e,t){return[c("additional-panel-card-item",{key:"embedding_".concat(t),attrs:{modelInfo:e,type:"embedding"},on:{deleteItem:function(t){return d.deleteModel(e,"Embedding")},updateVersion:function(t){return d.handleUpdateEmbeddingVersion(t,e)},changeWeight:function(t){return d.changeWeight(t,e,"Embedding")}}})]}))],2)]),d._v(" "),d.showViewMore?c("div",{staticClass:"tools-popup-view-more-btn",on:{click:function(e){return e.stopPropagation(),d.openSelectModal()}}},[c("span",{staticClass:"tools-popup-view-more-btn-text"},[d._v(d._s(d.$t("viewMore")))]),d._v(" "),c("span",{staticClass:"tools-popup-view-more-btn-icon el-icon-right"})]):d._e(),d._v(" "),c("easy-style-modal",{ref:"easyStyleModal",attrs:{"model-type":"LORA",inTask:!0,isSD35:null===(r=d.easyTop)||void 0===r?void 0:r.isSd35Model,isSDXL:null===(l=d.easyTop)||void 0===l?void 0:l.isSDXLModel,"is-studio-mode":!0,studioModelInfo:d.modelInfo,"select-list":d.selectIds},on:{selectModel:d.handleSelectModel}})],1)}),[],!1,null,"3decebd1",null)),$t=Et.exports;installComponents(Et,{EasyStyleModal:n(288).default});var Dt=n(85),Rt=n(99),Vt=n(25),At=n(597),Nt=n(137),zt=n(598),Ft=n(599),Ut=n(866),Bt=n(867),Gt=n(470),Ht=n(179);function Jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kt={name:"ImageAndControlNetPopup",data:function(){return{visible:!1,ENABLE_FLUX_STYLE_REFERENCE:_t.ENABLE_FLUX_STYLE_REFERENCE}},inject:["easyTop"],components:{SelectControlNetModal:n(602).default},computed:Wt(Wt(Wt({},Object(c.c)("creation",["v2_sd_xl_ctr_units","v2_ctr_units","conf_img"])),Object(c.c)("user",["cdnHostFun","isLoggedIn"])),{},{imageToVideoCover:function(){return["https://".concat(null==this?void 0:this.cdnHostFun(),"/static/upload/20250117/f8e2c9ab-5de4-4202-8b26-41a4df4bef26.png"),"https://".concat(null==this?void 0:this.cdnHostFun(),"/static/upload/20250117/f498b780-8343-4183-8c80-ffe684a46757.gif")]},imageToLive2DCover:function(){return["https://".concat(null==this?void 0:this.cdnHostFun(),"/static/upload/20250117/be9531c0-51dc-466a-bb44-e992b36e8f6d.png"),"https://".concat(null==this?void 0:this.cdnHostFun(),"/static/upload/20250117/0c1b39dc-8ff5-41f0-9191-5dc03b0472da.gif")]},styleReferenceCover:function(){var e;return(null==this||null===(e=this.conf_img)||void 0===e?void 0:e.flux_style_reference)||[]},isHideImageToImage:function(){var e,t,n,o,r,l,d,c,v,m=(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isCommunityFlux)&&(null==this||null===(t=this.easyTop)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.textToImage)||void 0===t||null===(t=t.controlnet_units)||void 0===t?void 0:t.length),h=(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isCommunityFlux)&&(null==this||null===(o=this.easyTop)||void 0===o||null===(o=o.config)||void 0===o||null===(o=o.textToImage)||void 0===o||null===(o=o.styleReferenceList)||void 0===o?void 0:o.length),f=null==this||null===(r=this.easyTop)||void 0===r?void 0:r.isMiniMax,_=null==this||null===(l=this.easyTop)||void 0===l?void 0:l.isKLModel,y=null==this||null===(d=this.easyTop)||void 0===d?void 0:d.isHunYuan,C=(null==this||null===(c=this.easyTop)||void 0===c?void 0:c.isTongYiFast)||(null==this||null===(v=this.easyTop)||void 0===v?void 0:v.isTongYiProfessional);return m||h||f||_||y||C},showIpMaintain:function(){var e,t,n,o,r,l,d,c,v,m=null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isCommunityFlux,h=!(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&null!==(t=t.config)&&void 0!==t&&null!==(t=t.textToImage)&&void 0!==t&&null!==(t=t.lora_models)&&void 0!==t&&t.length),f=!(null!=this&&null!==(n=this.easyTop)&&void 0!==n&&null!==(n=n.config)&&void 0!==n&&null!==(n=n.textToImage)&&void 0!==n&&null!==(n=n.styleReferenceList)&&void 0!==n&&n.length),_=!(null!=this&&null!==(o=this.easyTop)&&void 0!==o&&null!==(o=o.config)&&void 0!==o&&null!==(o=o.textToImage)&&void 0!==o&&null!==(o=o.controlnet_units)&&void 0!==o&&o.length),y=!(null!=this&&null!==(r=this.easyTop)&&void 0!==r&&r.isMiniMax),C=!(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isHunYuan),T=!(null!=this&&null!==(d=this.easyTop)&&void 0!==d&&d.isKLModel),w=!(null!=this&&null!==(c=this.easyTop)&&void 0!==c&&c.isTongYiFast||null!=this&&null!==(v=this.easyTop)&&void 0!==v&&v.isTongYiProfessional);return m&&h&&f&&_&&y&&C&&T&&w},taskModules:function(){var e;return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},renderControlNetList:function(){var e,t=["canny","reference_only"];return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isCommunityFlux&&(t=["canny"]),(this.taskModules||[]).filter((function(e){return t.includes(null==e?void 0:e.type)}))},isHideControlNet:function(){var e,t,n,o,r,l,d,c,v,m,h,f=(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isCommunityFlux)&&((null==this||null===(t=this.easyTop)||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.textToImage)||void 0===t||null===(t=t.styleReferenceList)||void 0===t?void 0:t.length)||!_t.ENABLE_FLUX_STYLE_REFERENCE),_=null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isSd35Model,y=(null==this||null===(o=this.easyTop)||void 0===o?void 0:o.isCommunityFlux)&&(null==this||null===(r=this.easyTop)||void 0===r||null===(r=r.config)||void 0===r||null===(r=r.textToImage)||void 0===r||null===(r=r.imageToImageList)||void 0===r?void 0:r.length)||(null==this||null===(l=this.easyTop)||void 0===l?void 0:l.hasIpMaintain),C=null==this||null===(d=this.easyTop)||void 0===d?void 0:d.isMiniMax,T=null==this||null===(c=this.easyTop)||void 0===c?void 0:c.isHunYuan,w=null==this||null===(v=this.easyTop)||void 0===v?void 0:v.isKLModel,x=(null==this||null===(m=this.easyTop)||void 0===m?void 0:m.isTongYiFast)||(null==this||null===(h=this.easyTop)||void 0===h?void 0:h.isTongYiProfessional);return f||_||y||C||T||w||x},isAnimeEnhanceEnable:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isAnimeEnhanceEnable},showStyleReference:function(){var e,t,n,o,r,l,d,c,v,m=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&null!==(e=e.config)&&void 0!==e&&null!==(e=e.textToImage)&&void 0!==e&&null!==(e=e.imageToImageList)&&void 0!==e&&e.length),h=!(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.hasIpMaintain),f=null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isCommunityFlux,_=!(null!=this&&null!==(o=this.easyTop)&&void 0!==o&&null!==(o=o.config)&&void 0!==o&&null!==(o=o.textToImage)&&void 0!==o&&null!==(o=o.controlnet_units)&&void 0!==o&&o.length),y=_t.ENABLE_FLUX_STYLE_REFERENCE,C=!(null!=this&&null!==(r=this.easyTop)&&void 0!==r&&r.isMiniMax),T=!(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isKLModel),w=!(null!=this&&null!==(d=this.easyTop)&&void 0!==d&&d.isHunYuan),x=!(null!=this&&null!==(c=this.easyTop)&&void 0!==c&&c.isTongYiFast||null!=this&&null!==(v=this.easyTop)&&void 0!==v&&v.isTongYiProfessional);return m&&h&&f&&_&&y&&C&&T&&w&&x},showImageToVideo:function(){var e,t,n,o,r,l=null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isMiniMax,d=null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isHunYuan,c=null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isKLModel,v=(null==this||null===(o=this.easyTop)||void 0===o?void 0:o.isTongYiFast)||(null==this||null===(r=this.easyTop)||void 0===r?void 0:r.isTongYiProfessional);return l||d||c||v},showImageToLive2D:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isMiniMax}}),methods:{onClose:function(){this.visible=!1},handlePopupShow:function(){this.$emit("show")},handlePopupHide:function(){this.$emit("hide")},logOperation:function(e){var t={imageToImage:"click_image_to_image_tab",controlNet:"click_controlnet_tab",IpMaintain:"click_character_reference"};t[e]&&this.$logEvent("log_actions",{operation:t[e],behavior_info:"on_new_create_flow_page"})},openModal:function(e,t){var n,o;if(this.logOperation(e),!this.isLoggedIn)return this.$EventBus.$emit("openLoginDialog",{dot:!1}),void this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});if(this.isAnimeEnhanceEnable&&["controlNet","imageToImage"].includes(e))this.$message.warning(this.$t("newGenerate20"));else{var r=null;"controlNet"===e&&((r={}).model=(null==t?void 0:t.default_model)||"None",r.module=(null==t?void 0:t.default_module)||"none",r.type=t.type),"controlNet"===e&&this.isHideControlNet||("controlNet"===e&&null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isCommunityFlux&&null!=this&&null!==(o=this.easyTop)&&void 0!==o&&null!==(o=o.config)&&void 0!==o&&null!==(o=o.textToImage)&&void 0!==o&&null!==(o=o.controlnet_units)&&void 0!==o&&o.length?this.$message(this.$t("newGenerate81")):("IpMaintain"!==e||this.showIpMaintain)&&("styleReference"!==e||this.showStyleReference)&&("imageToVideo"===e&&!this.showImageToVideo||"imageToLive2D"===e&&!this.showImageToLive2D||this.$emit("openUploadImage",{type:e,controlNetInfo:r,checkFace:"IpMaintain"===e})))}},handleSelect:function(e){this.$emit("openUploadImage",{type:"controlNet",controlNetInfo:e})},handleOpenPickControlNet:function(){if(!this.isLoggedIn)return this.$EventBus.$emit("openLoginDialog",{dot:!1}),void this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});this.isAnimeEnhanceEnable?this.$message.warning(this.$t("newGenerate20")):this.isHideControlNet||this.$refs.selectControlNetModal.show()}}},Xt=(n(5472),Object(_.a)(Kt,(function(){var e=this,t=e._self._c;return t("el-popover",{ref:"topBarPopover",attrs:{title:"",trigger:"click","popper-class":"image-and-control-net-popup","append-to-body":!0,"visible-arrow":!1,placement:"right-start"},on:{show:e.handlePopupShow,hide:e.handlePopupHide},scopedSlots:e._u([{key:"reference",fn:function(){return[e._t("default")]},proxy:!0}],null,!0),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isHideImageToImage,expression:"!isHideImageToImage"}],staticClass:"image-card-item",on:{click:function(t){return t.stopPropagation(),e.openModal("imageToImage")}}},[t("div",{staticClass:"image-card-item-title"},[e._v(e._s(e.$t("TaskUploadImage")))]),e._v(" "),t("div",{staticClass:"image-card-item-content"},[t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:"https://".concat(e.cdnHostFun(),"/static/upload/20240919/f4c390e3-8622-4a9b-a9c6-dd6a72866ac6.jpeg"),alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:"https://".concat(e.cdnHostFun(),"/static/upload/20240919/53cc0e90-573b-4e5e-a952-d56f5a87ff66.jpeg"),alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-text",attrs:{title:e.$t("newGenerate19")}},[e._v("\n        "+e._s(e.$t("newGenerate19"))+"\n      ")])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showImageToVideo,expression:"showImageToVideo"}],staticClass:"image-card-item",on:{click:function(t){return t.stopPropagation(),e.openModal("imageToVideo")}}},[t("div",{staticClass:"image-card-item-title"},[e._v(e._s(e.$t("ImageToVideo")))]),e._v(" "),t("div",{staticClass:"image-card-item-content"},[t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:e.imageToVideoCover[0],alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:e.imageToVideoCover[1],alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-text",attrs:{title:e.$t("newGenerate119")}},[e._v("\n        "+e._s(e.$t("newGenerate119"))+"\n      ")])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showImageToLive2D,expression:"showImageToLive2D"}],staticClass:"image-card-item",on:{click:function(t){return t.stopPropagation(),e.openModal("imageToLive2D")}}},[t("div",{staticClass:"image-card-item-title"},[e._v(e._s(e.$t("newGenerate122")))]),e._v(" "),t("div",{staticClass:"image-card-item-content"},[t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:e.imageToLive2DCover[0],alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-img"},[t("img",{attrs:{src:e.imageToLive2DCover[1],alt:""}})]),e._v(" "),t("div",{staticClass:"image-card-item-content-text",attrs:{title:e.$t("newGenerate120")}},[e._v("\n        "+e._s(e.$t("newGenerate120"))+"\n      ")])])]),e._v(" "),e._v(" "),t("select-control-net-modal",{ref:"selectControlNetModal",on:{confirm:e.handleSelect}})],1)}),[],!1,null,null,null).exports),qt=n(817),Yt=n(36);function Qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ei={name:"ParamInputPanel",props:["value","menuIndex"],inject:["easyTop"],mixins:[qt.promptPolishMixIn],components:{ImageAndControlNetPopup:Xt,ImageToImageCard:Gt.default,PickOrUploadImageModal:Ht.default,commonConfirmModal:ht.default},computed:{showImageUploadBtn:function(){var e;return"generateVideo"===this.menuIndex?0===(null===(e=this.value)||void 0===e||null===(e=e.imageToVideoList)||void 0===e?void 0:e.length)&&"txt2video"!==this.value.currentVideoInputToolTab:!this.hasExtraImages},isShowPromptPolish:function(){var e,t=(null==this||null===(e=this.value)||void 0===e?void 0:e.prompt)||"";return t&&t.length<100},getCurrentModelType:function(){var e=this.value.base_model_type||"",t=Object(Rt.getCurrentModelType)(e);return t||"sd"},showPlaceholder:function(){var e,t,n,o,r="WhatDoUWantToCreate",mask=null!==(e=this.value)&&void 0!==e&&null!==(e=e.imageToImageList)&&void 0!==e&&e.length?null===(t=this.value)||void 0===t||null===(t=t.imageToImageList[0])||void 0===t?void 0:t.mask:"";return null===(n=this.value)||void 0===n||null===(n=n.imageToImageList)||void 0===n||!n.length||["",null,void 0].includes(mask)||/^(http|https):\/\//.test(mask)||null!==(o=this.value)&&void 0!==o&&null!==(o=o.controlnet_units)&&void 0!==o&&o.length||(r="TaskImage2ImagePlaceholder"),r},hasExtraImages:function(){var e,t,n,o;return(null===(e=this.value)||void 0===e||null===(e=e.imageToImageList)||void 0===e?void 0:e.length)>0||(null===(t=this.value)||void 0===t||null===(t=t.controlnet_units)||void 0===t?void 0:t.length)>0||(null===(n=this.value)||void 0===n||null===(n=n.styleReferenceList)||void 0===n?void 0:n.length)>0||(null===(o=this.value)||void 0===o||null===(o=o.ipList)||void 0===o?void 0:o.length)>0},getCustomSizeOptions:function(){var e,t={min:128,max:1024};return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isCommunityFlux?{min:384,max:1024}:"sd"===this.getCurrentModelType?t:["sdxl","sd3"].includes(this.getCurrentModelType)?{min:128,max:1536}:t},getInputLimit:function(){var e,t;return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isPixVerse&&"effect"!==(null===(t=this.easyTop)||void 0===t?void 0:t.activeVideoInputTab)?2048:2e3}},data:function(){return{isZoom:!1,imagePopupVisible:!1,imageToImageTemplate:{url:"",denoising_strength:.35,mask:"",copyMask:"",enable:!0,width:0,height:0},isLoading:!1,imageSizeOptions:[{code:1,label:"2:3",icon:"icon-a-2_3",sd:{standard:{width:512,height:768}},sdxl:{standard:{width:768,height:1152}},flux:{standard:{width:688,height:1024},quality:{width:1024,height:1536}}},{code:2,label:"1:1",icon:"icon-icon-a-1_11",sd:{standard:{width:768,height:768}},sdxl:{standard:{width:1024,height:1024}},flux:{standard:{width:1024,height:1024},quality:{width:1536,height:1536}}},{code:3,label:"9:16",icon:"icon-a-9_161",sd:{standard:{width:432,height:768}},sdxl:{standard:{width:810,height:1440}},flux:{standard:{width:592,height:1024},quality:{width:864,height:1536}}},{code:4,label:"4:3",icon:"icon-a-4_31",sd:{standard:{width:768,height:576}},sdxl:{standard:{width:1024,height:768}},flux:{standard:{width:1024,height:768},quality:{width:1536,height:1152}}},{code:5,label:"custom",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}]}},methods:{handleStartPromptPolish:function(){var e;this.isPromptPolishing||this.isLoading||this.handlePromptPolish((null==this||null===(e=this.value)||void 0===e?void 0:e.prompt)||"","updatePrompt")},updatePrompt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.changeConfig(e,"prompt")},handleClickRandomPrompt:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r,l,d,c,pattern,text;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isPromptPolishing&&!e.isLoading){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,r={},null!==(n=e.value)&&void 0!==n&&n.art_model_no&&(r.art_model_no=(null===(l=e.value)||void 0===l?void 0:l.art_model_no)||""),r.scene="tf_v2",r.base_model_name=(null===(o=e.value)||void 0===o?void 0:o.base_model_type)||"",e.isLoading=!0,t.next=10,Object(Yt.getRandomPrompts)(r);case 10:if(d=t.sent,c=d.data.local,e.isLoading=!1,pattern=/--V6|--v6/g,text=(c||"").replace(pattern,""),!["",null,void 0].includes(text)){t.next=17;break}return t.abrupt("return");case 17:e.changeConfig(text,"prompt"),t.next=22;break;case 20:t.prev=20,t.t0=t.catch(2);case 22:case"end":return t.stop()}}),t,null,[[2,20]])})))()},handleOpenPickWorkModal:function(){var e,t,n,o,r,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;l&&"imageToImage"===l.type&&null!==(e=this.value.imageToImageList)&&void 0!==e&&e.length||l&&"controlNet"===l.type&&(null===(t=this.value)||void 0===t||null===(t=t.controlnet_units)||void 0===t?void 0:t.length)>=3?this.$message.warning(this.$t("newGenerate41")):l&&"IpMaintain"===l.type&&(null===(n=this.value)||void 0===n||null===(n=n.ipList)||void 0===n?void 0:n.length)>=1?this.$message.warning(this.$t("newGenerate64")):l&&"styleReference"===l.type&&(null===(o=this.value)||void 0===o||null===(o=o.styleReferenceList)||void 0===o?void 0:o.length)>=4||l&&["imageToVideo","imageToLive2D"].includes(l.type)&&null!==(r=this.value)&&void 0!==r&&null!==(r=r.imageToVideoList)&&void 0!==r&&r.length?this.$message.warning(this.$t("newGenerate81")):this.$refs.pickOrUploadImageModal.openModal([],l||null)},handlePickImage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&"imageToImage"===t.type){var n=JSON.parse(JSON.stringify(this.imageToImageTemplate));n=Zt(Zt({},n),e[0]||{}),this.handleUpdateImageSize(n),this.changeConfig([n],"imageToImageList"),this.handleClosePopup()}},changeConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));t&&(o[t]=e),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)},handleClosePopup:function(){try{this.$refs.imageControlNetPopup.onClose()}catch(e){}},handleUpdateImageSize:function(){var e,t,n,o,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(null==r||null===(e=r.info)||void 0===e?void 0:e.banner)||(null==r?void 0:r.banner)||{},d=l.width,c=l.height,v=JSON.parse(JSON.stringify(this.value)),m=(this.imageSizeOptions,{});m=this.convertStudioBaseSize(d,c,this.getCustomSizeOptions),v.width=(null===(t=m)||void 0===t?void 0:t.width)||(null==v?void 0:v.width),v.height=(null===(n=m)||void 0===n?void 0:n.height)||(null==v?void 0:v.height),null==this||null===(o=this.easyTop)||void 0===o||o.updateConfig(v)},convertStudioBaseSize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=(this.imageSizeOptions||[]).filter((function(e){return 5!==e.code})).map((function(e){return e.width=e.sd.standard.width,e.height=e.sd.standard.height,e})),r={},l=parseFloat((e/t).toFixed(2)),d=o.find((function(e){var t=parseFloat((e.width/e.height).toFixed(2));return l===t})),c=n;if(d){var v=this.getCurrentModelType;["sd","sdxl"].includes(v)&&(r=d[v].standard),["flux"].includes(v)&&(r=d[v].standard)}else{var m=Object(tt.resizeToBaseDimension)(e,t,c.max);r.width=m.width,r.height=m.height,r.isCustom=!0}return r},handleDeleteImageToVideo:function(e){var t;null===(t=this.easyTop)||void 0===t||t.deleteImageToVideo(e)}}},ti=ei,ii=(n(5473),Object(_.a)(ti,(function(){var e,t,n,o,r=this,l=r._self._c;return l("div",{staticClass:"c-param-input-panel"},[l("div",{staticClass:"param-input-panel-title"},[l("span",{staticClass:"sub"},[r._v("\n      "+r._s(r.$t("Prompt"))+"\n      "),l("span",{directives:[{name:"show",rawName:"v-show",value:"img2video"===(null===(e=r.value)||void 0===e?void 0:e.currentVideoInputToolTab)&&"generateVideo"===r.menuIndex,expression:"value?.currentVideoInputToolTab === 'img2video' && menuIndex === 'generateVideo'"}],staticClass:"sub-text"},[r._v("\n        ("+r._s(r.$t("Optional"))+")\n      ")])]),r._v(" "),l("el-switch",{directives:[{name:"show",rawName:"v-show",value:"img2video"===(null===(t=r.value)||void 0===t?void 0:t.currentVideoInputToolTab)&&"generateVideo"===r.menuIndex,expression:"value?.currentVideoInputToolTab === 'img2video' && menuIndex === 'generateVideo'"}],model:{value:r.isZoom,callback:function(e){r.isZoom=e},expression:"isZoom"}})],1),r._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:r.isZoom||"generateVideo"!==r.menuIndex||"txt2video"===(null===(n=r.value)||void 0===n?void 0:n.currentVideoInputToolTab),expression:"isZoom || menuIndex !== 'generateVideo' || value?.currentVideoInputToolTab === 'txt2video'"}],staticClass:"param-input-panel-main"},[l("div",{staticClass:"param-input-bar"},[l("el-input",{staticClass:"prompt-textarea",attrs:{type:"textarea",resize:"none",maxlength:r.getInputLimit,"show-word-limit":!1,value:r.value.prompt,placeholder:r.$t(r.showPlaceholder),autosize:!1},on:{input:function(e){return r.changeConfig(e,"prompt")}}}),r._v(" "),l("div",{staticClass:"param-input-panel-tool-bar"},[l("image-and-control-net-popup",{directives:[{name:"show",rawName:"v-show",value:r.showImageUploadBtn,expression:"showImageUploadBtn"}],ref:"imageControlNetPopup",on:{openUploadImage:r.handleOpenPickWorkModal,show:function(e){r.imagePopupVisible=!0},hide:function(e){r.imagePopupVisible=!1}}},[l("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:r.$t("newGenerate68"),placement:"top-start"}},[l("span",{staticClass:"top-input-box-icon"},[l("i",{staticClass:"iconfont icon-a-icon-addimg2img"})])])],1),r._v(" "),l("span",{staticClass:"top-input-box-icon",on:{click:function(e){return e.stopPropagation(),r.handleClickRandomPrompt.apply(null,arguments)}}},[l("i",{staticClass:"iconfont icon-dice-square",class:[r.isLoading&&"random-prompt-loading"]})]),r._v(" "),l("span",{directives:[{name:"show",rawName:"v-show",value:r.isShowPromptPolish,expression:"isShowPromptPolish"}],staticClass:"top-input-box-icon",on:{click:function(e){return e.stopPropagation(),r.handleStartPromptPolish.apply(null,arguments)}}},[l("i",{staticClass:"iconfont icon-gpt-advance",class:[r.isPromptPolishing&&"random-prompt-loading"]})])],1)],1),r._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:"img2video"===(null===(o=r.value)||void 0===o?void 0:o.currentVideoInputToolTab),expression:"value?.currentVideoInputToolTab === 'img2video'"}],staticClass:"param-additional-bar"},[r._l(r.value.imageToImageList,(function(image,i){return l("image-to-image-card",{key:"image_".concat(i),attrs:{value:r.value,type:"image",cardInfo:image}})})),r._v(" "),r._l(r.value.imageToVideoList,(function(image,i){return l("image-to-image-card",{key:"imageToVideo_".concat(i),attrs:{value:r.value,type:"imageToVideo",cardInfo:image},on:{delete:function(e){return r.handleDeleteImageToVideo(i)}}})}))],2)]),r._v(" "),l("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",on:{confirm:r.handlePickImage}}),r._v(" "),l("common-confirm-modal",{ref:"commonConfirmModal"})],1)}),[],!1,null,"5e84d9cf",null)),ni=ii.exports;function oi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ai(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oi(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ri={name:"EasyGenerateModePanel",props:["value","menuIndex"],inject:["easyTop"],components:{commonConfirmModal:ht.default,ImageSizeOptionsPopup:At.default,SliderItem:Nt.default,VideoUpload:zt.default,SpecialEffectsImage:Ft.default,MarkImgSelect:Ut.default,SpecialEffectsAppPanel:Bt.default,ParamInputPanel:ni},data:function(){return{createSetting:1,imageSizeOptions:[{code:1,label:"2:3",icon:"icon-a-2_3",sd:{standard:{width:512,height:768}},sdxl:{standard:{width:768,height:1152}},flux:{standard:{width:688,height:1024},quality:{width:1024,height:1536}}},{code:2,label:"1:1",icon:"icon-icon-a-1_11",sd:{standard:{width:768,height:768}},sdxl:{standard:{width:1024,height:1024}},flux:{standard:{width:1024,height:1024},quality:{width:1536,height:1536}}},{code:3,label:"9:16",icon:"icon-a-9_161",sd:{standard:{width:432,height:768}},sdxl:{standard:{width:810,height:1440}},flux:{standard:{width:592,height:1024},quality:{width:864,height:1536}}},{code:4,label:"4:3",icon:"icon-a-4_31",sd:{standard:{width:768,height:576}},sdxl:{standard:{width:1024,height:768}},flux:{standard:{width:1024,height:768},quality:{width:1536,height:1152}}},{code:5,label:"more",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}],imageSizeOptionsMore:Rt.IMAGE_SIZE_OPTIONS_MORE,pixVerseGenerationList:_t.PIX_VERSE_GENERATION_MODE,currentImageSize:1,isLockSize:!1,lockSize:{width:1,height:1,aspectRatio:1},showAspectRatio:"1:1",debounceComputedAspectRatio:function(){},debounceCheckActiveSizeMode:function(){},videoDuration:[{code:5,label:"5s"},{code:10,label:"10s"}],lastFrameState:!1}},created:function(){this.debounceComputedAspectRatio=Object(Vt.debounce)(this.getSizeAspectRatio,500),this.debounceCheckActiveSizeMode=Object(Vt.debounce)(this.checkAutoActiveSizeMode,500),this.$EventBus.$on("closeAllGeneratePopup",this.closeImageSizeOptionPopup)},beforeDestroy:function(){this.debounceComputedAspectRatio=null,this.debounceCheckActiveSizeMode=null,this.$EventBus.$off("closeAllGeneratePopup",this.closeImageSizeOptionPopup)},computed:ai(ai(ai(ai({},Object(c.c)("payment",["paymentInfo"])),Object(c.c)("creation",["pixVerseStyleList"])),Object(c.c)("user",["isCompanyAccount","isLoggedIn","userInfo"])),{},{disableBasicMode:function(){var e,t,n,o="txt2video"===(null===(e=this.easyTop)||void 0===e?void 0:e.activeVideoInputTab),r=null===(t=this.easyTop)||void 0===t?void 0:t.isKL10Model;return!o&&!r&&(null===(n=this.value)||void 0===n||null===(n=n.imageToVideoList)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.lastFrame)},renderPixVerseStyleList:function(){var e=((null==this?void 0:this.pixVerseStyleList)||[]).map((function(e){return e.label=e.name,e}));return[{label:this.$t("createModeType1"),value:"",img:""}].concat(Object(o.a)(e))},isShowVideoGenerateMode:function(){var e;return null===(e=this.easyTop)||void 0===e?void 0:e.isPixVerse},isShowFluency:function(){var e;return null===(e=this.easyTop)||void 0===e?void 0:e.isPixVerse},renderFluency:function(){return[{code:"normal",label:"fast_ai_standard"},{code:"fast",label:"fast_ai_fluent"}]},renderVideoDuration:function(){var e;return null!==(e=this.easyTop)&&void 0!==e&&e.isPixVerse?[{code:5,label:"5s"},{code:8,label:"8s"}]:this.videoDuration},showFixedVideoDuration:function(){var e,t=this.easyTop.isKLVideoModel,n=null===(e=this.easyTop)||void 0===e?void 0:e.isPixVerse;return t||n},isShowSizeText:function(){var e;return!(null!==(e=this.easyTop)&&void 0!==e&&e.isPixVerse)},isShowSpecialEffects:function(){var e,t=null===(e=this.easyTop)||void 0===e?void 0:e.isVideoModel,n="effect"===this.value.currentVideoInputToolTab;return t&&n},isShowVideoDuration:function(){var e,t,n=this.isHunyuan,o=(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isTongYiFast)&&(null==this||null===(t=this.value)||void 0===t||null===(t=t.imageToVideoList)||void 0===t?void 0:t.length);return n||o},isDisableGenModePanel:function(){var e,t;return(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isDisableSupportQuality)||(null===(t=this.easyTop)||void 0===t?void 0:t.isAnimeEnhanceEnable)},isShowRelevance:function(){return this.easyTop.isKLVideoModel},renderVideoSizeOptions:function(){var e=_t.MODEL_CONFIG_TEMPLATE[this.value.base_model_type]||{};return(null==e?void 0:e.sizeOptions)||[]},isShowFree:function(){var e,t,n,o=!this.isCompanyAccount,r=!this.isMiniMax,l=!this.easyTop.isHunyuan,d=!this.easyTop.isKLVideoModel,c=!this.easyTop.isTongYiFast&&!this.easyTop.isTongYiProfessional,v=!(null!==(e=this.easyTop)&&void 0!==e&&e.isPixVerse),m=!(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isHiDreamModel),h=!(null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isSeaArtFilmModel);return o&&r&&l&&d&&c&&v&&m&&h},isShowVideoSize:function(){var e,t,n,o,r=!(null!=this&&this.isMiniMax),l=(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isKLVideoModel)||(null==this?void 0:this.isHunyuan)||(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isTongYiFast)||(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isTongYiProfessional)||(null==this||null===(o=this.easyTop)||void 0===o?void 0:o.isPixVerse);return r&&l},UnlimitedQueueTip:function(){return this.isCompanyAccount?"ToBUnlimitedQueueTip":"UnlimitedQueueTip"},queueRenderList:function(){return[{code:1,i18nKey:"NormalQueue",tips:"",show:!this.isVipFun},{code:2,i18nKey:"SubsBottomTerms2",tips:"",isVip:!0,show:this.isVipFun},{code:3,i18nKey:"UnlimitedQueue",tips:this.UnlimitedQueueTip,isVip:!0,show:!0}].filter((function(e){return e.show}))},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},canUseUnlimitedQueue:function(){var e;return null===(e=this.paymentInfo)||void 0===e?void 0:e.infiniteQueue},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},vipLevel:function(){var e;return null===(e=this.paymentInfo)||void 0===e?void 0:e.productLevel},isShowGenerateMode:function(){var e,t,n,o,r=!this.isMiniMax,l=!this.easyTop.isHunyuan,d=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isTongYiFast||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isTongYiProfessional),c=!(null!==(n=this.easyTop)&&void 0!==n&&n.isPixVerse),v=!(null!==(o=this.easyTop)&&void 0!==o&&o.isHiDreamModel);return r&&l&&d&&c&&v},isShowPromptMagic:function(){var e,t,n,o,r,l,d=[null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isCommunityFlux,null==this||null===(t=this.getCurrentModelType)||void 0===t?void 0:t.includes("SD 3.5"),null==this?void 0:this.isHunyuan,null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isHiDreamModel,null==this||null===(o=this.easyTop)||void 0===o?void 0:o.isSeaArtFilmModel,(null==this||null===(r=this.easyTop)||void 0===r?void 0:r.isTongYiFast)||(null==this||null===(l=this.easyTop)||void 0===l?void 0:l.isTongYiProfessional)].some((function(e){return e})),c=!this.isKLModel,v=!this.isMiniMax;return d&&c&&v},isShowImageNum:function(){var e,t,n,o=!this.isHunyuan,r=!this.isKLModel,l=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isTongYiFast),d=!(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isTongYiProfessional),c=!(null!==(n=this.easyTop)&&void 0!==n&&n.isPixVerse);return o&&r&&l&&d&&c},isShowGenerateNum:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isShowGenerateNum},isShowImageSize:function(){var e,t,n,o,r=["img2video","img2Live2d"].includes(null==this||null===(e=this.value)||void 0===e?void 0:e.currentVideoInputToolTab),l=!this.isMiniMax,d=this.isKLModel&&r,c=((null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isTongYiFast)||(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isTongYiProfessional))&&r,v=(null===(o=this.easyTop)||void 0===o?void 0:o.isPixVerse)&&r;return l&&!d&&!c&&!v},imageNumLimit:function(){var e=4;return this.isMiniMax&&(e=3),e},isVideoModel:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isVideoModel},isMiniMax:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isMiniMax},isHunyuan:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isHunyuan},isKLModel:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isKLModel},isSDXLModel:function(){var e=this.value.base_model_type;return["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].concat(Object(o.a)(et.L.sdxl)).includes(e)||(e||"").includes("SDXL")},showAnimeStrong:function(){var e,t,n=null==this||null===(e=this.easyTop)||void 0===e?void 0:e.getStudioModelTagsType(this.value),o=!this.isMiniMax,r=this.isSDXLModel,l=!this.isHunyuan,d=!(null!==(t=this.easyTop)&&void 0!==t&&t.isPixVerse);return o&&r&&l&&d&&"anime"===n},getCustomSizeOptions:function(){var e,t={min:128,max:1024},n={min:384,max:1024};return null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isCommunityFlux?n:"sd"===this.getCurrentModelType?t:["sdxl"].includes(this.getCurrentModelType)?{min:128,max:1536}:"SD 3.5"===this.getCurrentModelType?n:t},isCurrentImageNum:function(){return function(i){return this.value.n_iter===i}},getCurrentModelType:function(){var e=this.value.base_model_type||"",t=Object(Rt.getCurrentModelType)(e);return t||"sd"},showVideoUpload:function(){var e,t,n,o,r;return(null===(e=this.easyTop)||void 0===e?void 0:e.isKLModel)||(null===(t=this.easyTop)||void 0===t?void 0:t.isMiniMax)||(null===(n=this.easyTop)||void 0===n?void 0:n.isTongYiFast)||(null===(o=this.easyTop)||void 0===o?void 0:o.isTongYiProfessional)||(null===(r=this.easyTop)||void 0===r?void 0:r.isPixVerse)},showVideoUploadContent:function(){var e,t,n,o=null===(e=this.easyTop)||void 0===e?void 0:e.isVideoModel,r=null==this||null===(t=this.value)||void 0===t?void 0:t.currentVideoInputToolTab,l=o&&["img2video"].includes(r),d=["img2Live2d"].includes(r)&&(null===(n=this.easyTop)||void 0===n?void 0:n.isMiniMax);return l||d},checkVideoGenerationModeStatus:function(){return function(code){var e,t=!1;if(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isPixVerse&&"1080p"===code){var n,o,r=8===(null===(n=this.value)||void 0===n||null===(n=n.generate_video)||void 0===n?void 0:n.generate_video_duration),l="fast"===(null===(o=this.value)||void 0===o||null===(o=o.generate_video)||void 0===o?void 0:o.motion_mode);t=r||l}return t}},checkVideoDurationStatus:function(){return function(code){var e,t,n=!1;null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isPixVerse&&8===code&&(n="fast"===(null===(t=this.value)||void 0===t||null===(t=t.generate_video)||void 0===t?void 0:t.motion_mode));return n}},showParamInputPanel:function(){var e,t,n,o="generateImage"===(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.currentTab),r="generateVideo"===(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.currentTab)&&!["effect"].includes(null==this||null===(n=this.value)||void 0===n?void 0:n.currentVideoInputToolTab);return o||r}}),watch:{"userInfo.settings.is_auto_pub_community":{handler:function(e){this.isLoggedIn?this.createSetting=e?1:2:this.createSetting=1},immediate:!0},isLoggedIn:{handler:function(e){!e&&(this.createSetting=1)},immediate:!0,deep:!0},"value.generate":{handler:function(e,t){(null==e?void 0:e.gen_mode)!==(null==t?void 0:t.gen_mode)&&this.checkNeedUpdateSize()},immediate:!0,deep:!0},"value.width":{handler:function(e){this.lockSize||(this.lockSize.width=e,this.lockSize.height=this.value.height),this.debounceComputedAspectRatio&&this.debounceComputedAspectRatio(),this.debounceCheckActiveSizeMode&&this.debounceCheckActiveSizeMode()},immediate:!0,deep:!0},"value.height":{handler:function(e){this.lockSize||(this.lockSize.height=e,this.lockSize.width=this.value.width),this.debounceComputedAspectRatio&&this.debounceComputedAspectRatio(),this.debounceCheckActiveSizeMode&&this.debounceCheckActiveSizeMode()},immediate:!0,deep:!0},"easyTop.currentModelType":{handler:function(e,t){try{e&&e!==t&&this.checkNeedUpdateSize()}catch(e){}},immediate:!0,deep:!0},"value.imageToImageList":{handler:function(e,t){null!=e&&e.length&&this.checkAutoActiveSizeMode()},immediate:!0,deep:!0},"value.art_model_no":{handler:function(e,t){e&&["",null,void 0].includes(t)&&this.checkNeedUpdateSize()},immediate:!0},"value.imageToVideoList":{handler:function(e){var t,n=null==e?void 0:e.some((function(e){return null==e?void 0:e.lastFrame}));if(n&&!this.lastFrameState&&(null===(t=this.easyTop)||void 0===t||!t.isKL10Model)&&(this.easyTop.isKL15Model||this.easyTop.isKL16Model)){var o,r=JSON.parse(JSON.stringify(this.value));r.generate.gen_mode=1,null==this||null===(o=this.easyTop)||void 0===o||o.updateConfig(r,this.menuIndex),this.$message.success(this.$t("LastFrameOnlyQualityMode"))}this.lastFrameState=n},deep:!0}},methods:ai(ai({},Object(c.b)("user",["getAccountInfo"])),{},{selectEffect:function(e){var t;console.log(e,"selectEffect"),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig({SpecialEffectsAppInfo:e},this.menuIndex)},selectSample:function(e){var t;console.log(e,"selectSample"),null==this||null===(t=this.easyTop)||void 0===t||t.updateEffectImage({url:null==e?void 0:e.url},0)},changeVideoConfig:function(e,t){var n,o,r,l,d=JSON.parse(JSON.stringify(this.value));("relevance"===t&&(d.generate_video.relevance=e),"generate_video_duration"!==t||null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isPixVerse)||(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isFixedDuration?d.generate_video.generate_video_duration=5:d.generate_video.generate_video_duration=e);null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isPixVerse&&(d=this.handlePixVerseConflict(d,e,t)),null==this||null===(r=this.easyTop)||void 0===r||r.updateConfig(d)},handlePixVerseConflict:function(source,e,t){return"generate_video_duration"===t&&(source.generate_video.generate_video_duration=e,8===e&&"1080p"===source.generate_video.quality_mode&&(source.generate_video.generate_video_duration=8,source.generate_video.quality_mode="720p"),8===e&&"fast"===source.generate_video.motion_mode&&(source.generate_video.generate_video_duration=5)),"motion_mode"===t&&(source.generate_video.motion_mode=e,"fast"===e&&"1080p"===source.generate_video.quality_mode&&(source.generate_video.quality_mode="720p"),"fast"===e&&(source.generate_video.generate_video_duration=5)),source},handleUpdateVideoSize:function(e){this.updateImageSize({width:e.width,height:e.height,aspect_ratio:e.aspectRatio})},handleQueueSelectChange:function(e){var t;if(this.$logEvent("log_actions",{operation:"click_free_create",behavior_info:"on_new_create_flow_page",behavior_info_sub:3===e?"open":"close"}),3===e&&!this.isLoggedIn)return this.$EventBus.$emit("openLoginDialog",{dot:!1}),void this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});![3].includes(e)||3!==e||this.isVipFun?[3].includes(e)&&this.isStudioMode&&this.isCompanyAccount||([3].includes(e)&&this.isOnlyVipLite?this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard"):![3].includes(e)||this.canUseUnlimitedQueue?(localStorage.setItem("speed_type",e),null==this||null===(t=this.easyTop)||void 0===t||t.updateSpeedType(e)):this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard")):this.$EventBus.$emit("showBreakDialog","UnlimitedQueueTipWeb","standard")},closeImageSizeOptionPopup:function(){try{var e;null===(e=this.$refs)||void 0===e||null===(e=e.ImageSizeOptionsPopup)||void 0===e||e.handleClose()}catch(e){}},resetData:function(){this.isLockSize=!1,this.lockSize={width:1,height:1,aspectRatio:1},this.showAspectRatio="1:1",this.currentImageSize=1},getSizeAspectRatio:function(){var e=this.isLockSize?this.lockSize.width:this.value.width,t=this.isLockSize?this.lockSize.height:this.value.height,n=(_t.checkImageSizeList||[]).find((function(n){return n.width===e&&n.height===t}));this.showAspectRatio=n?null==n?void 0:n.showAspectRatio:Object(Rt.calculateAspectRatio)(e,t)},changeLockStatus:function(){this.lockSize.width=this.value.width,this.lockSize.height=this.value.height,this.isLockSize=!this.isLockSize},checkAutoActiveSizeMode:function(){var e;if(null==this||null===(e=this.easyTop)||void 0===e||!e.isVideoModel){var t=this.value,n=t.width,o=t.height,r=(_t.checkImageSizeList||[]).find((function(e){return e.width===n&&e.height===o}));this.currentImageSize=r?r.code:5}},checkNeedUpdateSize:function(){var e,t=this;if(null==this||null===(e=this.easyTop)||void 0===e||!e.isVideoModel){var n=this.value,o=n.width,r=n.height,l={width:o,height:r},d=(_t.checkImageSizeList||[]).find((function(e){return e.width===o&&e.height===r}));if(this.currentImageSize=d?d.code:5,5!==this.currentImageSize)this.imageSizeOptions.forEach((function(e){if((null==e?void 0:e.code)===t.currentImageSize){var n="SD 3.5"===t.getCurrentModelType?"flux":t.getCurrentModelType;["sd","sdxl"].includes(n)&&(l=e[n].standard),["flux"].includes(n)&&(l=e[n].standard)}})),this.updateImageSize(l);else{var c=this.convertStudioBaseSize(o,r,this.getCustomSizeOptions);null!=c&&c.isCustom&&(this.currentImageSize=5),this.updateImageSize({width:null==c?void 0:c.width,height:null==c?void 0:c.height})}}},convertStudioBaseSize:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=(this.imageSizeOptions||[]).filter((function(e){return 5!==e.code})).map((function(e){return e.width=e.sd.standard.width,e.height=e.sd.standard.height,e})),r={},l=parseFloat((e/t).toFixed(2)),d=o.find((function(e){var t=parseFloat((e.width/e.height).toFixed(2));return l===t})),c=n;if(d){var v=this.getCurrentModelType;["sd","sdxl"].includes(v)&&(r=d[v].standard),["flux"].includes(v)&&(r=d[v].standard)}else{var m=Object(tt.resizeToBaseDimension)(e,t,c.max);r.width=m.width,r.height=m.height,r.isCustom=!0}return r},handleSwitchAnimeEnhance:function(e,t){var n,o,r,l=this;if(this.$logEvent("log_actions",{operation:"click_anime_enhance",behavior_info:"on_new_createflow_page"}),(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isShowAnimeEnhance)&&((null==this||null===(o=this.value)||void 0===o||null===(o=o.imageToImageList)||void 0===o?void 0:o.length)||(null===(r=this.value)||void 0===r||null===(r=r.controlnet_units)||void 0===r?void 0:r.length))&&1===e)try{var d;null===(d=this.$refs)||void 0===d||null===(d=d.commonConfirmModal)||void 0===d||d.show({subTitle:"newGenerate1"}).then((function(){l.clearAnimeEnhanceParams(e,t)}))}catch(e){}else this.changeConfig(e,t)},clearAnimeEnhanceParams:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));o.sampler_name="DPM++ 2M Karras",o.imageToImageList=[],o.controlnet_units=[],o.generate[t]=e,1===e&&(o.generate.gen_mode=0),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)},changeConfig:function(e,t){var n,o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!this.disableBasicMode||"gen_mode"!==t||0!==e){this.handleLogEvent(t,e),this.$EventBus.$emit("needCheckInputPackUp","paramsPanel");var l,d=JSON.parse(JSON.stringify(this.value));if("gen_mode"===t&&1===e&&!this.isLoggedIn)return this.$EventBus.$emit("openLoginDialog",{dot:!1}),void this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});if(this.isVipFun||"gen_mode"!==t||1!==e)if(null==this||null===(n=this.easyTop)||void 0===n||!n.isKLModel||this.canUseUnlimitedQueue||this.isCompanyAccount||""!==r){if("gen_mode"!==t||1!==e||!this.isDisableGenModePanel){if("n_iter"===t&&this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"}),"n_video_iter"===t&&2===e&&"vip2"===r){if(!this.isLoggedIn)return void this.$EventBus.$emit("openLoginDialog");if(this.vipLevel<2)return void this.$EventBus.$emit("showBreakDialog","video_vip_tips_web","standard","SpecificPop_QualityWork",["standard","professional","master"])}t&&!["anime_enhance","prompt_magic_mode","gen_mode"].includes(t)?(d[t]=e,"n_iter"===t&&localStorage.setItem("imageNums",e)):(d.generate[t]=e,"anime_enhance"===t&&(d.sampler_name="DPM++ 2M Karras",1===e&&(d.generate.gen_mode=0))),null==this||null===(o=this.easyTop)||void 0===o||o.updateConfig(d)}}else this.$EventBus.$emit("showBreakDialog","UpgradeQualityModel","standard","",["standard","professional","master"]);else null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isKLModel?this.$EventBus.$emit("showBreakDialog","UpgradeQualityModel","standard","",["standard","professional","master"]):this.$EventBus.$emit("showBreakDialog","newGenerate51","basic")}},changePixVerseConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value)),r=(this.pixVerseGenerationList||[]).filter((function(e){return null==e?void 0:e.isVip})).map((function(e){return null==e?void 0:e.code}));if("quality_mode"!==t||!r.includes(e)||this.isLoggedIn){if((!this.isVipFun||this.isVipFun&&!this.canUseUnlimitedQueue)&&"quality_mode"===t&&r.includes(e))this.$EventBus.$emit("showBreakDialog","UpgradeQualityModel","standard","",["standard","professional","master"]);else if("quality_mode"!==t||!this.checkVideoGenerationModeStatus(e)){if(t&&!["motion_mode","quality_mode","style"].includes(t))o[t]=e;else try{"motion_mode"===t&&"fast"===e&&"1080p"===o.generate_video.quality_mode&&(o.generate_video.quality_mode="720p"),"motion_mode"===t&&"fast"===e&&(o.generate_video.generate_video_duration=5),o.generate_video[t]=e}catch(e){}null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)}}else this.$EventBus.$emit("openLoginDialog",{dot:!1})},handleQualityLogEvent:function(source,e){try{var t,n=(null===(t=this.value)||void 0===t?void 0:t.base_model_type)||"";if(!e||!n)return;this.$logEvent("log_actions",{operation:e,behavior_info:"on_new_create_flow_page",behavior_info_sub:n})}catch(e){}},handleLogEvent:function(e,t){var n,o,r,l="",d="";switch(e){case"gen_mode":var c;if(l="click_generate_model",d=1===t?"quality":"standard",null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isVideoModel)null==this||null===(c=this.easyTop)||void 0===c||c.handleVideoModelLogEvent("qualityMode",1===t?"click_quality_model_off":"click_quality_model_on");this.handleQualityLogEvent("qualityMode",1===t?"click_quality_model_off":"click_quality_model_on");break;case"prompt_magic_mode":l="click_prompt_magic";d={0:"auto",1:"open",2:"close"}[t]||"";break;case"click_image_setting":l="click_image_setting",d=t;break;case"n_iter":l="click_image_numbers",d=t;break;case"createSetting":var v;if(l="click_private_model",d=t,console.log(t,"视频打点时候的val"),null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isVideoModel)null==this||null===(v=this.easyTop)||void 0===v||v.handleVideoModelLogEvent("privateMode","close"===t?"click_private_model_off":"click_private_model_on");this.handleQualityLogEvent("privateMode","close"===t?"click_private_model_off":"click_private_model_on")}if(l&&(!["gen_mode","createSetting"].includes(e)||null==this||null===(r=this.easyTop)||void 0===r||!r.isVideoModel)){var m={operation:l,behavior_info:"on_new_create_flow_page"};m.behavior_info_sub=d,this.$logEvent("log_actions",m)}},customSizeChange:function(e,t){if(this.isLockSize){var n=this.calculateDimensions(t,e),o=this.getCustomSizeOptions.max,r=this.getCustomSizeOptions.min;[null==n?void 0:n.width,null==n?void 0:n.height].every((function(e){return e>=r&&e<=o}))&&this.updateImageSize({width:null==n?void 0:n.width,height:null==n?void 0:n.height})}else{var l,d=JSON.parse(JSON.stringify(this.value));d[t]=e,null===(l=this.easyTop)||void 0===l||l.updateConfig(d)}},calculateDimensions:function(e,t){var n,o,r=this.lockSize.width,l=this.lockSize.height,d=this.getCustomSizeOptions.max,c=this.getCustomSizeOptions.min;return"width"===e?o=(n=t)/r*l:n=(o=t)/l*r,n>d?o=(n=d)/r*l:n<c&&(o=(n=c)/r*l),o>d?n=(o=d)/l*r:o<c&&(n=(o=c)/l*r),{width:Math.round(n),height:Math.round(o)}},handleCreateSettingSelectChange:function(e){return this.handleLogEvent("createSetting",[2,"2"].includes(e)?"open":"close"),console.log(this.isLoggedIn,"登录状态"),this.isLoggedIn?[2,"2"].includes(e)&&!this.paymentInfo.show_auto_pub_switch?(this.$EventBus.$emit("showBreakDialog","PrivateWorkTipWeb","basic"),void(this.createSetting=1)):void(this.isLoggedIn&&this.saveSettings(e)):(this.$EventBus.$emit("openLoginDialog",{dot:!1}),this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"}),void(this.createSetting=1))},saveSettings:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loading=!0;var n={};n.auto_pub_community=t,n.mode=1,Object(Dt.c)(n).then((function(n){var o=(n||{}).status.code;["10000",1e4].includes(void 0===o?"":o)&&(e.$message.success(e.$t("SaveSuccess")),e.createSetting=t,e.loading=!1,e.getAccountInfo())})).finally((function(){e.loading=!1}))},handleUpdateSize:function(){var e,t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$EventBus.$emit("needCheckInputPackUp","paramsPanel"),this.currentImageSize=r.code;var l=Object(o.a)(this.imageSizeOptionsMore).find((function(e){return(null==e?void 0:e.code)===(null==r?void 0:r.code)}));if(5===(null==r?void 0:r.code)&&(l={code:5,label:"newGenerate43",icon:"icon-icon-Custom",sd:{},sdxl:{},flux:{}}),this.isLockSize=!1,this.handleLogEvent("click_image_setting",5===(null===(e=l)||void 0===e?void 0:e.code)?"custom":null===(t=l)||void 0===t?void 0:t.label),5!==(null===(n=l)||void 0===n?void 0:n.code)){var d="SD 3.5"===this.getCurrentModelType?"flux":this.getCurrentModelType;["sd","sdxl","flux"].includes(d)&&this.updateImageSize(l[d].standard)}},updateImageSize:function(e){var t,n=e.width,o=e.height,r=JSON.parse(JSON.stringify(this.value));n&&(r.width=n||(null==r?void 0:r.width),r.height=o||(null==r?void 0:r.height)),o&&(r.height=o||(null==r?void 0:r.height)),null===(t=this.easyTop)||void 0===t||t.updateConfig(r)}})},si=ri,di=(n(5474),Object(_.a)(si,(function(){var e,t,o,r,l,d,c,v,m,h,f,_,y,C,T,w=this,x=w._self._c;return x("div",{staticClass:"c-easy-generate-mode-panel"},[[w.isShowSpecialEffects?[x("special-effects-app-panel",{attrs:{value:w.value,menuIndex:w.menuIndex},on:{selectEffect:w.selectEffect,selectSample:w.selectSample}})]:w._e()],w._v(" "),w.showVideoUpload?x("video-upload",{directives:[{name:"show",rawName:"v-show",value:w.showVideoUploadContent,expression:"showVideoUploadContent"}],attrs:{isEndImg:null===(e=w.easyTop)||void 0===e?void 0:e.isKLModel,value:w.value}}):w._e(),w._v(" "),x("param-input-panel",{directives:[{name:"show",rawName:"v-show",value:w.showParamInputPanel,expression:"showParamInputPanel"}],attrs:{value:w.value,"menu-index":w.menuIndex}}),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowVideoGenerateMode&&!w.isShowSpecialEffects,expression:"isShowVideoGenerateMode && !isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("mark-img-select",{staticClass:"generate-panel-item-mark-img",attrs:{list:w.renderPixVerseStyleList},on:{onChange:function(e){return w.changePixVerseConfig(e,"style")}},model:{value:w.value.generate_video.style,callback:function(e){w.$set(w.value.generate_video,"style",e)},expression:"value.generate_video.style"}})],1),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowVideoGenerateMode&&!w.isShowSpecialEffects,expression:"isShowVideoGenerateMode && !isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("newGenerate5")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:null!==(t=w.easyTop)&&void 0!==t&&t.isVideoModel?w.$t("newGenerate108"):w.$t("newGenerate47"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-rows"},w._l(w.pixVerseGenerationList,(function(e){var t;return x("div",{key:e.code,staticClass:"panel-item panel-item-video-content",class:[(null===(t=w.value)||void 0===t||null===(t=t.generate_video)||void 0===t?void 0:t.quality_mode)===e.code?"active-btn":"",w.checkVideoGenerationModeStatus(e.code)&&"panel-item-disable"],on:{click:function(t){return t.stopPropagation(),w.changePixVerseConfig(e.code,"quality_mode")}}},[x("span",{staticClass:"panel-item-title"},[w._v(w._s(w.$t(e.i18nKey)))]),w._v(" "),x("span",{staticClass:"panel-item-sub-title"},[w._v(w._s(e.subTitle))]),w._v(" "),!w.isCompanyAccount&&null!=e&&e.isVip?x("div",{staticClass:"panel-item-vip-icon"},[x("img",{attrs:{src:n(136),alt:"vip-icon"}})]):w._e()])})),0)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowGenerateMode&&!w.isShowSpecialEffects,expression:"isShowGenerateMode && !isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("newGenerate5")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:null!==(o=w.easyTop)&&void 0!==o&&o.isVideoModel?w.$t("newGenerate108"):w.$t("newGenerate47"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-content"},[x("div",{staticClass:"panel-item",class:[0===(null===(r=w.value)||void 0===r||null===(r=r.generate)||void 0===r?void 0:r.gen_mode)?"active-btn":"",w.disableBasicMode&&"disabled-box"],attrs:{"data-event":"video_editor_generate_basic_mode_panel_item"},on:{click:function(e){return e.stopPropagation(),w.changeConfig(0,"gen_mode")}}},[w._v("\n        "+w._s(w.$t("newGenerate44"))+"\n      ")]),w._v(" "),x("div",{staticClass:"panel-item",class:[1===(null===(l=w.value)||void 0===l||null===(l=l.generate)||void 0===l?void 0:l.gen_mode)?"active-btn":"",w.isDisableGenModePanel&&"panel-item-disable"],attrs:{"data-event":"video_editor_generate_advanced_mode_panel_item"},on:{click:function(e){return e.stopPropagation(),w.changeConfig(1,"gen_mode")}}},[w.isCompanyAccount?w._e():x("img",{staticClass:"vip-icon",attrs:{src:n(136),alt:"vip-icon"}}),w._v("\n        "+w._s(w.$t("newGenerate45"))+"\n      ")])])]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowPromptMagic&&!w.isShowSpecialEffects,expression:"isShowPromptMagic && !isShowSpecialEffects"}],staticClass:"generate-mode-panel-item",class:[(null===(d=w.easyTop)||void 0===d?void 0:d.isHunyuan)&&"generate-mode-panel-item-no-margin"]},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("studio28")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("studio45"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},[x("div",{staticClass:"panel-item",class:[2===(null===(c=w.value)||void 0===c||null===(c=c.generate)||void 0===c?void 0:c.prompt_magic_mode)?"active-btn":""],attrs:{"data-event":"video_editor_generate_magic_mode_auto"},on:{click:function(e){return e.stopPropagation(),w.changeConfig(2,"prompt_magic_mode")}}},[w._v("\n        "+w._s(w.$t("studio41"))+"\n      ")]),w._v(" "),x("div",{staticClass:"panel-item",class:[1===(null===(v=w.value)||void 0===v||null===(v=v.generate)||void 0===v?void 0:v.prompt_magic_mode)?"active-btn":""],attrs:{"data-event":"video_editor_generate_magic_mode_open"},on:{click:function(e){return e.stopPropagation(),w.changeConfig(1,"prompt_magic_mode")}}},[w._v("\n        "+w._s(w.$t("newGenerate18"))+"\n      ")]),w._v(" "),x("div",{staticClass:"panel-item",class:[0===(null===(m=w.value)||void 0===m||null===(m=m.generate)||void 0===m?void 0:m.prompt_magic_mode)?"active-btn":""],attrs:{"data-event":"video_editor_generate_magic_mode_close"},on:{click:function(e){return e.stopPropagation(),w.changeConfig(0,"prompt_magic_mode")}}},[w._v("\n        "+w._s(w.$t("newGenerate17"))+"\n      ")])])]),w._v(" "),w.isShowImageSize?x("div",{directives:[{name:"show",rawName:"v-show",value:!w.isShowSpecialEffects,expression:"!isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"generate-mode-panel-item-title"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("newGenerate6")))])]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowSizeText,expression:"isShowSizeText"}],staticClass:"current-size"},[w._v(w._s(w.value.width)+" x "+w._s(w.value.height))])]),w._v(" "),w.isShowVideoSize?[x("div",{staticClass:"panel-item-content",class:[null!==(h=w.easyTop)&&void 0!==h&&h.isTongYiFast||null!==(f=w.easyTop)&&void 0!==f&&f.isTongYiProfessional||null!==(_=w.easyTop)&&void 0!==_&&_.isPixVerse?"panel-item-content-5":"panel-item-content-3"]},w._l(w.renderVideoSizeOptions,(function(e){var t,n;return x("div",{key:e.code,staticClass:"panel-item",class:[(null===(t=w.value)||void 0===t?void 0:t.width)===e.width&&(null===(n=w.value)||void 0===n?void 0:n.height)===e.height?"active-btn":""],on:{click:function(t){return t.stopPropagation(),w.handleUpdateVideoSize(e)}}},[x("span",{staticClass:"iconfont panel-item-icon",class:["".concat(e.icon)]}),w._v(" "),x("span",{staticClass:"panel-item-label"},[w._v(w._s(e.label))])])})),0)]:[x("div",{staticClass:"panel-item-content panel-item-content-5 column-gap-4"},[w._l(w.imageSizeOptions,(function(e){return[5===e.code?[x("image-size-options-popup",{key:"ImageSizeOptionsPopup_".concat(e.code),ref:"ImageSizeOptionsPopup",refInFor:!0,attrs:{currentImageSize:w.currentImageSize},on:{applySize:w.handleUpdateSize}},[x("div",{key:e.code,staticClass:"panel-item",class:["panel-item-custom",![1,2,3,4].includes(w.currentImageSize)&&"panel-item-active"],attrs:{"data-event":"video_editor_generate_size_panel_more"}},[x("span",{staticClass:"iconfont panel-item-icon",class:["".concat(e.icon)]}),w._v(" "),x("span",{staticClass:"panel-item-label panel-item-label-overflow",attrs:{title:w.$t(null==e?void 0:e.label)}},[w._v(w._s(w.$t(null==e?void 0:e.label)))])])])]:[x("div",{key:e.code,staticClass:"panel-item",class:[5===e.code&&"panel-item-custom",e.code===w.currentImageSize&&"panel-item-active"],attrs:{"data-event":"video_editor_generate_size_panel_item","data-id":e.label},on:{click:function(t){return t.stopPropagation(),w.handleUpdateSize(e)}}},[x("span",{staticClass:"iconfont panel-item-icon",class:["".concat(e.icon)]}),w._v(" "),5===e.code?[x("span",{staticClass:"panel-item-label panel-item-label-overflow",attrs:{title:w.$t(null==e?void 0:e.label)}},[w._v(w._s(w.$t(null==e?void 0:e.label)))])]:x("span",{staticClass:"panel-item-label"},[w._v(w._s(e.label))])],2)]]}))],2),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:5===w.currentImageSize,expression:"currentImageSize === 5"}],staticClass:"custom-size-box"},[x("div",{staticClass:"custom-size-box-item"},[x("span",{staticClass:"custom-size-box-item-text-before"},[w._v("Width")]),w._v(" "),x("el-input-number",{key:"custom_width_input",staticClass:"easy-input-number custom-size-box-item-input-number",attrs:{value:w.value.width,controls:!1,min:w.getCustomSizeOptions.min,max:w.getCustomSizeOptions.max,step:1,disabled:5!==w.currentImageSize||w.isLockSize},on:{change:function(e){return w.customSizeChange(e,"width")}}}),w._v(" "),x("span",{staticClass:"custom-size-box-item-text-after"},[w._v("px")])],1),w._v(" "),x("div",{staticClass:"custom-size-box-item-lock",class:[w.isLockSize&&"active-btn"],on:{click:function(e){return e.stopPropagation(),w.changeLockStatus.apply(null,arguments)}}},[x("i",{staticClass:"iconfont",class:[w.isLockSize?"icon-collectLock":"icon-lock-open-variant-outline"]})]),w._v(" "),x("div",{staticClass:"custom-size-box-item"},[x("span",{staticClass:"custom-size-box-item-text-before"},[w._v("Height")]),w._v(" "),x("el-input-number",{key:"custom_height_input",staticClass:"easy-input-number custom-size-box-item-input-number",attrs:{value:w.value.height,controls:!1,min:w.getCustomSizeOptions.min,max:w.getCustomSizeOptions.max,step:1,disabled:5!==w.currentImageSize||w.isLockSize},on:{change:function(e){return w.customSizeChange(e,"height")}}}),w._v(" "),x("span",{staticClass:"custom-size-box-item-text-after"},[w._v("px")])],1)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:5===w.currentImageSize,expression:"currentImageSize === 5"}],staticClass:"custom-size-box"},[x("div",{staticClass:"custom-size-box-slider-item"},[x("el-slider",{staticClass:"easy-slider-item",attrs:{value:w.value.width,min:w.getCustomSizeOptions.min,max:w.getCustomSizeOptions.max,step:1,disabled:5!==w.currentImageSize,"show-tooltip":!1},on:{input:function(e){return w.customSizeChange(e,"width")}}})],1),w._v(" "),x("div",{staticClass:"custom-size-box-slider-item-ratio"},[w._v("\n          "+w._s(w.showAspectRatio)+"\n        ")]),w._v(" "),x("div",{staticClass:"custom-size-box-slider-item"},[x("el-slider",{staticClass:"easy-slider-item",attrs:{value:w.value.height,min:w.getCustomSizeOptions.min,max:w.getCustomSizeOptions.max,step:1,disabled:5!==w.currentImageSize,"show-tooltip":!1},on:{input:function(e){return w.customSizeChange(e,"height")}}})],1)])]],2):w._e(),w._v(" "),w.showFixedVideoDuration?x("div",{directives:[{name:"show",rawName:"v-show",value:!w.isShowSpecialEffects,expression:"!isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("Duration")))])]),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},w._l(w.renderVideoDuration,(function(i){var e;return x("div",{key:"videoDuration_".concat(i.code),staticClass:"panel-item",class:[w.value.generate_video.generate_video_duration===i.code?"active-btn":"",(null===(e=w.easyTop)||void 0===e?void 0:e.isFixedDuration)&&"panel-item-disable",w.checkVideoDurationStatus(i.code)&&"panel-item-disable"],on:{click:function(e){return e.stopPropagation(),w.changeVideoConfig(i.code,"generate_video_duration")}}},[w._v("\n        "+w._s(i.label)+"\n      ")])})),0)]):w._e(),w._v(" "),w.isShowVideoDuration?x("div",{directives:[{name:"show",rawName:"v-show",value:!w.isShowSpecialEffects,expression:"!isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("Duration")))])]),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},[x("slider-item",{attrs:{"hide-label":!0,value:w.value.generate_video.generate_video_duration,min:3,max:null!==(y=w.easyTop)&&void 0!==y&&y.isTongYiFast?5:6,step:1},on:{change:function(e){return w.changeVideoConfig(e,"generate_video_duration")}}})],1)]):w._e(),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowRelevance&&!w.isShowSpecialEffects,expression:"isShowRelevance && !isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("newGenerate123")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("newGenerate109"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},[x("slider-item",{attrs:{"hide-label":!0,value:w.value.generate_video.relevance,min:0,max:1,step:.1},on:{change:function(e){return w.changeVideoConfig(e,"relevance")}}})],1)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowImageNum&&!w.isShowSpecialEffects,expression:"isShowImageNum && !isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(null!==(C=w.easyTop)&&void 0!==C&&C.isVideoModel?w.$t("newGenerate124"):w.$t("QuantityOfImages")))])]),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-4"},w._l(w.imageNumLimit,(function(i){var e;return x("div",{key:"numberImages_".concat(i),staticClass:"panel-item",class:[(null===(e=w.value)||void 0===e?void 0:e.n_iter)===i?"active-btn":""],attrs:{"data-event":"video_editor_generate_image_num_panel_item","data-id":i},on:{click:function(e){return e.stopPropagation(),w.changeConfig(i,"n_iter")}}},[w._v("\n        "+w._s(i)+"\n      ")])})),0)]),w._v(" "),w.isShowFluency?x("div",{directives:[{name:"show",rawName:"v-show",value:!w.isShowSpecialEffects,expression:"!isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("pix_verse_6")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("pix_verse_5"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},w._l(w.renderFluency,(function(i){var e;return x("div",{key:"motion_mode_".concat(i.code),staticClass:"panel-item",class:[w.value.generate_video.motion_mode===i.code?"active-btn":"",(null===(e=w.easyTop)||void 0===e?void 0:e.isDisableSupportQuality)&&"panel-item-disable"],on:{click:function(e){return e.stopPropagation(),w.changePixVerseConfig(i.code,"motion_mode")}}},[w._v("\n        "+w._s(w.$t(i.label))+"\n      ")])})),0)]):w._e(),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowGenerateNum,expression:"isShowGenerateNum"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(null!==(T=w.easyTop)&&void 0!==T&&T.isVideoModel?w.$t("newGenerate124"):w.$t("QuantityOfImages")))])]),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-4"},w._l(2,(function(i){var e;return x("div",{key:"numberImages_".concat(i),staticClass:"panel-item",class:[(null===(e=w.value)||void 0===e?void 0:e.n_video_iter)===i?"active-btn":""],on:{click:function(e){return e.stopPropagation(),w.changeConfig(i,"n_video_iter","vip2")}}},[2===i?x("img",{staticClass:"vip-icon",attrs:{src:n(136),alt:""}}):w._e(),w._v("\n        "+w._s(i)+"\n      ")])})),0)]),w._v(" "),w.isCompanyAccount?w._e():x("div",{staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label panel-item-label-flex"},[x("div",{staticClass:"panel-item-label-box"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("newGenerate12")))]),w._v(" "),w.isCompanyAccount?w._e():x("img",{staticClass:"vip-icon",attrs:{src:n(136),alt:"vip-icon"}})]),w._v(" "),x("el-switch",{attrs:{"active-color":"#3F8CFF","active-value":2,"inactive-value":1,"data-event":"video_editor_generate_permission_panel_item"},on:{change:w.handleCreateSettingSelectChange},model:{value:w.createSetting,callback:function(e){w.createSetting=e},expression:"createSetting"}})],1)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowFree&&!w.isShowSpecialEffects,expression:"isShowFree && !isShowSpecialEffects"}],staticClass:"generate-mode-panel-item"},[x("div",{staticClass:"panel-item-label panel-item-label-flex"},[x("div",{staticClass:"panel-item-label-box"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("daily_rights_2")))]),w._v(" "),x("el-tooltip",{attrs:{content:w.$t(this.UnlimitedQueueTip),placement:"top-start",effect:"light"}},[w.isCompanyAccount?w._e():x("img",{staticClass:"vip-icon",attrs:{src:n(136),alt:"vip-icon"}})])],1),w._v(" "),x("el-switch",{attrs:{"active-color":"#3F8CFF",value:w.value.speed_type,"active-value":3,"inactive-value":w.queueRenderList[0].code,"data-event":"video_editor_generate_free_panel_item"},on:{change:function(e){return w.handleQueueSelectChange(e)}}})],1)]),w._v(" "),x("common-confirm-modal",{ref:"commonConfirmModal"})],2)}),[],!1,null,"7896f04e",null)),ci=di.exports;installComponents(di,{SliderItem:n(105).default});var ui=n(561),vi=n(562);function mi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function pi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var hi={name:"EasyAdvanceSettingPanel",props:["value"],inject:["easyTop"],data:function(){return{createSetting:1,loading:!1,cardConfigList:[{code:"vae",i18nKey:"VAE",tips:"vaeTips"},{code:"clip_skip",i18nKey:"clipSkip",tips:"clipSkipTips"},{code:"mode",i18nKey:"newGenerate7",tips:"",mapOptions:[{code:0,label:"默认",i18nKey:"createModeType1",tips:""},{code:1,label:"海艺V6",i18nKey:"createModeType2",tips:"createModeTips2",isVip:!0},{code:2,label:"海艺2.1",i18nKey:"createModeType6",tips:"createModeTips6",isVip:!0}]}],repairConfigList:[{code:"hr_upscaler",i18nKey:"taskTabUpscale",mapOptions:this.renderList,tips:""},{code:"hr_second_pass_steps",i18nKey:"UpscaleSamplingTimes",tips:""},{code:"hr_upscaler_redraw",i18nKey:"RedrawNoiseIntensity",tips:""},{code:"ad_model",i18nKey:"characterRepair",tips:"",mapOptions:[{code:"",i18nKey:"none"},{code:"face",i18nKey:"repairType1"},{code:"hand",i18nKey:"repairType2"},{code:"body",i18nKey:"repairType3"}]},{code:"ad_units.lora",i18nKey:"LoRA",tips:""},{code:"ad_units.ad_denoising_strength",i18nKey:"redrawingNoiseIntensity",tips:""},{code:"ad_units.ad_confidence",i18nKey:"Confidence",tips:""},{code:"ad_units.prompt",i18nKey:"Prompt",tips:""},{code:"ad_units.negative_prompt",i18nKey:"NegativePrompts",tips:""},{code:"restore_faces",i18nKey:"RestoreFaces",tips:""}],isCollapse:!0,CAMERA_CONTROL_OPTIONS:_t.CAMERA_CONTROL_OPTIONS}},components:{SliderItem:Nt.default,EasyAdvanceRepairModal:ui.default,EasyModeModal:vi.default},computed:pi(pi(pi(pi({},Object(c.c)("payment",["paymentInfo"])),Object(c.c)("user",["accountSettingsData","isCompanyAccount","isLoggedIn"])),Object(c.c)("creation",["taskSamplerMethods","taskVae","sd_xl_sampler_name","lab_scheduler","lab_sampler_name","hr_upscaler","flux_sampler_name","combined_sampler_name","video_config"])),{},{isShowNegativePrompts:function(){var e,t,n,o,r,l,d=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isTongYiFast||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isTongYiProfessional),c=!(null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isHiDreamModel),v=!(null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isSeaArtFilmModel);return!this.isCollapse&&!(null!==(r=this.easyTop)&&void 0!==r&&r.isCommunityFlux)&&!(null!==(l=this.easyTop)&&void 0!==l&&l.isSd35Model)&&d&&c&&v},getRenderVideoConfig:function(){var e,t,n=(null==this||null===(e=this.video_config)||void 0===e?void 0:e.camera_control_mode_items)||[];if(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isKL15Model){var o=["Horizontal","Vertical","Zoom","Pan","Titt","Roll"];n=n.filter((function(e){return o.includes(e.mode)}))}return n.map((function(e){return{code:e.mode,name:e.mode,preview:e.example_url||"",showOffSet:null==e?void 0:e.has_offset_opt}}))},renderHunyuanSampler:function(){var e;return(null==this||null===(e=this.video_config)||void 0===e?void 0:e.sampler_name)||[]},renderHunyuanScheduler:function(){var e;return(null==this||null===(e=this.video_config)||void 0===e?void 0:e.scheduler)||[]},cameraControlPreview:function(){var e,t=this;return(null===(e=(this.getRenderVideoConfig||[]).find((function(e){return e.code===t.value.generate_video.camera_control_option.mode})))||void 0===e?void 0:e.preview)||""},isHunyuan:function(){var e;return null==this||null===(e=this.easyTop)||void 0===e?void 0:e.isHunyuan},isShowCameraControl:function(){var e,t,n=!this.isCollapse,o=0===this.value.generate.gen_mode&&"txt2video"===this.value.currentVideoInputToolTab,r=5===this.value.generate_video.generate_video_duration,l=0!==this.value.generate.gen_mode&&"img2video"===this.value.currentVideoInputToolTab;return null!==(e=this.easyTop)&&void 0!==e&&e.isKL10Model?n&&o&&r:null!==(t=this.easyTop)&&void 0!==t&&t.isKL15Model?n&&l&&r:void 0},isShowCameraControlOffset:function(){var e=this,t=(this.getRenderVideoConfig||[]).find((function(t){var n;return(null==t?void 0:t.code)===(null===(n=e.value)||void 0===n||null===(n=n.generate_video)||void 0===n||null===(n=n.camera_control_option)||void 0===n?void 0:n.mode)}));return!!t&&(null==t?void 0:t.showOffSet)},isShowSampler:function(){var e,t,n,o,r,l,d,c=!this.isCollapse,v=!(null!==(e=this.easyTop)&&void 0!==e&&e.isSd35Model),m=!(null!==(t=this.easyTop)&&void 0!==t&&t.isKLVideoModel),h=!this.isHunyuan,f=!(null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isTongYiFast||null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isTongYiProfessional),_=!(null!=this&&null!==(r=this.easyTop)&&void 0!==r&&r.isPixVerse),y=!(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isHiDreamModel),C=!(null!=this&&null!==(d=this.easyTop)&&void 0!==d&&d.isSeaArtFilmModel);return c&&v&&m&&h&&f&&_&&y&&C},isShowCFGScale:function(){var e,t,n,o,r,l,d=!this.isCollapse,c=!(null!==(e=this.easyTop)&&void 0!==e&&e.isSd35Model),v=!(null!==(t=this.easyTop)&&void 0!==t&&t.isKLVideoModel),m=!this.isHunyuan,h=!(null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isTongYiFast||null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isTongYiProfessional),f=!(null!=this&&null!==(r=this.easyTop)&&void 0!==r&&r.isPixVerse),_=!(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isHiDreamModel);return d&&c&&v&&m&&h&&f&&_},isShowCard:function(){var e,t,n,o,r,l,d,c,v=!this.isCollapse,m=!(null!==(e=this.easyTop)&&void 0!==e&&e.isSd35Model||null!==(t=this.easyTop)&&void 0!==t&&t.isCommunityFlux),h=!(null!==(n=this.easyTop)&&void 0!==n&&n.isKLVideoModel),f=!this.isHunyuan,_=!(null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isTongYiFast||null!=this&&null!==(r=this.easyTop)&&void 0!==r&&r.isTongYiProfessional),y=!(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isPixVerse),C=!(null!=this&&null!==(d=this.easyTop)&&void 0!==d&&d.isHiDreamModel),T=!(null!=this&&null!==(c=this.easyTop)&&void 0!==c&&c.isSeaArtFilmModel);return v&&m&&h&&f&&_&&y&&C&&T},isShowSeed:function(){var e,t=!this.isCollapse,n=!(null!==(e=this.easyTop)&&void 0!==e&&e.isKLVideoModel),o=!this.isHunyuan;return t&&n&&o},showImgSeed:function(){return this.value.seedTemp&&this.value.seed!==this.value.seedTemp},isVipFun:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},canUseUnlimitedQueue:function(){var e;return null===(e=this.paymentInfo)||void 0===e?void 0:e.infiniteQueue},queueRenderList:function(){return[{code:1,i18nKey:"NormalQueue",tips:"",show:!this.isVipFun},{code:2,i18nKey:"SubsBottomTerms2",tips:"",isVip:!0,show:this.isVipFun},{code:3,i18nKey:"UnlimitedQueue",tips:this.UnlimitedQueueTip,isVip:!0,show:!0}].filter((function(e){return e.show}))},UnlimitedQueueTip:function(){return this.isCompanyAccount?"ToBUnlimitedQueueTip":"UnlimitedQueueTip"},isShowUpscale:function(){var e,t,n,o=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isCommunityFlux),r=null==this||null===(t=this.easyTop)||void 0===t?void 0:t.hasEnableImageToImage,l=null==this||null===(n=this.easyTop)||void 0===n?void 0:n.hasEnableControlNetToImage;return o&&(!r&&!l)},isShowAdvancedRepair:function(){var e,t,n,o,r,l,d,c,v,m,h,f,_,y=!(this.isCollapse||null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isCommunityFlux||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isAnimeEnhanceEnable||null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isSd35Model),C=!(null!==(o=this.value)&&void 0!==o&&null!==(o=o.controlnet_units)&&void 0!==o&&o.length&&(null===(r=this.value)||void 0===r||null===(r=r.imageToImageList)||void 0===r||!r.length)&&(null==this||null===(l=this.easyTop)||void 0===l||!l.isCommunityFlux)&&(null==this||null===(d=this.easyTop)||void 0===d||!d.isAnimeEnhanceEnable)),T=!(null!=this&&null!==(c=this.easyTop)&&void 0!==c&&c.isKLVideoModel),w=!this.isHunyuan,x=!(null!=this&&null!==(v=this.easyTop)&&void 0!==v&&v.isTongYiFast||null!=this&&null!==(m=this.easyTop)&&void 0!==m&&m.isTongYiProfessional),S=!(null!=this&&null!==(h=this.easyTop)&&void 0!==h&&h.isPixVerse),I=!(null!=this&&null!==(f=this.easyTop)&&void 0!==f&&f.isHiDreamModel),O=!(null!=this&&null!==(_=this.easyTop)&&void 0!==_&&_.isSeaArtFilmModel);return y&&C&&T&&w&&x&&S&&I&&O},schedulerDisabled:function(){return!1},isShowEngineMode:function(){var e,t,n,o,r,l=(null==this||null===(e=this.easyTop)||void 0===e||null===(e=e.config)||void 0===e?void 0:e.generateImage)||{},d=null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isSdModel,c=null==l||null===(n=l.imageToImageList)||void 0===n?void 0:n.length,v=null==l||null===(o=l.controlnet_units)||void 0===o?void 0:o.length,m=this.isOpenUpscale,h=null==this||null===(r=this.easyTop)||void 0===r?void 0:r.isEnableQuality;return d&&[!c,!v,!m,!h].every((function(e){return e}))},renderCardConfigList:function(){var e,t=["vae","clip_skip","mode"];return null!==(e=this.easyTop)&&void 0!==e&&e.isAnimeEnhanceEnable?this.cardConfigList.filter((function(e){return!t.includes(null==e?void 0:e.code)})):this.isShowEngineMode?this.cardConfigList:(t=["mode"],this.cardConfigList.filter((function(e){return!t.includes(null==e?void 0:e.code)})))},renderStepsOptions:function(){var e,t,n,o,r,l,d,c={min:10,max:40};return null!=this&&null!==(e=this.value)&&void 0!==e&&e.lcm_mode&&(c.min=4,c.max=8),null===(t=this.easyTop)||void 0===t||!t.isSDXLModel||null!=this&&null!==(n=this.value)&&void 0!==n&&n.lcm_mode||(c.min=20),null!==(o=this.easyTop)&&void 0!==o&&o.isAnimeEnhanceEnable&&(c.min=25,c.max=50),null!==(r=this.easyTop)&&void 0!==r&&r.isCommunityFlux&&(c.min=4,c.max=60),null!==(l=this.easyTop)&&void 0!==l&&l.isSd35Model&&(c.min=6,c.max=25),null!==(d=this.easyTop)&&void 0!==d&&d.isNoobai&&(c.min=32,c.max=40),c},renderCFGScale:function(){var e,t,n={min:3,max:15};return null!=this&&null!==(e=this.value)&&void 0!==e&&e.lcm_mode&&(n.min=1,n.max=3),null!==(t=this.easyTop)&&void 0!==t&&t.isAnimeEnhanceEnable&&(n.min=2,n.max=15),n},getCharacterRepairName:function(){var e=this,t=[{code:"",i18nKey:"none"},{code:"face",i18nKey:"repairType1"},{code:"hand",i18nKey:"repairType2"},{code:"body",i18nKey:"repairType3"}].find((function(t){return t.code===e.value.ad_model}));return t?this.$t(null==t?void 0:t.i18nKey):""},seedOptions:function(){var e,t,n,o,r={max:4294967294};return(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isCommunityFlux||null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isTongYiFast||null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isTongYiProfessional||null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isPixVerse)&&(r.max=2147483643),r},isOpenUpscale:function(){return""!==this.value.hr_upscaler},isOpenCharacterRepair:function(){return""!==this.value.ad_model},selectLora:function(){var e;return(null===(e=this.value.ad_units)||void 0===e?void 0:e.lora)||{}},isShowLora:function(){var e;return null===(e=Object.keys(this.selectLora))||void 0===e?void 0:e.length},renderList:function(){var e=(this.hr_upscaler||[]).map((function(e){return{label:e,code:e}}));return[{code:"",label:this.$t("none")}].concat(Object(o.a)(e))},getCardRenderInfo:function(){var e=this;return function(){var t=arguments.length>1?arguments[1]:void 0,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).mapOptions,o=(void 0===n?[]:n).find((function(e){return e.code===t}));return o?e.$t(null==o?void 0:o.i18nKey):t}},isCurrentImageNum:function(){return function(i){return this.value.n_iter===i}},renderTaskSamplerMethods:function(){var e;return"FLUX"===(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.currentModelType)?this.flux_sampler_name:this.combined_sampler_name},isShowSteps:function(){var e,t,n,o,r,l,d=!this.isCollapse,c=!(null!==(e=this.easyTop)&&void 0!==e&&e.isKLVideoModel),v=!this.isHunyuan,m=!(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isTongYiFast||null!=this&&null!==(n=this.easyTop)&&void 0!==n&&n.isTongYiProfessional),h=!(null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isPixVerse),f=!(null!=this&&null!==(r=this.easyTop)&&void 0!==r&&r.isHiDreamModel),_=!(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isSeaArtFilmModel);return d&&c&&v&&m&&h&&f&&_}}),watch:{accountSettingsData:{handler:function(){this.createSetting=this.accountSettingsData.is_auto_pub_community?1:2},immediate:!0,deep:!0},isShowEngineMode:{handler:function(e){if(!e)try{var t,n=JSON.parse(JSON.stringify(this.value));n.generate.mode=0,null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(n)}catch(e){}},immediate:!0},isShowCameraControl:{handler:function(e){if(e)try{var t,n=JSON.parse(JSON.stringify(this.value));n.generate_video.camera_control_option.mode=this.getRenderVideoConfig[0].code,null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(n,this.menuIndex)}catch(e){}},immediate:!0}},methods:pi(pi({},Object(c.b)("user",["getAccountInfo"])),{},{changeVideoConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));"mode"===t&&(o.generate_video.camera_control_option.mode=e),"offset"===t&&(o.generate_video.camera_control_option.offset=e),"generate_video_duration"===t&&(o.generate_video.generate_video_duration=e),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)},useSeed:function(e){var t,n=["",null,void 0,-1].includes(e)?-1:e,o=JSON.parse(JSON.stringify(this.value));o.seed=n,o.lockSeed||(o.lockSeed=!0),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(o)},handleQueueSelectChange:function(e){var t;if(this.$logEvent("log_actions",{operation:"click_free_create",behavior_info:"on_new_create_flow_page",behavior_info_sub:3===e?"open":"close"}),3===e&&!this.isLoggedIn)return this.$EventBus.$emit("openLoginDialog",{dot:!1}),void this.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});![3].includes(e)||3!==e||this.isVipFun?[3].includes(e)&&this.isStudioMode&&this.isCompanyAccount||([3].includes(e)&&this.isOnlyVipLite?this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard"):![3].includes(e)||this.canUseUnlimitedQueue?(localStorage.setItem("speed_type",e),null==this||null===(t=this.easyTop)||void 0===t||t.updateSpeedType(e)):this.$EventBus.$emit("showUpgradeDialog","UnlimitedQueueTipWeb","standard")):this.$EventBus.$emit("showBreakDialog","UnlimitedQueueTipWeb","standard")},toggleFoldStatus:function(){this.isCollapse=!this.isCollapse,this.$logEvent("log_actions",{operation:"click_advanced_config",behavior_info:"on_new_create_flow_page",behavior_info_sub:this.isCollapse?"open":"close"})},changeConfig:function(e,t){var n,o,r,l,d;this.$EventBus.$emit("needCheckInputPackUp","paramsPanel"),"enableNegativePrompts"===t&&(this.$logEvent("log_actions",{operation:"click_negative_prompt",behavior_info:"on_new_create_flow_page",behavior_info_sub:e?"open":"close"}),this.$EventBus.$emit("resetInputPackUpStatus"));var c=JSON.parse(JSON.stringify(this.value)),v=(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isCommunityFlux)||(null==this||null===(o=this.easyTop)||void 0===o?void 0:o.isTongYiFast)||(null==this||null===(r=this.easyTop)||void 0===r?void 0:r.isTongYiProfessional)||(null==this||null===(l=this.easyTop)||void 0===l?void 0:l.isPixVerse);t&&("sampler_name"!==t&&(c[t]=e),"lockSeed"===t&&(this.$logEvent("log_actions",{operation:"click_fixed_seed",behavior_info:"on_new_create_flow_page",behavior_info_sub:e?"open":"close"}),c.seed=e?Object(tt.getRandomSeed)(v):-1),"sampler_name"===t&&(c=this.handleLCMConfig(c,e))),null==this||null===(d=this.easyTop)||void 0===d||d.updateConfig(c)},handleLCMConfig:function(e,t){var n,o=null===(n=this.easyTop)||void 0===n?void 0:n.isSDXLModel,r=20,l=7;return"LCM"===t?(r=o?8:4,l=o?2:1.5,e.steps=r,e.cfg_scale=l,e.sampler_name="LCM",e.lcm_mode=1,e):("LCM"===(null==e?void 0:e.sampler_name)&&"LCM"!==t?(e.steps=r,e.cfg_scale=l,e.sampler_name=t,e.lcm_mode=0):(e.sampler_name=t,e.lcm_mode=0),e)},handleUpdateConfig:function(e){var t,n=JSON.parse(JSON.stringify(this.value));e&&e.hasOwnProperty("mode")&&(n.generate.mode=(null==e?void 0:e.mode)||0,delete e.mode),n=pi(pi({},n),e),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig(n)},handleCreateSettingSelectChange:function(e){if([2,"2"].includes(e)&&!this.paymentInfo.show_auto_pub_switch)return this.$EventBus.$emit("showBreakDialog","PrivateWorkTipWeb","basic"),void(this.createSetting=1);this.saveSettings(e)},saveSettings:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.loading=!0;var n={};n.auto_pub_community=t,n.mode=1,Object(Dt.c)(n).then((function(n){var o=(n||{}).status.code;["10000",1e4].includes(void 0===o?"":o)&&(e.$message.success(e.$t("SaveSuccess")),e.createSetting=t,e.loading=!1,e.getAccountInfo())})).finally((function(){e.loading=!1}))},openRepairModal:function(){this.$refs.repairModal.show()},openModeModal:function(){this.$refs.modeModal.show()}})},fi=hi,gi=(n(5475),n(5476),Object(_.a)(fi,(function(){var e,t,n,o,r,l,d,c,v,m,h,f,_,y,C,T,w=this,x=w._self._c;return x("div",{staticClass:"c-easy-advance-setting-panel",style:{"padding-bottom":w.isShowSeed||w.isCollapse?"0px":"var(--base-font-size)"}},[x("div",{staticClass:"additional-panel-title additional-panel-title-height",attrs:{"data-event":"video_editor_advance_toggle_setting"},on:{click:function(e){return e.stopPropagation(),w.toggleFoldStatus()}}},[x("span",{staticClass:"additional-panel-title-text"},[w._v(w._s(w.$t("AdvancedConfig")))]),w._v(" "),x("span",{staticClass:"additional-panel-title-icon",class:[w.isCollapse?"el-icon-caret-bottom":"el-icon-caret-top"]})]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowSampler,expression:"isShowSampler"}],staticClass:"advance-setting-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("SamplingMethod")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.schedulerDisabled?w.$t("studio44"):w.$t("WhichATUTPTI"),placement:"top-start"}},[x("i",{staticClass:"custom-tips",class:[w.schedulerDisabled?"iconfont icon-warn ":"el-icon-warning"]})])],1),w._v(" "),x("div",{staticClass:"panel-item-content"},[x("el-select",{staticClass:"easy-custom-select",attrs:{value:w.value.sampler_name,"popper-append-to-body":!0,disabled:w.schedulerDisabled,"popper-class":"custom-select"},on:{change:function(e){return w.changeConfig(e,"sampler_name")}}},w._l(w.renderTaskSamplerMethods,(function(e,i){return x("el-option",{key:"method_"+i,attrs:{label:e,value:e}},[x("el-tooltip",{attrs:{content:e,placement:"left"}},[x("span",[w._v(w._s(e))])])],1)})),1)],1)]),w._v(" "),w.isHunyuan&&!w.isCollapse?x("div",{staticClass:"advance-setting-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("studio21")))])]),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},[x("el-select",{staticClass:"easy-custom-select",attrs:{value:w.value.sampler_name,"popper-append-to-body":!0,"popper-class":"custom-select"},on:{change:function(e){return w.changeConfig(e,"sampler_name")}}},w._l(w.renderHunyuanSampler,(function(e,i){return x("el-option",{key:"method_"+i,attrs:{label:e,value:e}})})),1)],1)]):w._e(),w._v(" "),w.isHunyuan&&!w.isCollapse?x("div",{staticClass:"advance-setting-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("studio20")))])]),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},[x("el-select",{staticClass:"easy-custom-select",attrs:{value:w.value.scheduler,"popper-append-to-body":!0,"popper-class":"custom-select"},on:{change:function(e){return w.changeConfig(e,"scheduler")}}},w._l(w.renderHunyuanScheduler,(function(e,i){return x("el-option",{key:"method_"+i,attrs:{label:e,value:e}})})),1)],1)]):w._e(),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowSteps,expression:"isShowSteps"}],staticClass:"advance-setting-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("SamplingSteps")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("HowMTTITGII"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},[x("slider-item",{attrs:{"hide-label":!0,value:w.value.steps,min:w.renderStepsOptions.min,max:w.renderStepsOptions.max,label:"Strength"},on:{change:function(e){return w.changeConfig(e,"steps")}}})],1)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowCFGScale,expression:"isShowCFGScale"}],staticClass:"advance-setting-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("CFGScale")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("newGenerate49"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-content panel-item-content-2"},[x("slider-item",{attrs:{"hide-label":!0,value:w.value.cfg_scale,min:w.renderCFGScale.min,max:w.renderCFGScale.max,step:.5,precision:1},on:{change:function(e){return w.changeConfig(e,"cfg_scale")}}})],1)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:(null===(e=w.renderCardConfigList)||void 0===e?void 0:e.length)&&w.isShowCard,expression:"renderCardConfigList?.length && isShowCard"}],staticClass:"panel-item-card",on:{click:w.openModeModal}},[x("div",{staticClass:"panel-item-content-card"},w._l(w.renderCardConfigList,(function(e){var t;return x("div",{key:e.code,staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t(e.i18nKey)))]),w._v(" "),x("div",{staticClass:"card-item-value"},[e.mapOptions&&e.mapOptions.length?[w._v("\n            "+w._s(w.getCardRenderInfo(e,"mode"===e.code?null===(t=w.value)||void 0===t||null===(t=t.generate)||void 0===t?void 0:t.mode:w.value[e.code]))+"\n          ")]:[w._v(w._s(w.value[e.code]||""))]],2)])})),0)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowAdvancedRepair,expression:"isShowAdvancedRepair"}],staticClass:"advance-setting-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("AdvancedRepair")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("ClassifierFGSHSTI"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("div",{staticClass:"panel-item-card",on:{click:w.openRepairModal}},[x("div",{staticClass:"panel-item-content-card"},[x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowUpscale,expression:"isShowUpscale"}],staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("taskTabUpscale")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w.isOpenUpscale?[w._v("\n              "+w._s(w.value.hr_upscaler)+"\n            ")]:[w._v(w._s(w.$t("none")))]],2)]),w._v(" "),x("div",{staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("RestoreFaces")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w._v("\n            "+w._s(w.value.restore_faces?w.$t("newGenerate18"):w.$t("newGenerate17"))+"\n          ")])]),w._v(" "),x("div",{staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("characterRepair")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w.isOpenCharacterRepair?[w._v("\n              "+w._s(w.getCharacterRepairName)+"\n            ")]:[w._v(w._s(w.$t("newGenerate17")))]],2)]),w._v(" "),w.isOpenCharacterRepair?[w.isShowLora?x("div",{staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("LoRA")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w._v(w._s(null===(t=w.selectLora)||void 0===t?void 0:t.name)+":"+w._s(null===(n=w.selectLora)||void 0===n?void 0:n.version_name))])]):w._e(),w._v(" "),x("div",{staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("redrawingNoiseIntensity")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w._v("\n              "+w._s(null===(o=w.value)||void 0===o||null===(o=o.ad_units)||void 0===o?void 0:o.ad_denoising_strength)+"\n            ")])]),w._v(" "),x("div",{staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("Confidence")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w._v("\n              "+w._s(null===(r=w.value)||void 0===r||null===(r=r.ad_units)||void 0===r?void 0:r.ad_confidence)+"\n            ")])]),w._v(" "),null!==(l=w.value)&&void 0!==l&&null!==(l=l.ad_units)&&void 0!==l&&l.prompt?x("div",{staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("Prompt")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w._v("\n              "+w._s(null===(d=w.value)||void 0===d||null===(d=d.ad_units)||void 0===d?void 0:d.prompt)+"\n            ")])]):w._e(),w._v(" "),null!==(c=w.value)&&void 0!==c&&null!==(c=c.ad_units)&&void 0!==c&&c.negative_prompt?x("div",{staticClass:"panel-item-content-card-item"},[x("div",{staticClass:"card-item-label"},[w._v(w._s(w.$t("NegativePrompts")))]),w._v(" "),x("div",{staticClass:"card-item-value"},[w._v("\n              "+w._s(null===(v=w.value)||void 0===v||null===(v=v.ad_units)||void 0===v?void 0:v.negative_prompt)+"\n            ")])]):w._e()]:w._e()],2)])]),w._v(" "),w.isShowCameraControl?x("div",{staticClass:"advance-setting-panel-item"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("newGenerate118")))])]),w._v(" "),x("div",{staticClass:"panel-item-content"},[x("el-select",{staticClass:"easy-custom-select",attrs:{value:w.value.generate_video.camera_control_option.mode,"popper-append-to-body":!0,"popper-class":"custom-select"},on:{change:function(e){return w.changeVideoConfig(e,"mode")}}},w._l(w.getRenderVideoConfig,(function(e,i){return x("el-option",{key:"method_"+i,attrs:{label:e.name,value:e.code}})})),1)],1),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.cameraControlPreview,expression:"cameraControlPreview"}],staticClass:"camera-control-preview"},[x("img",{attrs:{src:w.cameraControlPreview,alt:"camera-control-preview"}})]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowCameraControlOffset,expression:"isShowCameraControlOffset"}],staticClass:"panel-item-content"},[x("slider-item",{attrs:{"hide-label":!0,value:w.value.generate_video.camera_control_option.offset,min:-10,max:10,step:.1},on:{change:function(e){return w.changeVideoConfig(e,"offset")}}})],1)]):w._e(),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowNegativePrompts,expression:"isShowNegativePrompts"}],staticClass:"advance-setting-panel-item advance-setting-panel-item-flex"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("NegativePrompts")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("newGenerate53"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("el-switch",{attrs:{"active-color":"#3F8CFF","data-event":"video_editor_advance_negative_panel_item"},on:{change:function(e){return w.changeConfig(e,"enableNegativePrompts")}},model:{value:w.value.enableNegativePrompts,callback:function(e){w.$set(w.value,"enableNegativePrompts",e)},expression:"value.enableNegativePrompts"}})],1),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:!w.isCollapse&&w.isShowNegativePrompts&&(null===(m=w.easyTop)||void 0===m?void 0:m.isVideoModel)&&"effect"!==(null===(h=w.easyTop)||void 0===h?void 0:h.activeVideoInputTab)&&!(null!==(f=w.easyTop)&&void 0!==f&&f.isStudioFlux)&&!(null!==(_=w.easyTop)&&void 0!==_&&_.isCommunityFlux)&&!(null!==(y=w.easyTop)&&void 0!==y&&y.isSd35Model)&&w.value.enableNegativePrompts,expression:"\n      !isCollapse &&\n      isShowNegativePrompts &&\n      easyTop?.isVideoModel &&\n      easyTop?.activeVideoInputTab !== 'effect' &&\n      !easyTop?.isStudioFlux &&\n      !easyTop?.isCommunityFlux &&\n      !easyTop?.isSd35Model &&\n      value.enableNegativePrompts\n    "}],staticClass:"advance-setting-panel-item margin-bottom-20"},[x("div",{staticClass:"negative-prompt-input"},[x("el-input",{ref:"negativePromptInput",staticClass:"top-input-area-input",attrs:{type:"textarea",value:w.value.negative_prompt,autosize:{minRows:4,maxRows:4},resize:"none",maxlength:null!==(C=w.easyTop)&&void 0!==C&&C.isPixVerse?2048:2e3,placeholder:w.$t("pleaseEnte")},on:{input:function(e){return w.changeConfig(e,"negative_prompt")}}})],1)]),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:w.isShowSeed,expression:"isShowSeed"}],staticClass:"advance-setting-panel-item advance-setting-panel-item-flex"},[x("div",{staticClass:"panel-item-label"},[x("span",{staticClass:"generate-mode-panel-label-text"},[w._v(w._s(w.$t("newGenerate21")))]),w._v(" "),x("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:w.$t("newGenerate42"),placement:"top-start"}},[x("i",{staticClass:"custom-tips el-icon-warning"})])],1),w._v(" "),x("el-switch",{attrs:{"active-color":"#3F8CFF","data-event":"video_editor_advance_seed_panel_item"},on:{change:function(e){return w.changeConfig(e,"lockSeed")}},model:{value:w.value.lockSeed,callback:function(e){w.$set(w.value,"lockSeed",e)},expression:"value.lockSeed"}})],1),w._v(" "),x("div",{directives:[{name:"show",rawName:"v-show",value:!w.isCollapse&&w.isShowSeed,expression:"!isCollapse && isShowSeed"}],staticClass:"advance-setting-panel-item margin-bottom-20"},[x("el-input-number",{directives:[{name:"show",rawName:"v-show",value:w.value.lockSeed,expression:"value.lockSeed"}],attrs:{placeholder:w.$t("customSeed"),value:w.value.seed,precision:0,controls:!1,min:-1,max:w.seedOptions.max},on:{change:function(e){return w.changeConfig(e,"seed")}}}),w._v(" "),w.showImgSeed?x("div",{staticClass:"seed-temp",on:{click:function(e){return w.useSeed(w.value.seedTemp)}}},[w._v("\n      "+w._s(w.$t("useImgSeed",{seed:w.value.seedTemp}))+"\n    ")]):w._e()],1),w._v(" "),x("easy-advance-repair-modal",{ref:"repairModal",attrs:{isShowUpscale:w.isShowUpscale,value:w.value},on:{updateData:w.handleUpdateConfig}}),w._v(" "),x("easy-mode-modal",{ref:"modeModal",attrs:{isShowEngineMode:w.isShowEngineMode,value:w.value,isAnimeEnhanceEnable:null===(T=w.easyTop)||void 0===T?void 0:T.isAnimeEnhanceEnable},on:{updateData:w.handleUpdateConfig}})],1)}),[],!1,null,"43f7fcdd",null)),_i=gi.exports;installComponents(gi,{SliderItem:n(105).default,EasyAdvanceRepairModal:n(561).default,EasyModeModal:n(562).default});var bi=n(603);function yi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ci(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yi(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ti={name:"videoTabs",inject:["easyTop"],props:["value"],components:{SpecialEffectsAppSelect:n(879).default,RandomPromptPopup:bi.default,ImageToImageCard:Gt.default,PickOrUploadImageModal:Ht.default,commonConfirmModal:ht.default},data:function(){return{typeOptions:[{key:"img2video",icon:"iconfont icon-a-icon-VideoGeneration",label:"newGenerate106",tooltip:""},{key:"img2Live2d",icon:"iconfont icon-a-icon-VideoGeneration",label:"newGenerate122",tooltip:""},{key:"txt2video",icon:"iconfont icon-Txt2Vid",label:"newGenerate105",tooltip:""},{key:"effect",icon:"iconfont icon-Effect",label:"Effect",tooltip:""}],effectPopoverVisible:!1,debounceGenerate:function(){},inputSize:{minRows:1,maxRows:3},isShowSale:!1,currentPlaceholder:this.$t("WhatDoUWantToCreate"),originalPlaceholder:this.$t("WhatDoUWantToCreate")}},computed:Ci(Ci({},Object(c.c)("user",["isCompanyAccount","isLoggedIn","userInfo"])),{},{specialEffectsOutputNodes:function(){var e;return(null===(e=this.value)||void 0===e||null===(e=e.SpecialEffectsAppInfo)||void 0===e||null===(e=e.templateInfo)||void 0===e||null===(e=e.inputs)||void 0===e?void 0:e.length)||1},checkIsShowDisable:function(){var e,t,n,o;return"effect"===this.currentType?!(null!==(e=this.effectImageList)&&void 0!==e&&null!==(e=e.slice(0,this.specialEffectsOutputNodes))&&void 0!==e&&e.every((function(e){return null==e?void 0:e.url}))&&null!==(t=this.specialEffectsAppInfo)&&void 0!==t&&t.id):"img2video"===this.currentType||"img2Live2d"===this.currentType?0===(null===(n=this.value)||void 0===n||null===(n=n.imageToVideoList)||void 0===n?void 0:n.length):"txt2video"===this.currentType&&!(null!=this&&null!==(o=this.value)&&void 0!==o&&o.prompt)},getCurrentModelSupportTabs:function(){var e,t,n=null==this||null===(e=this.easyTop)||void 0===e?void 0:e.currentRawModelType,o=(null===(t=_t.MODEL_CONFIG_TEMPLATE[n])||void 0===t?void 0:t.supportTabs)||[];return o.includes("effect")||o.push("effect"),o},getTabList:function(){var e=this;return this.typeOptions.filter((function(t){var n;return null===(n=e.getCurrentModelSupportTabs)||void 0===n?void 0:n.includes(null==t?void 0:t.key)}))},isShowTranslate:function(){var e,t,n;return(null===(e=this.value)||void 0===e?void 0:e.isTranslate)&&""!==(null===(t=this.value)||void 0===t?void 0:t.prompt)&&""!==(null===(n=this.value)||void 0===n?void 0:n.local_prompt)},getDiscountOffText:function(){var e;return"".concat(null===(e=this.easyTop)||void 0===e?void 0:e.discountOff,"% Off")},currentType:function(){var e;return(null==this||null===(e=this.value)||void 0===e?void 0:e.currentVideoInputToolTab)||""},showImageToVideoUpload:function(){return"img2video"===this.currentType||"img2Live2d"===this.currentType},showVideoEffectUpload:function(){return"effect"===this.currentType},showEffectBtn:function(){return"effect"===this.currentType},showUploadArea:function(){return["img2video","img2Live2d","effect"].includes(this.currentType)},isVideo:function(){var e,t=this;if(null==this||null===(e=this.specialEffectsAppInfo)||void 0===e||null===(e=e.cover)||void 0===e||!e.url)return!1;return[".mp4",".webm",".ogg"].some((function(e){var n;return((null==t||null===(n=t.specialEffectsAppInfo)||void 0===n||null===(n=n.cover)||void 0===n?void 0:n.url)||"").toLowerCase().endsWith(e)}))},specialEffectsAppInfo:function(){var e;return(null==this||null===(e=this.value)||void 0===e?void 0:e.SpecialEffectsAppInfo)||{}},specialEffectsAppOutputNodes:function(){var e;return(null===(e=this.specialEffectsAppInfo)||void 0===e||null===(e=e.templateInfo)||void 0===e||null===(e=e.inputs)||void 0===e?void 0:e.length)||1},effectImageList:function(){var e;return(null==this||null===(e=this.value)||void 0===e?void 0:e.specialEffectsImageList)||[]}}),mounted:function(){this.debounceGenerate=Object(Vt.debounce)(this.handleGenerate,500),this.$EventBus.$on("closeAllGeneratePopup",this.handleCloseEffectSelectPopup)},beforeDestroy:function(){this.$EventBus.$off("closeAllGeneratePopup",this.handleCloseEffectSelectPopup)},methods:{handleCloseEffectSelectPopup:function(){try{var e;null===(e=this.$refs)||void 0===e||null===(e=e.specialEffectsAppSelect)||void 0===e||e.handleClose()}catch(e){}},handleKeyCode:function(e){if(13==e.keyCode)if(e.metaKey||e.altKey){var t=this.value.prompt,n=document.querySelector("#easyGenerateVideoInput"),o=n.selectionStart,r=n.selectionEnd,l=t.slice(0,o)+"\n"+t.slice(r);n.focus(),setTimeout((function(){n.setSelectionRange(o+1,o+1),n.focus()}),10),this.changeConfig(l,"prompt")}else e.preventDefault(),this.debounceGenerate&&this.debounceGenerate()},changeConfig:function(e,t){var n,o=JSON.parse(JSON.stringify(this.value));"prompt"===t&&o.isTranslate&&(o.isTranslate=!1),t&&(o[t]=e),null==this||null===(n=this.easyTop)||void 0===n||n.updateConfig(o)},handleTypeChange:function(e){var t;if(this.currentType!==e){null==this||null===(t=this.easyTop)||void 0===t||t.changeCurrentVideoInputToolTab(e);var n={txt2video:"click_video_model",img2video:"click_image_model",effect:"click_video_effect"};n[e]&&this.$logEvent("log_actions",{operation:"".concat(n[e]," ").concat(this.currentType),behavior_info:"on_video_generate_params_page",behavior_info_sub:"click_video_generate"})}},handleOpenPickWorkModal:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&["imageToVideo","imageToLive2D"].includes(t.type)&&null!==(e=this.value)&&void 0!==e&&null!==(e=e.imageToVideoList)&&void 0!==e&&e.length?this.$message.warning(this.$t("newGenerate81")):this.$refs.pickOrUploadImageModal.openModal([],t||null)},handleAddImageToVideoImage:function(){var e={type:"img2video"===this.currentType?"imageToVideo":"imageToLive2D"};this.$refs.pickOrUploadImageModal.openModal([],e)},handleAddEffectImage:function(e){var t={type:"effectImage",index:e};this.$refs.pickOrUploadImageModal.openModal([],t)},handleEffectSelect:function(e){var t,n=this,o=(null==e?void 0:e.sub_title)||"";null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig({SpecialEffectsAppInfo:e,prompt:o}),setTimeout((function(){n.effectPopoverVisible=!1}),100)},handleDeleteEffectImage:function(e){var t;null===(t=this.easyTop)||void 0===t||t.deleteEffectImage(e)},checkNotAllowQualityMode:function(){var e,t,n;return(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.hasEnableImageToImage)&&(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.isSDXLModel)&&(null==this||null===(n=this.easyTop)||void 0===n?void 0:n.isEnableQuality)},handleGenerate:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.checkIsShowDisable){t.next=2;break}return t.abrupt("return");case 2:if(!e.checkNotAllowQualityMode()){t.next=13;break}return t.prev=3,t.next=6,null===(n=e.$refs)||void 0===n||null===(n=n.commonConfirmModal)||void 0===n?void 0:n.show({subTitle:"newGenerate46"}).then((function(){var t,n=JSON.parse(JSON.stringify(e.value));Object.assign(n,{generate:{gen_mode:0}}),null==e||null===(t=e.easyTop)||void 0===t||t.updateConfig(n)}));case 6:null===(o=e.easyTop)||void 0===o||o.handleGenerate(),t.next=11;break;case 9:t.prev=9,t.t0=t.catch(3);case 11:t.next=14;break;case 13:null===(r=e.easyTop)||void 0===r||r.handleGenerate();case 14:case"end":return t.stop()}}),t,null,[[3,9]])})))()},handlePickImage:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o&&["imageToVideo","imageToLive2D"].includes(o.type)&&(null===(e=this.easyTop)||void 0===e||e.addImageToVideo(n[0],o.type));o&&"effectImage"===o.type&&(null===(t=this.easyTop)||void 0===t||t.updateEffectImage(n[0],o.index))},handleViewMore:function(){},handleDeleteEffect:function(e){var t;e.stopPropagation(),null==this||null===(t=this.easyTop)||void 0===t||t.updateConfig({SpecialEffectsAppInfo:null}),e.preventDefault()},handleDeleteImageToVideo:function(e){var t;null===(t=this.easyTop)||void 0===t||t.deleteImageToVideo(e)},handleFocus:function(){this.currentPlaceholder=""},handleBlur:function(){this.currentPlaceholder=this.originalPlaceholder}}},wi=Ti,xi=(n(5477),{name:"ParamsPanel",components:{ModelPanel:It,AdditionalPanel:$t,GenerateModePanel:ci,AdvanceSettingPanel:_i,ParamInputPanel:ni,videoTabs:Object(_.a)(wi,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-video-input-area"},[t("div",{staticClass:"type-selector"},e._l(e.getTabList,(function(n){return t("button",{key:n.key,staticClass:"type-btn",class:{active:e.currentType===n.key},attrs:{title:n.tooltip},on:{click:function(t){return e.handleTypeChange(n.key)}}},[t("span",{staticClass:"btn-text"},[e._v(e._s(e.$t(n.label)))])])})),0),e._v(" "),t("pick-or-upload-image-modal",{ref:"pickOrUploadImageModal",on:{confirm:e.handlePickImage}}),e._v(" "),t("common-confirm-modal",{ref:"commonConfirmModal"})],1)}),[],!1,null,"7f7e6c6f",null).exports,VideoUpload:zt.default},props:["value","menuIndex"],inject:["easyTop"],data:function(){return{}},mounted:function(){},computed:{showAdvancePanel:function(){var e,t,n=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isMiniMax),o="effect"!==(null==this||null===(t=this.value)||void 0===t?void 0:t.currentVideoInputToolTab);return n&&o},showAdditionalPanel:function(){var e,t,n,o,r,l,d,c,v=!(null!=this&&null!==(e=this.easyTop)&&void 0!==e&&e.isMiniMax),m=!(null!=this&&null!==(t=this.easyTop)&&void 0!==t&&t.isKLModel),h="effect"!==(null==this||null===(n=this.easyTop)||void 0===n||null===(n=n.currentConfigInfo)||void 0===n?void 0:n.currentVideoTab),f=!(null!=this&&null!==(o=this.easyTop)&&void 0!==o&&o.isTongYiFast||null!=this&&null!==(r=this.easyTop)&&void 0!==r&&r.isTongYiProfessional),_=!(null!=this&&null!==(l=this.easyTop)&&void 0!==l&&l.isPixVerse),y=!(null!=this&&null!==(d=this.easyTop)&&void 0!==d&&d.isHiDreamModel),C=!(null!=this&&null!==(c=this.easyTop)&&void 0!==c&&c.isSeaArtFilmModel);return v&&m&&h&&f&&_&&y&&C},showParamInputPanel:function(){var e,t,n,o="generateImage"===(null==this||null===(e=this.easyTop)||void 0===e?void 0:e.currentTab),r="generateVideo"===(null==this||null===(t=this.easyTop)||void 0===t?void 0:t.currentTab)&&!["effect"].includes(null==this||null===(n=this.value)||void 0===n?void 0:n.currentVideoInputToolTab);return o||r}},methods:{handleResetParams:function(e){var t;null==this||null===(t=this.easyTop)||void 0===t||t.resetConfig(e);try{this.$refs.generateModePanel.resetData()}catch(e){}}}}),Si=(n(5478),Object(_.a)(xi,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"c-generate-params-panel"},[t("div",{staticClass:"params-panel-main"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"generateVideo"===e.menuIndex,expression:"menuIndex === 'generateVideo'"}],staticClass:"params-panel-main-tabs"},[t("videoTabs",{attrs:{value:e.value}})],1),e._v(" "),t("model-panel",e._b({directives:[{name:"show",rawName:"v-show",value:"effect"!==e.value.currentVideoInputToolTab,expression:"value.currentVideoInputToolTab !== 'effect'"}],attrs:{value:e.value,"menu-index":e.menuIndex}},"model-panel",e.$attrs,!1)),e._v(" "),t("additional-panel",{directives:[{name:"show",rawName:"v-show",value:e.showAdditionalPanel,expression:"showAdditionalPanel"}],attrs:{value:e.value}}),e._v(" "),t("generate-mode-panel",{ref:"generateModePanel",attrs:{"menu-index":e.menuIndex},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e._v(" "),t("advance-setting-panel",{directives:[{name:"show",rawName:"v-show",value:e.showAdvancePanel,expression:"showAdvancePanel"}],attrs:{value:e.value}})],1),e._v(" "),t("div",{staticClass:"reset-params-box"},[t("div",{staticClass:"reset-params-btn",on:{click:function(t){return t.stopPropagation(),e.handleResetParams(e.menuIndex)}}},[t("span",{staticClass:"reset-params-btn-icon el-icon-refresh-left"}),e._v(" "),t("span",{staticClass:"reset-params-btn-text"},[e._v(e._s(e.$t("resetAllConfig")))])])])])}),[],!1,null,"6bd0a80b",null).exports),Ii=n(952),Oi=n(5479),ki=n(48),Mi=n(407),Pi=n(870),Li=n(51),ji=n(818),Ei=n(871),$i=n(301);function Di(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ri(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Di(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Di(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vi={name:"GenerateMain",components:{ParamsPanel:Si,CombinedSelectDialog:Mi.default,CommonParamsPanel:Ei.default,UpscaleToolsModal:Pi.default,SelectVideoModelModal:$i.default},mixins:[Oi.a,ji.googleCaptchaMixIn],provide:function(){return{easyTop:this}},data:function(){return{isCollapsed:!0,currentTab:"generateImage",tabs:[{id:"generateImage",name:"imgTab",component:"params-panel",taskDomainTypes:[3,4,5,6,7,8,9,10]},{id:"generateVideo",name:"videoTab",component:"params-panel",taskDomainTypes:[11,12,13,14,15]},{id:"app",name:"aiapp",component:"common-params-panel",taskDomainTypes:[1,2,16]}],config:{generateImage:Object(Ii.a)("generateImage"),generateVideo:Object(Ii.a)("generateVideo"),app:Object(Ii.a)("app")},defaultModel:null,defaultVideoModel:null,debounceGenerate:function(){},discountOff:0,costInfo:{},calcCost:0,isShowSale:!1,isImageToImageToTextToImage:!1,UPLOAD:new Li.a({type:2}),needGoogleCaptcha:""}},computed:Ri(Ri(Ri(Ri(Ri(Ri({},Object(c.c)("creation",["taskBaseModels","animationLoraRecommends","taskModules","taskUnits","taskSdxlUnits","taskModels","sd_xl_base_model","image_mode","lab_base_model","lab_ctr_units","lab_style_enhancement_tag","default_flux","size_billing_rule","v2_sd_xl_ctr_units","v2_ctr_units","modelDefaultConfigParams","default_ai_app"])),Object(c.c)("user",["accountSettingsData","userInfo","isCompanyAccount","isLoggedIn"])),Object(c.e)("payment",["paymentInfo"])),Object(c.e)("user",["cdnHost"])),Object(c.e)("videoEditor",["projectId"])),{},{localProjectId:function(){return this.projectId},getDiscountOffText:function(){return"".concat(null==this?void 0:this.discountOff,"% Off")},isNoobai:function(){var e,t=null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type;return["NoobAI"].includes(t)||(t||"").includes("NoobAI")},currentTabConfig:function(){return this.config[this.currentTab]},isVip:function(){var e,t;return(null===(e=this.paymentInfo)||void 0===e?void 0:e.activeState)||(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)||this.isCompanyAccount},isOnlyVipLite:function(){var e,t;return!(null!==(e=this.paymentInfo)&&void 0!==e&&e.activeState)&&!this.isCompanyAccount&&(null===(t=this.paymentInfo)||void 0===t?void 0:t.liteActiveState)},isSd35Model:function(){var e,t=null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type;return["SD 3.5"].includes(t)||(t||"").includes("SD 3.5")},isSDXLModel:function(){var e,t=null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type;return["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].concat(Object(o.a)(et.L.sdxl)).includes(t)||(t||"").includes("SDXL")},isSdModel:function(){var e,t=null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type;return[].concat(Object(o.a)(et.L.sd),Object(o.a)(et.L.sd3),["SD 1.5 LCM","SD 1.5 Hyper"],Object(o.a)(et.L.other)).includes(t)},isCommunityFlux:function(){var e,t=null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type;return et.L.flux.includes(t)},isHiDreamModel:function(){var e,t=null==this||null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type;return((null===et.L||void 0===et.L?void 0:et.L.HiDream)||[]).includes(t)},isSeaArtFilmModel:function(){var e,t=null==this||null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type;return((null===et.L||void 0===et.L?void 0:et.L.SeaDream)||[]).includes(t)},isShowAnimeEnhance:function(){return!1},isAnimeEnhanceEnable:function(){return!1},getCurrentGenerateType:function(){var e=this.currentTabConfig,t=((null==e?void 0:e.imageToImageList)||[]).filter((function(e){return null==e?void 0:e.enable})),n=((null==e?void 0:e.controlnet_units)||[]).filter((function(e){return null==e?void 0:e.enable}));return this.isCommunityFlux||!(null!=t&&t.length||null!=n&&n.length)||this.isAnimeEnhanceEnable||this.isSd35Model?"textToImage":null!=t&&t.length?"imageToImage":null!=n&&n.length?"conditionToImage":"textToImage"},getCurrentEquivalentCategory:function(){var e=1,t=this.currentTabConfig,n=this.getCurrentModelType(null==t?void 0:t.base_model_type);return this.isCommunityFlux||this.isAnimeEnhanceEnable?e=7:"SD"===n?(0===t.generate.mode&&(e=1),1===t.generate.mode&&(e=2),2===t.generate.mode&&(e=6),e):"SDXL"===n?e=5:void 0},currentPrompt:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.prompt},currentPromptMagicStatus:function(){var e;return null===(e=this.currentTabConfig)||void 0===e||null===(e=e.generate)||void 0===e?void 0:e.prompt_magic_mode},currentImageSizeStatus:function(){var e;return null===(e=this.currentTabConfig)||void 0===e||null===(e=e.generate)||void 0===e?void 0:e.gen_mode},computedCost:function(){var e,t,n=this.currentTabConfig,o=this.size_billing_rule.baselines||[],r=this.size_billing_rule.extra_rule||[],l=this.size_billing_rule.face_restoration||[],d=(null===(e=this.size_billing_rule)||void 0===e?void 0:e.imt_to_img_baselines)||[],c=(null===(t=this.size_billing_rule)||void 0===t?void 0:t.lab_billing_rule)||{},v=1,m=Math.max(n.width,n.height);(o||[]).forEach((function(e){m>e.min&&m<=e.max&&(v=e.value)})),["conditionToImage","imageToImage"].includes(this.getCurrentGenerateType)&&(d||[]).forEach((function(e){m>e.min&&m<=e.max&&(v=e.value)}));var h=1,f=this.getCurrentEquivalentCategory;(r||[]).forEach((function(e){e.task_category===f&&(h=e.value||1)}));var _=0,y=(null==n?void 0:n.agency_fee)||0;(n.lora_models||[]).forEach((function(e){e&&e.agency_fee>0&&(_+=e.agency_fee)}));var C=null;C=5===f?6*(n.n_iter||1):v*h*(n.n_iter||1),"LCM"===n.sampler_name&&(C*=.5);var T=C;if([4,5,7].includes(f)||(T=C+_+y),n.enable_hr&&""!==n.hr_upscaler&&[1,"1"].includes(f)){var w,x=n.hr_scale||6,S=n.width*x,I=n.height*x,O=1,k=(null===(w=this.size_billing_rule)||void 0===w?void 0:w.hd)||[],M=Math.max(S,I);(k||[]).forEach((function(e){M>e.min&&M<=e.max&&(O=e.value)}));var P=1;(r||[]).forEach((function(e){2===e.task_action&&e.task_category===f&&(P=e.value||1)})),T+=O*P*(n.n_iter||1)}if(!["",null,void 0].includes(n.ad_model)&&["textToImage","imageToImage"].includes(this.getCurrentGenerateType)&&![7,"7",5,"5","sdxl","studio"].includes(f)){var L=0;(l||[]).forEach((function(e){m>e.min&&m<=e.max&&(L=e.value||0)})),T+=L*(n.n_iter||1)}if(7===f){var j,E={conditionToImage:"contrlnet_to_img",textToImage:"text_to_img",imageToImage:"img_to_img"}[this.getCurrentGenerateType]||"",$=E&&c[E]||6,D=0;if([1].includes(null==n||null===(j=n.generate)||void 0===j?void 0:j.anime_enhance)&&"textToImage"===this.getCurrentGenerateType){D=2*(n.n_iter||1)}T=$*(n.n_iter||1)+D}return 3===n.speed_type&&(T=0),T},currentModelType:function(){var e;return this.getCurrentModelType(null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type)},currentWidth:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.width},currentHeight:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.height},currentUpscaler:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.hr_upscaler},currentFaceRepair:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.restore_faces},currentPersonRepair:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.ad_model},currentPersonRepairObj:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.ad_units},currentImageOrControlNet:function(){try{var e=this.currentTabConfig,t=((null==e?void 0:e.imageToImageList)||[]).filter((function(e){return null==e?void 0:e.enable})),n=((null==e?void 0:e.controlnet_units)||[]).filter((function(e){return null==e?void 0:e.enable}));return this.isCommunityFlux||!(null!=t&&t.length||null!=n&&n.length)||this.isAnimeEnhanceEnable?"textToImage":null!=t&&t.length?"imageToImage":null!=n&&n.length?"conditionToImage":"textToImage"}catch(e){return"textToImage"}},currentRawModelType:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.base_model_type},hasEnableImageToImage:function(){var e;return((null===(e=this.currentTabConfig)||void 0===e?void 0:e.imageToImageList)||[]).some((function(e){return null==e?void 0:e.enable}))},hasEnableControlNetToImage:function(){var e;return((null===(e=this.currentTabConfig)||void 0===e?void 0:e.controlnet_units)||[]).some((function(e){return null==e?void 0:e.enable}))},hasEnableControlNetToImageLength:function(){var e;return((null===(e=this.currentTabConfig)||void 0===e?void 0:e.controlnet_units)||[]).length},isEnableQuality:function(){try{var e;return 1===(null===(e=this.currentTabConfig)||void 0===e||null===(e=e.generate)||void 0===e?void 0:e.gen_mode)}catch(e){}},taskControlNetModules:function(){return null!=this&&this.isSDXLModel?this.v2_sd_xl_ctr_units:this.v2_ctr_units},hasActiveIpMain:function(){var e,t=this.currentTabConfig;return["FLUX"===this.getCurrentModelType(null==t?void 0:t.base_model_type),((null==t?void 0:t.ipList)||[]).some((function(e){return null==e?void 0:e.enable})),!(null!=t&&null!==(e=t.lora_models)&&void 0!==e&&e.length)].every((function(e){return e}))},hasIpMaintain:function(){var e,t,n=this.currentTabConfig;return["FLUX"===this.getCurrentModelType(null==n?void 0:n.base_model_type),null==n||null===(e=n.ipList)||void 0===e?void 0:e.length,!(null!=n&&null!==(t=n.lora_models)&&void 0!==t&&t.length)].every((function(e){return e}))},currentModelId:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.art_model_no},notNeedCheckPrompt:function(){var e,t=(null===(e=this.currentTabConfig)||void 0===e||null===(e=e.imageToVideoList)||void 0===e?void 0:e.length)&&"img2video"===this.config[this.currentTab].currentVideoInputToolTab,n=(this.isMiniMax||this.isKLModel||this.isTongYiFast||this.isTongYiProfessional||this.isPixVerse)&&t,o="effect"===this.activeVideoInputTab&&this.isVideoModel;return n||o},currentSteps:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.steps},activeVideoInputTab:function(){var e;return null===(e=this.currentTabConfig)||void 0===e?void 0:e.currentVideoInputToolTab},currentSpecialEffectsTemplateInfo:function(){var e;return(null===(e=this.currentTabConfig)||void 0===e?void 0:e.SpecialEffectsAppInfo)||null},currentSpecialEffectsImageList:function(){var e;return(null===(e=this.currentTabConfig)||void 0===e?void 0:e.specialEffectsImageList)||[]},videoGenerationMode:function(){var e;return(null===(e=this.currentTabConfig)||void 0===e||null===(e=e.generate_video)||void 0===e?void 0:e.quality_mode)||""},videoMotionMode:function(){var e;return(null===(e=this.currentTabConfig)||void 0===e||null===(e=e.generate_video)||void 0===e?void 0:e.motion_mode)||""},videoStyle:function(){var e;return(null===(e=this.currentTabConfig)||void 0===e||null===(e=e.generate_video)||void 0===e?void 0:e.style)||""},imageGenerateConfig:function(){return this.config.generateImage||{}},videoGenerateConfig:function(){return this.config.generateVideo||{}}}),watch:{isLoggedIn:{handler:function(e,t){!e&&t&&this.checkNeedGoogleCaptcha()},immediate:!0},currentTab:{handler:function(e,t){e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},currentSpecialEffectsTemplateInfo:{handler:function(e,t){var n;"effect"===(null===(n=this.currentTabConfig)||void 0===n?void 0:n.currentVideoInputToolTab)&&e!==t&&this.throttledClick&&this.throttledClick()},deep:!0},currentSpecialEffectsImageList:{handler:function(e,t){var n;"effect"===(null===(n=this.currentTabConfig)||void 0===n?void 0:n.currentVideoInputToolTab)&&e!==t&&this.throttledClick&&this.throttledClick()},deep:!0},computedCost:{handler:function(e,t){this.config[this.currentTab].prompt&&e!==t&&this.throttledClick&&this.throttledClick()},immediate:!0},"config.generateImage":{handler:function(e,t){"generateImage"===this.currentTab&&e!==t&&this.throttledClick&&this.throttledClick()},deep:!0,immediate:!0},"config.generateVideo":{handler:function(e,t){"generateVideo"===this.currentTab&&e!==t&&this.throttledClick&&this.throttledClick()},deep:!0,immediate:!0}},mounted:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.initDebounce(),e.getDefaultInter(),e.isLoggedIn&&(null==e||null===(n=e.lab_base_model)||void 0===n||!n.length)){t.next=6;break}return o=[e.$store.dispatch("creation/getTaskOptionsInfo"),e.$store.dispatch("creation/getV2TaskOptionsInfo")],t.next=6,Promise.all(o);case 6:return e.$EventBus.$on("openVideoEditorRecModal",e.openVideoModal),t.next=9,e.init();case 9:e.show({action:1}),e.$EventBus.$on("remixClick",e.show),e.$EventBus.$on("updateCategoryInfo",e.updateCategoryInfo);case 12:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.$EventBus.$off("remixClick"),this.$EventBus.$off("updateCategoryInfo"),this.$EventBus.$off("openVideoEditorRecModal")},methods:{init:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.dispatch("creation/getTaskOptionsInfo"),r=(null==e?void 0:e.modelDefaultConfigParams)||{},null!==(n=Object.keys(r))&&void 0!==n&&n.length||e.$store.dispatch("creation/getV2TaskOptionsInfo"),null!==(o=e.defaultModel)&&void 0!==o&&o.id){t.next=6;break}return t.next=6,e.getPresetModel(!1,!1);case 6:return t.next=8,e.resetConfig(!0);case 8:case"end":return t.stop()}}),t)})))()},show:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var o,r,l,d,data,c,v,m,h,f,_,y,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==(o=n.defaultModel)&&void 0!==o&&o.id){t.next=4;break}return t.next=4,n.getPresetModel(!1,!0);case 4:if(n.checkNeedGoogleCaptcha(),n.$store.dispatch("creation/setGenerateTaskNum",0),l=e.action,d=e.data,null==(data=void 0===d?{}:d)||!data.creativity||3!==(null==data?void 0:data.creativity.type)&&4!==(null==data?void 0:data.creativity.type)){t.next=12;break}return h={obj:{banner:null==data||null===(c=data.creativity)||void 0===c?void 0:c.cover,name:null==data||null===(v=data.creativity)||void 0===v?void 0:v.name,id:null==data||null===(m=data.creativity)||void 0===m?void 0:m.id,reMixId:null==e?void 0:e.task_id},type:"aiApp"},n.switchTab("app"),n.updateCategoryInfo(h,"aiApp"),t.abrupt("return");case 12:if("SIMPLE"===(null==data?void 0:data.openType)&&(n.switchTab("generateImage"),n.handleSimpleTextToImage(e)),null==e||null===(r=e.data)||void 0===r||!r.imageToVideoUrl){t.next=17;break}return n.switchTab("generateVideo"),n.handleSelectVideoModel(e.data,null==e||null===(f=e.data)||void 0===f?void 0:f.imageToVideoUrla,n.defaultVideoModel),t.abrupt("return");case 17:if("SIMPLE"!==(null==data?void 0:data.openType)){t.next=19;break}return t.abrupt("return");case 19:if(6!==l||null==data||!data.imageUrl){t.next=22;break}return n.getUpscaleParamsAndOpenModal(e),t.abrupt("return");case 22:if(24!==(null==data?void 0:data.action)||null==data||!data.parent_task_id){t.next=27;break}_=JSON.parse(JSON.stringify(data));try{_.art_model_no=(null==e||null===(y=e.data)||void 0===y?void 0:y.art_model_no)||"",_.art_model_ver_no=(null==e||null===(C=e.data)||void 0===C?void 0:C.art_model_ver_no)||"",_.art_work_no=""}catch(e){}return n.getAnimeParamsAndOpenModal(_),t.abrupt("return");case 27:n.getConfig(Ri(Ri({},e),{},{action:l}));case 28:case"end":return t.stop()}}),t)})))()},getAnimeParamsAndOpenModal:function(data){var e,t,n,o;null==data||null===(e=data.meta)||void 0===e||e.animatediff,Array.isArray(null==data||null===(t=data.meta)||void 0===t?void 0:t.init_images)&&null!=data&&null!==(n=data.meta)&&void 0!==n&&null!==(n=n.init_images)&&void 0!==n&&n.length&&(null==data||null===(o=data.meta)||void 0===o||o.init_images[0]),null==data||data.art_model_no,null==data||data.art_model_ver_no,null==data||data.art_work_no,null==data||data.meta},getUpscaleParamsAndOpenModal:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.data,o=((void 0===n?{}:n)||{}).imageUrl,r={url:void 0===o?"":o};t&&(r=e),r.source=40001,r.channel_id=this.$route.query.project_id,this.openEasyUpscaleToolsModal(r)},getStudioDefaultStyle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getCurrentModelType(e),o={width:832,height:1216,min:768,max:1536};return"SD"===n&&(o={width:624,height:936,min:512,max:1024}),(t||["FLUX"].includes(n))&&(o={width:688,height:1024,min:384,max:1024}),"HiDream"===n&&(o={width:832,height:1248,min:768,max:1360}),o},openVideoModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{this.handleSelectVideoModel({},e,this.defaultVideoModel)}catch(e){}},resetRemixParams:function(){var e=Ri({},_t.AI_VIDEO_GENERATE_PARAMS);return e.isUploadImage=!1,e.enable_hr=!1,e.hr_upscaler="",e.hr_scale=1.5,e.ad_model="",e.restore_faces=!1,e.ad_units={lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},e.embeddings=[],e.imageToImageList=[],e.lora_models=[],e.controlnet_units=[],e.negative_prompt="",e.ipList=[],e.styleReferenceList=[],e},setImageSize:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(Vt.cloneDeep)(source);return null!=e&&e.width&&null!=e&&e.height||(e.width=688,e.height=1024),e},getDefaultModel:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null==data||!data.art_model)try{var e,t,n,o,r,l,d,c,v,m,h,f,_,y,C,T,w={},x={banner:{url:""}};if(this.defaultModel)(w=JSON.parse(JSON.stringify(this.defaultModel))).cover=(null===(y=w)||void 0===y||null===(y=y.banner)||void 0===y?void 0:y.url)||"",x.cover=(null===(C=w)||void 0===C||null===(C=C.banner)||void 0===C?void 0:C.url)||"",x.model_cover=(null===(T=w)||void 0===T||null===(T=T.banner)||void 0===T?void 0:T.url)||"";x.id=null===(e=w)||void 0===e?void 0:e.id,x.name=null===(t=w)||void 0===t?void 0:t.name,x.art_work_no="",x.banner.url=null===(n=w)||void 0===n?void 0:n.cover,x.is_agency_fee=(null===(o=w)||void 0===o?void 0:o.is_agency_fee)||!1,x.agency_fee=(null===(r=w)||void 0===r?void 0:r.agency_fee)||0,x.version_name=(null===(l=w)||void 0===l?void 0:l.model_ver_name)||(null===(d=w)||void 0===d?void 0:d.version_name),x.model_ver_name=(null===(c=w)||void 0===c?void 0:c.model_ver_name)||(null===(v=w)||void 0===v?void 0:v.version_name),x.model_ver_no=(null===(m=w)||void 0===m?void 0:m.model_ver_no)||"",x.base_model=(null===(h=w)||void 0===h?void 0:h.base_model)||"",x.modelTags=Array.isArray(null===(f=w)||void 0===f?void 0:f.tags)?null===(_=w)||void 0===_?void 0:_.tags:[],data.art_model=x}catch(e){}return data},handleInitConfig:function(){var e,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(Vt.cloneDeep)(source),pattern=/--auto|--s2/g;try{t.local_prompt=t.local_prompt.replace(pattern,""),t.local_prompt.trim(),t.prompt=t.prompt.replace(pattern,""),t.prompt.trim()}catch(e){}if("textToImage"===this.menuIndex&&["sdxl",5,"5"].includes(t.category))try{var n,o,r,l;t.cfg_scale=t.cfg_scale||7,t.steps=t.steps||30;var d,c=this.sd_xl_base_model[0];if(c=null===(n=this.getDefaultModel({}))||void 0===n?void 0:n.art_model,t.art_model_no=t.art_model_no||c.id,t.modelName=t.modelName||c.name,t.art_model_no===c.id)t.art_work_no=(null===(d=c)||void 0===d||null===(d=d.artwork)||void 0===d?void 0:d.id)||"";else t.art_work_no=t.art_work_no||"";t.art_work_no=t.art_work_no||"",t.model_cover=t.model_cover||c.cover,t.is_agency_fee=t.is_agency_fee||!1,t.agency_fee=t.agency_fee||0,t.art_model_ver_no_name=(null==t?void 0:t.art_model_ver_no_name)||(null===(o=c)||void 0===o?void 0:o.model_ver_name)||"",t.art_model_ver_no=(null==t?void 0:t.art_model_ver_no)||(null===(r=c)||void 0===r?void 0:r.model_ver_no)||"",t.base_model_type=(null==t?void 0:t.base_model_type)||(null===(l=c)||void 0===l?void 0:l.base_model)||"",t.modelTags=this.getStudioModelTags(c)}catch(e){}if(null!=t&&null!==(e=t.roop_arg)&&void 0!==e&&e.image&&(t.roopZoom=!0),t&&t.sdxl)try{var v;t.enablePromptMagic=![0,"0",null,void 0].includes(t.sdxl.prompt_magic),t.sdxl={prompt_magic:[0,"0",null,void 0].includes(null==t||null===(v=t.sdxl)||void 0===v?void 0:v.prompt_magic)?.4:t.sdxl.prompt_magic,prompt_style:t.sdxl.prompt_style||"Fantasy Art"}}catch(e){}return t},getConfig:function(e){var t=this;if(null==e||!e.task_id){var n,o=this.getCacheConfig()||{},l=!1;return null!=e&&e.id||!o||null===(n=o[this.currentTab])||void 0===n||!n.art_model_no||(l=!0),void this.setDefaultMeta(e,l)}Object(Ze.getMetaInfo)({id:e.task_id}).then(function(){var n=Object(r.a)(regeneratorRuntime.mark((function n(o){var r,l,d,c,v,m,h,f,_,y,C,T,w,x,S,I,O,k,M,P,L,data,j,E,$,D,R,V,A,N,z,F,U,B,G,H,J,W,K,X,Y,Q,Z,ee,te,ie,ne,oe,ae,re,se,le,de,ce,ue,ve,me,pe,he,fe,ge,_e,be,ye,Ce,Te,we,pattern,xe,Se,Ie,Oe,ke,Me,Pe,Le,je,Ee,$e,De,Re,Ve,Ae,Ne,ze,Fe,Ue,Be,Ge,He,Je,We,Ke,Xe,qe;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if([1e4,"10000"].includes(null==o||null===(r=o.status)||void 0===r?void 0:r.code)){n.next=3;break}return t.$message.error(o.status.msg||t.$t("ServerError")),n.abrupt("return");case 3:if(data=Ri(Ri({},e),o.data),3===(null==e?void 0:e.action))try{data.meta.lab_base=[]}catch(e){}if(j=JSON.parse(JSON.stringify(data)),24!==(null==data||null===(l=data.task)||void 0===l?void 0:l.type)&&24!==(null==data?void 0:data.action)){n.next=11;break}E=JSON.parse(JSON.stringify(data));try{D=E.img_uris,R=void 0===D?[]:D,V=(null==E?void 0:E.meta)||{},A=V.init_images,N=null==E||null===($=E.banner)||void 0===$?void 0:$.url,E.meta.init_images=null!=R&&R.length?A||[]:N?[N]:[]}catch(e){}return t.getAnimeParamsAndOpenModal(E),n.abrupt("return");case 11:if(3===(null==e?void 0:e.action)||![4,13].includes(null==data||null===(d=data.task)||void 0===d?void 0:d.type)){n.next=16;break}return F=(null==data||null===(z=data.meta)||void 0===z?void 0:z.hi_res_arg)||{},U=F.upscaling_resize,B=void 0===U?2:U,G=F.upscaler_1,H=void 0===G?"4x-UltraSharp":G,J=F.image,W={url:void 0===J?"":J,upscaler_1:H,upscaling_resize:B},t.getUpscaleParamsAndOpenModal(W,"display"),n.abrupt("return");case 16:K=!1;try{K=(null==data||null===(X=data.meta)||void 0===X||null===(X=X.generate_video)||void 0===X?void 0:X.init_extend_video_url)||""}catch(e){}if((Y=t.checkCurrentTab(data))&&t.switchTab(Y),37!==(null==e?void 0:e.action)&&37!==(null==data||null===(c=data.task)||void 0===c?void 0:c.type)&&37!==(null==data?void 0:data.type)||!K){n.next=23;break}return t.getVideoExtensionAndOpenModal(data),n.abrupt("return");case 23:if(Q=t.getMapMenuIndex(null==data||null===(v=data.task)||void 0===v?void 0:v.type),null!=e&&e.parent_task_id&&(data.meta=Object.assign({},(null==e?void 0:e.meta)||{},(null==o||null===(Z=o.data)||void 0===Z?void 0:Z.meta)||{}),data.art_work_no=(null==data?void 0:data.artwork_no)||""),null!=e&&e.parent_task_id&&(data.channel=null==data?void 0:data.category),3===(null==e?void 0:e.action)){data.meta.init_images=(null==e?void 0:e.init_images)||[],data.meta.controlnet_units=[];try{ie={image:null==e||null===(ee=e.init_images)||void 0===ee?void 0:ee[0],mode:"ImagePrompt",stop_at:1,weight:.35},null!=data&&null!==(te=data.meta)&&void 0!==te&&null!==(te=te.lab_base)&&void 0!==te&&null!==(te=te.conds)&&void 0!==te&&te.length?data.meta.lab_base.conds.push(ie):data.meta.lab_base.conds=[ie]}catch(e){}}return ne=[t.checkIsStudioMode(null==data?void 0:data.category),t.checkIsStudioMode(null==data||null===(m=data.task)||void 0===m?void 0:m.category)].some((function(e){return e})),data&&ne&&(data.channel="studio",data.category=7,t.creativeMode="studio",null==data||null===(oe=data.task)||void 0===oe||oe.type,t.checkIsStudioMode(null===(ae=t.config[t.currentTab])||void 0===ae?void 0:ae.category)||t.resetStudioParams()),n.next=31,t.handleMeta(data,"",Y);case 31:if(re=n.sent,se=t.resetRemixParams(),(re=Object.assign({},se,re))&&null!==(h=re)&&void 0!==h&&null!==(h=h.controlnet_units)&&void 0!==h&&h.length&&(re.controlnet_units=((null===(le=re)||void 0===le?void 0:le.controlnet_units)||[]).map((function(e){return e.enable=!0,e}))),re.logEventSource=(null==e?void 0:e.logEventSource)||0,re=t.setImageSize(re),(re=t.handleInitConfig(re)).base_model_type=(null==data?void 0:data.base_model_name)||"",de=[t.checkIsStudioMode(null==data?void 0:data.category),t.checkIsStudioMode(null==data?void 0:data.channel)].some((function(e){return e})),["textToImage","imageToImage","conditionToImage"].includes(Q)&&de)try{be=(t.lab_base_model||[]).filter((function(e){return(null==e?void 0:e.id)===t.fluxModelId})),be[0],ye=null===(ce=t.getDefaultModel({}))||void 0===ce?void 0:ce.art_model,re.art_model_no=re.art_model_no||ye.id,re.modelName=re.modelName||ye.name,re.art_work_no="",re.model_cover=re.model_cover||(null===(ue=ye)||void 0===ue?void 0:ue.cover),re.is_agency_fee=re.is_agency_fee||!1,re.agency_fee=re.agency_fee||0,re.art_model_ver_no_name=(null===(ve=re)||void 0===ve?void 0:ve.art_model_ver_no_name)||(null===(me=ye)||void 0===me?void 0:me.model_ver_name)||"",re.art_model_ver_no=(null===(pe=re)||void 0===pe?void 0:pe.art_model_ver_no)||(null===(he=ye)||void 0===he?void 0:he.model_ver_no)||"",re.base_model_type=(null===(fe=re)||void 0===fe?void 0:fe.base_model_type)||(null===(ge=ye)||void 0===ge?void 0:ge.base_model)||"",re.modelTags=null!==(_e=re)&&void 0!==_e&&_e.modelTags?re.modelTags:t.getStudioModelTags(ye),re=t.checkStudioParams(re)}catch(e){}if("imageToImage"!==Q&&"animGen"!==Q){n.next=52;break}if(null!=j&&null!==(Ce=j.meta)&&void 0!==Ce&&Ce.mask&&(re.mask=(null==j||null===(we=j.meta)||void 0===we?void 0:we.mask)||""),pattern=/^(http|https):\/\//,re.keepDenoisingStrength=!1,3===re.action&&(re.copyMask="",re.mask="",re.tempMask="",re.keepDenoisingStrength=!1),!pattern.test(re.mask)){n.next=51;break}return re.ad_model="",re.keepDenoisingStrength=!0,n.next=51,Object(tt.getImageBlob)(re.mask,(function(e){re.copyMask=re.mask,re.mask=e,re.tempMask=e}));case 51:!pattern.test(re.mask)&&null!=data&&null!==(Te=data.meta)&&void 0!==Te&&null!==(Te=Te.ad_units)&&void 0!==Te&&Te.length&&(Se=(null==data||null===(xe=data.meta)||void 0===xe?void 0:xe.ad_units[0])||{},re.ad_model=Se.ad_model||"",re.ad_units=Object.assign({},{lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},Se||{}),delete re.ad_units.ad_model);case 52:("imageToImage"===Q||["textToImage","conditionToImage"].includes(Q)&&3===(null===(f=re)||void 0===f?void 0:f.action))&&((ke={}).url=(null===(Ie=re)||void 0===Ie?void 0:Ie.init_images[0])||"",ke.denoising_strength=(null===(Oe=re)||void 0===Oe?void 0:Oe.denoising_strength)||.35,ke.enable=!0,ke.mask=re.mask||"",ke.tempMask=re.tempMask||"",ke.copyMask=re.copyMask||"",ke.compose_mask="",re.imageToImageList=[ke]),Me=(null===et.L||void 0===et.L?void 0:et.L.flux)||[],Pe=(null===et.L||void 0===et.L?void 0:et.L.sd35)||[],(Me.includes(null==data?void 0:data.base_model_name)||Pe.includes(null==data?void 0:data.base_model_name))&&null!=data&&null!==(_=data.meta)&&void 0!==_&&null!==(_=_.lab_base)&&void 0!==_&&null!==(_=_.conds)&&void 0!==_&&_.length&&(Re={},Ve=((null==data||null===(Le=data.meta)||void 0===Le||null===(Le=Le.lab_base)||void 0===Le?void 0:Le.conds)||[]).find((function(e){return"ImagePrompt"===e.mode}))||null,re.ipList=((null==data||null===(je=data.meta)||void 0===je||null===(je=je.lab_base)||void 0===je?void 0:je.conds)||[]).filter((function(e){return"IpMaintain"===e.mode})).map((function(e){return e.enable=!0,e})),re.styleReferenceList=((null==data||null===(Ee=data.meta)||void 0===Ee||null===(Ee=Ee.lab_base)||void 0===Ee?void 0:Ee.conds)||[]).filter((function(e){return"StyleReference"===e.mode})).map((function(e){return e.enable=!0,e})),re.lab_base.conds=((null===($e=re)||void 0===$e||null===($e=$e.lab_base)||void 0===$e?void 0:$e.conds)||[]).filter((function(e){return"IpMaintain"!==e.mode&&"StyleReference"!==e.mode})),Re.denoising_strength=null==Ve?void 0:Ve.weight,Re.enable=!0,Re.mask=re.mask||"",Re.tempMask=re.tempMask||"",Re.copyMask=re.copyMask||"",Re.url=(null==Ve?void 0:Ve.image)||"",Re.compose_mask=(null===(De=re)||void 0===De?void 0:De.compose_mask)||"",Ve&&(re.imageToImageList=[Re])),["textToImage","imageToImage","animGen"].includes(Q)&&null!=data&&null!==(y=data.meta)&&void 0!==y&&null!==(y=y.ad_units)&&void 0!==y&&y.length&&(Fe=(null===(Ae=data.meta)||void 0===Ae?void 0:Ae.ad_units[0])||{},Ue=null==data||null===(Ne=data.meta)||void 0===Ne||null===(Ne=Ne.ad_units)||void 0===Ne||null===(Ne=Ne[0])||void 0===Ne||null===(Ne=Ne.lora_models)||void 0===Ne?void 0:Ne[0],Be=Ue?Ri(Ri({},Ue),{},{banner:{url:(null==Ue||null===(ze=Ue.art_model)||void 0===ze||null===(ze=ze.banner)||void 0===ze?void 0:ze.url)||""}}):{},re.ad_model=Fe.ad_model||"",re.characterRepairZoom=!!re.ad_model,re.ad_units=Object.assign({},{lora:Be||{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""},Fe||{}),delete re.ad_units.ad_model),null!==(C=re)&&void 0!==C&&C.hr_scale&&(re.hr_scale=1.5),null!=data&&null!==(T=data.meta)&&void 0!==T&&null!==(T=T.ad_units)&&void 0!==T&&T.length||(re.ad_model="",re.characterRepairZoom=!!re.ad_model,re.ad_units={lora:{},ad_denoising_strength:.3,ad_confidence:.3,prompt:"",negative_prompt:""}),re.steps<=0&&(re.steps=[5,"5"].includes(re.category)?30:20),re.imgFiles=[],re.tabIndex=t.creativeMode,re.generate=(null==j||null===(w=j.meta)||void 0===w?void 0:w.generate)||(null===(x=t.config[Y])||void 0===x?void 0:x.generate),"generateVideo"===Y&&(re=Object.assign(re,t.initVideoParams(re,j)||{}));try{re.generate.gen_mode=t.config[Y].generate.gen_mode||0,t.isLoggedIn||(re.generate.gen_mode=0),re.generate.prompt_magic_mode=[null,void 0,null].includes(null===(Ge=t.config[Y])||void 0===Ge||null===(Ge=Ge.generate)||void 0===Ge?void 0:Ge.prompt_magic_mode)?2:null===(He=t.config[Y])||void 0===He?void 0:He.generate.prompt_magic_mode}catch(e){}if((null===(S=(null===et.L||void 0===et.L?void 0:et.L.flux)||[])||void 0===S?void 0:S.includes(null===(I=re)||void 0===I?void 0:I.base_model_type))&&(re.enableNegativePrompts=!1,re.negative_prompt=""),null!==(O=re)&&void 0!==O&&O.base_model_type.includes("SD 3.5")&&(re.steps=null===(Je=j.meta)||void 0===Je?void 0:Je.steps,re.width=null===(We=j.meta)||void 0===We?void 0:We.width,re.height=null===(Ke=j.meta)||void 0===Ke?void 0:Ke.height),re.n_iter=t.config[Y].n_iter,null!=t&&t.isVideoModel&&""===Object(_t.checkVideoModelType)(null===(k=re)||void 0===k?void 0:k.base_model_type)&&1===re.n_iter&&(re.n_iter=2),(null===(M=re)||void 0===M?void 0:M.base_model_type)===t.config[Y].base_model_type){n.next=75;break}return n.next=73,null==t?void 0:t.getModelDefaultConfig(null===(Xe=re)||void 0===Xe?void 0:Xe.base_model_type);case 73:qe=n.sent,re=Object.assign(qe||{},re);case 75:null!==et.L&&void 0!==et.L&&null!==(P=et.L.HiDream)&&void 0!==P&&P.includes(null===(L=re)||void 0===L?void 0:L.base_model_type)&&!t.checkHiDreamModelSize(re.width,re.height)&&(re.width=832,re.height=1248),t.config[Y]=re,t.config[Y].loading=!1,t.$set(t.config,Y,t.config[Y]);case 79:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).finally((function(){t.config[t.currentTab].loading=!1,Object.keys(t.config).forEach((function(e){t.$set(t.config,e,Object.assign({},t.config[e],{loading:!1}))}))}))},checkHiDreamModelSize:function(e,t){return IMAGE_SIZE_OPTIONS_MORE.filter((function(e){return Object.keys(e).includes("HiDream")&&5!==e.code})).some((function(n){var o,r;return(null===(o=n.HiDream)||void 0===o||null===(o=o.standard)||void 0===o?void 0:o.width)===e&&(null===(r=n.HiDream)||void 0===r||null===(r=r.standard)||void 0===r?void 0:r.height)===t}))},handleParams:function(e,t){var n=this.accountSettingsData.is_off_localization,o=["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res","inpaint_full_res_padding"];"imageToImage"===this.menuIndex&&(o=e.meta.mask?o.slice(1):o);var r,l=e.local_prompt,d=e.parent_task_id,c=e.operate_number,v=e.meta,m=v.prompt,h=(v.sampler_name,e.action),f=e.channel,_=e.art_model,y=(e.banner,e.task,_||{}),C=y.name,T=y.id,w=y.agency_fee,x=void 0===w?0:w,S=y.is_agency_fee,I=void 0!==S&&S;if("textToImage"===this.menuIndex){var O=Object(tt.handleCategory)(f);localStorage.setItem("defaultCategory",O),e.meta.category=O}T&&(e.meta.art_model_no=T,e.meta.modelName=C,e.meta.agency_fee=x||0,e.meta.is_agency_fee=I||!1,e.meta.model_cover=(null==_||null===(r=_.banner)||void 0===r?void 0:r.url)||"",e.meta.art_model_ver_no_name=(null==_?void 0:_.version_name)||"",e.meta.base_model_type=(null==_?void 0:_.base_model)||"",e.meta.modelTags=this.getStudioModelTags(_));return _&&_.id==e.id&&(_.model_ver_no=e.model_ver_no),e.meta.local_prompt=l,e.meta=Ri(Ri({},e.meta),{},{action:h}),n||(e.meta.prompt=l,e.meta.local_prompt=m),d&&(e.meta.parent_task_id=d),c&&(e.meta.operate_number=c),Object.keys(e.meta).forEach((function(t){o.includes(t)&&delete e.meta[t]})),e},getStudioModelTags:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Array.isArray(null==source?void 0:source.tags)?null==source?void 0:source.tags:[]},setSeed:function(){var meta=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(Vt.cloneDeep)(meta),t=this.config[this.currentTab].seed;return e.seedTemp=e.seed||"",e.seed=t,e},getModelDefaultConfig:function(){var e=arguments,t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.length>0&&void 0!==e[0]?e[0]:"",l=(null==t?void 0:t.modelDefaultConfigParams)||{},null!==(o=Object.keys(l))&&void 0!==o&&o.length){n.next=5;break}return n.next=5,t.$store.dispatch("creation/getV2TaskOptionsInfo");case 5:return d=(null==t?void 0:t.modelDefaultConfigParams[r])||{},c=Object.assign({},d),n.abrupt("return",c||{});case 8:case"end":return n.stop()}}),n)})))()},handleMeta:function(data,e){var t=arguments,n=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var r,l,d,c,v,m,h,f,meta,_,y,C,T,w,x,S,I,O,k,M,P,L,j;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return v=t.length>2&&void 0!==t[2]?t[2]:"",o.next=3,n.getImageNums();case 3:return m=o.sent,h=v||e,f=n.handleParams(data,h),meta=f.meta,_=f.art_work_no,y=f.art_model,C=f.base_model_name,T=void 0===C?"":C,[3,"3"].includes(null==data?void 0:data.action)&&(meta=n.handleVariationsMeta(data,meta)),meta.lcm_mode=null!==(r=meta)&&void 0!==r&&r.lcm_mode?1:0,(meta=n.setSeed(meta,data)).lora_models=n.changeLora(meta.lora_models),w=Array.isArray(null==data||null===(l=data.meta)||void 0===l?void 0:l.embeddings)?null==data||null===(d=data.meta)||void 0===d?void 0:d.embeddings:[],meta.embeddings=(w||[]).map((function(e){return Ri(Ri({},e),(null==e?void 0:e.art_model)||{})})),x={},e?(S=n.config[e],I=S.width,O=S.height,k=S.seed,M=S.prompt,P=S.left_margin,L=S.up_margin,meta=Ri({width:I,height:O,seed:k,prompt:M,left_margin:P,up_margin:L},meta)):x=n.getOtherParams(data),(null==(j=Ri(Ri(Ri(Ri({},n.config[e||n.menuIndex]),{},{art_work_no:_,art_model_ver_no:y?y.model_ver_no:"",denoising_strength:.35},meta),x),{},{isTranslate:!0,n_iter:m,isRead:x.imageUrl&&x.imageUrl[0],category:Object(tt.handleCategory)((null==data?void 0:data.category)||(null==data||null===(c=data.meta)||void 0===c?void 0:c.category)||1),base_model_type:T}))?void 0:j.prompt)!==(null==j?void 0:j.local_prompt)&&null!=j&&j.prompt&&null!=j&&j.local_prompt||(j.isTranslate=!1),o.abrupt("return",j);case 17:case"end":return o.stop()}}),o)})))()},getOtherParams:function(data){var e=data||{},t=e.meta,n=t.controlnet_units,o=void 0===n?[]:n,image=t.image,r=e.operate_number,l={workIndex:0};if(["imageToImage","conditionToImage","animGen"].includes(this.menuIndex)){var d,c=(null==data?void 0:data.category)||(null==data||null===(d=data.meta)||void 0===d?void 0:d.category)||1;l={imageUrl:this.getImageUrl(data),controlnet_units:r?[]:this.getControlNetParams(o,c)}}else"expansion"===this.menuIndex&&(l={imageUrl:[image],isDrag:!1});return l},changeLora:function(e){return e?e.map((function(e){var t=e.art_model,n=e.model_ver_no;return Ri(Ri(Ri({},e),t),{},{model_ver_no:n})})):[]},handleVariationsMeta:function(data,meta){try{var e,t=data.img_uris,n=(meta||{}).init_images,o=null==data||null===(e=data.banner)||void 0===e?void 0:e.url;meta.init_images=t.length?n||[]:o?[o]:[]}catch(e){}return meta},resetStudioParams:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r,l,d,c,v,m,h,f,_,y,C,T;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=["textToImage","imageToImage","conditionToImage"],o={negative_prompt:"",cfg_scale:6,steps:30,category:1,sampler_name:"Euler",denoising_strength:.5,base_model_type:"",modelTags:[],embeddings:[],lab_base:{conds:[],style_selections:["Studio Enhance","Studio Expand"],expand_token_length:10,hdr_enabled:!0,hdr_intensity:.5,auto_brightness_open:!0,auto_brightness_strength:75,auto_adjust_open:!1,auto_adjust_strength:20,semantics_open:!1,film_turbo:0,sharpness:2,scheduler:"karras",custom_height_width:!1,quality_open:!1,quality_detail_offset:.45,quality_mode:1,quality_type:"anime",intelligence_open:!1,prompt_magic:!0},studio:{style:"classic",width:1152,height:896}},t.prev=2,m=["imageToImage","conditionToImage"],h=(e.lab_base_model||[]).filter((function(t){var n=null==t?void 0:t.base_model.includes("SD 3.5");return m.includes(e.menuIndex)?!n:t})),h[0],f=null===(r=e.getDefaultModel({}))||void 0===r?void 0:r.art_model,o.art_model_no=f.id,o.modelName=f.name,o.art_work_no="",o.lora_models=[],o.model_cover=(null===(l=f)||void 0===l?void 0:l.cover)||"",o.is_agency_fee=!1,o.agency_fee=0,o.art_model_ver_no_name=(null===(d=f)||void 0===d?void 0:d.model_ver_name)||"",o.art_model_ver_no=(null===(c=f)||void 0===c?void 0:c.model_ver_no)||"",o.base_model_type=(null===(v=f)||void 0===v?void 0:v.base_model)||"",o.modelTags=e.getStudioModelTags(f),_=e.isCommunityFlux,y=e.getStudioDefaultStyle(o.base_model_type,_),o.studio.width=y.width,o.studio.height=y.height,((null===et.L||void 0===et.L?void 0:et.L.flux)||[]).includes(null==o?void 0:o.base_model_type)&&(o.sampler_name="Euler",o.cfg_scale=3.5,o.steps=25),t.next=25,e.getModelDefaultConfig(o.base_model_type);case 25:C=t.sent,Object.assign(o,C||{}),t.next=31;break;case 29:t.prev=29,t.t0=t.catch(2);case 31:n.includes(e.menuIndex)&&(T=Object.assign(e.config[e.currentTab],o),"conditionToImage"===e.menuIndex&&(T.lab_base.conds=(T.controlnet_units||[]).map((function(t){return e.$set(t,"type","canny"),{image:"",mode:"PyraCanny",stop_at:.5,weight:1}}))),e.$set(e.config,e.menuIndex,T));case 32:case"end":return t.stop()}}),t,null,[[2,29]])})))()},checkIsStudioMode:function(){return["7","11",7,11,"studio"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")},getMapMenuIndex:function(e){var t=[{code:1,value:"textToImage"},{code:7,value:"imageToImage"},{code:8,value:"conditionToImage"},{code:24,value:"animGen"}].find((function(t){return t.code===e}));return t?t.value:"textToImage"},getVideoExtensionAndOpenModal:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e,t=(null==data||null===(e=data.meta)||void 0===e||null===(e=e.generate_video)||void 0===e?void 0:e.init_extend_video_cover_url)||"";console.log("处理同款参数并且打开视频延长",data,t)}catch(e){}},checkCurrentTab:function(){var e,data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(null==data?void 0:data.task_domain_type)||(null==data||null===(e=data.task)||void 0===e?void 0:e.task_domain_type),n=(null==data?void 0:data.base_model_name)||"",o="",r=Object(_t.checkIsVideoModel)(n);return(this.tabs||[]).forEach((function(e){((null==e?void 0:e.taskDomainTypes)||[]).includes(t)&&(o=null==e?void 0:e.id)})),r&&(o="generateVideo"),o||"generateImage"},getModelParams:function(e){var t,n,o,r,l=this.config[this.currentTab].category,d=[5,"5","sdxl"].includes(l),c=(this.checkIsStudioMode(l),e.art_work_no),v=(e.model_ver_no,e.type),m=e.banner,h=e.action,f=e.name,_=e.id,y=e.samples,C=["LORA","Checkpoint"].includes(v)&&(!(null!=y&&y.length)||""===(null==m?void 0:m.url)),T=d?this.sd_xl_base_model[0]:this.taskBaseModels[0],w=(Object(ki.o)(),{art_work_no:c,art_model_no:(T=null===(t=this.getDefaultModel({}))||void 0===t?void 0:t.art_model).id,modelName:T.name,agency_fee:0,is_agency_fee:!1,model_cover:T.cover||"",art_model_ver_no_name:(null===(n=T)||void 0===n?void 0:n.model_ver_name)||"",art_model_ver_no:(null===(o=T)||void 0===o?void 0:o.model_ver_no)||"",base_model_type:(null===(r=T)||void 0===r?void 0:r.base_model)||"",modelTags:this.getStudioModelTags(T)});return C&&("LORA"===v&&(w=this.getLoraParams(w,e)),"Checkpoint"===v&&(w.art_model_no=_,w.modelName=f)),6!==h&&(w.art_work_no=""),C&&(w.category=1),w},getLoraParams:function(e,t){var n,o=t.id,r=t.name,l=t.origin_model,d=t.agency_fee,c=t.is_agency_fee,v=t.base_model,m=t.cover;l&&(e.art_model_no=null==l?void 0:l.model_no,e.modelName=null==l?void 0:l.name,e.model_cover=(null==l||null===(n=l.banner)||void 0===n?void 0:n.url)||"",e.art_model_ver_no_name=(null==l?void 0:l.version_name)||"",e.base_model_type=(null==l?void 0:l.base_model)||"");return e.lora_models=[{id:o,name:r,banner:{url:m||""},weight:1,model_id:o,agency_fee:d,is_agency_fee:c,base_model:v||""}],e},getFluxDefaultConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={},n=this.getCacheConfig()||{};return((null===et.L||void 0===et.L?void 0:et.L.flux)||[]).includes(e)&&!n&&(t=Object.assign(t,_t.FLUX_DEFAULT_CONFIG)),t},setModelVersion:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=Object(Vt.cloneDeep)(source);try{"LORA"===e.type&&(t.lora_models[0].model_ver_no=e.model_ver_no),"Checkpoint"===e.type&&(t.art_model_ver_no=e.model_ver_no)}catch(e){}return t},setDefaultMeta:function(e,t){var n,o=this;this.switchTab("generateImage");var r=e.action;e.art_work_no,e.imageUrl;r=r<1?1:r;Object(ki.o)();var l=this.defaultModel;if(null!=l&&l.id){var d=this.getModelParams(e);if(d=this.setModelVersion(d,e),!t){delete this.config[this.currentTab].channel;var c=this.getFluxDefaultConfig(null===(n=d)||void 0===n?void 0:n.base_model_type);this.config[this.currentTab]=Ri(Ri(Ri(Ri({},this.config[this.currentTab]),e),{},{action:r},d),c),this.$set(this.config,this.currentTab,this.config[this.currentTab])}}else setTimeout((function(){o.setDefaultMeta(e,t)}),2e3)},updateCategoryInfo:function(e){var t=e.obj,n=e.type;if((null!==t||null!==n)&&"aiApp"===n){this.categoryInfo=null!=t&&t.id?t:this.categoryInfo;var o=Object(Vt.cloneDeep)(this.categoryInfo),r=Ri(Ri({},this.config.app),{},{categoryInfo:o});this.$set(this.config,"app",r)}},handleSimpleTextToImage:function(){var e=arguments,t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c,v,m,h,f,_,y,C;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(c=e.length>0&&void 0!==e[0]?e[0]:{})&&c.data){n.next=3;break}return n.abrupt("return");case 3:if(v=(null==c?void 0:c.data)||{},m=v.art_model_no,h=v.art_model_ver_no,f=(null==c||null===(o=c.data)||void 0===o?void 0:o.meta)||{},_=f.negative_prompt,y=f.prompt,(C={model_no:m,model_ver_no:h,channel_id:"",speed_type:null==t||null===(r=t.config)||void 0===r?void 0:r[t.currentTab].speed_type,meta:{cfg_scale:7,steps:20,lcm_mode:0,sampler_name:"DPM++ 2M Karras",width:683,height:1024,prompt:y||GENERATE_PROMPT.prompt,negative_prompt:_||GENERATE_PROMPT.negative_prompt,imageSize:2,n_iter:1,clip_skip:2,restore_faces:!1,prompt_magic:!0,vae:"vae-ft-mse-840000-ema-pruned",lora_models:[]}}).meta=Object.assign(C.meta,(null==c||null===(l=c.data)||void 0===l?void 0:l.meta)||{}),C.meta.generate=null==t||null===(d=t.config)||void 0===d?void 0:d[t.currentTab].generate,t.isLoggedIn){n.next=16;break}return C.g_mode=1,n.next=12,t.checkNeedGoogleCaptcha();case 12:if(1!==t.needGoogleCaptcha){n.next=16;break}return n.next=15,t.updateCaptcha("ttc_v2");case 15:C.g_recaptcha_token=t.captchaToken||"";case 16:Object(Qe.easyTextToImage)(C).then((function(e){var n,o;if([2e4,20001,20002,20003,20004,20301].includes(null==e||null===(n=e.status)||void 0===n?void 0:n.code))return t.$EventBus.$emit("openLoginDialog",{dot:!1}),void t.$logEvent("log_actions",{operation:"register_popup",behavior_info:"on_new_createflow_page"});if(!e||1e4===(null==e||null===(o=e.status)||void 0===o?void 0:o.code)){t.$message.success(t.$t("CreateSuccess"));var r=Object.assign({},C,(null==e?void 0:e.data)||{});r.banner=null,r.img_uris=[],r.status=1,t.updateTask(r)}})).catch((function(e){})).finally((function(){}));case 17:case"end":return n.stop()}}),n)})))()},getCacheConfig:function(){var e=null;try{e=localStorage.getItem("generatorConfig")||null,e=JSON.parse(e)||null}catch(e){}return e||{}},getDefaultInter:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r,l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Qe.easyGetDefaultParams)();case 2:if(1e4!==(null==(o=t.sent)||null===(n=o.status)||void 0===n?void 0:n.code)){t.next=8;break}return e.config[e.currentTab].n_iter=(null==o||null===(r=o.data)||void 0===r?void 0:r.dft_img_gen_num)||2,e.defaultInter=(null==o||null===(l=o.data)||void 0===l?void 0:l.dft_img_gen_num)||2,e.$store.commit("creation/SET_GENERATE_TASK_OPTIONS",null==o?void 0:o.data),t.abrupt("return",(null==o||null===(d=o.data)||void 0===d?void 0:d.dft_img_gen_num)||2);case 8:case"end":return t.stop()}}),t)})))()},getImageNums:function(){var e=localStorage.getItem("imageNums")||this.defaultInter;return["1","2","3","4",1,2,3,4].includes(e)?Number(e):2},getData:function(e){var t=e||{};t.data,t.source,t.subSource},initDebounce:function(){this.debounceGenerate=Object(Vt.debounce)(this.handleGenerate,500),this.throttledClick=Object(Vt.throttle)(this.getCalcCost,2e3)},getCurrentModelType:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].concat(Object(o.a)(et.L.sdxl)),r=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].concat(Object(o.a)(et.L.other)),l=null===et.L||void 0===et.L?void 0:et.L.sd35,d=null===et.L||void 0===et.L?void 0:et.L.flux,c=n.includes(t)||(t||"").includes("SDXL"),v=r.includes(t),m=["SD 3"].includes(t),h=d.includes(t),f=l.includes(t)||(t||"").includes("SD 3.5");return c?"SDXL":v||m?"SD":h?"FLUX":f?"SD 3.5":null!==et.L&&void 0!==et.L&&null!==(e=et.L.HiDream)&&void 0!==e&&e.includes(t)?"HiDream":Object(_t.checkVideoModelType)(t)},adjustControlNetWeight:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var n;((null===(n=this.config)||void 0===n||null===(n=n[this.currentTab])||void 0===n?void 0:n.controlnet_units)||[]).forEach((function(n){e.$set(n,"weight",t?.75:1)}))}catch(e){}},getPresetModel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=Ri({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});return Object(Qe.easyGetDefaultPresetModel)(n).then((function(n){var o=n||{},r=o.status.code,code=void 0===r?"":r;o.data;if([1e4,"10000"].includes(code)){var l,d,c=(null==n||null===(l=n.data)||void 0===l||null===(l=l.default_model)||void 0===l?void 0:l.art_model)||{};e.defaultModel=null!=c&&c.id?c:null;var v=(null==n||null===(d=n.data)||void 0===d||null===(d=d.default_video_model)||void 0===d?void 0:d.art_model)||{};e.defaultVideoModel=null!=v&&v.id?v:null,t&&(e.config[e.currentTab].prompt=(null==c?void 0:c.positive_prompt)||"")}})).finally((function(){}))},resetConfig:function(){var e=arguments,t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c,v,i,m,h,f,_,y,C,T,w,x,S,I;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.length>0&&void 0!==e[0]&&e[0],r=e.length>1&&void 0!==e[1]&&e[1],l=e.length>2&&void 0!==e[2]?e[2]:"",d=t.getCacheConfig()||{},c=JSON.parse(JSON.stringify(t.config)),n.next=7,t.getImageNums();case 7:v=n.sent,n.t0=regeneratorRuntime.keys(t.config);case 9:if((n.t1=n.t0()).done){n.next=36;break}if(i=n.t1.value,m=Ri(Ri({},Object(Ii.a)(i)),{},{n_iter:v}),!o){n.next=31;break}if(n.prev=13,(m=Object.assign({},m,d[i]||{})).category=1,m.generateing=!1,m.speed_type=null===(h=t.config[i])||void 0===h?void 0:h.speed_type,m.keepDenoisingStrength=!1,m.logEventSource=0,y=!(null!==(f=m)&&void 0!==f&&f.art_model_no)&&["generateImage","generateVideo"].includes(i),C=!(null!==(_=m)&&void 0!==_&&null!==(_=_.categoryInfo)&&void 0!==_&&_.id)&&["app"].includes(i),!y&&!C){n.next=27;break}return n.next=25,t.initDefaultModelOrAppConfig(i);case 25:T=n.sent,m=Object.assign(m,T||{});case 27:n.next=31;break;case 29:n.prev=29,n.t2=n.catch(13);case 31:try{r&&(m.prompt=(null===(w=c[i])||void 0===w?void 0:w.prompt)||"",m.local_prompt=(null===(x=c[i])||void 0===x?void 0:x.local_prompt)||"")}catch(e){}r||t.$set(t.config,i,m),r&&l&&t.$set(t.config,l,m),n.next=9;break;case 36:if(!r){n.next=42;break}return n.next=39,t.initDefaultModelOrAppConfig(l);case 39:S=n.sent,I=Ri(Ri({},t.config[l]),S),t.$set(t.config,l,I);case 42:case"end":return n.stop()}}),n,null,[[13,29]])})))()},initDefaultModelOrAppConfig:function(){var e=arguments,t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=e.length>0&&void 0!==e[0]?e[0]:"",l={},n.t0=r,n.next="generateImage"===n.t0?5:"generateVideo"===n.t0?7:"app"===n.t0?9:15;break;case 5:return l=t.initDefaultModelInfo("generateImage"),n.abrupt("break",16);case 7:return l=t.initDefaultModelInfo("generateVideo"),n.abrupt("break",16);case 9:if(null===(o=t.config.app)||void 0===o||null===(o=o.categoryInfo)||void 0===o||!o.id){n.next=11;break}return n.abrupt("return");case 11:return n.next=13,t.initDefaultAppInfo("app");case 13:return l=n.sent,n.abrupt("break",16);case 15:return n.abrupt("break",16);case 16:return n.abrupt("return",l);case 17:case"end":return n.stop()}}),n)})))()},switchTab:function(e){this.currentTab=e;var t={generateVideo:"click_video_generate",generateImage:"click_image_generate",app:"click_ai_generate"};t[e]&&this.$logEvent("log_actions",{operation:"".concat(t[e]," "),behavior_info:"on_createflow_page"})},updateConfig:function(e){return this.updateMultipleConfigValues(this.currentTab,e)},getStaticConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(null==this?void 0:this.modelDefaultConfigParams[e])||{};return Object.assign({},t)||{}},initDefaultModelInfo:function(){var e,t,n,o,r,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c={},v={};if(!l||!["generateImage","generateVideo"].includes(l))return c;if("generateImage"===l?v=this.defaultModel||{}:"generateVideo"===l&&(v=this.defaultVideoModel||{}),v=JSON.parse(JSON.stringify(v)),c.art_model_no=(null===(e=v)||void 0===e?void 0:e.id)||"",c.modelName=v.name||"",c.model_cover=(null===(t=v)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.url)||"",c.art_model_ver_no_name=(null===(n=v)||void 0===n?void 0:n.version_name)||"",c.art_model_ver_no=(null===(o=v)||void 0===o?void 0:o.model_ver_no)||"",c.base_model_type=(null===(r=v)||void 0===r?void 0:r.base_model)||"",c.modelTags=[],"generateVideo"===l){var m,h=this.initVideoModelDefaultParams(null===(m=c)||void 0===m?void 0:m.base_model_type);c=Object.assign(c,h)}var f=this.getStaticConfig(c.base_model_type);return c=Object.assign(c,f||{}),d&&this.$set(this.config,l,Object.assign(this.config[l],c)),c},initDefaultAppInfo:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.default_ai_app||"",o={template_id:n},l={},t.next=6,Object(yt.e)(o).then(function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var o,r,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.data,l={banner:{url:(null==(data=void 0===r?{}:r)||null===(o=data.samples)||void 0===o||null===(o=o[0])||void 0===o?void 0:o.url)||""},id:n,name:(null==data?void 0:data.name)||""};case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){}));case 6:return t.abrupt("return",{categoryInfo:l});case 7:case"end":return t.stop()}}),t)})))()},saveConfig:function(){localStorage.setItem("generatorConfig",JSON.stringify(this.config))},addConfigKey:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.config[e]?this.config[e].hasOwnProperty(t)?(console.warn("配置项 ".concat(t," 已存在于 ").concat(e," 标签页中")),!1):(this.$set(this.config[e],t,n),!0):(console.error("标签页 ".concat(e," 不存在")),!1)},updateConfigValue:function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.config[e])return console.error("标签页 ".concat(e," 不存在")),!1;if(!this.config[e].hasOwnProperty(t))return console.warn("配置项 ".concat(t," 不存在于 ").concat(e," 标签页中")),!1;if(!o||"object"!==Object(ut.a)(n)||null===n||Array.isArray(n)||"object"!==Object(ut.a)(this.config[e][t])||null===this.config[e][t]||Array.isArray(this.config[e][t]))this.$set(this.config[e],t,n);else{var r=this.deepMergeObjects(this.config[e][t],n);this.$set(this.config[e],t,r)}return!0},updateNestedConfigValue:function(e,t,n,o){return this.config[e]?this.config[e].hasOwnProperty(t)?"object"!==Object(ut.a)(this.config[e][t])||null===this.config[e][t]?(console.error("配置项 ".concat(t," 不是对象类型")),!1):(this.$set(this.config[e][t],n,o),!0):(console.warn("配置项 ".concat(t," 不存在于 ").concat(e," 标签页中")),!1):(console.error("标签页 ".concat(e," 不存在")),!1)},updateMultipleConfigValues:function(e,t){var n=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.config[e]?(Object.entries(t).forEach((function(t){var r=Object(d.a)(t,2),l=r[0],c=r[1];n.config[e].hasOwnProperty(l)?n.updateConfigValue(e,l,c,o):(console.warn("配置项 ".concat(l," 不存在于 ").concat(e," 标签页中，将被添加")),n.$set(n.config[e],l,c))})),!0):(console.error("标签页 ".concat(e," 不存在")),!1)},deepMergeObjects:function(e,source){var t=this,n=Ri({},e);return Object.keys(source).forEach((function(o){"object"!==Object(ut.a)(source[o])||null===source[o]||Array.isArray(source[o])||"object"!==Object(ut.a)(e[o])||null===e[o]||Array.isArray(e[o])?n[o]=source[o]:n[o]=t.deepMergeObjects(e[o],source[o])})),n},handleGenerate:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r,l,d,c,v,m,h,f,_,y,C,T,w,x;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn||!e.isVideoModel){t.next=3;break}return e.$EventBus.$emit("openLoginDialog"),t.abrupt("return");case 3:if(!(d=(null===(n=e.config)||void 0===n?void 0:n[e.currentTab])||{}).generateing){t.next=6;break}return t.abrupt("return");case 6:if(c=function(){var t,n;if((null==d||null===(t=d.imageToVideoList)||void 0===t?void 0:t.length)>0&&null!=d&&null!==(n=d.imageToVideoList[0])&&void 0!==n&&n.lastFrame)try{var o,r,l=JSON.parse(JSON.stringify(d));l.imageToVideoList[0].lastFrame="",l.imageToVideoList[0].url="",null!=d&&null!==(o=d.imageToVideoList[0])&&void 0!==o&&o.firstFrame||(l.imageToVideoList=[]),e.updateConfig(l,e.menuIndex),null!=d&&null!==(r=d.imageToVideoList)&&void 0!==r&&r[0]&&(d.imageToVideoList[0].lastFrame="")}catch(e){console.error("清空尾帧失败",e)}},!(null!=e&&e.isKL10Model||null!=e&&e.isKL16Model)){t.next=17;break}if(null==e||!e.isStartAndEnd||"img2video"!==(null==d?void 0:d.currentVideoInputToolTab)){t.next=14;break}if(!((null==d||null===(v=d.imageToVideoList)||void 0===v?void 0:v.length)>0&&null!=d&&null!==(m=d.imageToVideoList[0])&&void 0!==m&&m.lastFrame)||null!=d&&null!==(h=d.imageToVideoList[0])&&void 0!==h&&h.firstFrame){t.next=12;break}return e.$message.warning(e.$t("kl10_model_not_support_only_last_frame")),t.abrupt("return");case 12:t.next=15;break;case 14:c();case 15:t.next=18;break;case 17:null!=e&&e.isKL15Model&&null!=e&&e.isStartAndEnd||c();case 18:if(console.log("config?.imageToVideoList?.length",null==d?void 0:d.imageToVideoList),!((null===et.L||void 0===et.L?void 0:et.L.sd3)||[]).includes(null==d?void 0:d.base_model_type)){t.next=22;break}return e.$message.warning(e.$t("newGenerate52")),t.abrupt("return");case 22:if(!e.vipLimit(d)){t.next=24;break}return t.abrupt("return");case 24:if(!e.validParams(d)){t.next=27;break}return d.generateing=!1,t.abrupt("return");case 27:return d.generateing=!0,t.next=30,e.getParams();case 30:if(f=t.sent,_=e.isVideoModel,y=e.getGenerateType(),C=e.getParamsByType(f,y),_&&(C=e.extractVideoParams(f),w=(null===(T=C)||void 0===T||null===(T=T.meta)||void 0===T||null===(T=T.generate_video)||void 0===T?void 0:T.image_opts)||[],y=null!=w&&w.length?"imageToVideo":"textToVideo"),!_||"imageToVideo"!==y||null!==(o=C)&&void 0!==o&&null!==(o=o.meta)&&void 0!==o&&null!==(o=o.generate_video)&&void 0!==o&&null!==(o=o.image_opts)&&void 0!==o&&o.length){t.next=38;break}return e.$message.warning(e.$t("pleaseSelectImage")),t.abrupt("return");case 38:if(!_||"imageToVideo"!==y||null===(r=C)||void 0===r||!r.template_id||(!(null!==(l=C)&&void 0!==l&&null!==(l=l.meta)&&void 0!==l&&null!==(l=l.generate_video)&&void 0!==l&&l.image_opts)||[]).every((function(e){return null==e?void 0:e.url}))){t.next=41;break}return e.$message.warning(e.$t("pleaseSelectImage")),t.abrupt("return");case 41:if(e.checkStudioModelType(d,f)||_){t.next=45;break}return d.generateing=!1,e.$message.warning(e.$t("studio25")),t.abrupt("return");case 45:if(e.checkEmbeddingModelType(d,f)||_){t.next=49;break}return d.generateing=!1,e.$message.warning(e.$t("newGenerate63")),t.abrupt("return");case 49:_||(C.meta.generate=e.config[e.currentTab].generate),x=Qe.easyTextToImage,t.t0=y,t.next="textToImage"===t.t0?54:"imageToImage"===t.t0?56:"conditionToImage"===t.t0?58:"imageToVideo"===t.t0?60:"textToVideo"===t.t0?62:64;break;case 54:return x=Qe.easyTextToImage,t.abrupt("break",66);case 56:return x=Qe.easyImageToImage,t.abrupt("break",66);case 58:return x=Qe.easyControlNetToImage,t.abrupt("break",66);case 60:return x=Qe.easyImageToVideo,t.abrupt("break",66);case 62:return x=Qe.easyTextToVideo,t.abrupt("break",66);case 64:return x=Qe.easyTextToImage,t.abrupt("break",66);case 66:if(e.isLoggedIn||!["textToImage"].includes(y)){t.next=74;break}return C.g_mode=1,t.next=70,e.checkNeedGoogleCaptcha();case 70:if(1!==e.needGoogleCaptcha){t.next=74;break}return t.next=73,e.updateCaptcha("ttc_v2");case 73:C.g_recaptcha_token=e.captchaToken||"";case 74:C.source=40001,C.channel_id=e.localProjectId||"",x(C).then((function(t){var n,o;t.data;if(t&&1e4!==(null==t||null===(n=t.status)||void 0===n?void 0:n.code))e.config[e.currentTab].generateing=!1;else{e.$message.success(e.$t("CreateSuccess"));var r=Object.assign({},f,(null==t?void 0:t.data)||{});r.banner=null,r.img_uris=[],r.status=1,["imageToVideo","textToVideo"].includes(y)&&(r.task_domain_type="textToVideo"===y?11:12),["imageToVideo"].includes(y)&&null!==(o=C)&&void 0!==o&&o.template_id&&(r.task_domain_type=15),e.$emit("updateList",r),e.config[e.currentTab].generateing=!1}})).catch((function(t){e.config[e.currentTab].generateing=!1})).finally((function(){e.isImageToImageToTextToImage=!1,e.config[e.currentTab].generateing=!1}));case 77:case"end":return t.stop()}}),t)})))()},validParams:function(e){var t=e.prompt;e.art_work_no,e.art_model_no;return this.isOnlySupportImageToVideo?(this.$message.warning(this.$t("newGenerate111")),!0):!t&&!this.notNeedCheckPrompt&&("generateVideo"===this.currentTab&&"img2video"===this.config[this.currentTab].currentVideoInputToolTab?this.$message.warning(this.$t("pleaseSelectImage")):this.$message.warning(this.$t("PromptNotEmpty")))},checkNeedGoogleCaptcha:function(){var e=this;if(""!==this.needGoogleCaptcha||this.isLoggedIn)return Promise.resolve();return easyGetVisitorStatus({scene:4}).then((function(t){var n,o;1e4===(null==t||null===(n=t.status)||void 0===n?void 0:n.code)&&(e.needGoogleCaptcha=null==t||null===(o=t.data)||void 0===o?void 0:o.state)}))},checkStudioModelType:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{}).base_model_type,n=void 0===t?"":t,r=((null==e?void 0:e.meta)||{}).lora_models,l=void 0===r?[]:r,d=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].concat(Object(o.a)(et.L.sdxl)),c=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].concat(Object(o.a)(et.L.other)),v=["SD 3"],m=(null===et.L||void 0===et.L?void 0:et.L.sd35)||[],h=d.includes(n)||(n||"").includes("SDXL"),f=c.includes(n),_=v.includes(n),y=m.includes(n)||(n||"").includes("SD 3.5"),C=((null===et.L||void 0===et.L?void 0:et.L.flux)||[]).includes(n);return(l||[]).every((function(e){var t=d.includes(null==e?void 0:e.base_model),o=c.includes(null==e?void 0:e.base_model),r=v.includes(null==e?void 0:e.base_model),l=((null===et.L||void 0===et.L?void 0:et.L.flux)||[]).includes(null==e?void 0:e.base_model),T=m.includes(null==e?void 0:e.base_model)&&(null==e?void 0:e.base_model)===n;return!(y&&!T||h&&!t||f&&!o||_&&!r||C&&!l)}))},checkEmbeddingModelType:function(){var e,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{},r=n.base_model_type,l=void 0===r?"":r,d=n.embeddings,c=void 0===d?[]:d;if(null==t||null===(e=t.meta)||void 0===e||null===(e=e.embeddings)||void 0===e||!e.length)return!0;var v=["SDXL 1.0","SDXL 0.9","SDXL Turbo","SDXL 1.0 LCM","SDXL Lightning","Pony","SDXL Hyper"].concat(Object(o.a)(et.L.sdxl)),m=["SD 1.5","SD 2.0","SD 1.4","SD 2.1 768","SD 2.1","SD 2.0 768","SD 1.5 LCM"].concat(Object(o.a)(et.L.other)),h=["SD 3"],f=v.includes(l)||(l||"").includes("SDXL"),_=m.includes(l),y=h.includes(l),C=((null===et.L||void 0===et.L?void 0:et.L.flux)||[]).includes(l);return(c||[]).every((function(e){var t=v.includes(null==e?void 0:e.base_model),n=m.includes(null==e?void 0:e.base_model),o=h.includes(null==e?void 0:e.base_model),r=((null===et.L||void 0===et.L?void 0:et.L.flux)||[]).includes(null==e?void 0:e.base_model);return!(f&&!t||_&&!n||y&&!o||C&&!r)}))},getParamsByType:function(){var e,t,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=/^blob:/,l={model_no:null==source?void 0:source.art_model_no,model_ver_no:null==source?void 0:source.art_model_ver_no,channel_id:"",speed_type:null===(e=this.config)||void 0===e||null===(e=e[this.currentTab])||void 0===e?void 0:e.speed_type},d=null==this||null===(t=this.config)||void 0===t||null===(t=t[this.currentTab])||void 0===t||null===(t=t.controlnet_units)||void 0===t?void 0:t.length;if((this.isCommunityFlux&&!d||this.isSd35Model)&&"textToImage"===n){var c,v,m,h;if(l.meta={cfg_scale:source.meta.cfg_scale,width:source.meta.width,height:source.meta.height,n_iter:source.meta.n_iter,prompt:source.meta.prompt,seed:source.meta.seed,steps:source.meta.steps,sampler_name:"DPM++ 2M Karras",negative_prompt:"",lab_base:{conds:[]}},this.isCommunityFlux)l.meta.sampler_name=(null==source||null===(h=source.meta)||void 0===h?void 0:h.sampler_name)||"Euler";if(null!==(c=this.config[this.currentTab].imageToImageList)&&void 0!==c&&c.length){var f,_=this.config[this.currentTab].imageToImageList[0],y={image:null==_?void 0:_.url,stop_at:1,weight:null==_?void 0:_.denoising_strength,mode:"ImagePrompt",loading:!1};l.meta.lab_base={conds:[y]};var C=this.isCommunityFlux&&(null===(f=this.config)||void 0===f||null===(f=f[this.currentTab])||void 0===f||null===(f=f.ipList)||void 0===f?void 0:f.length);if(null!=_&&_.mask&&!C){["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res_padding"].forEach((function(e){l.meta[e]=source.meta[e]}))}}if((this.isCommunityFlux||this.isSd35Model)&&(l.meta.lora_models=source.meta.lora_models||[]),this.isCommunityFlux&&null!==(v=this.config)&&void 0!==v&&null!==(v=v[this.currentTab])&&void 0!==v&&null!==(v=v.ipList)&&void 0!==v&&v.length){var T,w,x,S,I=((null===(T=this.config)||void 0===T||null===(T=T[this.currentTab])||void 0===T?void 0:T.ipList)||[]).filter((function(e){return"IpMaintain"===e.mode&&e.image&&!r.test(e.image)&&(null==e?void 0:e.enable)})).map((function(e){return{image:null==e?void 0:e.image,mode:null==e?void 0:e.mode,stop_at:null==e?void 0:e.stop_at,weight:null==e?void 0:e.weight}}));if(null!==(w=l)&&void 0!==w&&null!==(w=w.meta)&&void 0!==w&&null!==(w=w.lora_models)&&void 0!==w&&w.length&&(I=(I||[]).filter((function(e){return"IpMaintain"!==e.mode})).map((function(e){return{image:null==e?void 0:e.image,mode:null==e?void 0:e.mode,stop_at:null==e?void 0:e.stop_at,weight:null==e?void 0:e.weight}}))),null!==(x=I)&&void 0!==x&&x.length)(S=l.meta.lab_base.conds).push.apply(S,Object(o.a)(I))}if(null!==(m=this.config[this.currentTab].styleReferenceList)&&void 0!==m&&m.length&&this.isCommunityFlux){var O,k,M,P,L=((null===(O=this.config)||void 0===O||null===(O=O[this.currentTab])||void 0===O?void 0:O.styleReferenceList)||[]).filter((function(e){return"StyleReference"===e.mode&&e.image&&!r.test(e.image)})).map((function(e){return{image:null==e?void 0:e.image,mode:null==e?void 0:e.mode,weight:null==e?void 0:e.weight}}));if(!(this.hasIpMaintain||null!==(k=this.config[this.currentTab].controlnet_units)&&void 0!==k&&k.length||null!==(M=this.config[this.currentTab].imageToImageList)&&void 0!==M&&M.length))(P=l.meta.lab_base.conds).push.apply(P,Object(o.a)(L))}}if(!this.isCommunityFlux&&"textToImage"===n&&!this.isImageToImageToTextToImage){var j,E,$={meta:{}},D=["prompt","negative_prompt","width","height","steps","cfg_scale","sampler_name","n_iter","lora_models","vae","clip_skip","seed","restore_faces","ad_units","embeddings"];if(""!==(null===(j=this.config)||void 0===j||null===(j=j[this.currentTab])||void 0===j?void 0:j.hr_upscaler))$.meta.hr_upscaler=null===(E=this.config)||void 0===E||null===(E=E[this.currentTab])||void 0===E?void 0:E.hr_upscaler,$.meta.hr_second_pass_steps=20,$.meta.denoising_strength=.5;if(this.isAnimeEnhanceEnable){var R=["vae","clip_skip","ad_units","embeddings"];D=D.filter((function(e){return!R.includes(e)}))}D.forEach((function(e){$.meta[e]=source.meta[e]})),this.isAnimeEnhanceEnable&&($.meta.sampler_name="DPM++ 2M Karras",$.meta.lab_base={scheduler:"karras"}),$.speed_type=l.speed_type,l=Object.assign(l,$)}return"imageToImage"===n&&(l=Object.assign(l,this.getImageToImagePostParams(source))),"conditionToImage"===n&&(l=Object.assign(l,this.getControlNetPostParams(source))),l},getImageToImagePostParams:function(source){var e,t,n,o={},r=["prompt","negative_prompt","width","height","steps","cfg_scale","sampler_name","n_iter","lora_models","vae","clip_skip","seed","controlnet_units","init_images","denoising_strength","embeddings","ad_units"];("SD"!==this.currentModelType&&(r=r.filter((function(e){return!["ad_units"].includes(e)}))),null!=source&&null!==(e=source.meta)&&void 0!==e&&null!==(e=e.controlnet_units)&&void 0!==e&&e.length||null==source||null===(t=source.meta)||void 0===t||!t.mask)||(n=r).push.apply(n,["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res_padding"]);return o.meta={},r.forEach((function(e){o.meta[e]=source.meta[e]})),o.speed_type=source.speed_type,o},getControlNetPostParams:function(source){var e={};return e.meta={},["prompt","negative_prompt","width","height","steps","cfg_scale","sampler_name","n_iter","lora_models","vae","clip_skip","seed","controlnet_units","embeddings"].forEach((function(t){e.meta[t]=source.meta[t]})),e.speed_type=source.speed_type,e},getParams:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r,l,d,c,v,m,h,f,_,y,C,meta;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.config[e.currentTab]||{},o={},r=n.art_work_no,l=n.art_model_no,d=n.parent_task_id,c=n.art_model_ver_no,v=n.action,m=n.operate_number,h=n.category,f=n.speed_type,_=n.animatediff,y=n.logEventSource,C=void 0===y?0:y,meta=e.getCommonMeta(n),t.next=6,e.getPrivateMeta(n,meta);case 6:return meta=t.sent,o={action:v,art_work_no:r,art_model_no:l,art_model_ver_no:c,parent_task_id:d,operate_number:m,channel_id:"",category:h,speed_type:f,meta:meta},C&&(o.source=C),"animGen"===e.menuIndex&&(o.meta.animatediff=_),"textToImage"!==e.menuIndex&&([3,"3","midjourney","sdxl",5,"5"].includes(n.channel)||[3,"3","midjourney","sdxl",5,"5"].includes(meta.channel))&&(([3,"3","midjourney"].includes(n.channel)||[3,"3","midjourney"].includes(meta.channel))&&(o.category=3),(["sdxl",5,"5"].includes(n.channel)||["sdxl",5,"5"].includes(meta.channel))&&(o.category=5),[3,"3","midjourney","sdxl",5,"5"].includes(meta.channel)&&delete o.meta.channel),8===n.action&&"descriptors"===e.menuIndex&&(Reflect.deleteProperty(o,"art_work_no"),Reflect.deleteProperty(o,"art_model_no"),Reflect.deleteProperty(o,"art_model_ver_no")),Object.keys(o).forEach((function(e){o[e]||Reflect.deleteProperty(o,e)})),t.abrupt("return",o);case 14:case"end":return t.stop()}}),t)})))()},getCommonMeta:function(e){var t,meta={},n=["prompt","negative_prompt","restore_faces","seed","sampler_name","width","height","steps","cfg_scale","lora_models","vae","clip_skip","hr_second_pass_steps","lcm_mode"];return["development"].includes("production")&&n.push("roop_arg"),n.push("n_iter"),n.forEach((function(t){meta[t]=e[t]})),["",null,void 0,0,"0"].includes(meta.seed)&&(meta.seed=-1),["-1",-1].includes(meta.seed)&&(meta.seed=Object(tt.getRandomSeed)(this.isCommunityFlux||this.isTongYiFast||this.isTongYiProfessional||this.isPixVerse)),["",null,void 0].includes(null==meta||null===(t=meta.roop_arg)||void 0===t?void 0:t.image)&&delete meta.roop_arg,["textToImage","imageToImage","animGen","conditionToImage"].includes(this.menuIndex)&&![5,"5"].includes(e.category)||delete meta.roop_arg,!["",null,void 0].includes(e.hr_upscaler)&&[1,"1"].includes(e.category)&&(e.enable_hr?(meta.enable_hr=!0,meta.hr_upscaler=e.hr_upscaler||"R-ESRGAN 4x+",meta.hr_scale=1.5):meta.enable_hr=!1),meta.width=(null==meta?void 0:meta.width)<=0?1024:meta.width,meta.height=(null==meta?void 0:meta.height)<=0?1024:meta.height,meta.lora_models=((null==e?void 0:e.lora_models)||[]).map((function(e){var t=e.model_id,n=e.weight,o=e.model_ver_no,r=e.base_model;return{model_id:t,weight:n,model_ver_no:o||"",base_model:void 0===r?"":r}})),meta},uploadMaskImage:function(mask){var e=mask.includes("data:image/png;base64")?mask:"data:image/png;base64,".concat(mask),t=Object(tt.dataURItoBlob)(e);return this.UPLOAD.startUpload(t,{name:"img2img-mask".concat(Date.now(),".png"),type:"png",isRedirection:!0,category:46})},getPrivateMeta:function(e,meta){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c,v,m,h,f,_,y,C,T,w,x,S,I,O,k,M,P,L,j,E,$,D;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.menuIndex,r=e.denoising_strength,l=e.imageUrl,d=e.controlnet_units,c=e.scaling_ratio,v=e.up_scaler,m=e.controlnet_processor_res,h=e.left_margin,f=e.up_margin,_=e.embeddings,y=e.meta,C=e.imageToImageList,meta.embeddings=(_||[]).map((function(e){return{model_id:null==e?void 0:e.id,model_ver_id:null==e?void 0:e.model_ver_no,weight:(null==e?void 0:e.weight)||1}})),null==C||!C.length){n.next=17;break}if(T=C[0],meta.denoising_strength=null==T?void 0:T.denoising_strength,meta.init_images=[T.url],!d.length){n.next=11;break}n.t0={},n.next=14;break;case 11:return n.next=13,t.getCanvasParams(e);case 13:n.t0=n.sent;case 14:w=n.t0,d.length&&(meta.controlnet_units=t.getControlnet_units(d)),meta=Object.assign({},meta,w);case 17:if(null!=C&&C.length||null==d||!d.length||(meta.controlnet_units=t.getControlnet_units(d)),!["imageToImage","animGen","characterRepair"].includes(o)){n.next=34;break}if(meta.denoising_strength=r,meta.init_images=l.slice(3),d.length&&(meta.controlnet_units=t.getControlnet_units(d,l)),x=e.imageToImageList[0]||{},S={},null==x||!x.enable){n.next=33;break}if(!d.length){n.next=29;break}n.t1={},n.next=32;break;case 29:return n.next=31,t.getCanvasParams(e);case 31:n.t1=n.sent;case 32:S=n.t1;case 33:meta=Object.assign({},meta,S);case 34:return["imageToImage","textToImage","animGen","characterRepair"].includes(o)&&(""!==e.ad_model&&(M=(null==e||null===(I=e.ad_units)||void 0===I?void 0:I.lora)||{},P=M.id,L=M.model_ver_no,j=M.weights,E={model_id:P,model_ver_no:L,weight:j},(null==($=Object(Vt.cloneDeep)(e.ad_units))?void 0:$.lora)&&delete $.lora,meta.ad_units=[Object.assign({ad_model:e.ad_model,lora_models:null!==(O=Object.keys((null==e||null===(k=e.ad_units)||void 0===k?void 0:k.lora)||{}))&&void 0!==O&&O.length?[E]:[]},$)]),3===e.action&&(e.enable_hr?(meta.enable_hr=!0,meta.hr_upscaler=e.hr_upscaler||"R-ESRGAN 4x+",meta.hr_scale=1.5):meta.enable_hr=!1)),"extraUpscale"===o&&(meta.hi_res_arg={upscaling_resize:c,upscaler_1:v,image:l[0]},meta.width=e.realWidth||e.width,meta.height=e.realHeight||e.height,meta=Ri(Ri({},y),meta)),"conditionToImage"===o&&(meta.controlnet_units=t.getControlnet_units(d)),"descriptors"===o&&(meta={img_2_text:{uri:e.imageUrl[0]}}),"preview"===o&&(meta={controlnet_input_images:l,controlnet_module:null===(D=d[0])||void 0===D?void 0:D.module,controlnet_processor_res:m}),"expansion"===o&&(meta=Ri(Ri({},meta),{},{left_margin:h,up_margin:f,image:l[0]})),n.abrupt("return",meta);case 41:case"end":return n.stop()}}),n)})))()},getCanvasParams:function(){var e=arguments,t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c,mask,v,m,h,pattern,f,_;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=(d=e.length>0&&void 0!==e[0]?e[0]:{}).imageToImageList[0]||{},mask=(null==c?void 0:c.mask)||"",v=(null==c?void 0:c.tempMask)||"",m=(null==c?void 0:c.compose_mask)||"",h={mask:mask,mask_blur:4,inpainting_fill:1,inpainting_mask_invert:0,inpaint_full_res_padding:32,compose_mask:m},pattern=/^(http|https):\/\//,["",null,void 0].includes(v)||["",null,void 0].includes(mask)||v!==mask){n.next=11;break}return h.mask=c.copyMask,((null===(f=t.config)||void 0===f||null===(f=f[t.currentTab])||void 0===f?void 0:f.imageToImageList)||[]).forEach((function(e){t.$set(e,"mask",c.copyMask)})),n.abrupt("return",h);case 11:if(["",null,void 0].includes(null===(o=d.imageToImageList[0])||void 0===o?void 0:o.mask)||"data:,"===(null===(r=d.imageToImageList[0])||void 0===r?void 0:r.mask)||pattern.test(null===(l=d.imageToImageList[0])||void 0===l?void 0:l.mask)){n.next=14;break}return n.next=14,t.uploadMaskImage(null===(_=d.imageToImageList[0])||void 0===_?void 0:_.mask).then((function(e){var n;((null===(n=t.config)||void 0===n||null===(n=n[t.currentTab])||void 0===n?void 0:n.imageToImageList)||[]).forEach((function(n){t.$set(n,"mask",e)})),h.mask=e}));case 14:return d.generateing=!1,n.abrupt("return",["",null,void 0].includes(h.mask)?{}:h);case 16:case"end":return n.stop()}}),n)})))()},getControlnet_units:function(e){var t=this;return(e||[]).filter((function(e){return null==e?void 0:e.enable})).map((function(e,n){var o=e.type,r=e.processor_res,l=e.threshold_a,d=e.control_mode,c=e.model,v=e.module,m=e.weight,h=e.isHandle,f=e.input_image,_=l,y=(t.taskControlNetModules||[]).find((function(e){return(null==e?void 0:e.type)===o}));return[0,"0"].includes(d)&&y&&null!=y&&y.has_style_fidelity||(_=null),{processor_res:h?r:0,input_image:f,threshold_a:_,model:c,module:h?v:"none",control_mode:Number(d),weight:m,guidance:1,guidance_end:1,type:o}}))},getCalcCost:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,o,r,l,d,c,v,m,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d=e.config[e.currentTab],null!==(n=e.config)&&void 0!==n&&null!==(n=n[e.currentTab])&&void 0!==n&&n.art_model_no){t.next=3;break}return t.abrupt("return");case 3:if(d.prompt||e.isVideoModel){t.next=6;break}return t.abrupt("return");case 6:if(null==e||!e.isVideoModel||null!=e&&null!==(o=e.currentSpecialEffectsTemplateInfo)&&void 0!==o&&o.id||"effect"!==e.activeVideoInputTab){t.next=11;break}return e.calcCost=0,e.discountOff=0,e.costInfo={},t.abrupt("return");case 11:return t.next=13,e.getParams();case 13:c=t.sent,v=e.getGenerateType(),m=e.getParamsByType(c,v),e.isVideoModel&&(m=e.extractVideoParams(c),v=null!=d&&null!==(h=d.imageToVideoList)&&void 0!==h&&h.length?"imageToVideo":"textToVideo"),e.isVideoModel&&"effect"===e.activeVideoInputTab&&null!==(r=m)&&void 0!==r&&r.template_id&&(m.task_domain_type=15),m.meta.generate=(null===(l=e.config)||void 0===l||null===(l=l[e.currentTab])||void 0===l?void 0:l.generate)||{},e.isPosting=!0,m.source=40001,m.channel_id=e.localProjectId||"",Object(Qe.easyEstimatedConsumption)(m).then((function(t){var n,o,r;t&&1e4!==(null==t||null===(n=t.status)||void 0===n?void 0:n.code)||(e.calcCost=(null==t||null===(o=t.data)||void 0===o?void 0:o.calculate_coins)||0,e.discountOff=(null==t||null===(r=t.data)||void 0===r?void 0:r.discount_off_rate)||0,e.costInfo=(null==t?void 0:t.data)||{})})).finally((function(){e.isPosting=!1}));case 23:case"end":return t.stop()}}),t)})))()},getGenerateType:function(){var e=JSON.parse(JSON.stringify(this.config[this.currentTab])),t=(e.imageToImageList||[]).filter((function(e){return null==e?void 0:e.enable})),n=(e.controlnet_units||[]).filter((function(e){return null==e?void 0:e.enable}));return this.isHiDreamModel?"textToImage":this.isCommunityFlux&&(null==n||!n.length)||!(null!=t&&t.length||null!=n&&n.length)||this.isAnimeEnhanceEnable||this.isSd35Model?(this.isImageToImageToTextToImage=this.isSd35Model,"textToImage"):null!=t&&t.length?"imageToImage":null!=n&&n.length?"conditionToImage":"textToImage"},vipLimit:function(e){return!this.isVip&&((null!=e&&null!==(t=e.lora_models)&&void 0!==t&&t.length?e.lora_models:[]).length>3&&(this.$EventBus.$emit("showBreakDialog","LoRALimit5TipWeb","basic"),!0));var t},updateSpeedType:function(e){for(var i in this.config)this.config[i]=Ri(Ri({},this.config[i]),{},{speed_type:e})},toggleSidebar:function(){this.isCollapsed=!this.isCollapsed,this.$emit("toggleSidebar",this.isCollapsed)},openEasyUpscaleToolsModal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$refs.upscaleToolsModal.show(e)},handleImageExtraUpscale:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign(t,{task_flow_version:"v2"});return Object(Ze.createTask)(n).then((function(t){var n,o={banner:null,img_uris:[],status:1};return(null===(n=o=Object.assign(o,(null==t?void 0:t.data)||{}))||void 0===n?void 0:n.id)&&e.updateTask(o),t})).catch((function(e){}))},updateTask:function(data){this.$emit("updateList",data)}}},Ai=Vi,Ni=(n(5480),n(5481),Object(_.a)(Ai,(function(){var e,t=this,n=t._self._c;return n("div",{staticClass:"c-generate-main"},[n("div",{staticClass:"collapse-button",on:{click:t.toggleSidebar}},[n("i",{staticClass:"el-icon-arrow-left",class:{rotated:!t.isCollapsed}})]),t._v(" "),n("div",{staticClass:"generate-tabs"},t._l(t.tabs,(function(e){return n("div",{key:e.id,staticClass:"tab-item",class:{active:t.currentTab===e.id},attrs:{"data-id":e.id},on:{click:function(n){return t.switchTab(e.id)}}},[t._v("\n      "+t._s(t.$t(e.name))+"\n      "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.currentTab===e.id,expression:"currentTab === tab.id"}],staticClass:"tab-indicator"})])})),0),t._v(" "),n("div",{staticClass:"generate-content video-editor-generate-content"},[t._l(Object.keys(t.config),(function(e){return[["app"].includes(e)?[t.currentTab===e?n("div",{key:e,staticStyle:{height:"100%"}},[n("common-params-panel",{attrs:{value:t.config[e],"menu-index":e,source:40001}})],1):t._e()]:[t.currentTab===e?n("params-panel",{key:e,attrs:{value:t.config[e],"menu-index":e}}):t._e()]]}))],2),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!["app"].includes(t.currentTab),expression:"!['app'].includes(currentTab)"}],staticClass:"generate-footer"},[n("el-button",{staticClass:"generate-btn",class:{"no-sale":!t.isShowDiscountOff},attrs:{loading:null===(e=t.config[t.currentTab])||void 0===e?void 0:e.generateing,"data-sale":t.getDiscountOffText},on:{click:function(e){return t.debounceGenerate()}}},[n("span",{staticClass:"txt"},[t._v(t._s(t.$t("Generate")))]),t._v(" "),t.calcCost>0?[n("span",{staticClass:"cost"},[n("Icon",{attrs:{name:"trail-fast-queue",size:"24"}}),t._v(" "),t.getDiscountOffBeforeNum?n("s",[t._v(t._s(t.getDiscountOffBeforeNum))]):t._e(),t._v("\n          "+t._s(t.calcCost)+"\n        ")],1)]:[n("el-tooltip",{attrs:{effect:"dark",content:t.$t("workFlow31"),placement:"top"},model:{value:t.isShowSale,callback:function(e){t.isShowSale=e},expression:"isShowSale"}},[n("i",{staticClass:"iconfont icon-a-icon-ContactUs",on:{click:function(e){e.stopPropagation(),t.isShowSale=!t.isShowSale}}})])]],2)],1),t._v(" "),n("CombinedSelectDialog",{attrs:{source:"videoEditor",subSource:t.currentTab},on:{getData:t.getData}}),t._v(" "),n("UpscaleToolsModal",{ref:"upscaleToolsModal"}),t._v(" "),n("SelectVideoModelModal",{ref:"selectVideoModelModal",on:{confirm:t.handleSelectVideoModel}})],1)}),[],!1,null,"21e5f2d6",null).exports);n(73);function zi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Fi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zi(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ui={name:"mirrorTag",props:{item:{type:Object,default:function(){}}},data:function(){return{}},computed:Fi(Fi({},Object(c.e)("videoEditor",["mirrorList"])),{},{localMirrorList:function(){return this.mirrorList},iList:function(){var e=this,t=[];return this.localMirrorList.forEach((function(n,i){n.material_id===e.item.material_id&&t.push(i+1)})),t}}),mounted:function(){},methods:{setMrrorTag:function(e){var t=this.iList.slice(0,3);return"".concat(this.$t("Storyboard")," ").concat(t.join(" ")).concat(this.iList.length>3?" ...":"")}}},Bi=(n(5482),n(5483),Object(_.a)(Ui,(function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{placement:"bottom-start",trigger:"hover","popper-class":"mirrorTag-popover",disabled:e.iList.length<=3}},[t("div",{staticClass:"popover-content"},e._l(e.iList,(function(i){return t("div",{key:i,staticClass:"mirrorTag tagList"},[t("span",[e._v(e._s("".concat(e.$t("Storyboard")," ").concat(i)))])])})),0),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.iList.length>0,expression:"iList.length > 0"}],staticClass:"mirrorTag",attrs:{slot:"reference"},slot:"reference"},[t("span",[e._v(e._s(e.setMrrorTag(e.item)))])])])}),[],!1,null,"37d6bbbc",null).exports);function Gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Hi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ji={components:{HyUploadMoald:ae.default,mirrorTag:Bi},mixins:[se.a],props:["leftCollapsed"],data:function(){return{saveImg:m.M,isCollapsed:!1,materialList:[],needsProjectId:!1,formListData:{workspace_id:this.localProjectId,query_content_types:[],limit:50,after_id:""},loading:!1,noMore:!1,processIds:[],fetchTaskTimer:null,saving:!1,filterPopoverVisible:!1,debounceTimer:null}},mounted:function(){this.localProjectId&&this.getMaterialList()},computed:Hi(Hi({},Object(c.e)("videoEditor",["projectId","audioList","mirrorList","currentMirror","isLeavingPage"])),{},{localProjectId:function(){return this.projectId},disabled:function(){return this.loading||this.noMore},localAudioList:function(){return this.audioList},localMirrorList:function(){return this.mirrorList}}),watch:{localProjectId:function(e){this.materialList=[],this.formListData.after_id="",this.formListData.query_content_types=[],this.noMore=!1,this.clearFetchTaskTimer(),this.processIds=[],e&&(this.getMaterialList(),this.needsProjectId=!1)},localMirrorList:{handler:function(e){var t=this;e&&e.length&&e.forEach((function(e){if(e.material_id&&-1===t.materialList.findIndex((function(t){return t.material_id===e.material_id}))){var n=Hi(Hi({},e),{},{material_id:e.material_id,idx:0,status:3,type:"image"===e.type?0:1,url:e.cover,task_id:e.task_id,preview_url:e.original||e.preview_url||e.url||e.cover});t.materialList.unshift(n)}}))},deep:!0},localAudioList:{handler:function(e){var t=this;e&&e.length&&e.forEach((function(e){if(e.material_id&&-1===t.materialList.findIndex((function(t){return t.material_id===e.material_id}))){var n=Hi(Hi({},e),{},{material_id:e.material_id,idx:0,status:3,type:3});t.materialList.unshift(n)}}))},deep:!0}},methods:Hi(Hi({},Object(c.b)("videoEditor",["getOrCreateProject","setSaving","setCurrentMirror","setMirrorList","setAudioList"])),{},{handleItemClick:function(e){var t=this;this.debounceTimer||(this.debounceTimer=setTimeout((function(){t.debounceTimer=null}),500),3===e.status&&2!==e.type&&8!==e.type&&1!==e.nsfw&&(this.localAudioList.length>=3&&3===e.type?this.$message.warning(this.$t("maxUploadAudioCount")):this.$emit("itemClick",e)))},formatDuration:function(e){if(!e&&0!==e)return"00:00";var t=Math.floor(Number(e)),n=Math.floor(t/60),o=t%60,r=String(n).padStart(2,"0"),l=String(o).padStart(2,"0");return"".concat(r,":").concat(l)},formatTimestamp:function(e){if(!e)return"";var t=new Date(Number(e)),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0"),c=String(t.getSeconds()).padStart(2,"0");return"".concat(n,"-").concat(o,"-").concat(r," ").concat(l,":").concat(d,":").concat(c)},ensureProjectId:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.localProjectId){t.next=12;break}return e.needsProjectId=!0,t.prev=2,t.next=5,e.getOrCreateProject();case 5:t.sent,e.needsProjectId=!1,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),console.error("创建项目失败",t.t0);case 12:return t.abrupt("return",e.localProjectId);case 13:case"end":return t.stop()}}),t,null,[[2,9]])})))()},addProcessIds:function(e){this.processIds.push(e),this.onBatchFetchTaskProcess()},clearFetchTaskTimer:function(){this.fetchTaskTimer&&(clearTimeout(this.fetchTaskTimer),this.fetchTaskTimer=null)},onBatchFetchTaskProcess:function(){var e=this;0!==this.processIds.length&&(this.clearFetchTaskTimer(),Object(Ze.batchFetchTaskProcess)({task_ids:this.processIds}).then((function(t){var n=!1;t.data.items.forEach((function(t){if(1!=t.status&&2!=t.status||(n=!0),3===t.status&&t.img_uris&&t.img_uris.length>0){var o=e.processIds.indexOf(t.task_id);-1!==o&&e.processIds.splice(o,1);var r=[];e.materialList.forEach((function(e,n){e.task_id===t.task_id&&r.push(n)}));for(var i=r.length-1;i>=0;i--)e.materialList.splice(r[i],1);var l=r.length>0?r[0]:0;e.$nextTick((function(){t.img_uris.forEach((function(component,n){var o=component.duration||3;e.materialList.splice(l+n,0,Hi(Hi({},component),{},{task_id:t.task_id,preview_url:component.url,status:t.status,material_type:1,create_at:t.create_at,creativity:t.creativity?t.creativity:null,idx:n,title:component.title,url:1===component.type&&component.cover_url||component.url,material_id:component.id,duration:o,clipInfo:{startTime:0,endTime:o}}))}))}))}else{var d=[];e.materialList.forEach((function(e,n){e.task_id===t.task_id&&d.push(n)})),d.length>0?d.forEach((function(n){e.materialList[n]&&(e.$set(e.materialList[n],"status",t.status),e.$set(e.materialList[n],"process",t.process))})):e.materialList.unshift({id:"task_".concat(t.task_id,"_").concat(Date.now()),task_id:t.task_id,status:t.status,process:t.process})}})),n&&(e.fetchTaskTimer=setTimeout((function(){e.onBatchFetchTaskProcess()}),3e3))})))},getMaterialList:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.clearFetchTaskTimer(),e.localProjectId){t.next=3;break}return t.abrupt("return");case 3:e.loading=!0,e.formListData.workspace_id=e.localProjectId,Object(v.getMaterialList)(e.formListData).then((function(t){var n=t.data.items;0!==n.length?(n.forEach((function(n){1!==n.status&&2!==n.status||e.processIds.includes(n.id)||e.processIds.push(n.id),n.components.forEach((function(component,o){var r=component.duration||3,l=Hi(Hi({},component),{},{task_id:n.id,status:n.status,status_desc:n.status_desc,material_type:n.material_type,create_at:n.create_at,idx:o,creativity:n.creativity?n.creativity:null,material_id:component.id,title:component.title,duration:r,clipInfo:{startTime:0,endTime:r}});e.removeExistingItems(l.id),e.formListData.after_id||(e.materialList=[]),e.materialList.push(l),e.formListData.after_id=t.data.after_id}))})),e.processIds.length>0&&e.onBatchFetchTaskProcess()):e.noMore=!0})).catch((function(t){e.noMore=!0})).finally((function(){e.loading=!1}));case 6:case"end":return t.stop()}}),t)})))()},removeExistingItems:function(e){if(e){var t=[];this.materialList.forEach((function(n,o){n.material_id===e&&t.push(o)}));for(var i=t.length-1;i>=0;i--)this.materialList.splice(t[i],1)}},handleScroll:function(e){var t=e.target,n=t.scrollTop;t.scrollHeight-n-t.clientHeight<20&&!this.loading&&!this.noMore&&this.getMaterialList()},toggleSidebar:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isCollapsed=!e.isCollapsed,e.$emit("toggleSidebar",e.isCollapsed);case 2:case"end":return t.stop()}}),t)})))()},handlePopoverShow:function(){this.$logEvent("log_actions",{operation:"click_selec",behavior_info:"on_video_edit_createflow_page",behavior_info_sub:"on_right_sidebar"})},onFilterTypeChange:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.clearFetchTaskTimer(),t.processIds=[],n.next=4,t.ensureProjectId();case 4:t.formListData.query_content_types="all"===e?[]:["video"===e?2:1],t.formListData.after_id="",t.materialList=[],t.noMore=!1,t.getMaterialList(),t.filterPopoverVisible=!1;case 10:case"end":return n.stop()}}),n)})))()},onMoreClick:function(e,t,n){var o=this;return Object(r.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.showMore=!1,r.next=3,o.ensureProjectId();case 3:r.t0=e,r.next="remix"===r.t0?6:"download"===r.t0?9:"delete"===r.t0?11:13;break;case 6:return o.$emit("remixClick",t),o.$emit("openCreate"),r.abrupt("break",13);case 9:return o.saveImg(t.preview_url,t.title),r.abrupt("break",13);case 11:return o.$confirm(o.$t("canvas_delete_tips"),o.$t("Tip"),{confirmButtonText:o.$t("Delete"),cancelButtonText:o.$t("Cancel"),type:"warning"}).then((function(){var e=o.localMirrorList.findIndex((function(e){return e.material_id===t.material_id}));Object(v.deleteMaterial)({items:[{id:t.task_id,index:t.idx}]}).then((function(r){if(1e4===r.status.code){var l;o.materialList.splice(n,1);var d=o.localMirrorList.map((function(e,n){return e.material_id===t.material_id?{customType:"empty_mirror",duration:3,clipInfo:{startTime:0,endTime:3},key:(new Date).getTime().toString()+n}:e}));o.setMirrorList(d);var c=d[e];c&&(null==c?void 0:c.key)!==(null===(l=o.currentMirror)||void 0===l?void 0:l.key)&&o.setCurrentMirror(c);var v=o.localAudioList.filter((function(audio){return audio.material_id!==t.material_id}));o.setAudioList(v)}}))})).catch((function(){})),r.abrupt("break",13);case 13:case"end":return r.stop()}}),r)})))()},handleUpload:function(){this.saving||(this.$refs.hyUploadMoald.openModal(),this.$logEvent("log_actions",{operation:"click_upload_resource",behavior_info:"on_video_edit_createflow_page",behavior_info_sub:"on_right_sidebar"}))},handleConfirm:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,c,m,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=[],r=0;case 2:if(!(r<e.length)){n.next=17;break}if(l=e[r],d=7===l.info.sub_obj_type?"video":"image",7!==l.info.sub_obj_type){n.next=11;break}return n.next=8,Object(re.getVideoDuration)(l.url);case 8:n.t0=n.sent,n.next=12;break;case 11:n.t0=3;case 12:c=n.t0,o.push({uri:l.url,duration:c,category:"image"===d?2:8,artwork_id:"artwork"===l.info.channel?l.info.obj_parent_no||l.info.id:""});case 14:r++,n.next=2;break;case 17:if(!(o.length>0)){n.next=23;break}return t.saving=!0,n.next=21,Object(v.syncMaterialToPersonalCenter)({workspace_id:t.localProjectId,material:o});case 21:1e4===(m=n.sent).status.code&&(null==m||null===(h=m.data)||void 0===h||h.items.forEach((function(e){e.components.forEach((function(component,n){var o=component.duration||3;t.materialList.unshift(Hi(Hi({},component),{},{status:3,task_id:e.id,idx:n,material_type:e.material_type,material_id:component.id,duration:o,clipInfo:{startTime:0,endTime:o}}))}))})));case 23:t.saving=!1;case 24:case"end":return n.stop()}}),n)})))()}}),beforeDestroy:function(){this.clearFetchTaskTimer()}},Wi=Ji,Ki=(n(5484),n(5485),Object(_.a)(Wi,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"material-library-main-container"},[t("div",{staticClass:"material-library-main"},[t("div",{staticClass:"collapse-button",on:{click:e.toggleSidebar}},[t("i",{staticClass:"el-icon-arrow-right",class:{rotated:!e.isCollapsed}})]),e._v(" "),t("div",{staticClass:"material-library-main-header"},[t("div",{staticClass:"material-library-main-header-title"},[t("span",[e._v(e._s(e.$t("video_material_$13")))])])]),e._v(" "),t("div",{staticClass:"material-library-main-content"},[t("div",{staticClass:"action-container"},[t("div",{staticClass:"upload-button",class:{disabled:!e.leftCollapsed},attrs:{disabled:!e.leftCollapsed},on:{click:function(t){return e.$emit("openCreate")}}},[t("i",{staticClass:"iconfont icon-icon-menu-generate-default",staticStyle:{"font-size":"24px"}}),e._v(" "),t("span",[e._v(e._s(e.$t("Create")))])]),e._v(" "),t("el-button",{staticClass:"upload-button",attrs:{loading:e.saving,"data-event":"video_editor_right_upload_img"},on:{click:e.handleUpload}},[t("i",{staticClass:"iconfont icon-shangchuan"}),e._v(" "),t("span",[e._v(e._s(e.$t("AddMaterials")))])]),e._v(" "),t("el-popover",{attrs:{placement:"bottom-end",trigger:"click","popper-class":"filter-popover",disabled:!e.localProjectId},on:{show:e.handlePopoverShow},model:{value:e.filterPopoverVisible,callback:function(t){e.filterPopoverVisible=t},expression:"filterPopoverVisible"}},[t("div",{staticClass:"popover-content"},[t("div",{staticClass:"item",class:{active:0===e.formListData.query_content_types.length},on:{click:function(t){return e.onFilterTypeChange("all")}}},[t("span",[e._v(e._s(e.$t("video_material_$2")))])]),e._v(" "),t("div",{staticClass:"item",class:{active:e.formListData.query_content_types.includes(2)},on:{click:function(t){return e.onFilterTypeChange("video")}}},[t("span",[e._v(e._s(e.$t("video_material_$3")))])]),e._v(" "),t("div",{staticClass:"item",class:{active:e.formListData.query_content_types.includes(1)},on:{click:function(t){return e.onFilterTypeChange("image")}}},[t("span",[e._v(e._s(e.$t("video_material_$4")))])])]),e._v(" "),t("div",{staticClass:"filter-button",attrs:{slot:"reference"},slot:"reference"},[t("i",{staticClass:"iconfont icon-shaixuan1"})])])],1),e._v(" "),t("div",{staticClass:"material-list-container",on:{scroll:e.handleScroll}},[t("div",{staticClass:"material-list-item-container"},e._l(e.materialList,(function(n,o){var r;return t("div",{key:n.id+","+o,staticClass:"material-list-item",on:{click:function(t){return e.handleItemClick(n)}}},[t("div",{staticClass:"material-list-item-content"},[1===n.status||2===n.status?t("div",{staticClass:"material-list-item-loading"},[t("el-progress",{attrs:{percentage:n.process,type:"circle",color:"rgba(255,255,255,0.8)","define-back-color":"rgba(255,255,255,0.2)"}})],1):4==n.status?t("div",{staticClass:"material-list-item-other"},[t("span",[e._v(e._s(e.$t("systemCancel")))])]):1===(null==n?void 0:n.type)||0===(null==n?void 0:n.type)?t("div",{staticClass:"material-list-item-content-media"},[t("mirrorTag",{attrs:{item:n}}),e._v(" "),t("img",{attrs:{src:n.url}}),e._v(" "),t("div",{staticClass:"material-list-item-content-media-icon"},[0===(null==n?void 0:n.type)?t("i",{staticClass:"iconfont icon-icon-picture-selected"}):e._e(),e._v(" "),1===(null==n?void 0:n.type)?t("i",{staticClass:"iconfont icon-icon-tag-video"}):e._e()]),e._v(" "),1===(null==n?void 0:n.type)?t("div",{staticClass:"material-list-item-content-media-duration"},[e._v("\n                  "+e._s(e.formatDuration(n.duration))+"\n                ")]):e._e(),e._v(" "),t("el-popover",{attrs:{placement:"left",trigger:"hover","popper-class":"filter-popover","visible-arrow":!1},model:{value:n.showPreview,callback:function(t){e.$set(n,"showPreview",t)},expression:"item.showPreview"}},[t("div",{staticClass:"preview-content"},[0===n.type?t("img",{attrs:{src:n.preview_url}}):e._e(),e._v(" "),1===n.type&&n.showPreview?t("video",{attrs:{src:n.preview_url,autoplay:"",muted:"",loop:""},domProps:{muted:!0}}):e._e()]),e._v(" "),t("div",{staticClass:"preview-button",attrs:{slot:"reference"},slot:"reference"},[t("i",{staticClass:"iconfont icon-fangda"})])])],1):3===(null==n?void 0:n.type)?t("div",{staticClass:"material-list-item-content-media-audio"},[t("i",{staticClass:"iconfont icon-music1"}),e._v(" "),t("audio",{attrs:{src:n.url}})]):t("div",{staticClass:"material-list-item-other"},[t("span",[e._v(e._s(e.$t("video_material_$5")))]),e._v(" "),t("i",{staticClass:"iconfont icon-shanchu"})]),e._v(" "),t("el-popover",{attrs:{placement:"bottom-start",trigger:"hover","popper-class":"filter-popover"},model:{value:n.showMore,callback:function(t){e.$set(n,"showMore",t)},expression:"item.showMore"}},[t("div",{staticClass:"popover-content",on:{click:function(e){e.stopPropagation()}}},[null!==(r=n.operation_labels)&&void 0!==r&&r.includes("supportRetry")&&1==n.material_type?t("div",{staticClass:"item hover",on:{click:function(t){return e.onMoreClick("remix",n)}}},[t("span",[e._v(e._s(e.$t("Remix")))])]):e._e(),e._v(" "),1==n.material_type?t("div",{staticClass:"item hover",on:{click:function(t){return e.onMoreClick("download",n)}}},[t("span",[e._v(e._s(e.$t("Download")))])]):e._e(),e._v(" "),t("div",{staticClass:"item hover",on:{click:function(t){return e.onMoreClick("delete",n,o)}}},[t("span",[e._v(e._s(e.$t("Delete")))])])]),e._v(" "),1!=(null==n?void 0:n.type)&&0!=(null==n?void 0:n.type)&&3!=(null==n?void 0:n.type)||3!==n.status?e._e():t("div",{staticClass:"material-list-item-content-media-more",attrs:{slot:"reference"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[t("i",{staticClass:"iconfont icon-more1"})])])],1),e._v(" "),1!=(null==n?void 0:n.type)&&0!=(null==n?void 0:n.type)&&3!=(null==n?void 0:n.type)||3!==n.status?e._e():t("div",{staticClass:"material-list-item-name"},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:n.title,placement:"bottom"}},[t("span",[e._v(e._s(n.title))])])],1)])})),0),e._v(" "),e.loading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"loading-box"}):e._e()])])]),e._v(" "),t("HyUploadMoald",{ref:"hyUploadMoald",attrs:{isMultiSelect:"",category:61,"file-types":["image","video"],uploadObj:{limit:5,multiple:!0},"before-upload":e.handleBeforeUpload},on:{onConfirm:e.handleConfirm}})],1)}),[],!1,null,"7eec9409",null).exports);function Xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function qi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xi(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Yi={props:{isCollapsed:{type:Boolean,default:!1}},components:{HyUploadMoald:ae.default},mixins:[se.a],computed:qi(qi({},Object(c.c)("user",["isLoggedIn"])),Object(c.e)("videoEditor",["selectedMediaList","projectId"])),mounted:function(){var e=this;this.selectedMediaList&&this.selectedMediaList.length>0&&!this.projectId&&this.$nextTick((function(){e.handleConfirm(e.selectedMediaList),e.clearSelectedMediaList()}))},methods:qi(qi({},Object(c.b)("videoEditor",["setCurrentMirror","clearSelectedMediaList","setIsCreateNewProject"])),{},{handleImportMirror:function(){this.isLoggedIn?this.$refs.hyUploadMoald.openModal():this.$EventBus.$emit("openLoginDialog")},handleConfirmResult:function(e){e.length>20?this.$message.warning(this.$t("maxUploadCount")):(this.setIsCreateNewProject(!0),this.handleConfirm(e))},handleCreateMirror:function(){this.projectId||this.getOrCreateProject(),this.setIsCreateNewProject(!0);var e={customType:"empty_mirror",duration:3,clipInfo:{startTime:0,endTime:3},key:(new Date).getTime()};this.setCurrentMirror(e),this.setMirrorList([e])},toggleMirrorList:function(){this.$emit("toggleAnimation")}})},Qi=(n(5486),Object(_.a)(Yi,(function(){var e=this,t=e._self._c;return t("div",{ref:"editorFooter",staticClass:"editor-footer"},[t("div",{staticClass:"editor-footer-toggle-btn",on:{click:e.toggleMirrorList}},[t("i",{staticClass:"iconfont icon-a-dropdown",class:{"icon-up":e.isCollapsed}})]),e._v(" "),e.isCollapsed?e._e():t("div",{staticClass:"editor-btn-box"},[t("div",{staticClass:"btn-item",on:{click:e.handleImportMirror}},[t("p",[e._v(e._s(e.$t("batch_import_mirror")))]),e._v(" "),t("span",[e._v(e._s(e.$t("batch_import_mirror_desc")))])]),e._v(" "),t("div",{staticClass:"btn-item",on:{click:e.handleCreateMirror}},[t("p",[e._v(e._s(e.$t("CreateBlankStoryboard")))]),e._v(" "),t("span",[e._v(e._s(e.$t("create_empty_mirror_desc")))])])]),e._v(" "),e._m(0),e._v(" "),t("HyUploadMoald",{ref:"hyUploadMoald",attrs:{isMultiSelect:"",category:2,videoCategory:61,"file-types":["image","video"],uploadObj:{limit:5,multiple:!0},"before-upload":e.handleBeforeUpload},on:{onConfirm:e.handleConfirmResult}})],1)}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"bar-bottom"},[t("div",{staticClass:"control-btn"},[t("i",{staticClass:"iconfont icon-zanting1"})]),e._v(" "),t("div",{staticClass:"time"},[t("span",{staticClass:"current-time"},[e._v("00:00")]),e._v(" "),t("span",{staticClass:"total-time"},[e._v("/ 00:00")])])])}],!1,null,"15fab763",null).exports),Zi={mixins:[nt.a],components:{PreviewImageContainer:J,InitFooter:Qi}};n(5487);function en(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?en(Object(n),!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nn={name:"VideoEditor",components:{EditorHeader:R,EditorMain:ct,GenerateMain:Ni,MaterialLibraryMain:Ki,InitEditor:Object(_.a)(Zi,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"init-editor"},[t("PreviewImageContainer",{ref:"previewInstance"}),e._v(" "),t("InitFooter",{ref:"footerInstance",attrs:{isCollapsed:e.isCollapsed},on:{toggleAnimation:e.toggleAnimation}})],1)}),[],!1,null,"3f348815",null).exports},data:function(){return{isCollapsed:!1,isLeftCollapsed:!0,savedIsCollapsed:!1,savedIsLeftCollapsed:!0}},computed:tn({},Object(c.e)("videoEditor",["audioList","mirrorList","currentMirror","projectId","isPlaying","refreshProject"])),watch:{isPlaying:function(e){e?(this.savedIsCollapsed=this.isCollapsed,this.savedIsLeftCollapsed=this.isLeftCollapsed,this.isCollapsed=!0,this.isLeftCollapsed=!0,this.$refs.materialLibraryMain.isCollapsed=this.isCollapsed,this.$refs.generateMain.isCollapsed=this.isLeftCollapsed):(this.isCollapsed=this.savedIsCollapsed,this.isLeftCollapsed=this.savedIsLeftCollapsed,this.$refs.materialLibraryMain.isCollapsed=this.savedIsCollapsed,this.$refs.generateMain.isCollapsed=this.savedIsLeftCollapsed)}},beforeRouteLeave:function(e,t,n){t.path.includes("/video-editor")&&(this.setProjectId(""),this.setMirrorList([],!1),this.setAudioList([],!1),this.setEditorId(null)),n()},methods:tn(tn({},Object(c.b)("videoEditor",["setAudioList","setMirrorList","setCurrentMirror","setCurrentTime","setMirrorLoading","setProjectId","setEditorId","setIsUserSelectedMirror"])),{},{handleUpdateHistoryList:function(e){this.$refs.materialLibraryMain.addProcessIds(e.id)},toggleSidebar:function(){this.isCollapsed=!this.isCollapsed},toggleLeftSidebar:function(){this.isLeftCollapsed=!this.isLeftCollapsed},handleRemixClick:function(e){this.$refs.generateMain.show({action:1,task_id:e.task_id,data:{creativity:e.creativity?e.creativity:null}})},handleItemClick:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,l,d,c,i,v,m,h,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,0!==e.type&&1!==e.type){n.next=11;break}if(t.currentMirror){n.next=4;break}return n.abrupt("return");case 4:if(e.preview_url!==t.currentMirror.original){n.next=6;break}return n.abrupt("return");case 6:if(t.setMirrorLoading(!0),t.setIsUserSelectedMirror(!0),r=tn(tn({},e),{},{type:1===e.type?"video":"image",duration:e.duration,original:e.preview_url,cover:e.url,material_id:e.material_id,id:e.id||(new Date).getTime().toString(),customType:"material",clipInfo:{startTime:0,endTime:e.duration},key:t.currentMirror.key}),l=t.mirrorList.findIndex((function(e){return e.key===t.currentMirror.key})),-1!==l){for((d=Object(o.a)(t.mirrorList))[l]=r,c=0,i=0;i<l;i++)(v=d[i]).clipInfo&&(c+=v.clipInfo.endTime-v.clipInfo.startTime);t.setMirrorList(d),t.setCurrentMirror(r),t.setCurrentTime(c),t.storeItemResources(e),t.setMirrorLoading(!1)}case 11:3===e.type&&(m=t.audioList.reduce((function(e,t){return Math.max(e,t.position.y)}),0),h=tn(tn({},e),{},{type:"audio",original:e.preview_url,blob:e.preview_url,duration:e.duration,material_id:e.material_id,clipInfo:{startTime:0,endTime:e.duration},startTime:0,isMute:!1,id:e.id||(new Date).getTime().toString(),position:{x:0,y:0!=m||t.audioList.length?m+40:0}}),f=[].concat(Object(o.a)(t.audioList),[h]),t.setAudioList(f),Object(re.storeResourceToIndexedDB)(h.original,h.type).catch((function(e){return console.error("Error storing audio resource:",e)}))),n.next=17;break;case 14:n.prev=14,n.t0=n.catch(0),console.error("Error in handleItemClick:",n.t0);case 17:case"end":return n.stop()}}),n,null,[[0,14]])})))()},storeItemResources:function(e){Promise.all([Object(re.storeResourceToIndexedDB)(e.preview_url,1===e.type?"video":"image"),1===e.type?Object(re.storeResourceToIndexedDB)(e.url,"image"):Promise.resolve()]).catch((function(e){return console.error("Error storing resources:",e)}))}})},on=(n(5488),n(5489),Object(_.a)(nn,(function(){var e=this,t=e._self._c;return t("div",{key:e.refreshProject+"refs",staticClass:"video-editor-container"},[t("client-only",[t("div",{staticClass:"video-editor-header"},[t("EditorHeader")],1),e._v(" "),e.projectId?t("div",{staticClass:"video-editor-content"},[t("div",{staticClass:"video-editor-content-left",class:{collapsed:e.isLeftCollapsed}},[t("GenerateMain",{ref:"generateMain",on:{toggleSidebar:e.toggleLeftSidebar,updateList:e.handleUpdateHistoryList}})],1),e._v(" "),t("div",{staticClass:"video-editor-content-center",class:{"expanded-right":e.isCollapsed,"expanded-left":e.isLeftCollapsed}},[t("EditorMain",{on:{addTask:e.handleUpdateHistoryList,openCreate:function(t){e.isLeftCollapsed=!1}}})],1),e._v(" "),t("div",{staticClass:"video-editor-content-right",class:{collapsed:e.isCollapsed}},[t("MaterialLibraryMain",{ref:"materialLibraryMain",attrs:{leftCollapsed:e.isLeftCollapsed},on:{toggleSidebar:e.toggleSidebar,remixClick:e.handleRemixClick,itemClick:e.handleItemClick,openCreate:function(t){e.isLeftCollapsed=!1}}})],1)]):e._e(),e._v(" "),e.projectId?e._e():t("InitEditor")],1)],1)}),[],!1,null,"29163e50",null));t.default=on.exports}}]);