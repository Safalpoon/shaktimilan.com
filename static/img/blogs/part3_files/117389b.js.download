(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1645:function(t,e,n){t.exports={}},1667:function(t,e,n){t.exports={}},1668:function(t,e,n){t.exports={}},1669:function(t,e,n){t.exports={}},1673:function(t,e,n){t.exports={}},1674:function(t,e,n){t.exports={}},1680:function(t,e,n){t.exports={}},1682:function(t,e,n){t.exports={}},1683:function(t,e,n){t.exports={}},1684:function(t,e,n){t.exports={}},1685:function(t,e,n){t.exports={}},1686:function(t,e,n){t.exports={}},1687:function(t,e,n){t.exports={}},1729:function(t,e,n){t.exports={}},1730:function(t,e,n){t.exports={}},2167:function(t,e,n){t.exports={}},2294:function(t,e,n){t.exports={}},2295:function(t,e,n){t.exports={}},2296:function(t,e,n){t.exports={}},2297:function(t,e,n){t.exports={}},2298:function(t,e,n){t.exports={}},2299:function(t,e,n){t.exports={}},2301:function(t,e,n){t.exports={}},2302:function(t,e,n){t.exports={}},2303:function(t,e,n){t.exports={}},2304:function(t,e,n){t.exports={}},2321:function(t,e,n){t.exports={}},2322:function(t,e,n){t.exports={}},2323:function(t,e,n){t.exports={}},2324:function(t,e,n){t.exports={}},2325:function(t,e,n){t.exports={}},2326:function(t,e,n){t.exports={}},2327:function(t,e,n){t.exports={}},2328:function(t,e,n){t.exports={}},2329:function(t,e,n){t.exports={}},2330:function(t,e,n){t.exports={}},2331:function(t,e,n){t.exports={}},2332:function(t,e,n){t.exports={}},2333:function(t,e,n){t.exports={}},2334:function(t,e,n){t.exports={}},2335:function(t,e,n){t.exports={}},2336:function(t,e,n){t.exports={}},2337:function(t,e,n){t.exports={}},2338:function(t,e,n){t.exports={}},2339:function(t,e,n){t.exports={}},2340:function(t,e,n){t.exports={}},2341:function(t,e,n){t.exports={}},2342:function(t,e,n){t.exports={}},2343:function(t,e,n){t.exports={}},2344:function(t,e,n){t.exports={}},2345:function(t,e,n){t.exports={}},2346:function(t,e,n){t.exports={}},2347:function(t,e,n){t.exports={}},2348:function(t,e,n){t.exports={}},2349:function(t,e,n){t.exports={}},2350:function(t,e,n){t.exports={}},2351:function(t,e,n){t.exports={}},2352:function(t,e,n){t.exports={}},2354:function(t,e,n){t.exports={}},2355:function(t,e,n){t.exports={}},2356:function(t,e,n){t.exports={}},2387:function(t,e,n){t.exports={}},2388:function(t,e,n){t.exports={}},2389:function(t,e,n){t.exports={}},2390:function(t,e,n){t.exports={}},2391:function(t,e,n){t.exports={}},2393:function(t,e,n){t.exports={}},2394:function(t,e,n){t.exports={}},2395:function(t,e,n){t.exports={}},2399:function(t,e,n){t.exports={}},2400:function(t,e,n){t.exports={}},2401:function(t,e,n){t.exports={}},2402:function(t,e,n){t.exports={}},2403:function(t,e,n){t.exports={}},2404:function(t,e,n){t.exports={}},2405:function(t,e,n){t.exports={}},2406:function(t,e,n){t.exports={}},2407:function(t,e,n){t.exports={}},2408:function(t,e,n){t.exports={}},2415:function(t,e,n){t.exports={}},2416:function(t,e,n){t.exports={}},2417:function(t,e,n){t.exports={}},2418:function(t,e,n){t.exports={}},2419:function(t,e,n){t.exports={}},2420:function(t,e,n){t.exports={}},2421:function(t,e,n){t.exports={}},2824:function(t,e,n){t.exports={}},2825:function(t,e,n){t.exports={}},2826:function(t,e,n){t.exports={}},2913:function(t,e,n){t.exports={}},2914:function(t,e,n){t.exports={}},2915:function(t,e,n){t.exports={}},2916:function(t,e,n){t.exports={}},2917:function(t,e,n){t.exports={}},2918:function(t,e,n){t.exports={}},2919:function(t,e,n){t.exports={}},2920:function(t,e,n){t.exports={}},2921:function(t,e,n){t.exports={}},2922:function(t,e,n){t.exports={}},2923:function(t,e,n){t.exports={}},2924:function(t,e,n){t.exports={}},2925:function(t,e,n){t.exports={}},2926:function(t,e,n){t.exports={}},2927:function(t,e,n){t.exports={}},2928:function(t,e,n){t.exports={}},2929:function(t,e,n){t.exports={}},2930:function(t,e,n){t.exports={}},2931:function(t,e,n){t.exports={}},2932:function(t,e,n){t.exports={}},2933:function(t,e,n){t.exports={}},2934:function(t,e,n){t.exports={}},2935:function(t,e,n){t.exports={}},2936:function(t,e,n){t.exports={}},2937:function(t,e,n){t.exports={}},2938:function(t,e,n){t.exports={}},2939:function(t,e,n){t.exports={}},2940:function(t,e,n){t.exports={}},2941:function(t,e,n){t.exports={}},3190:function(t,e,n){"use strict";n.r(e);n(11),n(6),n(12),n(13),n(8),n(4),n(7);var o=n(3),r=n(2),l=(n(20),n(1)),c=n(898),d=(n(38),n(899)),m=n(783).a,v=(n(4028),n(0)),component=Object(v.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"aichat-head",class:{"left-collapsed":t.leftCollapsed,"right-collapsed":t.rightCollapsed,"all-collapsed":t.leftCollapsed&&t.rightCollapsed}},[t.leftCollapsed?e("div",{staticClass:"left-tabs"},[e("div",{staticClass:"back-icon flex-center",on:{click:t.goback}},[e("i",{staticClass:"el-icon-arrow-left"})]),t._v(" "),e("a",{staticClass:"web-logo",class:["release"!==t.envMark&&"canary"],attrs:{href:t.localePath("/"),"data-text":t.envMark},on:{click:function(e){return e.preventDefault(),t.toHome.apply(null,arguments)}}},[e("img",{staticClass:"logo",attrs:{src:t.logo,alt:"Avatar"}})]),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:t.isCompanyAccount,expression:"isCompanyAccount"}],staticClass:"company-name"},[t._v("\n      "+t._s(t.$t("Enterprise"))+"\n    ")]),t._v(" "),e("div",{staticClass:"collapse-button left",on:{click:t.openLeft}},[e("i",{staticClass:"iconfont icon-a-arrowleft"})])]):t._e(),t._v(" "),t.rightCollapsed?e("div",{staticClass:"right-tabs flex-center"},[e("div",{staticClass:"info-item asset-item flex-center",attrs:{title:t.getCoinTitle(t.coins[0])},on:{click:function(e){return t.toMall("?openTab=Credit&dotFrom=on_tavern_sidebar")}}},[e("img",{attrs:{src:n(205),alt:""}}),t._v(" "),e("span",[t._v(t._s(t._f("formatNumberForeign")(t.paymentInfo.calculateCoins)))])]),t._v(" "),e("div",{staticClass:"info-item asset-item flex-center",attrs:{title:t.getCoinTitle(t.coins[1])},on:{click:function(e){return t.toMall("?openTab=Credit&dotFrom=on_tavern_sidebar")}}},[e("img",{attrs:{src:n(160),alt:""}}),t._v(" "),e("span",[t._v(t._s(t._f("formatNumberForeign")(t.paymentInfo.tempCoins)))])]),t._v(" "),e("div",{staticClass:"info-item vip-item",on:{click:function(e){return t.toMall("?dotFrom=on_tavern_sidebar")}}},[e("img",{attrs:{src:n(665),alt:""}})]),t._v(" "),e("div",{staticClass:"collapse-button right",on:{click:t.openRight}},[e("i",{staticClass:"iconfont icon-a-arrowleft"})])]):t._e()])}),[],!1,null,"09dff2b8",null),f=component.exports,h=(n(19),n(18),n(784).a),_=(n(4032),Object(v.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"sidebar",class:{"is-collapsed":t.isCollapsed},on:{dblclick:function(t){t.stopPropagation()}}},[e("div",{staticClass:"sidebar-fixed-header"},[e("a",{staticClass:"web-logo",class:["release"!==t.envMark&&"canary"],attrs:{href:t.localePath("/"),"data-text":t.envMark},on:{click:function(e){return e.preventDefault(),t.toHome.apply(null,arguments)}}},[e("img",{staticClass:"logo",attrs:{src:t.logo,alt:"SeaArt AI"}})]),t._v(" "),e("div",{staticClass:"collapse-button",on:{click:t.toggleCollapse}},[e("i",{staticClass:"iconfont icon-a-arrowleft"})])]),t._v(" "),e("div",{staticClass:"sidebar-lists-container"},[e("div",{staticClass:"list-section",class:{collapsed:!t.isRecentChatsExpanded}},[e("div",{staticClass:"list-header-box"},[e("div",{staticClass:"list-header-1 list-header",attrs:{"data-event":"ai-chat-recent-chat-toggle"},on:{click:t.toggleRecentChats}},[e("div",{staticClass:"sidebar-title overflow-ellipsis"},[t._v(t._s(t.$t("recChat")))]),t._v(" "),e("i",{staticClass:"icon",class:[t.isRecentChatsExpanded?"el-icon-arrow-up":"el-icon-arrow-right"]})])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isRecentChatsExpanded,expression:"isRecentChatsExpanded"}],ref:"chatList",staticClass:"list-content hide-scrollbar",class:{collapsed:!t.isRecentChatsExpanded}},[e("div",{staticClass:"new-chat-btn",on:{click:t.handleNewChat}},[t._m(0),t._v(" "),e("span",[t._v(t._s(t.$t("newChat")))])]),t._v(" "),t._l(t.groupedChats,(function(n,o){return[e("div",{key:o,staticClass:"time-group-title"},[t._v(t._s(n.title))]),t._v(" "),t._l(n.items,(function(n,o){return e("div",{key:"lastChat_"+n.file_name+"_"+o,staticClass:"chat-item-chat",class:{active:"".concat(n.file_name,"_").concat(n.last_mes)===t.currentChatIndex},on:{click:function(e){return t.changeChat(n,"".concat(n.file_name,"_").concat(n.last_mes))}}},[n.file_name?e("div",{staticClass:"chat-preview overflow-ellipsis session_title"},[t._v("\n              "+t._s(t.formatChatTitle(n.file_name))+"\n            ")]):n.preview_message?e("div",{staticClass:"chat-preview overflow-ellipsis session_title",domProps:{innerHTML:t._s(t.formatMsg(n.preview_message,!0))}}):e("div",{staticClass:"chat-preview overflow-ellipsis session_title"},[t._v("\n              "+t._s(n.last_mes)+"\n            ")]),t._v(" "),e("handle-popover",{staticClass:"handle-popover",attrs:{options:t.options,placement:"bottom-start"},on:{moreActions:function(e){return t.moreActions(e,n)}}})],1)}))]}))],2)]),t._v(" "),t.recentCharacters.length?e("div",{staticClass:"list-section",class:{collapsed:!t.isRecentChatsExpanded}},[e("div",{staticClass:"list-header",on:{click:t.toggleCharacters}},[e("div",{staticClass:"sidebar-title overflow-ellipsis"},[t._v(t._s(t.$t("recentBots")))]),t._v(" "),e("i",{staticClass:"icon",class:[t.isCharactersExpanded?"el-icon-arrow-up":"el-icon-arrow-right"]})]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isCharactersExpanded,expression:"isCharactersExpanded"}],ref:"characterList",staticClass:"list-content hide-scrollbar",class:{collapsed:!t.isCharactersExpanded}},t._l(t.recentCharacters,(function(n,i){var o,r;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.currentCharacterName===n.name&&t.isDialogLoading,expression:"currentCharacterName === character.name && isDialogLoading"}],key:"character_"+i,staticClass:"chat-item",style:"".concat(t.isGenerating?"pointer-events: none;":""),on:{click:function(e){return t.handleClickCharacter(n)}}},[e("div",{staticClass:"delete-btn",on:{click:function(e){return e.stopPropagation(),t.handleDeleteCharacter(n)}}},[e("i",{staticClass:"el-icon-delete"})]),t._v(" "),n.avatar?e("div",{staticClass:"avatar",style:n.avatar?{backgroundImage:"url(".concat(t.getAvatar(n.avatar),")")}:{}}):e("div",{staticClass:"avatar default-avatar"},[t._v("\n            "+t._s(t.getFirstLetter(n.name||(null===(o=n.data)||void 0===o?void 0:o.name)))+"\n          ")]),t._v(" "),e("div",{staticClass:"chat-details"},[e("div",{staticClass:"chat-header"},[e("span",{staticClass:"chat-name"},[t._v(t._s(n.name||(null===(r=n.data)||void 0===r?void 0:r.name)))]),t._v(" "),e("span",{staticClass:"chat-time"},[t._v(t._s(t.formatTimestampCustom(n.date_last_chat)))])]),t._v(" "),e("div",{staticClass:"chat-preview overflow-ellipsis"},[t._v(t._s(n.creatorcomment||""))])])])})),0)]):t._e()]),t._v(" "),e("ConfirmModal",{ref:"confirmModal",attrs:{dialogWidth:"edit"===t.curHandle?560:462},on:{confirm:t.handleConfirmModalConfirm}},["edit"===t.curHandle?e("template",{slot:"custom_content"},[e("AiChatEditForm",{ref:"editFormComponent",attrs:{formObj:t.handleForm}})],1):t._e()],2)],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"icon-box"},[t("i",{staticClass:"iconfont icon-xinduihua"})])}],!1,null,"ea7a2692",null)),y=_.exports,C=n(14),w=(n(26),n(84));function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var D={name:"ChatCenter",inject:["chatIndex"],data:function(){return{isReady:!1,iframeAttemptsCount:0,maxAttempts:10,iframeCheckInterval:null}},computed:k(k(k(k({},Object(l.e)("payment",["paymentInfo"])),Object(l.c)("user",["token","isCompanyAccount","userInfo"])),Object(l.c)("tavern",["currentCharacter","currentConfig","isChangeModelByRightMenu","selectedModelName"])),{},{isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},getIframeUrl:function(){return"https://tavern.seaart.ai"}}),watch:{currentCharacter:{handler:function(t,e){var n=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var r,l,c,d,m;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("create"!==(null===(r=n.$route)||void 0===r||null===(r=r.params)||void 0===r?void 0:r.id)&&t){o.next=2;break}return o.abrupt("return");case 2:return d=(null===(l=n.chatIndex)||void 0===l||null===(l=l.detailData)||void 0===l?void 0:l.id)||(null===(c=n.$route)||void 0===c||null===(c=c.params)||void 0===c?void 0:c.id)||"",o.next=5,n.$store.dispatch("tavern/fetchConfig",d);case 5:m=o.sent,n.$store.dispatch("tavern/setCurrentCharacter",t),n.$store.dispatch("tavern/setCurrentConfig",m),n.sendDataToIframe({characterId:d,characterData:m},"CHARACTER_DATA"),(null==t?void 0:t.id)!==(null==e?void 0:e.id)&&n.$store.dispatch("tavern/setDialogLoading",!0);case 10:case"end":return o.stop()}}),o)})))()},deep:!0,immediate:!0}},methods:k(k({},Object(l.d)("tavern",["SET_EDIT_LOADING","SET_IS_CHANGE_MODEL_BY_RIGHT_MENU","SET_SELECTED_MODEL_NAME"])),{},{handleIframeLoad:function(){console.log("iframe onload事件触发"),this.isReady=!0,this.sendInfoToIframe()},sendInfoToIframe:function(){var t,e,n,o,r=this;if("create"!==(null===(t=this.$route)||void 0===t||null===(t=t.params)||void 0===t?void 0:t.id)){var iframe=this.$el.querySelector("#sillyTavernIframe");if(iframe&&iframe.contentWindow){var l={AUTH_TOKEN:localStorage.getItem("t")||this.token,LANGUAGE:null!==(e=this.$i18n.locale)&&void 0!==e?e:"en",USER_INFO:this.userInfo,CHARACTER_DATA:{characterData:this.currentConfig,characterId:(null===(n=this.chatIndex)||void 0===n||null===(n=n.detailData)||void 0===n?void 0:n.id)||(null===(o=this.$route)||void 0===o||null===(o=o.params)||void 0===o?void 0:o.id)||""}};Object.keys(l).forEach((function(t){r.sendDataToIframe(l[t],t)}))}else console.warn("iframe或contentWindow不存在，无法发送token")}},sendDataToIframe:function(t,e){var n={type:e,data:t};this.postMsgToIframe(n)},checkForIframe:function(){var iframe=this.$refs.sillyTavernIframe||this.$el.querySelector("#sillyTavernIframe")||document.getElementById("sillyTavernIframe");this.iframeAttemptsCount++,console.log("第".concat(this.iframeAttemptsCount,"次尝试获取iframe"),iframe),iframe?(console.log("找到iframe元素"),clearInterval(this.iframeCheckInterval),this.isReady||(iframe.addEventListener("load",this.handleIframeLoad),iframe.contentDocument&&"complete"===iframe.contentDocument.readyState&&(console.log("iframe已经加载完成，手动触发处理"),this.handleIframeLoad()))):this.iframeAttemptsCount>=this.maxAttempts&&(console.error("多次尝试后仍未找到iframe元素，停止尝试"),clearInterval(this.iframeCheckInterval),this.isReady=!0)},handleSTMessage:function(data){var t,e,n,o,r;if(console.log("处理来自st的消息",data),"create"!==(null===(t=this.$route)||void 0===t||null===(t=t.params)||void 0===t?void 0:t.id)){var l=data.type,c=data.info;switch(l){case"goBack":console.log("goBack, 消息发来了"),this.$router.push(this.localePath("/"));break;case"vipTip":console.log("vipTip, 消息发来了",c);var d,m={70039:["showVipComputingDialog","vipDialogComputedTit2"],70010:["showBreakDialog","VipTip","basic"],80008:this.isVip?["showVipComputingDialog"]:["showNotVipComputingDialog"]};if(c.code&&m[c.code])(d=this.$EventBus).$emit.apply(d,Object(C.a)(m[c.code]));break;case"hideLoader":this.$store.dispatch("tavern/setDialogLoading",!1),this.$EventBus.$emit(w.b.ST_HIDE_LOADER);break;case"ST_CHAT_LIST":this.$EventBus.$emit(w.b.ST_CHAT_LIST,c.data||[]);break;case"ST_CHARACTER_LIST":this.$EventBus.$emit(w.b.ST_CHARACTER_LIST,c.data||[]);break;case"ST_MODEL_LIST":this.$EventBus.$emit(w.b.ST_MODEL_LIST,c.data||[]);break;case"ST_SETTINGS_LOADED":this.$EventBus.$emit(w.b.ST_SETTINGS_LOADED,c.data||{});break;case"ST_PARAMS_UPDATED":console.log("模型参数更新-room",c),this.handleParamsUpdated(c);break;case"seeNsfw":console.log("查看nsfw资源-room",c),(null==c?void 0:c.url)&&(null===(e=this.chatIndex)||void 0===e||e.openNsfw(null==c?void 0:c.url));break;case"publish":if("create"!==(null===(n=this.$route)||void 0===n||null===(n=n.params)||void 0===n?void 0:n.id))return;console.log("发布操作-room",c),this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-publish-btn",entity_type:"sillyTavern-chat-room",obj_type:76}),this.$EventBus.$emit("open-publish-dialog",c);break;case"instruction":if("create"!==(null===(o=this.$route)||void 0===o||null===(o=o.params)||void 0===o?void 0:o.id))return;console.log("instruction-room",c),this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-guide-btn",entity_type:"sillyTavern-chat-page"}),window.open(this.localePath("/tavernInstruction"),"_blank");break;case"createNewCard":if("create"!==(null===(r=this.$route)||void 0===r||null===(r=r.params)||void 0===r?void 0:r.id))return;console.log("ST内部创建新角色-room",c);var v=c.status,f=void 0===v?"start":v;this.$xyLogEvent({front_operation:"click",entity_name:"start"===f?"create-new-card":"create-new-card-success",entity_type:"sillyTavern"});break;case"ST_EDIT_CHAT_DONE":console.log("编辑会话完成",c),this.SET_EDIT_LOADING(!1);var h=c.status;"success"===(void 0===h?"success":h)?this.$emit("editChatDone"):this.$message.error(this.$t("taskOperateFailed"));break;case"ST_MESSAGE_RECEIVING":console.log("接收回复消息状态",c),this.$store.dispatch("tavern/setIsGenerating",c.data)}}},handleParamsUpdated:function(t){this.$EventBus.$emit(w.b.ST_PARAMS_UPDATED,t||{}),this.isChangeModelByRightMenu&&this.selectedModelName&&(this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-chat-model-btn-click",entity_type:"sillyTavern-chat-room",obj_id:this.selectedModelName}),this.SET_IS_CHANGE_MODEL_BY_RIGHT_MENU(!1),this.SET_SELECTED_MODEL_NAME(""))},postMsgToIframe:function(data){var t,e=this.getIframeUrl,iframe=null===(t=document.getElementById("sillyTavernIframe"))||void 0===t?void 0:t.contentWindow;iframe&&iframe.postMessage(data,e)},initEvent:function(){var t=this.sendDataToIframe,e=this.$EventBus;e.$on(w.b.ST_NEW_CHAT,(function(data){console.log("开始新对话",data),t(null,"ST_NEW_CHAT")})),e.$on(w.b.ST_CHANGE_CHAT,(function(e){console.log("切换会话",e),t(e,"ST_CHANGE_CHAT")})),e.$on(w.b.ST_CHANGE_CHARACTER,(function(e){console.log("切换角色",e),t(e,"ST_CHANGE_CHARACTER")})),e.$on(w.b.ST_CHANGE_MODEL,(function(e){console.log("切换模型",e),t(e,"ST_CHANGE_MODEL")})),e.$on(w.b.ST_EDIT_CHAT,(function(data){console.log("编辑会话",data),t(data,"ST_EDIT_CHAT")})),e.$on(w.b.ST_DELETE_CHAT,(function(data){console.log("删除会话",data),t(data,"ST_DELETE_CHAT")})),e.$on(w.b.ST_CHANGE_PARAMS,(function(data){console.log("模型参数设置",data),t(data,"ST_CHANGE_PARAMS")})),e.$on(w.b.ST_DELETE_CHAT_CHARACTER,(function(data){console.log("删除历史聊天数字人",data),t(data,"ST_DELETE_CHAT_CHARACTER")}))},removeEvent:function(){var t=this.$EventBus;t.$off(w.b.ST_NEW_CHAT),t.$off(w.b.ST_CHANGE_CHAT),t.$off(w.b.ST_CHANGE_CHARACTER),t.$off(w.b.ST_CHANGE_MODEL),t.$off(w.b.ST_EDIT_CHAT),t.$off(w.b.ST_DELETE_CHAT),t.$off(w.b.ST_CHANGE_PARAMS)}}),mounted:function(){var t=this;window.addEventListener("message",(function(e){"https://tavern.seaart.ai"===e.origin&&t.handleSTMessage(e.data)})),this.iframeCheckInterval=setInterval(this.checkForIframe,500),setTimeout((function(){t.isReady||(console.warn("iframe加载超时，强制设置isReady"),t.isReady=!0,clearInterval(t.iframeCheckInterval),t.sendInfoToIframe())}),8e3),this.initEvent()},updated:function(){this.checkForIframe()},beforeDestroy:function(){clearInterval(this.iframeCheckInterval);var iframe=this.$el.querySelector("#sillyTavernIframe");iframe&&iframe.removeEventListener("load",this.handleIframeLoad),this.removeEvent(),this.SET_IS_CHANGE_MODEL_BY_RIGHT_MENU(!1)}},$=(n(4033),Object(v.a)(D,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-silly-tavern"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isReady,expression:"isReady"}],staticClass:"p-silly-tavern-box"},[e("client-only",[e("iframe",{ref:"sillyTavernIframe",attrs:{id:"sillyTavernIframe",src:t.getIframeUrl,width:"100%",height:"100%",frameborder:"0"},on:{load:t.handleIframeLoad}})])],1)])}),[],!1,null,"1c69b9e1",null).exports),T=(n(32),n(16),n(22),n(21),n(10)),O=n(257),I=n(116),S=(n(122),n(15));function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E={name:"ChatModelPopup",inject:["chatIndex"],props:{currentModels:{type:Array,default:function(){return[]}},modelId:{type:String,default:""}},watch:{modelId:{handler:function(t){this.selectedModel=t},immediate:!0}},data:function(){return{dialogVisible:!1,selectedModel:"",loading:!1}},computed:j(j({},Object(l.c)("user",["isLoggedIn"])),{},{currentModel:function(){var t=this;return this.currentModels.find((function(e){return e.id===t.selectedModel}))||{}},currentShowModels:function(){var t,e=this;return((null===(t=this.currentModels)||void 0===t?void 0:t.map((function(t){var n;return j(j({},t),{},{isRecommend:t.id===(null===(n=e.chatIndex.characterData)||void 0===n||null===(n=n.preset)||void 0===n?void 0:n.model_id)})})))||[]).sort((function(a,b){return a.isRecommend?-1:1}))}}),methods:j(j({},Object(l.d)("tavern",["SET_IS_CHANGE_MODEL_BY_RIGHT_MENU","SET_SELECTED_MODEL_NAME"])),{},{show:function(){this.dialogVisible=!0},hide:function(){this.dialogVisible=!1},handleSave:function(){this.dialogVisible&&(this.saveModelToConfig(),this.dialogVisible=!1,this.$message.success(this.$t("OperateSuccess")))},handleModelClick:function(t){this.isLoggedIn?(this.loading=!0,this.selectedModel=t.id,this.$EventBus.$emit(w.b.ST_CHANGE_MODEL,this.currentModel),this.SET_IS_CHANGE_MODEL_BY_RIGHT_MENU(!0),this.SET_SELECTED_MODEL_NAME(t.name)):this.$EventBus.$emit("openLoginDialog")},saveModelToConfig:function(){var data={id:this.chatIndex.detailData.id,std_id:this.chatIndex.characterData.st_card_id,model_id:this.selectedModel};Object(S.a)({url:"/api/v1/tavern-pro/config_save",method:"post",data:data}).then((function(t){console.log(t)}))}}),mounted:function(){var t=this;this.$EventBus.$on(w.b.ST_SETTINGS_LOADED,(function(data){t.loading=!1,t.handleSave()}))},beforeDestroy:function(){this.$EventBus.$off(w.b.ST_SETTINGS_LOADED)}};n(4039);function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var N={name:"ChatSetting",components:{ChatModelPopup:Object(v.a)(E,(function(){var t=this,e=t._self._c;return e("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:t.$t("characterSettingModelChange"),visible:t.dialogVisible,"custom-class":"model-switcher-dialog","close-on-click-modal":!1,"append-to-body":"",top:"5vh"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"model-list"},[t.currentShowModels.length>0?t._l(t.currentShowModels,(function(o){return e("div",{key:o.id,staticClass:"model-list-item",class:{"model-list-item-is-checked":t.selectedModel===o.id},on:{click:function(e){return t.handleModelClick(o)}}},[e("div",{staticClass:"model-list-item-header"},[e("div",{staticClass:"model-title"},[t._v("\n            "+t._s(t.$t(o.title_key)||o.name)+"\n\n            "),t._v(" "),1===o.free_switch?e("div",{staticClass:"model-title-tag-free"},[e("img",{staticClass:"icon-free",attrs:{src:n(1520),alt:"free"}}),t._v(" "),e("span",[t._v("Free for a limited time")])]):t._e()]),t._v(" "),e("div",{staticClass:"model-handle"},[e("div",{staticClass:"custom-checkbox",class:{"is-checked":o.id===t.selectedModel}},[e("i",{staticClass:"el-icon-check"})])]),t._v(" "),o.isRecommend?e("img",{staticClass:"icon-recommend",attrs:{src:n(1523),alt:"recommend"}}):t._e()])])})):t._e(),t._v(" "),0===t.currentShowModels.length?[e("div",{staticClass:"model-list-no-data"},[t._v(t._s(t.$t("no_data")))])]:t._e()],2)])}),[],!1,null,"1da82f0c",null).exports,AiChatCustomSlider:n(941).a},inject:["chatIndex"],props:{modelId:{type:String,default:""},currentModels:{type:Array,default:function(){return[]}}},data:function(){return{PARAMS_TYPE:w.c,visible:!1,settingConfig:{contextLength:0,replyLength:0},loading:!1}},computed:M(M({},Object(l.e)("tavern",["isDialogLoading"])),{},{currentModel:function(){var t,e,n,o,r=this,l=this.currentModels.find((function(t){return t.id===r.modelId}))||{};return this.settingConfig=M(M({},this.settingConfig),{},{contextLength:null!==(t=null!==(e=l.openai_max_context)&&void 0!==e?e:l.min_context_length)&&void 0!==t?t:0,replyLength:null!==(n=null!==(o=l.openai_max_tokens)&&void 0!==o?o:l.min_message_length)&&void 0!==n?n:0}),l}}),methods:{show:function(){this.visible=!0},hide:function(){this.visible=!1},handleDialogOpened:function(){var t=this;this.$nextTick((function(){t.resizeObserver&&t.$refs.settingsContainer&&t.resizeObserver.observe(t.$refs.settingsContainer),t.checkDialogHeight()}))},checkDialogHeight:function(){var t=this.$refs.settingsContainer;if(t){var e=window.innerHeight,n=e-.05*e-20-60;t.scrollHeight>n?(t.style.maxHeight="".concat(n,"px"),t.style.overflowY="auto",t.style.paddingRight="10px"):(t.style.maxHeight="none",t.style.overflowY="visible",t.style.paddingRight="0")}},changeModel:function(){this.$refs.chatModelPopup.show()},updateContextLength:function(t){var e=this.PARAMS_TYPE,n=this.$EventBus;this.loading=!0,n.$emit(w.b.ST_CHANGE_PARAMS,{type:e.ST_CHANGE_MAX_CONTEXT,value:t,model:this.currentModel})},updateReplyLength:function(t){var e=this.PARAMS_TYPE,n=this.$EventBus;this.loading=!0,n.$emit(w.b.ST_CHANGE_PARAMS,{type:e.ST_CHANGE_MAX_TOKENS,value:t,model:this.currentModel})}},mounted:function(){var t=this;this.$EventBus.$on(w.b.ST_PARAMS_UPDATED,(function(e){var n=e.type,o=e.data.oai_settings,r=t.PARAMS_TYPE,l=t.$message;if(t.loading=!1,o)switch(n!==r.ST_CHANGE_PARAMS_ALL&&l.success(t.$t("OperateSuccess")),n){case r.ST_CHANGE_MAX_CONTEXT:t.settingConfig.contextLength=o.openai_max_context;break;case r.ST_CHANGE_MAX_TOKENS:t.settingConfig.replyLength=o.openai_max_tokens;break;case r.ST_CHANGE_PARAMS_ALL:t.settingConfig=M(M({},t.settingConfig),{},{contextLength:o.openai_max_context,replyLength:o.openai_max_tokens})}else l.error(t.$t("taskOperateFailed"))}))},beforeDestroy:function(){this.$EventBus.$off(w.b.ST_PARAMS_UPDATED)}};n(4041),n(4042);function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var F={name:"ChatRight",components:{ChatSetting:Object(v.a)(N,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.visible,title:t.$t("characterSettingChat"),top:"0","custom-class":"chat-settings-dialog","append-to-body":""},on:{"update:visible":function(e){t.visible=e},opened:t.handleDialogOpened}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isDialogLoading,expression:"isDialogLoading"}],ref:"settingsContainer",staticClass:"settings-container"},[e("section",{staticClass:"settings-section"},[e("div",{staticClass:"item-title"},[t._v(t._s(t.$t("talk_model_setting")))]),t._v(" "),e("p",{staticClass:"section-subtitle"},[t._v(t._s(t.$t("ST_chatpage_model_title")))]),t._v(" "),e("p",{staticClass:"model-description"},[t._v(t._s(t.$t("ST_chatpage_model_desc")))]),t._v(" "),e("div",{staticClass:"model-select"},[e("div",{staticClass:"model-info"},[e("span",[t._v(t._s(t.$t("current_model"))+": "+t._s(t.currentModel.name||t.currentModel.id))])]),t._v(" "),e("div",{staticClass:"change-model-btn",attrs:{"data-event":"ai-chat-change-model-btn"},on:{click:t.changeModel}},[t._v("\n          "+t._s(t.$t("characterSettingChange"))+"\n        ")])])]),t._v(" "),e("section",{staticClass:"settings-section"},[e("div",{staticClass:"item-title"},[t._v(t._s(t.$t("characterSettingGeneral")))]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"parameter-item"},[e("div",{staticClass:"parameter-item-content"},[e("div",{staticClass:"parameter-header"},[e("span",[t._v(t._s(t.$t("MaxMemory")))])]),t._v(" "),e("AiChatCustomSlider",{attrs:{min:t.currentModel.min_context_length||0,max:t.currentModel.max_context_length||2048,step:1,decimal:0},on:{change:t.updateContextLength},model:{value:t.settingConfig.contextLength,callback:function(e){t.$set(t.settingConfig,"contextLength",e)},expression:"settingConfig.contextLength"}}),t._v(" "),e("div",{staticClass:"temperature-desc"},[e("span",[t._v(t._s(t.currentModel.min_context_length||0))]),t._v(" "),e("span",[t._v(t._s(t.currentModel.max_context_length||2048))])])],1),t._v(" "),e("div",{staticClass:"parameter-item-content"},[e("div",{staticClass:"parameter-header"},[e("span",[t._v(t._s(t.$t("MaxMessage")))])]),t._v(" "),e("AiChatCustomSlider",{attrs:{min:t.currentModel.min_message_length||0,max:t.currentModel.max_message_length||2048,step:1,decimal:0},on:{change:t.updateReplyLength},model:{value:t.settingConfig.replyLength,callback:function(e){t.$set(t.settingConfig,"replyLength",e)},expression:"settingConfig.replyLength"}}),t._v(" "),e("div",{staticClass:"temperature-desc"},[e("span",[t._v(t._s(t.currentModel.min_message_length||0))]),t._v(" "),e("span",[t._v(t._s(t.currentModel.max_message_length||2048))])])],1)])])]),t._v(" "),e("ChatModelPopup",{ref:"chatModelPopup",attrs:{currentModels:t.currentModels,"model-id":t.modelId}})],1)}),[],!1,null,"33654452",null).exports,AiChatReport:O.a,CmtComments:I.default},provide:function(){return{top:this}},inject:["chatIndex"],props:{isCollapsed:{type:Boolean,default:!1}},filters:{formatNumberForeign:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(T.p)(t)}},data:function(){return{showTip:!1,currentModels:[],defaultModelId:"",settings:{},detailData:null,defaultModelName:"deepseek v3 0324",loading:!1,imageLoading:!1,imageLoadTimestamp:Date.now()}},watch:{"chatIndex.characterData":{handler:function(t){var e,n;this.defaultModelId=(null===(e=this.chatIndex)||void 0===e||null===(e=e.characterData)||void 0===e?void 0:e.model_id)||(null===(n=this.chatIndex)||void 0===n||null===(n=n.characterData)||void 0===n||null===(n=n.preset)||void 0===n?void 0:n.model_id)},deep:!0,immediate:!0},"characterInfo.cover.url":{handler:function(t,e){t&&t!==e&&(this.imageLoadTimestamp=Date.now(),this.preloadImage(t))},immediate:!1},defaultModelId:function(t){var e=this.formattedModels.find((function(e){return e.id===t}));t&&e&&(console.log("主站主动去更新模型",e,t),this.$EventBus.$emit(w.b.ST_CHANGE_MODEL,e))}},computed:A(A(A({},Object(l.c)("user",["isLoggedIn"])),Object(l.c)("tavern",["isGenerating"])),{},{characterInfo:function(){var t;return(null===(t=this.chatIndex)||void 0===t?void 0:t.detailData)||this.detailData||{}},viewCount:function(){var t=this.characterInfo.stat||{},e=t.num_of_token,n=void 0===e?0:e,o=t.num_of_view,r=void 0===o?0:o,l=r;return r||(l=Math.floor(n*(1/4+Math.random()*(1/4-.2)))),l},formattedModels:function(){var t,e=this;return null!==(t=this.settings)&&void 0!==t&&t.model_config?this.currentModels.map((function(t){var n,o,r=e.settings.model_config[t.id];return A(A({},t),{},{openai_max_context:null!==(n=null==r?void 0:r.openai_max_context)&&void 0!==n?n:t.default_context_length,openai_max_tokens:null!==(o=null==r?void 0:r.openai_max_tokens)&&void 0!==o?o:t.default_message_length})})):Object(C.a)(this.currentModels)},optimizedImageUrl:function(){var t,e=null===(t=this.characterInfo)||void 0===t||null===(t=t.cover)||void 0===t?void 0:t.url;if(!e)return"";var n=e.includes("?")?"&":"?";return"".concat(e).concat(n,"_t=").concat(this.imageLoadTimestamp)},imageKey:function(){var t;return"".concat((null===(t=this.characterInfo)||void 0===t?void 0:t.id)||"default","-").concat(this.imageLoadTimestamp)}}),mounted:function(){this.pageInit()},methods:{pageInit:function(){var t=this;this.$EventBus.$on(w.b.ST_SETTING,(function(data){console.log("ST_SETTING",data)})),this.$EventBus.$on(w.b.ST_MODEL_LIST,(function(data){t.currentModels=data;var e={};e=t.defaultModelId?t.formattedModels.find((function(e){return e.id===t.defaultModelId})):t.formattedModels.find((function(e){return e.name===t.defaultModelName})),console.log("主站主动去更新模型",e,t.defaultModelId),t.$EventBus.$emit(w.b.ST_CHANGE_MODEL,e)})),this.$EventBus.$on(w.b.ST_SETTINGS_LOADED,(function(data){console.log("ST_SETTINGS_LOADED",data),t.settings=data})),this.$EventBus.$on(w.b.ST_CHANGE_CHARACTER,(function(data){t.getCharacterDetail(data)})),this.$EventBus.$on(w.b.ST_CHANGE_MODEL,(function(e){null!=e&&e.id&&(t.defaultModelId=e.id)}))},pageDestroy:function(){document.removeEventListener("click",this.hideReportTip),this.$EventBus.$off(w.b.ST_MODEL_LIST),this.$EventBus.$off(w.b.ST_SETTINGS_LOADED),this.$EventBus.$off(w.b.ST_CHANGE_CHARACTER)},getCharacterDetail:function(t){var e=this;console.log("获取角色卡详情",t),this.loading=!0;var data={card_id:t.name};Object(S.a)({url:"/api/v1/tavern-pro/detail",method:"post",data:data}).then((function(t){var n,o;if(null!==(n=t.data)&&void 0!==n&&n.id){var r="/tavern/".concat(t.data.id);history.replaceState(null,"",r),e.detailData=t.data,e.$store.dispatch("tavern/setCurrentCharacter",t.data),e.preloadImage(null===(o=t.data)||void 0===o||null===(o=o.cover)||void 0===o?void 0:o.url),e.chatIndex.getConfigData(t.data.id).then((function(t){var n,o=t.model_id||(null===(n=t.preset)||void 0===n?void 0:n.model_id);e.$EventBus.$emit(w.b.ST_CHANGE_MODEL,e.formattedModels.find((function(t){return t.id===o})))})),e.loading=!1}}))},preloadImage:function(t){var e=this;if(t){this.imageLoading=!0;var img=new Image;img.onload=function(){e.imageLoadTimestamp=Date.now(),e.imageLoading=!1},img.onerror=function(){console.warn("角色头像预加载失败:",t),e.imageLoading=!1},img.src=t}},onImageLoad:function(){this.imageLoading=!1},onImageError:function(){this.imageLoading=!1,console.warn("角色头像加载失败:",this.optimizedImageUrl)},toggleCollapse:function(){this.$emit("toggle-collapse",!this.isCollapsed)},openSetting:function(){this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-chat-setting-btn-click",entity_type:"sillyTavern-chat-room"}),this.$refs.chatSetting.show()},share:function(){var t=location.host+this.localePath("/tavern/".concat(this.$route.params.id));Object(T.g)(t),this.$message.success(this.$t("CopiedURLToClipboard"))},openReport:function(){var t;null===(t=this.$refs.aiChatReport)||void 0===t||t.open()},handleShowTip:function(t){var e=this;t.stopPropagation(),this.showTip||(this.showTip=!0,setTimeout((function(){document.addEventListener("click",e.hideReportTip)}),0))},hideReportTip:function(t){t&&t.target.closest(".report-tip")||(this.showTip=!1,document.removeEventListener("click",this.hideReportTip))}},beforeDestroy:function(){this.pageDestroy()}},B=F,V=(n(4043),Object(v.a)(B,(function(){var t,e,n,o=this,r=o._self._c;return r("div",{staticClass:"sidebar",class:{"is-collapsed":o.isCollapsed},on:{dblclick:function(t){t.stopPropagation()}}},[r("div",{staticClass:"sidebar-header"},[r("div",{staticClass:"collapse-button",on:{click:o.toggleCollapse}},[r("i",{staticClass:"iconfont icon-a-arrowleft"})])]),o._v(" "),r("div",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],staticClass:"sidebar-content"},[r("div",{staticClass:"comment-drawer-info"},[r("div",{staticClass:"image-container"},[r("img",{key:o.imageKey,staticClass:"comment-drawer-info-left",class:{"image-loading":o.imageLoading},attrs:{src:o.optimizedImageUrl,alt:null===(t=o.characterInfo)||void 0===t?void 0:t.name},on:{load:o.onImageLoad,error:o.onImageError}}),o._v(" "),o.imageLoading?r("div",{staticClass:"image-loader"},[r("i",{staticClass:"el-icon-loading"})]):o._e()]),o._v(" "),r("div",{staticClass:"comment-drawer-info-right"},[r("h1",{staticClass:"name"},[o._v(o._s(null===(e=o.characterInfo)||void 0===e?void 0:e.name))]),o._v(" "),r("div",{staticClass:"chat-bumber"},[r("i",{staticClass:"iconfont icon-users-solid"}),o._v(" "),r("span",[o._v(o._s(o._f("formatNumberForeign")(null===(n=o.characterInfo)||void 0===n||null===(n=n.stat)||void 0===n?void 0:n.num_of_token)))])])])]),o._v(" "),r("div",{staticClass:"comment-drawer-2"},[r("span",{staticClass:"comment-btn"},[r("i",{staticClass:"iconfont icon-browse"}),o._v(" "),r("span",{staticClass:"comment-btn-text"},[o._v(o._s(o._f("formatNumberForeign")(o.viewCount)))])]),o._v(" "),r("span",{staticClass:"comment-btn",on:{click:o.share}},[r("i",{staticClass:"iconfont icon-icon_share"}),o._v(" "),r("span",{staticClass:"comment-btn-text"},[o._v(o._s(o.$t("Share")))])]),o._v(" "),r("span",{staticClass:"comment-btn",on:{click:function(t){return t.stopPropagation(),o.handleShowTip.apply(null,arguments)}}},[r("i",{staticClass:"iconfont icon-more"}),o._v(" "),o.showTip?r("div",{staticClass:"report-tip",on:{click:function(t){return t.stopPropagation(),o.openReport.apply(null,arguments)}}},[r("i",{staticClass:"iconfont icon-icon_report"}),o._v(" "),r("span",[o._v(o._s(o.$t("Report")))])]):o._e()])]),o._v(" "),r("div",{staticClass:"comment-drawer-divider"}),o._v(" "),r("div",{staticClass:"comment-drawer-setting-item chat-setting-btn",class:{"disable-click":o.isGenerating},on:{click:o.openSetting}},[r("i",{staticClass:"iconfont icon-icons-setting1"}),o._v(" "),r("span",[o._v(o._s(o.$t("characterSettingChat")))])]),o._v(" "),r("div",{staticClass:"comment-drawer-content"},[r("CmtComments",{staticClass:"ai-chat-comments dot-group",attrs:{infos:o.characterInfo,type:76}})],1)]),o._v(" "),r("client-only",[r("ChatSetting",{ref:"chatSetting",attrs:{"model-id":o.defaultModelId,"current-models":o.formattedModels}}),o._v(" "),r("AiChatReport",{ref:"aiChatReport",attrs:{skipRequest:!0}})],1)],1)}),[],!1,null,"df7cea9e",null)),U=V.exports;installComponents(V,{CmtComments:n(116).default});var H=n(380),z=n.n(H);function W(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?W(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var K={name:"TavernChatRoom",components:{ChatHead:f,ChatLeft:y,ChatCenter:$,ChatRight:U,Loading:d.a,StCustomConfirm:c.a},provide:function(){return{chatIndex:this}},computed:G(G({},Object(l.c)("tavern",["currentCharacter","currentConfig","isDialogVisible","isDialogLoading"])),{},{characterId:function(){var t;return(null===(t=this.currentCharacter)||void 0===t?void 0:t.id)||this.$route.params.id},characterData:function(){return this.currentConfig||{}},detailData:function(){return this.currentCharacter||{}}}),watch:{isDialogVisible:{handler:function(t){var e;(console.log("角色切换-isDialogVisible",t,this.isDialogLoading),t&&this.isDialogLoading)||(null===(e=this.$refs.loadingComponent)||void 0===e||e.completeLoading())}},isDialogLoading:{handler:function(t){var e;t||(console.log("角色切换完成，关闭loading页面"),null===(e=this.$refs.loadingComponent)||void 0===e||e.completeLoading())}}},data:function(){return{leftCollapsed:!1,rightCollapsed:!1,handleToggle:!0,debounceFn:null}},mounted:function(){this.initEvent(),document.addEventListener("keydown",this.handleKeyDown),this.debounceFn=z()((function(){var t,mask=null===(t=document)||void 0===t?void 0:t.querySelector(".chat-page-mask");mask&&(mask.style.pointerEvents="auto")}),1e3)},beforeDestroy:function(){this.destroyEvent(),document.removeEventListener("keydown",this.handleKeyDown)},methods:{handleEditChatDone:function(){this.$refs.aiChatLeft.hideEditChatDialog()},handleKeyDown:function(t){"Escape"===t.key&&this.closeDialog()},closeDialog:function(){this.$store.dispatch("tavern/hideChatDialog")},goBack:function(){this.isDialogVisible?this.closeDialog():this.$router.go(-1)},getConfigData:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$axios.$post("/api/v1/tavern-pro/config",{id:t||e.$route.params.id});case 3:return o=n.sent,e.$store.dispatch("tavern/setCurrentConfig",o.data),n.abrupt("return",o.data);case 8:n.prev=8,n.t0=n.catch(0),console.log("重新获取tavern-pro/config数据失败",n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},openNsfw:function(t){t&&this.$refs.stCustomConfirm.openDialog(t)},openLeft:function(){this.leftCollapsed=!1},openRight:function(){this.rightCollapsed=!1},handleLeftToggle:function(t){this.leftCollapsed=t},handleRightToggle:function(t){this.rightCollapsed=t},handleDoubleClick:function(t){console.log("handleDoubleClick",t),window.getSelection().removeAllRanges(),t.preventDefault(),t.target.closest(".sidebar")||(this.leftCollapsed||this.rightCollapsed?(this.leftCollapsed=!1,this.rightCollapsed=!1):(this.leftCollapsed=!0,this.rightCollapsed=!0),this.handleToggle=!1)},initEvent:function(){var t=this;this.$EventBus.$on(w.b.ST_HIDE_LOADER,(function(){t.$refs.loadingComponent.completeLoading()}))},destroyEvent:function(){this.$EventBus.$off(w.b.ST_HIDE_LOADER)},handleClickMask:function(t){this.$message.warning(this.$t("st_loading_notice01")),t.preventDefault(),t.stopPropagation()},handleWheelPassthrough:function(t){var mask=t.target;mask.style.pointerEvents="none";var e=document.elementFromPoint(t.clientX,t.clientY);if(mask.style.pointerEvents="auto",e)if("IFRAME"===e.tagName)this.handleIframeScroll(e,t);else{var n=this.findScrollableAncestor(e);n&&this.simulateScroll(n,t.deltaX,t.deltaY)}t.preventDefault(),t.stopPropagation()},findScrollableAncestor:function(element){for(var t=element;t&&t!==document.body&&t!==document.documentElement;){var e=window.getComputedStyle(t),n=e.overflowY,o=e.overflowX,r=("scroll"===n||"auto"===n)&&t.scrollHeight>t.clientHeight,l=("scroll"===o||"auto"===o)&&t.scrollWidth>t.clientWidth;if(r||l)return t;t=t.parentElement}return document.scrollingElement||document.documentElement},simulateScroll:function(element,t,e){var n=1*t,o=1*e;element===document.documentElement||element===document.body?window.scrollBy(n,o):(element.scrollLeft+=n,element.scrollTop+=o)},handleIframeScroll:function(iframe,t){try{var e=iframe.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;if(n>=0&&n<=e.width&&o>=0&&o<=e.height&&iframe.contentWindow){var r=new WheelEvent("wheel",{deltaX:t.deltaX,deltaY:t.deltaY,deltaZ:t.deltaZ,deltaMode:t.deltaMode,bubbles:!0,cancelable:!0,clientX:n,clientY:o,view:iframe.contentWindow});iframe.contentDocument?iframe.contentDocument.dispatchEvent(r):iframe.contentWindow.scrollBy(t.deltaX,t.deltaY)}}catch(t){console.warn("无法处理 iframe 滚动，可能是跨域限制:",t),this.trySimulateMouseEvents()}},trySimulateMouseEvents:function(){var t,mask=null===(t=document)||void 0===t?void 0:t.querySelector(".chat-page-mask");mask&&(mask.style.pointerEvents="none"),this.debounceFn()}}},Y=(n(4044),Object(v.a)(K,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat-page",class:{"left-collapsed":t.leftCollapsed,"right-collapsed":t.rightCollapsed},on:{dblclick:t.handleDoubleClick}},[e("ChatHead",{attrs:{leftCollapsed:t.leftCollapsed,rightCollapsed:t.rightCollapsed},on:{openLeft:t.openLeft,openRight:t.openRight}}),t._v(" "),e("ChatLeft",{ref:"aiChatLeft",attrs:{"is-collapsed":t.leftCollapsed},on:{"toggle-collapse":t.handleLeftToggle}}),t._v(" "),e("ChatCenter",{on:{editChatDone:t.handleEditChatDone}}),t._v(" "),e("ChatRight",{ref:"aiChatRight",attrs:{"is-collapsed":t.rightCollapsed},on:{"toggle-collapse":t.handleRightToggle}}),t._v(" "),e("Loading",{ref:"loadingComponent"}),t._v(" "),e("StCustomConfirm",{ref:"stCustomConfirm"}),t._v(" "),t.isDialogLoading?e("div",{staticClass:"chat-page-mask",on:{click:t.handleClickMask,wheel:t.handleWheelPassthrough}}):t._e()],1)}),[],!1,null,"bc38303c",null));e.default=Y.exports},3432:function(t,e,n){"use strict";n(11),n(72),n(16),n(18),n(6),n(12),n(13);var o=n(14),r=n(3),l=n(2),c=(n(20),n(19),n(32),n(22),n(31),n(49),n(306),n(307),n(8),n(4),n(28),n(21),n(44),n(90),n(350),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(7),n(41),n(1)),d=n(9),m=n(10),v=n(51),f=n(211),h=n(35),_=n.n(h),y=n(38),C=n(580);function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var k={name:"PublishStRoleDialog",components:{StarLine:n(617).a},computed:x(x({},Object(c.c)("user",["isLoggedIn"])),{},{sendParams:function(){var t,e,n,o,r=this,l=""===this.formData.recommend_preset?null:null===(t=this.presetList)||void 0===t?void 0:t.find((function(t){return t.value===r.formData.recommend_preset}));return{png_height:(null===(e=this.formData.avatar)||void 0===e?void 0:e.height)||null,png_width:(null===(n=this.formData.avatar)||void 0===n?void 0:n.width)||null,png_url:(null===(o=this.formData.avatar)||void 0===o?void 0:o.url)||null,recommend_preset:l||null,model_id:this.formData.model_id||null,tags:this.formData.tags||null}},optionItems:function(){return[{key:"worldBook",label:"ST_Detailed_book",value:this.hasWorldBook},{key:"regular",label:"ST_Regular",value:this.hasRegular},{key:"quickReply",label:"ST_Quick_Reply",value:this.hasReply}]},hasWorldBook:function(){var t;return(null===(t=this.formData.data)||void 0===t||null===(t=t.character_book)||void 0===t||null===(t=t.entries)||void 0===t?void 0:t.length)||!1},hasRegular:function(){var t,e;return(null===(t=this.formData.data)||void 0===t||null===(t=t.extensions)||void 0===t?void 0:t.regex_scripts)&&(null===(e=this.formData.data)||void 0===e||null===(e=e.extensions)||void 0===e?void 0:e.regex_scripts.length)||!1},hasReply:function(){var t,e;return(null===(t=this.formData)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.alternate_greetings)&&(null===(e=this.formData)||void 0===e||null===(e=e.data)||void 0===e||null===(e=e.alternate_greetings)||void 0===e?void 0:e.length)||!1},getLangCode:function(){var t=this.$i18n.locale;return"zhTW"===t?"zh_tw":"zhCN"===t?"zh_cn":t||"en"}}),data:function(){return{EMOJI_ENUM_ST:d.f,loading:!1,UPLOAD:new v.a({type:2}),submitLoading:!1,modelList:[{label:"--None--",value:""}],presetList:[{label:"--None--",value:""}],tagList:[],dialogVisible:!1,currentStep:1,formData:{recommend_preset:"",model_id:"",avatar:"",name:"",first_mes:"",description:"",creatorcomment:"",tags:[],data:{name:"",description:"",creatorcomment:"",alternate_greetings:[],character_book:{},extensions:{regex_scripts:[]}}},formRules:{tags:[{type:"array",required:!0,message:this.$t("tavern55",{number:1}),trigger:"change"}],creatorcomment:[{required:!0,message:this.$t("ST_Input_Evaluate"),trigger:"blur"},{validator:this.validateCreatorComment,trigger:"blur"}]}}},methods:{formatMsgForStCard:f.b,innitData:function(){this.initTags(),this.initModels(),this.initPresets()},submit:function(){var t=this;this.$refs.publishForm.validate((function(e){if(e){t.submitLoading=!0;try{var n=_()(t.sendParams);Object.keys(n).forEach((function(t){null!==n[t]&&n[t]||delete n[t]})),Object(y.P)(n).then((function(e){e.data;1e4===e.status.code&&(t.$message.success(t.$t("publish_success")),t.dialogVisible=!1)})).catch((function(e){t.$message.error(t.$t("publish_failed"))})).finally((function(){t.submitLoading=!1}))}catch(e){t.submitLoading=!1}}else t.$message.error(t.$t("tavern33"))}))},initModels:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,data,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(y.E)({page:1,page_size:100,has_category:0});case 3:n=e.sent,data=n.data,1e4===n.status.code&&(t.modelList=null!==(o=data.items)&&void 0!==o&&o.length?data.items.map((function(t){return{label:t.name,value:t.id}})):[],t.modelList.unshift({label:"--None--",value:""})),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),t.modelList=[{label:"--None--",value:""}];case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},initPresets:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,data,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoggedIn){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Object(y.F)({page:1,page_size:100,has_category:0});case 5:n=e.sent,data=n.data,1e4===n.status.code&&(t.presetList=null!==(o=data.items)&&void 0!==o&&o.length?data.items.map((function(e){return x(x({},e),{},{label:e.title[t.getLangCode]||e.title.en,value:e.id})})):[],t.presetList.unshift({label:"--None--",value:""})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0),t.presetList=[{label:"--None--",value:""}];case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))()},initTags:function(){var t=this;Object(C.a)({show_areas:["tavern-pro-all"],lang:this.$i18n.locale||"en"}).then((function(e){var data=(e.data||{})["tavern-pro-all"];t.tagList=data.map((function(e){return{value:e.id,label:Object(d.f)(e.id)?"".concat(Object(d.f)(e.id)," ").concat(e[t.getLangCode]):e[t.getLangCode],type:e.type}}))}))},openDialog:function(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dialogVisible=!0,this.currentStep=1,this.innitData(),this.handlePublishData(data),this.$xyLogEvent({front_operation:"exposure",entity_name:"sillyTavern-publish-dialog-step1",entity_type:"sillyTavern-publish-dialog"})},handlePublishData:function(){var t=this,data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0;var e=data.pngData,n=void 0===e?{}:e,o=data.jsonData,r=void 0===o?{}:o;if(n.data&&"string"==typeof n.data&&n.data.startsWith("data:image/png;base64,")&&Object.keys(r).length>0){var l=Object(m.d)(n.data);this.UPLOAD.startUpload(l,{name:"st-publish-".concat(Date.now(),".png"),type:"png",isRedirection:!0,sub_category:1}).then((function(e){e&&(t.formData=x(x(x({},t.formData),r),{avatar:{url:e,height:null==n?void 0:n.height,width:null==n?void 0:n.width}}))})).finally((function(){t.loading=!1}))}},handleClose:function(){this.dialogVisible=!1,this.$refs.publishForm.resetFields(),this.resetForm()},resetForm:function(){this.currentStep=1,this.formData={recommend_preset:"",model_id:"",avatar:"",first_mes:"",name:"",description:"",creatorcomment:"",tags:[],data:{name:"",description:"",creatorcomment:"",alternate_greetings:[],character_book:{},extensions:{regex_scripts:[]}}}},handleTagSelect:function(t){t&&!this.formData.tags.includes(t)&&this.formData.tags.push(t)},handleTagClose:function(t){var e=this.formData.tags.indexOf(t);e>-1&&this.formData.tags.splice(e,1)},handlePublish:function(){console.log("发布数据:",this.formData),this.$emit("publish",this.formData),this.handleClose()},validateCreatorComment:function(t,e,n){e&&e.length>3e3?n(new Error(this.$t("audio_for_textlength"))):n()},validateStepOne:function(){var t=this;this.$refs.publishForm.validate((function(e){e&&(t.currentStep=2,t.$xyLogEvent({front_operation:"exposure",entity_name:"sillyTavern-publish-dialog-step2",entity_type:"sillyTavern-publish-dialog"}))}))},parseCharacterCardFromPNG:function(t){try{for(var e=t.replace(/^data:image\/png;base64,/,""),n=atob(e),o=new Uint8Array(n.length),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);var r=this.extractCharacterInfoFromPNG(o);r?(console.log("解析到的角色卡信息:",r),this.fillFormWithCharacterInfo(r)):console.log("未在PNG中找到角色卡信息")}catch(t){console.error("解析PNG角色卡信息失败:",t)}},extractCharacterInfoFromPNG:function(t){try{for(var e=[137,80,78,71,13,10,26,10],i=0;i<8;i++)if(t[i]!==e[i])throw new Error("不是有效的PNG文件");for(var n=8;n<t.length-8;){var o=t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3];n+=4;var r=String.fromCharCode(t[n],t[n+1],t[n+2],t[n+3]);if(n+=4,"tEXt"===r||"zTXt"===r||"iTXt"===r){var l=t.slice(n,n+o),c=this.parseTextChunk(l,r);if(c&&("chara"===c.keyword||"character"===c.keyword||"Character"===c.keyword||"parameters"===c.keyword||c.text.includes('"name"')||c.text.includes('"description"')))try{return JSON.parse(c.text)}catch(t){try{console.log("尝试解码base64数据, keyword:",c.keyword);var d=atob(c.text);return console.log("解码后的文本:",d),JSON.parse(d)}catch(t){return console.log("找到角色卡文本数据但无法解析:",c),{rawText:c.text,keyword:c.keyword}}}}if(n+=o+4,"IEND"===r)break}return null}catch(t){return console.error("提取PNG信息失败:",t),null}},parseTextChunk:function(data,t){try{if("tEXt"===t){var e=data.indexOf(0);return-1===e?null:{keyword:String.fromCharCode.apply(String,Object(o.a)(data.slice(0,e))),text:String.fromCharCode.apply(String,Object(o.a)(data.slice(e+1)))}}if("zTXt"===t){var n=data.indexOf(0);if(-1===n)return null;var r=String.fromCharCode.apply(String,Object(o.a)(data.slice(0,n)));if(0===data[n+1])return{keyword:r,text:"[压缩数据，需要解压缩]",compressedData:data.slice(n+2)}}else if("iTXt"===t){var l=0,c=data.indexOf(0,l);if(-1===c)return null;var d=String.fromCharCode.apply(String,Object(o.a)(data.slice(l,c)));data[l=c+1],data[l+=1];l+=1;var m=data.indexOf(0,l);if(-1===m)return null;var v=String.fromCharCode.apply(String,Object(o.a)(data.slice(l,m)));l=m+1;var f=data.indexOf(0,l);if(-1===f)return null;var h=String.fromCharCode.apply(String,Object(o.a)(data.slice(l,f)));return l=f+1,{keyword:d,text:String.fromCharCode.apply(String,Object(o.a)(data.slice(l))),languageTag:v,translatedKeyword:h}}return null}catch(t){return console.error("解析文本chunk失败:",t),null}},fillFormWithCharacterInfo:function(t){var e=this;try{if(console.log("开始填充表单，角色卡信息:",t),t.rawText&&!t.name)try{t=JSON.parse(atob(t.rawText)),console.log("从rawText解析出的数据:",t)}catch(t){console.log("无法从rawText解析数据:",t)}t.name&&(this.formData.name=t.name,console.log("设置name:",t.name)),t.description&&(this.formData.description=t.description,console.log("设置description:",t.description)),t.personality&&(this.formData.personality=t.personality,console.log("设置personality:",t.personality)),t.scenario&&(this.formData.scenario=t.scenario,console.log("设置scenario:",t.scenario)),t.first_mes&&(this.formData.first_mes=t.first_mes,console.log("设置first_mes:",t.first_mes)),t.mes_example&&(this.formData.mes_example=t.mes_example,console.log("设置mes_example:",t.mes_example)),t.system_prompt&&(this.formData.system_prompt=t.system_prompt),t.post_history_instructions&&(this.formData.post_history_instructions=t.post_history_instructions),t.rawText&&console.log("原始角色卡文本长度:",t.rawText.length),this.$nextTick((function(){e.$forceUpdate()})),this.$message.success("成功从PNG中导入角色卡信息")}catch(t){console.error("填充表单数据失败:",t),this.$message.error("解析角色卡信息失败")}}}},D=k,$=(n(4045),n(4046),n(0)),component=Object($.a)(D,(function(){var t,e=this,n=e._self._c;return n("el-dialog",{attrs:{visible:e.dialogVisible,width:"820px","custom-class":"role-release-dialog","close-on-click-modal":!1,"show-close":!0,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[n("div",{staticClass:"dialog-wrapper"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dialog-content",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.5)"}},[n("div",{staticClass:"star-box"},[n("img",{attrs:{src:"https://image.cdn2.seaart.me/tavern/loading/star.webp",alt:"seaart"}})]),e._v(" "),n("div",{staticClass:"step-header"},[2===e.currentStep?n("div",{staticClass:"back-btn",on:{click:function(t){e.currentStep=1}}},[n("i",{staticClass:"el-icon-arrow-left"})]):e._e(),e._v(" "),n("h2",{staticClass:"dialog-title"},[e._v(e._s(e.$t("ST_Role_Publish")))]),e._v(" "),n("span",{staticClass:"close-icon",on:{click:e.handleClose}},[n("i",{staticClass:"el-icon-close"})])]),e._v(" "),n("div",{staticClass:"content-box"},[n("div",{staticClass:"left-section"},[n("div",{staticClass:"img-box"},[e.formData.avatar?n("img",{attrs:{src:null===(t=e.formData.avatar)||void 0===t?void 0:t.url,alt:"SeaArt.AI"}}):e._e()]),e._v(" "),e.formData.name?n("div",{staticClass:"name-box"},[n("img",{staticClass:"loading-header-star",attrs:{src:"https://image.cdn2.seaart.me/tavern/loading/loading-star.webp",alt:"seaart"}}),e._v(" "),n("div",{staticClass:"name-box-title"},[n("span",[e._v(e._s(e.formData.name))])]),e._v(" "),n("img",{staticClass:"loading-header-star-right",attrs:{src:"https://image.cdn2.seaart.me/tavern/loading/loading-star-2.webp",alt:"seaart"}})]):e._e()]),e._v(" "),n("div",{staticClass:"right-section"},[n("el-form",{ref:"publishForm",attrs:{model:e.formData,rules:e.formRules,"label-position":"top"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:1===e.currentStep,expression:"currentStep === 1"}],staticClass:"step-one"},[n("el-form-item",{class:{"custom-form-item":!0},attrs:{label:e.$t("ST_Role_Name"),prop:"description"}},[n("div",{staticClass:"display-field"},[e._v("\n                  "+e._s(e.formData.description)+"\n                ")])]),e._v(" "),n("StarLine",{attrs:{starStyle:"",customClass:"star-line-box"}}),e._v(" "),n("el-form-item",{class:{"custom-form-item":!0},attrs:{label:e.$t("ST_Detailed_firstmes"),prop:"first_mes"}},[n("div",{staticClass:"display-field description"},[n("div",{domProps:{innerHTML:e._s(e.formatMsgForStCard(e.formData.first_mes,!1,this))}})])]),e._v(" "),n("StarLine",{attrs:{starStyle:"",customClass:"star-line-box"}}),e._v(" "),n("el-form-item",{class:{"custom-form-item":!0},attrs:{label:e.$t("Tags"),prop:"tags"}},[n("el-select",{attrs:{clearable:"","popper-class":"contribution-publish-el-select-popper",multiple:"","multiple-limit":10,filterable:"","default-first-option":"",placeholder:e.$t("ST_Select_Tag")},scopedSlots:e._u([{key:"empty",fn:function(){return[n("div",{staticClass:"empty-tag"},[e._v("\n                      "+e._s(e.$t("NoResultsFound"))+"\n                    ")])]},proxy:!0}]),model:{value:e.formData.tags,callback:function(t){e.$set(e.formData,"tags",t)},expression:"formData.tags"}},[e._v(" "),e._l(e.tagList,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[n("span",[e._v(e._s(t.label))]),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:[1,"1"].includes(null==t?void 0:t.type),expression:"[1, '1'].includes(item?.type)"}],staticClass:"label-flag"},[e._v(e._s(e.$t("official")))])])}))],2)],1),e._v(" "),n("el-form-item",{class:{"custom-form-item":!0},attrs:{label:e.$t("tavern12"),prop:"creatorcomment"}},[n("el-input",{staticClass:"creator-comment-input",attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},maxlength:3e3,placeholder:e.$t("ST_Input_Evaluate"),resize:"none","show-word-limit":""},model:{value:e.formData.creatorcomment,callback:function(t){e.$set(e.formData,"creatorcomment",t)},expression:"formData.creatorcomment"}})],1)],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:2===e.currentStep,expression:"currentStep === 2"}],staticClass:"step-two"},[n("el-form-item",{class:{"custom-form-item":!0},attrs:{label:e.$t("ST_Rec_Set"),prop:"recommend_preset"}},[n("el-select",{attrs:{"popper-class":"contribution-publish-el-select-popper",placeholder:e.$t("Pls_select")},model:{value:e.formData.recommend_preset,callback:function(t){e.$set(e.formData,"recommend_preset",t)},expression:"formData.recommend_preset"}},e._l(e.presetList,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[n("span",[e._v(e._s(t.label))])])})),1)],1),e._v(" "),n("el-form-item",{class:{"custom-form-item":!0},attrs:{label:e.$t("RecommendedModels"),prop:"model_id"}},[n("el-select",{attrs:{"popper-class":"contribution-publish-el-select-popper",placeholder:e.$t("Pls_select")},model:{value:e.formData.model_id,callback:function(t){e.$set(e.formData,"model_id",t)},expression:"formData.model_id"}},e._l(e.modelList,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[n("span",[e._v(e._s(t.label))])])})),1)],1),e._v(" "),n("div",{staticClass:"options-list"},e._l(e.optionItems,(function(t){return n("div",{key:t.key,staticClass:"option-item"},[n("span",{staticClass:"option-title"},[e._v(e._s(e.$t(t.label)))]),e._v(" "),n("span",{staticClass:"right"},[n("i",{class:[t.value?"el-icon-success":"el-icon-error"]}),e._v(" "),n("span",{staticClass:"option-title"},[e._v(e._s(e.$t(t.value?"included":"not_included")))])])])})),0)],1)])],1)]),e._v(" "),n("div",{staticClass:"step-actions"},[1===e.currentStep?n("el-button",{attrs:{type:"primary"},on:{click:e.validateStepOne}},[e._v(e._s(e.$t("NextStep")))]):e._e(),e._v(" "),2===e.currentStep?n("el-button",{attrs:{type:"primary",disabled:e.submitLoading,loading:e.submitLoading},on:{click:e.submit}},[e._v(e._s(e.$t("ST_publish")))]):e._e()],1)])])])}),[],!1,null,"f07939a4",null);e.a=component.exports},3999:function(t,e,n){"use strict";n(1645)},4026:function(t,e,n){"use strict";n(1667)},4027:function(t,e,n){"use strict";n(1668)},4028:function(t,e,n){"use strict";n(1669)},4032:function(t,e,n){"use strict";n(1673)},4033:function(t,e,n){"use strict";n(1674)},4039:function(t,e,n){"use strict";n(1680)},4041:function(t,e,n){"use strict";n(1682)},4042:function(t,e,n){"use strict";n(1683)},4043:function(t,e,n){"use strict";n(1684)},4044:function(t,e,n){"use strict";n(1685)},4045:function(t,e,n){"use strict";n(1686)},4046:function(t,e,n){"use strict";n(1687)},4088:function(t,e,n){"use strict";n(1729)},4089:function(t,e,n){"use strict";n(1730)},4730:function(t,e,n){"use strict";n(2167)},4856:function(t,e,n){"use strict";n(2294)},4857:function(t,e,n){"use strict";n(2295)},4858:function(t,e,n){"use strict";n(2296)},4859:function(t,e,n){"use strict";n(2297)},4860:function(t,e,n){"use strict";n(2298)},4861:function(t,e,n){"use strict";n(2299)},4863:function(t,e,n){"use strict";n(2301)},4864:function(t,e,n){"use strict";n(2302)},4865:function(t,e,n){"use strict";n(2303)},4866:function(t,e,n){"use strict";n(2304)},4883:function(t,e,n){"use strict";n(2321)},4884:function(t,e,n){"use strict";n(2322)},4885:function(t,e,n){"use strict";n(2323)},4886:function(t,e,n){"use strict";n(2324)},4887:function(t,e,n){"use strict";n(2325)},4888:function(t,e,n){"use strict";n(2326)},4889:function(t,e,n){"use strict";n(2327)},4890:function(t,e,n){"use strict";n(2328)},4891:function(t,e,n){"use strict";n(2329)},4892:function(t,e,n){"use strict";n(2330)},4893:function(t,e,n){"use strict";n(2331)},4894:function(t,e,n){"use strict";n(2332)},4895:function(t,e,n){"use strict";n(2333)},4896:function(t,e,n){"use strict";n(2334)},4897:function(t,e,n){"use strict";n(2335)},4898:function(t,e,n){"use strict";n(2336)},4899:function(t,e,n){"use strict";n(2337)},4900:function(t,e,n){"use strict";n(2338)},4901:function(t,e,n){"use strict";n(2339)},4903:function(t,e,n){"use strict";n(2340)},4904:function(t,e,n){"use strict";n(2341)},4905:function(t,e,n){"use strict";n(2342)},4906:function(t,e,n){"use strict";n(2343)},4907:function(t,e,n){"use strict";n(2344)},4908:function(t,e,n){"use strict";n(2345)},4909:function(t,e,n){"use strict";n(2346)},4910:function(t,e,n){"use strict";n(2347)},4911:function(t,e,n){"use strict";n(2348)},4912:function(t,e,n){"use strict";n(2349)},4913:function(t,e,n){"use strict";n(2350)},4914:function(t,e,n){"use strict";n(2351)},4915:function(t,e,n){"use strict";n(2352)},4917:function(t,e,n){"use strict";n(2354)},4919:function(t,e,n){"use strict";n(2355)},4920:function(t,e,n){"use strict";n(2356)},4951:function(t,e,n){"use strict";n(2387)},4952:function(t,e,n){"use strict";n(2388)},4953:function(t,e,n){"use strict";n(2389)},4954:function(t,e,n){"use strict";n(2390)},4955:function(t,e,n){"use strict";n(2391)},4957:function(t,e,n){"use strict";n(2393)},4958:function(t,e,n){"use strict";n(2394)},4959:function(t,e,n){"use strict";n(2395)},4962:function(t,e,n){"use strict";n(2399)},4963:function(t,e,n){"use strict";n(2400)},4964:function(t,e,n){"use strict";n(2401)},4965:function(t,e,n){"use strict";n(2402)},4966:function(t,e,n){"use strict";n(2403)},4967:function(t,e,n){"use strict";n(2404)},4968:function(t,e,n){"use strict";n(2405)},4969:function(t,e,n){"use strict";n(2406)},4970:function(t,e,n){"use strict";n(2407)},4971:function(t,e,n){"use strict";n(2408)},4978:function(t,e,n){"use strict";n(2415)},4979:function(t,e,n){"use strict";n(2416)},4980:function(t,e,n){"use strict";n(2417)},4981:function(t,e,n){"use strict";n(2418)},4982:function(t,e,n){"use strict";n(2419)},4983:function(t,e,n){"use strict";n(2420)},4984:function(t,e,n){"use strict";n(2421)},5404:function(t,e,n){"use strict";n(2824)},5405:function(t,e,n){"use strict";n(2825)},5406:function(t,e,n){"use strict";n(2826)},5496:function(t,e,n){"use strict";n(2913)},5497:function(t,e,n){"use strict";n(2914)},5498:function(t,e,n){"use strict";n(2915)},5499:function(t,e,n){"use strict";n(2916)},5500:function(t,e,n){"use strict";n(2917)},5501:function(t,e,n){"use strict";n(2918)},5502:function(t,e,n){"use strict";n(2919)},5503:function(t,e,n){"use strict";n(2920)},5504:function(t,e,n){"use strict";n(2921)},5505:function(t,e,n){"use strict";n(2922)},5506:function(t,e,n){"use strict";n(2923)},5507:function(t,e,n){"use strict";n(2924)},5508:function(t,e,n){"use strict";n(2925)},5509:function(t,e,n){"use strict";n(2926)},5510:function(t,e,n){"use strict";n(2927)},5511:function(t,e,n){"use strict";n(2928)},5512:function(t,e,n){"use strict";n(2929)},5513:function(t,e,n){"use strict";n(2930)},5514:function(t,e,n){"use strict";n(2931)},5515:function(t,e,n){"use strict";n(2932)},5516:function(t,e,n){"use strict";n(2933)},5517:function(t,e,n){"use strict";n(2934)},5518:function(t,e,n){"use strict";n(2935)},5519:function(t,e,n){"use strict";n(2936)},5520:function(t,e,n){"use strict";n(2937)},5521:function(t,e,n){"use strict";n(2938)},5522:function(t,e,n){"use strict";n(2939)},5523:function(t,e,n){"use strict";n(2940)},5524:function(t,e,n){"use strict";n(2941)},5724:function(t,e,n){"use strict";n.r(e);var o=n(3),r=(n(20),n(16),n(22),n(18),n(4),n(28),n(43),n(44),n(128)),l=n(10),c=(n(11),n(6),n(12),n(13),n(8),n(2)),d=(n(40),n(7),n(41),n(141),n(142),n(109),n(125)),m=n.n(d),v=n(52),f=n(1);function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y={components:{SwipeableList:v.default},props:{info:{type:Object,default:function(){return{}}},chooseId:{type:String,default:""}},data:function(){return{modelId:this.$route.params.id,itemScroll:null,dayjs:m.a}},computed:_(_({},Object(f.c)("user",["userInfo"])),{},{isUrl:function(){if(!this.info.refer||"string"!=typeof this.info.refer)return!1;try{return new URL(this.info.refer),!0}catch(t){return!1}},isAuthor:function(){var t,e;return(null===(t=this.userInfo)||void 0===t?void 0:t.id)===(null===(e=this.info)||void 0===e||null===(e=e.author)||void 0===e?void 0:e.id)}}),methods:{selectVn:function(t){var e=this;this.$nextTick((function(){e.$refs.listItem.forEach((function(t,n){t.classList.contains("vnActivate")&&(e.itemScroll={value:t.getBoundingClientRect().left,idx:n})}))})),this.$emit("onChange",t)},goToCreationCenter:function(){this.$logEvent("log_actions",{operation:"click_creator_revenue_center",behavior_info:location.href}),this.$router.push("/creationCenter")},onEdit:function(){this.$router.push({path:this.localePath("/modelEditStep"),query:{id:this.info.id,addVersion:!0}})}}},C=(n(4951),n(0)),component=Object(C.a)(y,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex_c max-box",attrs:{"data-group":"model-page-image-info"}},[e("div",{staticClass:"tabs-nav-box"},[e("div",{staticClass:"title-box"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isUrl,expression:"!isUrl"}],staticClass:"original-tag",attrs:{"data-event":"click_type_original"},on:{click:t.goToCreationCenter}},[e("svg-icon",{attrs:{"icon-class":"modelOriginal"}}),t._v(" "),e("div",{staticClass:"txt"},[t._v(t._s(t.$t("Original")+" - "+t.$t("motivatingTitle")))])],1),t._v(" "),e("h1",{staticClass:"title"},[t._v(t._s(t.info.name))])]),t._v(" "),e("div",{staticClass:"flex_m tab-version"},[e("div",{staticClass:"left flex_m"},[t.isAuthor?e("i",{staticClass:"iconfont icon-icon-release",on:{click:t.onEdit}}):t._e(),t._v(" "),e("SwipeableList",{staticClass:"w-full",attrs:{scrollChange:t.itemScroll,iconBntWidth:20,top:"0px"}},[e("div",{staticClass:"vnList"},t._l(t.info.model_ver_nos,(function(n,o){return e("div",{key:o,ref:"listItem",refInFor:!0,staticClass:"vnItem",class:{vnActivate:t.chooseId===n.id},on:{click:function(e){return t.selectVn(n)}}},[t._v("\n              "+t._s(n.version_name)+"\n            ")])})),0)])],1),t._v(" "),e("div",{staticClass:"right"},[t.isUrl?e("div",{staticClass:"modelType"},[e("svg-icon",{attrs:{"icon-class":"modelReship"}}),t._v(" "),e("span",[t._v(t._s(t.$t("Reship")))])],1):t._e(),t._v(" "),e("div",{staticClass:"last-update"},[t._v(t._s(t.$t("LastUpdate"))+"："+t._s(t.dayjs(t.info.update_at).format("YYYY-MM-DD")))])])])])])}),[],!1,null,"cc4206a4",null),w=component.exports;installComponents(component,{SvgIcon:n(115).default,SwipeableList:n(52).default});var x=n(14),k=(n(31),{props:{imageId:{type:String,default:""},visible:{type:Boolean,default:!1}},data:function(){return{info:{},loading:!1,hasLoaded:!1}},computed:{isShowAdvancedConfig:function(){var t,e,n,o,r,l,c;return(null===(t=this.info)||void 0===t||null===(t=t.origin_meta)||void 0===t?void 0:t.width)&&(null===(e=this.info)||void 0===e||null===(e=e.origin_meta)||void 0===e?void 0:e.height)&&(null===(n=this.info)||void 0===n||null===(n=n.origin_meta)||void 0===n?void 0:n.cfg_scale)&&(null===(o=this.info)||void 0===o||null===(o=o.origin_meta)||void 0===o?void 0:o.steps)&&(null===(r=this.info)||void 0===r||null===(r=r.origin_meta)||void 0===r?void 0:r.seed)&&(null===(l=this.info.origin_meta)||void 0===l?void 0:l.sampler_name)&&(null===(c=this.info.origin_meta)||void 0===c?void 0:c.vae)}},methods:{getImageMeta:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,Object(r.b)({id:t.imageId,scene:"model_detail_v2"});case 3:1e4===(n=e.sent).status.code&&(t.info=n.data,t.hasLoaded=!0),t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},copyField:function(t){var e;Object(l.g)(null===(e=this.info)||void 0===e||null===(e=e.origin_meta)||void 0===e?void 0:e[t]),this.$message.success(this.$t("CopySuccess"))},handleRemix:function(){this.$emit("remix",this.info)}},watch:{visible:function(t){t&&!this.hasLoaded&&this.getImageMeta()}}}),D=(n(4952),{components:{ImageMeta:Object(C.a)(k,(function(){var t,e,n,o,r,l,c,d,m,v,f,h,_,y,C,w,x,k,D,$,T,O,I=this,S=I._self._c;return S("div",{directives:[{name:"loading",rawName:"v-loading",value:I.loading,expression:"loading"}],staticClass:"image-meta"},[null!==(t=I.info)&&void 0!==t&&null!==(t=t.origin_meta)&&void 0!==t&&t.prompt?S("div",{staticClass:"image-meta-item"},[S("div",{staticClass:"image-meta-item-title"},[I._v("\n      "+I._s(I.$t("Prompt"))+"\n      "),S("i",{staticClass:"iconfont icon-codeCopy1",on:{click:function(t){return I.copyField("prompt")}}})]),I._v(" "),null!==(e=I.info)&&void 0!==e&&null!==(e=e.origin_meta)&&void 0!==e&&e.prompt?S("div",{staticClass:"image-meta-item-content"},[I._v("\n      "+I._s(null===(n=I.info)||void 0===n||null===(n=n.origin_meta)||void 0===n?void 0:n.prompt)+"\n    ")]):I._e()]):I._e(),I._v(" "),null!==(o=I.info)&&void 0!==o&&null!==(o=o.origin_meta)&&void 0!==o&&o.negative_prompt?S("div",{staticClass:"image-meta-item"},[S("div",{staticClass:"image-meta-item-title"},[I._v("\n      "+I._s(I.$t("NegativePrompts"))+"\n      "),S("i",{staticClass:"iconfont icon-codeCopy1",on:{click:function(t){return I.copyField("negative_prompt")}}})]),I._v(" "),null!==(r=I.info)&&void 0!==r&&null!==(r=r.origin_meta)&&void 0!==r&&r.negative_prompt?S("div",{staticClass:"image-meta-item-content"},[I._v("\n      "+I._s(null===(l=I.info)||void 0===l||null===(l=l.origin_meta)||void 0===l?void 0:l.negative_prompt)+"\n    ")]):I._e()]):I._e(),I._v(" "),null!==(c=I.info)&&void 0!==c&&null!==(c=c.used_models)&&void 0!==c&&c.length?S("div",{staticClass:"image-models"},I._l(null===(d=I.info)||void 0===d?void 0:d.used_models,(function(t){var e;return S("div",{key:t.id,staticClass:"image-models-item"},[S("div",{staticClass:"model-cover"},[S("img",{attrs:{src:null==t||null===(e=t.banner)||void 0===e?void 0:e.url,alt:"model-cover"}})]),I._v(" "),S("div",{staticClass:"model-desc"},[S("div",{staticClass:"model-type"},[I._v("\n          "+I._s("TextualInversion"===(null==t?void 0:t.model_type)?"Embedding":"LoCon"===(null==t?void 0:t.model_type)?"LyCORIS":null==t?void 0:t.model_type)+"\n        ")]),I._v(" "),S("div",{staticClass:"model-name"},[I._v("\n          "+I._s(t.name)+"\n        ")])])])})),0):I._e(),I._v(" "),I.isShowAdvancedConfig?S("div",{staticClass:"image-advanced-config"},[null!==(m=I.info)&&void 0!==m&&null!==(m=m.origin_meta)&&void 0!==m&&m.width&&null!==(v=I.info)&&void 0!==v&&null!==(v=v.origin_meta)&&void 0!==v&&v.height?S("div",{staticClass:"image-advanced-config-item"},[S("span",{staticClass:"image-advanced-config-item-key"},[I._v(I._s(I.$t("Size"))+" ")]),I._v(" "),S("span",{staticClass:"image-advanced-config-item-value"},[I._v(I._s(null===(f=I.info)||void 0===f||null===(f=f.origin_meta)||void 0===f?void 0:f.width)+" x "+I._s(null===(h=I.info)||void 0===h||null===(h=h.origin_meta)||void 0===h?void 0:h.height))])]):I._e(),I._v(" "),null!==(_=I.info)&&void 0!==_&&null!==(_=_.origin_meta)&&void 0!==_&&_.cfg_scale?S("div",{staticClass:"image-advanced-config-item"},[S("span",{staticClass:"image-advanced-config-item-key"},[I._v(I._s(I.$t("CFGScale"))+" ")]),I._v(" "),S("span",{staticClass:"image-advanced-config-item-value"},[I._v(I._s(null===(y=I.info)||void 0===y||null===(y=y.origin_meta)||void 0===y?void 0:y.cfg_scale))])]):I._e(),I._v(" "),null!==(C=I.info)&&void 0!==C&&null!==(C=C.origin_meta)&&void 0!==C&&C.steps?S("div",{staticClass:"image-advanced-config-item"},[S("span",{staticClass:"image-advanced-config-item-key"},[I._v(I._s(I.$t("Steps"))+" ")]),I._v(" "),S("span",{staticClass:"image-advanced-config-item-value"},[I._v(I._s(null===(w=I.info)||void 0===w||null===(w=w.origin_meta)||void 0===w?void 0:w.steps))])]):I._e(),I._v(" "),null!==(x=I.info)&&void 0!==x&&null!==(x=x.origin_meta)&&void 0!==x&&x.seed?S("div",{staticClass:"image-advanced-config-item"},[S("span",{staticClass:"image-advanced-config-item-key"},[I._v(I._s(I.$t("Seed"))+" ")]),I._v(" "),S("span",{staticClass:"image-advanced-config-item-value"},[I._v(I._s(null===(k=I.info)||void 0===k||null===(k=k.origin_meta)||void 0===k?void 0:k.seed))])]):I._e(),I._v(" "),null!==(D=I.info)&&void 0!==D&&null!==(D=D.origin_meta)&&void 0!==D&&D.sampler_name?S("div",{staticClass:"image-advanced-config-item"},[S("span",{staticClass:"image-advanced-config-item-key"},[I._v(I._s(I.$t("SamplingMethod"))+" ")]),I._v(" "),S("span",{staticClass:"image-advanced-config-item-value"},[I._v(I._s(null===($=I.info)||void 0===$||null===($=$.origin_meta)||void 0===$?void 0:$.sampler_name))])]):I._e(),I._v(" "),null!==(T=I.info)&&void 0!==T&&null!==(T=T.origin_meta)&&void 0!==T&&T.vae?S("div",{staticClass:"image-advanced-config-item"},[S("span",{staticClass:"image-advanced-config-item-key"},[I._v(I._s(I.$t("VAE"))+" ")]),I._v(" "),S("span",{staticClass:"image-advanced-config-item-value"},[I._v(I._s(null===(O=I.info)||void 0===O||null===(O=O.origin_meta)||void 0===O?void 0:O.vae))])]):I._e()]):I._e(),I._v(" "),S("div",{staticClass:"btn-box"},[S("div",{staticClass:"btn",on:{click:I.handleRemix}},[I._v(I._s(I.$t("Remix")))])])])}),[],!1,null,"7c0664a2",null).exports},props:{info:{type:Object,default:function(){return{}}}},data:function(){return{currentItemUrl:"",dialogVisible:!1,carouselHeight:"382px",carouselKey:Date.now()}},computed:{pictureList:function(){for(var t,e,n,o=(null===(t=this.info)||void 0===t||null===(t=t.samples)||void 0===t?void 0:t.filter((function(t){return t.url})))||[{url:null===(e=this.info)||void 0===e?void 0:e.cover,support_remix:!1,support_detail:!1,id:null===(n=this.info)||void 0===n?void 0:n.id}],r=[],i=0;i<o.length;i+=2)r.push(o.slice(i,i+2));return r}},methods:{calculateFirstScreenHeight:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,m,v,f,h,_,y,C,w,k,D,$;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v=function(t){return/\.(mp4|mov|avi|mkv|webm|flv|wmv)$/i.test(t)},o=382,r=.5,l=2,c=191,d=764,m=563,0!==(f=((null===(n=t.info)||void 0===n?void 0:n.samples)||[]).slice(0,2).filter((function(t){return null==t?void 0:t.url}))).length){e.next=11;break}return t.carouselHeight="382px",e.abrupt("return");case 11:if(!f.some((function(t){return v(t.url)}))){e.next=15;break}return t.carouselHeight="".concat(m,"px"),e.abrupt("return");case 15:return e.next=17,Promise.all(f.map((function(t){return new Promise((function(e){var img=new Image;img.src=t.url,img.onload=function(){var t=img.width/img.height;e({ratio:t})},img.onerror=function(){return e(null)}}))})));case 17:if(h=e.sent,0!==(_=h.filter(Boolean)).length){e.next=22;break}return t.carouselHeight="382px",e.abrupt("return");case 22:y=_.filter((function(i){return i.ratio>=r&&i.ratio<=l})),C=_.some((function(i){return i.ratio<r})),w=_.some((function(i){return i.ratio>l})),y.length?(D=Math.min.apply(Math,Object(x.a)(y.map((function(i){return i.ratio})))),k=o/D):C&&w||C?k=d:($=Math.max.apply(Math,Object(x.a)(_.map((function(i){return i.ratio})))),k=o/$),t.carouselHeight="".concat(Math.min(Math.max(k,c),d),"px");case 27:case"end":return e.stop()}}),e)})))()},handleRemix:function(t){this.$EventBus.$emit("openGenerate",{action:1,taskVersion:"v2",data:{source:t}})},mediaType:function(t){var e=null==t?void 0:t.split(".").pop();return["mp4","mov","avi","wmv","flv","mkv"].includes(e)?"video":"image"},handleClick:function(t){this.currentItemUrl=t.url,this.dialogVisible=!0},handleJump:function(t){this.$router.push(this.localePath("/explore/detail/".concat(t.id)))},handlePopoverShow:function(t){this.$set(t,"popoverVisible",!0)},handlePopoverHide:function(t){this.$set(t,"popoverVisible",!1)}},watch:{info:{handler:function(){var t=this;this.carouselKey=Date.now(),this.$nextTick((function(){t.calculateFirstScreenHeight()}))}}}}),$=(n(4953),n(4954),Object(C.a)(D,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"picture-wall",attrs:{"data-group":"newDetail-picture-wall"}},[e("el-carousel",{key:t.carouselKey,class:{"picture-wall-carousel":t.pictureList.length<2},attrs:{"indicator-position":"none",autoplay:!1,height:t.carouselHeight,arrow:"always"}},t._l(t.pictureList,(function(n,o){return e("el-carousel-item",{key:o},[e("div",{staticClass:"carousel-content"},t._l(n,(function(n){return e("div",{key:n.id,staticClass:"picture-wall-item"},["image"===t.mediaType(null==n?void 0:n.url)?e("div",{staticClass:"image-bg",style:{backgroundImage:"url(".concat(n.url,")")}}):t._e(),t._v(" "),n.url&&"image"===t.mediaType(null==n?void 0:n.url)?[null!=n&&n.support_detail?e("img",{attrs:{src:n.url,alt:""},on:{click:function(e){return t.handleJump(n)}}}):e("el-image",{attrs:{src:n.url,"preview-src-list":[n.url],alt:""}})]:t._e(),t._v(" "),n.url&&"video"===t.mediaType(n.url)?e("video",{attrs:{src:n.url,autoplay:"",loop:"",controls:!1,muted:""},domProps:{muted:!0},on:{click:function(e){return t.handleClick(n)}}}):t._e(),t._v(" "),null!=n&&n.support_remix?e("div",{staticClass:"remix-btn",on:{click:function(e){return t.handleRemix(n)}}},[t._v("\n            "+t._s(t.$t("Remix"))+"\n          ")]):t._e(),t._v(" "),n.support_detail?e("el-popover",{attrs:{"visible-arrow":!1,placement:"right",width:"320",trigger:"hover"},on:{show:function(e){return t.handlePopoverShow(n)},hide:function(e){return t.handlePopoverHide(n)}}},[e("ImageMeta",{attrs:{imageId:n.id,visible:n.popoverVisible},on:{remix:t.handleRemix}}),t._v(" "),e("i",{staticClass:"iconfont icon-notification",attrs:{slot:"reference"},slot:"reference"})],1):t._e()],2)})),0)])})),1),t._v(" "),e("el-dialog",{attrs:{visible:t.dialogVisible,fullscreen:"","append-to-body":!0,"custom-class":"picture-wall-video-dialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("video",{staticStyle:{width:"99vw",height:"90vh","object-fit":"contain"},attrs:{src:t.currentItemUrl,autoplay:"",loop:"",controls:!0,muted:""},domProps:{muted:!0}})])],1)}),[],!1,null,"a054c116",null).exports),T={name:"Tags",props:{tags:{type:Array,default:function(){return[]}}},data:function(){return{isExpanded:!1,showExpandArrow:!1}},mounted:function(){this.checkOverflow(),window.addEventListener("resize",this.checkOverflow)},beforeDestroy:function(){window.removeEventListener("resize",this.checkOverflow)},watch:{tags:{handler:function(){var t=this;this.$nextTick((function(){t.checkOverflow()}))},immediate:!0}},methods:{checkOverflow:function(){if(this.$refs.tagsContainer){var t=this.$refs.tagsContainer,e=t.style.height;t.style.height="auto";var n=t.scrollHeight;t.style.height=e,this.showExpandArrow=n>28}},toggleExpand:function(){this.isExpanded=!this.isExpanded},handleTagClick:function(t){window.open(this.localePath("/tagInfo/model/".concat(t.id)),"_blank")}}},O=(n(4955),Object(C.a)(T,(function(){var t=this,e=t._self._c;return e("div",{ref:"tagsContainer",staticClass:"tags",class:{"tags-expanded":t.isExpanded}},[t._l(t.tags,(function(n,o){return e("div",{key:o,staticClass:"tags-item",on:{click:function(e){return t.handleTagClick(n)}}},[t._v("\n    #"+t._s(n.title)+"\n  ")])})),t._v(" "),t.showExpandArrow&&!t.isExpanded?e("div",{staticClass:"tags-arrow tags-arrow-down",on:{click:t.toggleExpand}},[e("i",{staticClass:"iconfont icon-arrow_01"})]):t._e(),t._v(" "),t.isExpanded?e("div",{staticClass:"tags-arrow tags-arrow-up",on:{click:t.toggleExpand}},[e("i",{staticClass:"iconfont icon-arrow_01"})]):t._e()],2)}),[],!1,null,"35bf711a",null).exports),I=(n(32),n(72),n(89),n(69),n(185),n(92),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(9)),S=n(162),L=n(428);function j(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return E(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?E(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function E(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}var P={name:"ModelIntroduction",components:{TranslateLoading:L.default},props:{info:{type:Object,default:function(){}},versionId:{type:String,default:""}},data:function(){return{languageList:I.ab,translateLoading:!1,filterRichText:I.S,isTranslated:!1,isExpanded:!1,isShowMore:!1,originModelDesc:"",currentDesc:""}},computed:{currentLanguage:function(){var t,e=this,n=null===(t=I.ab.find((function(t){return t.value===e.$i18n.locale})))||void 0===t?void 0:t.name;return this.$t(n)}},watch:{"info.model_info_v2.desc":{handler:function(t){var e=this;this.currentDesc=t,this.originModelDesc=t,this.$nextTick((function(){e.checkOverflow()}))}},versionId:function(t){t!==this.info.model_ver_no&&(this.isTranslated=!1)}},methods:{checkOverflow:function(){var t;if(this.$refs.modelIntroductionContent&&null!==(t=this.info)&&void 0!==t&&null!==(t=t.model_info_v2)&&void 0!==t&&t.desc){var e=this.$refs.modelIntroductionContent;e.style.height="auto";var n=e.scrollHeight;this.isShowMore=n>300,this.isShowMore?e.style.height="300px":e.style.height="auto"}},translateRichText:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d,m,v,f,h,_,i,y,C,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return","");case 2:if((o=document.createElement("div")).innerHTML=t,r=[],l=new Map,c=function t(e){if(e.nodeType===Node.TEXT_NODE&&e.textContent.trim()){var text=e.textContent.trim();text&&(r.push(text),l.has(text)||l.set(text,[]),l.get(text).push(e))}for(var n=0,o=Array.from(e.childNodes);n<o.length;n++){t(o[n])}},d=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,o=[],r="",l=j(t);try{for(l.s();!(e=l.n()).done;){var text=e.value;(r+"\n"+text).length>n?(r&&o.push(r),r=text):r=r?r+"\n"+text:text}}catch(t){l.e(t)}finally{l.f()}return r&&o.push(r),o},n.prev=8,c(o),0!==r.length){n.next=12;break}return n.abrupt("return",t);case 12:m=d(r),v=e.$i18n.locale,f={zhCN:"zh-cn",zhTW:"zh-tw"}[v]||v,h=5,_=[],i=0;case 19:if(!(i<m.length)){n.next=29;break}return y=m.slice(i,i+h),C=y.map((function(text){return Object(S.a)(text,{to:f})})),n.next=24,Promise.all(C);case 24:w=n.sent,_.push.apply(_,Object(x.a)(w));case 26:i+=h,n.next=19;break;case 29:return _.forEach((function(t,e){var n=m[e],o=t.text.split("\n");n.split("\n").forEach((function(text,i){var t=l.get(text);t&&t.forEach((function(t){t.textContent=o[i]||""}))}))})),n.abrupt("return",o.innerHTML);case 33:return n.prev=33,n.t0=n.catch(8),console.error("Rich text translation failed:",n.t0),n.abrupt("return",t);case 37:case"end":return n.stop()}}),n,null,[[8,33]])})))()},translateModelDesc:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isTranslated=!t.isTranslated,e.prev=1,t.isTranslated){e.next=5;break}return t.originModelDesc&&(t.currentDesc=t.originModelDesc),e.abrupt("return");case 5:return t.originModelDesc||(t.originModelDesc=t.currentDesc),t.translateLoading=!0,e.next=9,t.translateRichText(t.currentDesc);case 9:n=e.sent,t.currentDesc=n,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),t.isTranslated=!1,t.originModelDesc&&(t.currentDesc=t.originModelDesc);case 17:return e.prev=17,t.translateLoading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[1,13,17,20]])})))()}}},M=P,N=(n(4957),Object(C.a)(M,(function(){var t,e=this,n=e._self._c;return null!==(t=e.info)&&void 0!==t&&null!==(t=t.model_info_v2)&&void 0!==t&&t.desc?n("div",{staticClass:"model-introduction"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.translateLoading,expression:"!translateLoading"}],ref:"modelIntroductionContent",staticClass:"model-introduction-content",class:{"model-introduction-content-expanded":e.isExpanded,"model-introduction-content-show-more":e.isShowMore&&!e.isExpanded},domProps:{innerHTML:e._s(e.filterRichText(e.currentDesc))}}),e._v(" "),e.translateLoading?n("TranslateLoading"):e._e(),e._v(" "),n("div",{staticClass:"model-introduction-more"},[e.isShowMore?n("div",{staticClass:"model-introduction-more-item",class:{"model-introduction-more-item-expanded":e.isExpanded},on:{click:function(t){e.isExpanded=!e.isExpanded}}},[n("span",[e._v(e._s(e.isExpanded?e.$t("PackUp"):e.$t("viewMore")))]),e._v(" "),n("i",{staticClass:"arrow",class:{"icon-arrow-expanded":e.isExpanded}})]):e._e(),e._v(" "),n("div",{staticClass:"model-introduction-more-item translate-model-desc",on:{click:e.translateModelDesc}},[e._v("\n      "+e._s(e.isTranslated?e.$t("cancel_translate"):e.$t("OneClickTranslation"))+"\n    ")])])],1):e._e()}),[],!1,null,"30e1d624",null)),R=N.exports;installComponents(N,{TranslateLoading:n(428).default});var A=n(116),F=n(240),B={props:{modelInfo:{type:Object,default:function(){}}},components:{Author:F.default},data:function(){return{formatNumberForeign:l.p}}},V=(n(4958),Object(C.a)(B,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-profile-container"},[e("Author",{attrs:{type:"model",activeImg:t.modelInfo,showRight:!1,size:60},scopedSlots:t._u([{key:"name",fn:function(){var n,o,r,l,c,d;return[e("div",{staticClass:"nums"},[e("div",{staticClass:"nums-item"},[e("i",{staticClass:"iconfont icon-icon-following1"}),t._v(" "),e("span",[t._v(t._s(t.formatNumberForeign(null!==(n=null===(o=t.modelInfo)||void 0===o||null===(o=o.author)||void 0===o?void 0:o.follower_cnt)&&void 0!==n?n:0)))])]),t._v(" "),e("div",{staticClass:"nums-item"},[e("i",{staticClass:"iconfont icon-collect-gpt"}),t._v(" "),e("span",[t._v(t._s(t.formatNumberForeign(null!==(r=null===(l=t.modelInfo)||void 0===l||null===(l=l.author)||void 0===l?void 0:l.num_of_collect)&&void 0!==r?r:0)))])]),t._v(" "),e("div",{staticClass:"nums-item"},[e("i",{staticClass:"iconfont icon-eye1"}),t._v(" "),e("span",[t._v(t._s(t.formatNumberForeign(null!==(c=null===(d=t.modelInfo)||void 0===d||null===(d=d.author)||void 0===d?void 0:d.num_of_view)&&void 0!==c?c:0)))])])])]},proxy:!0},{key:"follow",fn:function(){return[e("i",{staticClass:"iconfont icon-user-plus"})]},proxy:!0}])})],1)}),[],!1,null,"b5c6cb5a",null)),U=V.exports;installComponents(V,{Author:n(240).default});n(21);var H=n(45),z=n(63),W=n(618),G=n(39);function K(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?K(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var X={mixins:[H.a],components:{CollectPopover:z.default,modelDownload:W.a},props:{modelInfo:{type:Object,default:function(){}},dotReportInfo:{type:Object,default:function(){}}},data:function(){return{formatNumberForeign:l.p}},computed:Y(Y({},Object(f.c)("user",["isCompanyAccount","isLoggedIn"])),{},{showTrainSameId:function(){var t,e,n=this;if(null!==(t=this.modelInfo)&&void 0!==t&&t.model_ver_no&&null!==(e=this.modelInfo)&&void 0!==e&&e.model_ver_nos){var o,r,l,c=null===(o=this.modelInfo)||void 0===o?void 0:o.model_ver_nos.find((function(t){var e;return t.id===(null===(e=n.modelInfo)||void 0===e?void 0:e.model_ver_no)}));return!(!c||2!==(null==c||null===(r=c.same)||void 0===r?void 0:r.primary))&&(null==c||null===(l=c.same)||void 0===l?void 0:l.train_model_no)}return!1}}),methods:{handleCreate:function(){var t=["Checkpoint","LORA","TextualInversion","DoRA","LoCon"].includes(this.modelInfo.type),e=Object(I.M)(this.modelInfo),n=I.G.includes(this.modelInfo.base_model);if(t)if(e){var o={action:"task",obj_no:this.modelInfo.id,obj_type:2,category:"default",batch_id:"",negative_ids:[],view_domain:"details_model"};Object(G.i)({items:[o]});var r=Object.assign({},this.modelInfo,{taskSource:2}),l=n||I.u.includes(this.modelInfo.base_model);this.$EventBus.$emit("openGenerate",{action:1,data:{source:Y(Y({},r),{},{scene:"model_detail_v2"})},taskVersion:l?"v2":""})}else this.$message.warning(this.$t("theTypeNocreate"));else this.$message(this.$t("theTypeNocreate"))},handleMark:function(){this.isLoggedIn?(1===this.modelInfo.publish_status||this.isCompanyAccount)&&(this.setCollectData(this.modelInfo).includes("icon-collect_selected")?(this.$refs.collectPopover.visible=!1,this.setCollect(this.modelInfo,"model")):this.$refs.collectPopover.visible=!0):this.$EventBus.$emit("openLoginDialog")},dotDownload:function(){["Checkpoint","LORA","TextualInversion","DoRA","LoCon"].includes(this.modelInfo.type)?this.isLoggedIn?this.$refs.modelDownload&&this.$refs.modelDownload.getDownLoadUrl():this.$EventBus.$emit("openLoginDialog"):this.$message(this.$t("theTypeNocreate"))},noDownload:function(){2===this.modelInfo.download&&this.$message(this.$t("noUseDownload"))},handleTrainSame:function(){var t,e;this.$router.push(this.localePath({path:"/loraTrainingEdit",query:{dataSetNo:this.showTrainSameId,modelVerNo:null===(t=this.modelInfo)||void 0===t?void 0:t.model_ver_no,DSType:["Hunyuan Video","Wan Video"].includes(null===(e=this.modelInfo)||void 0===e?void 0:e.base_model)?1:0}}))}}},J=(n(4959),Object(C.a)(X,(function(){var t,e,n,o,r,l,c,d=this,m=d._self._c;return m("div",{staticClass:"btns-container"},[m("div",{staticClass:"btns-container-item create-btn",attrs:{"data-event":"model_detail_v2_create","data-info":JSON.stringify({model_version:null===(t=d.modelInfo)||void 0===t?void 0:t.model_ver_info_v2}),"data-id":d.modelInfo.id},on:{click:d.handleCreate}},[m("i",{staticClass:"iconfont icon-creation_small"}),d._v(" "),m("span",[d._v(d._s(d.$t("creativeList")))]),d._v(" "),m("span",[d._v("("+d._s(d.formatNumberForeign((null===(e=d.modelInfo)||void 0===e||null===(e=e.stat)||void 0===e?void 0:e.num_of_task)||0))+")")])]),d._v(" "),d.showTrainSameId?m("div",{staticClass:"btns-container-item train-same-btn",attrs:{"data-event":"model_detail_v2_train_same","data-info":JSON.stringify({model_version:null===(n=d.modelInfo)||void 0===n?void 0:n.model_ver_info_v2}),"data-id":d.modelInfo.id},on:{click:d.handleTrainSame}},[m("span",[d._v(d._s(d.$t("trainSame")))])]):d._e(),d._v(" "),1===d.modelInfo.publish_status||d.isCompanyAccount?m("div",{staticClass:"btns-container-item btn-collect",on:{click:function(t){return t.stopPropagation(),d.handleMark.apply(null,arguments)}}},[m("CollectPopover",{ref:"collectPopover",attrs:{hideBtn:!0,type:"model",folder:d.modelInfo,dotReportInfo:d.dotReportInfo}},[m("div",{staticClass:"btns-container-item-collect",attrs:{"data-event":"model_detail_v2_collect","data-info":JSON.stringify({model_version:null===(o=d.modelInfo)||void 0===o?void 0:o.model_ver_info_v2}),"data-id":d.modelInfo.id}},[m("i",{staticClass:"iconfont",class:d.setCollectData(d.modelInfo)}),d._v(" "),m("span",[d._v(d._s(d.$t("Collect")))]),d._v(" "),m("span",[d._v("("+d._s(d.formatNumberForeign((null===(r=d.modelInfo)||void 0===r||null===(r=r.stat)||void 0===r?void 0:r.num_of_collection)||0))+")")])])])],1):d._e(),d._v(" "),m("div",{staticClass:"btns-container-item",class:{"download-btn":!(1===d.modelInfo.publish_status||d.isCompanyAccount)},attrs:{"data-event":"model_detail_v2_download","data-info":JSON.stringify({model_version:null===(l=d.modelInfo)||void 0===l?void 0:l.model_ver_info_v2}),"data-id":d.modelInfo.id},on:{click:function(t){return t.stopPropagation(),d.dotDownload.apply(null,arguments)}}},[1===d.modelInfo.download?m("div",[m("modelDownload",{ref:"modelDownload",attrs:{modelInfo:d.modelInfo}})],1):d._e(),d._v(" "),2===d.modelInfo.download?m("i",{staticClass:"iconfont icon-icon-download",on:{click:d.noDownload}}):d._e(),d._v(" "),m("span",[d._v(d._s(d.$t("Download")))]),d._v(" "),m("span",[d._v("("+d._s(d.formatNumberForeign((null===(c=d.modelInfo)||void 0===c||null===(c=c.stat)||void 0===c?void 0:c.num_of_download)||0))+")")])])])}),[],!1,null,"40383608",null)),Q=J.exports;installComponents(J,{CollectPopover:n(63).default});n(19),n(73),n(3448),n(140),n(90);var Z=n(429),tt=n(25),et=n(359),at={data:function(){return{dialogVisible:!1,paramsInfo:{}}},methods:{openDialog:function(data){this.paramsInfo=data,this.dialogVisible=!0},closeDialog:function(){this.dialogVisible=!1}}},it=(n(4962),Object(C.a)(at,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:"",visible:t.dialogVisible,width:"40vw","append-to-body":"","show-close":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"use-tips-modal-container-title"},[e("div",{staticClass:"use-tips-modal-container-title-left"},[e("div",{staticClass:"use-tips-modal-container-title-left-title"},[t._v("\n        "+t._s(t.$t("ModelParameters"))+"\n      ")])]),t._v(" "),e("i",{staticClass:"iconfont icon-guanbi1",on:{click:t.closeDialog}})]),t._v(" "),e("div",{staticClass:"use-tips-modal-container-content"},t._l(t.paramsInfo,(function(n,o){return e("div",{key:o,staticClass:"use-tips-modal-container-content-item"},[e("div",{staticClass:"use-tips-modal-container-content-item-left"},[t._v(t._s(o)+":")]),t._v(" "),e("div",{staticClass:"use-tips-modal-container-content-item-right"},[t._v("\n        "+t._s(n)+"\n      ")])])})),0)])}),[],!1,null,"761470dc",null).exports),nt={data:function(){return{dialogVisible:!1,paramsInfo:[]}},methods:{openDialog:function(data){this.paramsInfo=data,this.dialogVisible=!0},closeDialog:function(){this.dialogVisible=!1}}},ot=(n(4963),Object(C.a)(nt,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:"",visible:t.dialogVisible,width:"40vw",center:"","append-to-body":"","show-close":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"trigger-word-modal-container-title"},[e("div",{staticClass:"trigger-word-modal-container-title-left"},[e("div",{staticClass:"trigger-word-modal-container-title-left-title"},[t._v("\n        "+t._s(t.$t("TriggerWords"))+"\n      ")])]),t._v(" "),e("i",{staticClass:"iconfont icon-guanbi1",on:{click:t.closeDialog}})]),t._v(" "),e("div",{staticClass:"trigger-word-modal-container-content"},t._l(t.paramsInfo,(function(n,o){return e("div",{key:o,staticClass:"trigger-word-modal-container-content-item"},[t._v("\n      "+t._s(n)+"\n    ")])})),0)])}),[],!1,null,"200fdd52",null).exports),st=n(404),lt=n(361),ct=n(56);function ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function mt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ut(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var pt={mixins:[H.a],components:{Evaluate:Z.default,AppealDialog:et.default,UseTipsModal:it,TriggerWordsModal:ot,NoLike:st.default,Report:lt.default},props:{modelInfo:{type:Object,default:function(){}}},data:function(){return{dayjs:m.a,isNil:tt.isNil,morePop:!1,appealShow:!1,appealData:{obj_no:"",obj_type:2,remark:"",order_by:"recommend"},isDeleteLoading:!1,dialogVisible:!1}},computed:mt(mt({},Object(f.c)("user",["userInfo","isCompanyAccount"])),{},{toolsMenu:function(){var t=this.modelInfo,e=t.author,n=t.status,o=t.publish_status,r=this.userInfo.id===(null==e?void 0:e.id),l=[{key:"NOLIKE",label:"dislike"}],c=function(t,label){return{key:t,label:label}};return r?(r&&(3===n||this.isCompanyAccount||l.push(c("EDIT","Edit")),1===o&&l.push(c("OFFSHELF","offShelf")),2===o&&l.push(c("DELETE","Delete")),2===n&&l.push(c("APPEAL","appeal"))),l):(1===o&&l.push(c("REPORT","Report")),l.push(c("CLAIM","ClaimModel")),l)},triggerWords:function(){var t;return null===(t=this.modelInfo)||void 0===t||null===(t=t.model_ver_info_v2)||void 0===t?void 0:t.trigger_words.slice(0,6)},recGenerateParam:function(){var t=this;return function(e){var n,o=(null===(n=t.modelInfo)||void 0===n||null===(n=n.model_ver_info_v2)||void 0===n?void 0:n.rec_generate_param)||{},r=Object(tt.omitBy)(o,(function(t){return null==t||""===t})),l=["sampler","cfg_scale","steps"],c=[].concat(Object(x.a)(l.filter((function(t){return t in r}))),Object(x.a)(Object.keys(r).filter((function(t){return!l.includes(t)})))),d=e&&e>0?c.slice(0,e):c;return Object.fromEntries(d.map((function(t){return[t,r[t]]})))}}}),methods:{isLink:function(t){try{return new URL(t),/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(t)}catch(t){return!1}},showLink:function(t){var e=t;if(e){var n=e.match(/([^:/?#]+)(?:\.[^:/?#]+)+(?:[/?#]|$)/i);if(n){var o=n[1];return o=(o=o.replace(/^www\./i,"")).replace(/\.(com|cn|org|net|edu|gov|jp|uk|au|de|fr|kr)$/i,"")}return e}return"-"},toolsEvent:function(t){var e={CLAIM:this.claimModel,EDIT:this.onEdit,DELETE:this.deleteModel,APPEAL:this.openAppeal,OFFSHELF:this.offShelf};e[t]?e[t]():this.reportModel(),this.morePop=!1},claimModel:function(){var t="https://aihelp.net/questionnaire/#/?formId=78dea50f5cbb426cb136748154c029aa";this.$i18n.locale.startsWith("zh")&&(t="https://aihelp.net/questionnaire/#/?formId=bffe7a2307454e859f559913e28d4f19"),window.open(t,"_blank")},onEdit:function(){this.$router.push({path:this.localePath("/modelEditStep"),query:{id:this.modelInfo.id}})},deleteModel:function(){var t=this;this.$confirm(this.$t("newDeleteModelDesc"),this.$t("Tip"),{confirmButtonText:this.$t("Delete"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(e){t.onDelete()}))},onDelete:function(){var t=this;this.isDeleteLoading=!0,Object(ct.y)({model_id:this.modelInfo.id}).then((function(e){1e4==e.status.code&&(t.setWaterFallDeleteLits(t.modelInfo.id),t.$router.back())})).finally((function(){t.isDeleteLoading=!1}))},openAppeal:function(){this.appealData.obj_no=this.modelInfo.id,this.appealShow=!0},offShelf:function(){var t=this;this.$confirm(this.$t("modelDelistTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(e){Object(ct.r)({id:t.modelInfo.id}).then((function(e){if(1e4==e.status.code)t.$message.success(t.$t("modelDelistSuccess")),t.$emit("updateData");else if(10500==e.status.code){var n="https://aihelp.net/questionnaire/#/?formId=291ecf705dee4ceaa97af1bcc0d017b8";t.$i18n.locale.startsWith("zh")&&(n="https://aihelp.net/questionnaire/#/?formId=d9483db10f694841ba66414325fefbb6"),window.open(n,"_blank")}}))}))},reportModel:function(){var t=this;Object(r.f)({id:this.$route.params.id}).then((function(e){t.$message.success(t.$t("ReportSuccess"))}))},openUseTipsModal:function(){this.$refs.useTipsModal.openDialog(this.recGenerateParam())},openTriggerWordsModal:function(){var t;this.$refs.triggerWordsModal.openDialog(null===(t=this.modelInfo)||void 0===t||null===(t=t.model_ver_info_v2)||void 0===t?void 0:t.trigger_words)},copyTriggerWords:function(){var content=this.triggerWords.join(",");Object(l.g)(content),this.$message.success(this.$t("CopySuccess"))}}},vt=(n(4964),n(4965),Object(C.a)(pt,(function(){var t,e,n,o,r,l,c,d,m,v,f,h,_,y,C=this,w=C._self._c;return w("div",{staticClass:"version-detail-container"},[w("div",{staticClass:"version-detail-container-title"},[C._v("\n    "+C._s(C.$t("version_detail"))+"\n  ")]),C._v(" "),w("div",{staticClass:"version-detail-container-content"},[w("div",{staticClass:"version-detail-container-content-item"},[w("div",{staticClass:"left"},[C._v("\n        "+C._s(C.$t("Type"))+"\n      ")]),C._v(" "),w("div",{staticClass:"right"},[C._v(C._s(null===(t=C.modelInfo)||void 0===t||null===(t=t.model_ver_info_v2)||void 0===t?void 0:t.model_type))])]),C._v(" "),w("div",{staticClass:"version-detail-container-content-item"},[w("div",{staticClass:"left"},[C._v("\n        "+C._s(C.$t("rating"))+"\n      ")]),C._v(" "),w("div",{staticClass:"right"},[w("Evaluate",{attrs:{"data-event":"model_detail_v2_rating","data-info":JSON.stringify({model_version:null===(e=C.modelInfo)||void 0===e?void 0:e.model_ver_info_v2}),"data-id":C.modelInfo.id,evaluateData:C.modelInfo,obj_type:2}})],1)]),C._v(" "),w("div",{staticClass:"version-detail-container-content-item"},[w("div",{staticClass:"left"},[C._v("\n        "+C._s(C.$t("publishTime"))+"\n      ")]),C._v(" "),w("div",{staticClass:"right"},[C._v("\n        "+C._s(null!==(n=C.modelInfo)&&void 0!==n&&null!==(n=n.model_ver_info_v2)&&void 0!==n&&n.publish_at?C.dayjs(null===(o=C.modelInfo)||void 0===o||null===(o=o.model_ver_info_v2)||void 0===o?void 0:o.publish_at).format("YYYY-MM-DD"):"-")+"\n      ")])]),C._v(" "),w("div",{staticClass:"version-detail-container-content-item"},[w("div",{staticClass:"left"},[C._v("\n        "+C._s(C.$t("BaseModel"))+"\n      ")]),C._v(" "),w("div",{staticClass:"right"},[C._v(C._s(null===(r=C.modelInfo)||void 0===r||null===(r=r.model_ver_info_v2)||void 0===r?void 0:r.base_model_name))])]),C._v(" "),null!==(l=C.modelInfo)&&void 0!==l&&null!==(l=l.model_ver_info_v2)&&void 0!==l&&null!==(l=l.trigger_words)&&void 0!==l&&l.length?w("div",{staticClass:"version-detail-container-content-item"},[w("div",{staticClass:"left"},[C._v("\n        "+C._s(C.$t("TriggerWords"))+"\n      ")]),C._v(" "),w("div",{staticClass:"right"},[C._l(C.triggerWords,(function(t,e){return w("div",{key:e,staticClass:"item-tag"},[w("el-tooltip",{attrs:{content:t,"visible-arrow":!1,"popper-class":"version-detail-item-tag-content",placement:"top-start",effect:"dark"}},[w("span",[C._v(C._s(t))])])],1)})),C._v(" "),C.triggerWords.length?w("div",{staticClass:"more",on:{click:C.copyTriggerWords}},[C._v("\n          "+C._s(C.$t("copy"))+"\n        ")]):C._e(),C._v(" "),(null===(c=this.modelInfo)||void 0===c||null===(c=c.model_ver_info_v2)||void 0===c?void 0:c.trigger_words.length)>6?w("div",{staticClass:"more",on:{click:C.openTriggerWordsModal}},[C._v("\n          "+C._s(C.$t("viewMore"))+"\n        ")]):C._e()],2)]):C._e(),C._v(" "),Object.keys(C.recGenerateParam()).length?w("div",{staticClass:"version-detail-container-content-item"},[w("div",{staticClass:"left"},[C._v("\n        "+C._s(C.$t("ModelParameters"))+"\n      ")]),C._v(" "),w("div",{staticClass:"right"},[C._l(C.recGenerateParam(4),(function(t,e){return w("div",{key:e,staticClass:"item-tag model-tag"},[w("el-tooltip",{attrs:{content:e+"："+t,"visible-arrow":!1,"popper-class":"version-detail-item-tag-content",placement:"top-start",effect:"dark"}},[w("span",[C._v(C._s(e)+"："+C._s(t))])])],1)})),C._v(" "),Object.keys(C.recGenerateParam()).length>=4?w("div",{staticClass:"more",on:{click:C.openUseTipsModal}},[C._v("\n          "+C._s(C.$t("viewMore"))+"\n        ")]):C._e()],2)]):C._e(),C._v(" "),null!==(d=C.modelInfo)&&void 0!==d&&null!==(d=d.model_ver_info_v2)&&void 0!==d&&d.train_info?w("div",{staticClass:"version-detail-container-content-item"},[w("div",{staticClass:"left"},[C._v("\n        "+C._s(C.$t("trainParamete"))+"\n      ")]),C._v(" "),C.isNil(null===(m=C.modelInfo)||void 0===m||null===(m=m.model_ver_info_v2)||void 0===m||null===(m=m.train_info)||void 0===m?void 0:m.epoch)&&C.isNil(null===(v=C.modelInfo)||void 0===v||null===(v=v.model_ver_info_v2)||void 0===v||null===(v=v.train_info)||void 0===v?void 0:v.step)?C._e():w("div",{staticClass:"right"},[C.isNil(null===(f=C.modelInfo)||void 0===f||null===(f=f.model_ver_info_v2)||void 0===f||null===(f=f.train_info)||void 0===f?void 0:f.epoch)?C._e():w("div",{staticClass:"item-tag"},[C._v("\n          Epochs："+C._s(null===(h=C.modelInfo)||void 0===h||null===(h=h.model_ver_info_v2)||void 0===h||null===(h=h.train_info)||void 0===h?void 0:h.epoch)+"\n        ")]),C._v(" "),C.isNil(null===(_=C.modelInfo)||void 0===_||null===(_=_.model_ver_info_v2)||void 0===_||null===(_=_.train_info)||void 0===_?void 0:_.step)?C._e():w("div",{staticClass:"item-tag"},[C._v("\n          Steps："+C._s(null===(y=C.modelInfo)||void 0===y||null===(y=y.model_ver_info_v2)||void 0===y||null===(y=y.train_info)||void 0===y?void 0:y.step)+"\n        ")])])]):C._e()]),C._v(" "),w("div",{staticClass:"version-detail-container-title model-source"},[w("div",{staticClass:"version-detail-container-title-left"},[C._v("\n      "+C._s(C.$t("ModelSource"))+":\n      "),C.isLink(C.modelInfo.refer)?w("a",{staticClass:"link",attrs:{href:C.modelInfo.refer,target:"_blank",rel:"nofollow"}},[C._v("\n        "+C._s(C.showLink(C.modelInfo.refer))+"\n      ")]):w("span",[C._v(C._s(C.modelInfo.refer||"-"))])]),C._v(" "),w("div",{staticClass:"version-detail-container-title-right"},[C.modelInfo.author&&C.modelInfo.author.id?w("el-popover",{attrs:{placement:"top-start","popper-class":"my-popover version-detail-popover","visible-arrow":!1,width:"100"},model:{value:C.morePop,callback:function(t){C.morePop=t},expression:"morePop"}},[w("div",{staticClass:"popBox",attrs:{"data-group":"model-page-image-info"}},[C._l(C.toolsMenu,(function(t,i){return["REPORT"===t.key?w("Report",{key:"tools_"+i,attrs:{targetItem:{id:C.modelInfo.id,obj_type:2},isBack:""}},[C._v("\n              "+C._s(C.$t(t.label))+"\n            ")]):C._e(),C._v(" "),"NOLIKE"===t.key?w("NoLike",{key:"tools_"+i,attrs:{targetItem:{id:C.modelInfo.id,obj_type:2},isBack:""}},[C._v("\n              "+C._s(C.$t(t.label))+"\n            ")]):C._e(),C._v(" "),["REPORT","NOLIKE"].includes(t.key)?C._e():w("div",{key:"tools_"+i,attrs:{"data-event":"more-action-item","data-id":t.key},on:{click:function(e){return C.toolsEvent(t.key)}}},[C._v("\n              "+C._s(C.$t(t.label))+"\n            ")])]}))],2),C._v(" "),w("div",{staticClass:"edit",attrs:{slot:"reference"},slot:"reference"},[w("i",{staticClass:"el-icon-more"})])]):C._e()],1)]),C._v(" "),C.appealShow?w("AppealDialog",{attrs:{"appeal-data":C.appealData,"is-appealing":C.isAppealLoading,"submit-callback":C.setResourceAppeal,"dialog-visible":C.appealShow},on:{"update:dialogVisible":function(t){C.appealShow=t},"update:dialog-visible":function(t){C.appealShow=t}}}):C._e(),C._v(" "),w("el-dialog",{attrs:{visible:C.dialogVisible,top:"40vh",width:"508px","custom-class":"SaDialog","append-to-body":""},on:{"update:visible":function(t){C.dialogVisible=t}}},[w("div",{staticClass:"sure"},[C._v(C._s(C.$t("DeleteModelSure")))]),C._v(" "),w("div",{staticClass:"sureDesc"},[C._v(C._s(C.$t("newDeleteModelDesc")))]),C._v(" "),w("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[w("el-button",{on:{click:function(t){C.dialogVisible=!1}}},[C._v(C._s(C.$t("Cancel")))]),C._v(" "),w("el-button",{attrs:{loading:C.isDeleteLoading},on:{click:C.onDelete}},[C._v(C._s(C.$t("Delete")))])],1)]),C._v(" "),w("UseTipsModal",{ref:"useTipsModal"}),C._v(" "),w("TriggerWordsModal",{ref:"triggerWordsModal"})],1)}),[],!1,null,"acfb0cda",null)),ft=vt.exports;installComponents(vt,{Evaluate:n(429).default,AppealDialog:n(359).default});function ht(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return _t(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_t(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function _t(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}var gt={name:"VersionModal",components:{TranslateLoading:L.default},data:function(){return{dialogVisible:!1,filterRichText:I.S,currentDesc:"",originModelDesc:"",isTranslated:!1,translateLoading:!1}},methods:{translateRichText:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d,m,v,f,h,_,i,y,C,w;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return","");case 2:if((o=document.createElement("div")).innerHTML=t,r=[],l=new Map,c=function t(e){if(e.nodeType===Node.TEXT_NODE&&e.textContent.trim()){var text=e.textContent.trim();text&&(r.push(text),l.has(text)||l.set(text,[]),l.get(text).push(e))}for(var n=0,o=Array.from(e.childNodes);n<o.length;n++){t(o[n])}},d=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,o=[],r="",l=ht(t);try{for(l.s();!(e=l.n()).done;){var text=e.value;(r+"\n"+text).length>n?(r&&o.push(r),r=text):r=r?r+"\n"+text:text}}catch(t){l.e(t)}finally{l.f()}return r&&o.push(r),o},n.prev=8,c(o),0!==r.length){n.next=12;break}return n.abrupt("return",t);case 12:m=d(r),v=e.$i18n.locale,f={zhCN:"zh-cn",zhTW:"zh-tw"}[v]||v,h=5,_=[],i=0;case 19:if(!(i<m.length)){n.next=29;break}return y=m.slice(i,i+h),C=y.map((function(text){return Object(S.a)(text,{to:f})})),n.next=24,Promise.all(C);case 24:w=n.sent,_.push.apply(_,Object(x.a)(w));case 26:i+=h,n.next=19;break;case 29:return _.forEach((function(t,e){var n=m[e],o=t.text.split("\n");n.split("\n").forEach((function(text,i){var t=l.get(text);t&&t.forEach((function(t){t.textContent=o[i]||""}))}))})),n.abrupt("return",o.innerHTML);case 33:return n.prev=33,n.t0=n.catch(8),console.error("Rich text translation failed:",n.t0),n.abrupt("return",t);case 37:case"end":return n.stop()}}),n,null,[[8,33]])})))()},translateModelDesc:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isTranslated=!t.isTranslated,e.prev=1,t.isTranslated){e.next=5;break}return t.originModelDesc&&(t.currentDesc=t.originModelDesc),e.abrupt("return");case 5:return t.originModelDesc||(t.originModelDesc=t.currentDesc),t.translateLoading=!0,e.next=9,t.translateRichText(t.currentDesc);case 9:n=e.sent,t.currentDesc=n,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),t.isTranslated=!1,t.originModelDesc&&(t.currentDesc=t.originModelDesc);case 17:return e.prev=17,t.translateLoading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[1,13,17,20]])})))()},openDialog:function(data){this.currentDesc=null==data?void 0:data.model_ver_info_v2.desc,this.originModelDesc=null==data?void 0:data.model_ver_info_v2.desc,this.dialogVisible=!0},closeDialog:function(){this.dialogVisible=!1,this.isTranslated=!1,this.translateLoading=!1,this.currentDesc="",this.originModelDesc=""}}},bt=gt,yt=(n(4966),Object(C.a)(bt,(function(){var t=this,e=t._self._c;return e("el-dialog",{ref:"versionModal",attrs:{title:"",visible:t.dialogVisible,"append-to-body":"","show-close":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"version-modal-container-title"},[e("div",{staticClass:"version-modal-container-title-left"},[e("div",{staticClass:"version-modal-container-title-left-title"},[t._v("\n        "+t._s(t.$t("verIntroduction"))+"\n      ")]),t._v(" "),e("div",{staticClass:"translate-model-desc",on:{click:t.translateModelDesc}},[t._v("\n        "+t._s(t.isTranslated?t.$t("cancel_translate"):t.$t("OneClickTranslation"))+"\n      ")])]),t._v(" "),e("i",{staticClass:"iconfont icon-guanbi1",on:{click:t.closeDialog}})]),t._v(" "),e("div",{staticClass:"version-modal-container-content"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.translateLoading,expression:"!translateLoading"}],staticClass:"version-modal-container-content-rich-text",domProps:{innerHTML:t._s(t.filterRichText(t.currentDesc))}}),t._v(" "),t.translateLoading?e("TranslateLoading"):t._e()],1)])}),[],!1,null,"3c9212f8",null)),Ct=yt.exports;installComponents(yt,{TranslateLoading:n(428).default});var wt={name:"VersionIntroduction",components:{VersionModal:Ct},props:{modelInfo:{type:Object,default:function(){}}},data:function(){return{filterRichText:I.S}},methods:{openVersionModal:function(){this.$refs.versionModal.openDialog(this.modelInfo)}}},xt=(n(4967),Object(C.a)(wt,(function(){var t,e,n=this,o=n._self._c;return null!==(t=n.modelInfo)&&void 0!==t&&null!==(t=t.model_ver_info_v2)&&void 0!==t&&t.desc?o("div",{staticClass:"version-introduction-container"},[o("div",{staticClass:"title"},[n._v("\n    "+n._s(n.$t("verIntroduction"))+"\n  ")]),n._v(" "),o("div",{ref:"richText",staticClass:"rich-text",domProps:{innerHTML:n._s(n.filterRichText(null===(e=n.modelInfo)||void 0===e||null===(e=e.model_ver_info_v2)||void 0===e?void 0:e.desc))}}),n._v(" "),o("div",{staticClass:"more",on:{click:n.openVersionModal}},[n._v("\n    "+n._s(n.$t("viewMore"))+"\n  ")]),n._v(" "),o("VersionModal",{ref:"versionModal"})],1):n._e()}),[],!1,null,"01eb819a",null).exports),kt={name:"LicenseScope",props:{modelInfo:{type:Object,default:function(){}}},methods:{pcion:function(t){var e=t||2;return[1===e?"el-icon-check":"el-icon-close",1===e?"succ":"err"]}}},Dt=(n(4968),Object(C.a)(kt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"license-scope"},[e("div",{staticClass:"license-scope-title"},[t._v("\n    "+t._s(t.$t("licenseScopeInit"))+"\n  ")]),t._v(" "),e("div",{staticClass:"license-scope-content"},[e("div",{staticClass:"license-scope-content-item"},[e("div",{staticClass:"license-scope-content-item-title"},[t._v("\n        "+t._s(t.$t("createLicenseScope"))+"\n      ")]),t._v(" "),e("div",{staticClass:"license-scope-content-item-content"},[e("div",{staticClass:"item"},[e("i",{class:t.pcion(t.modelInfo.allow_use_in_haiyi)}),t._v(" "),e("span",[t._v(t._s(t.$t("onlineMapping")))])]),t._v(" "),e("div",{staticClass:"item"},[e("i",{class:t.pcion(t.modelInfo.mix)}),t._v(" "),e("span",[t._v(t._s(t.$t("performFusion")))])]),t._v(" "),e("div",{staticClass:"item"},[e("i",{class:t.pcion(t.modelInfo.download)}),t._v(" "),e("span",[t._v(t._s(t.$t("comfyUpLoad9")))])])])]),t._v(" "),e("div",{staticClass:"license-scope-content-item"},[e("div",{staticClass:"license-scope-content-item-title"},[t._v("\n        "+t._s(t.$t("businessLicenseScope"))+"\n      ")]),t._v(" "),e("div",{staticClass:"license-scope-content-item-content"},[e("div",{staticClass:"item"},[e("i",{class:t.pcion(t.modelInfo.commercial)}),t._v(" "),e("span",[t._v(t._s(t.$t("commercialYesImg")))])]),t._v(" "),e("div",{staticClass:"item"},[e("i",{class:t.pcion(t.modelInfo.allow_resell)}),t._v(" "),e("span",[t._v(t._s(t.$t("modelSellYes")))])])])])])])}),[],!1,null,"50ce4046",null).exports),$t=n(36);function Tt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Ot(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Tt(Object(n),!0).forEach((function(e){Object(c.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var It={components:{HyWaterfallFlowList:n(64).default},props:{versionId:{type:String,default:""},baseModel:{type:String,default:""}},data:function(){return{queryParam:{page:1,page_size:20,order_by:"hot"},timeName:"All",timeTypeOption:[{name:"All",startTime:null,endTime:null},{name:"days",startTime:Object(l.B)().startTimestamp,endTime:Object(l.B)().endTimestamp},{name:"week",startTime:Object(l.C)().startTimestamp,endTime:Object(l.C)().endTimestamp},{name:"months",startTime:Object(l.A)().startTimestamp,endTime:Object(l.A)().endTimestamp}],typeOption:[{name:"Hot",id:"hot",icon:"hot"},{name:"New",id:"new",icon:"new1"}],relatedImages:[],isReq:!1,isLock:!1,replaceImageType:l.K}},computed:Ot(Ot({},Object(f.e)("app",["ABInfo"])),{},{newTypeOption:function(){var t;return"A"===(null===(t=this.ABInfo)||void 0===t?void 0:t.model_relation_recommend_new)?(this.queryParam.order_by="trending",this.typeOption.concat({name:"Trending",id:"trending",icon:"homeIcon1"})):this.typeOption},dataInfo:function(){var t,e=(this.queryParam||{}).order_by,time="All"===this.timeName?"":"".concat({All:"All",days:"day",week:"week",months:"month"}[this.timeName]||"","_");return{model_id:(null===(t=this.$route)||void 0===t||null===(t=t.params)||void 0===t?void 0:t.id)||"",sort_type:"hot"===e?"".concat(time).concat(e):e,model_ver_no:this.versionId||"",base_model:this.baseModel||""}}}),mounted:function(){this.initList(),this.intList()},methods:{setIcon:function(){var t=this,e="homeIcon1";return this.typeOption.forEach((function(n){t.queryParam.order_by==n.id&&(e=n.icon)})),e},initList:function(){var t;null!==(t=this.relatedImages)&&void 0!==t&&t.length&&(this.relatedImages=this.relatedImages.map((function(t){var e=t.banner;return null==e||!e.url||null!=e&&e.replaceUrl||(t.banner.replaceUrl=Object(l.K)(e.url,"low")),t})))},getList:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,time,param,r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isReq&&!t.isLock){e.next=2;break}return e.abrupt("return");case 2:if(t.isReq=!0,n=t.queryParam.order_by,o={All:"All",days:"day",week:"week",months:"month"},time="All"===t.timeName?"":"".concat(o[t.timeName],"_"),param=Ot(Ot({},t.queryParam),{},{artwork_types:[1,3,4,6,7],model_nos:[t.$route.params.id],order_by:"hot"===n?"".concat(time).concat(n):"new"}),r={artwork_types:[1,3,4,6,7],model_nos:[t.$route.params.id],page:t.queryParam.page,page_size:t.queryParam.page_size,offset:t.queryParam.offset||""},"trending"!==n){e.next=14;break}return e.next=11,Object($t.getWaterHomeArtworkRecommend)(r);case 11:e.t0=e.sent,e.next=17;break;case 14:return e.next=16,Object($t.getWaterHomeArtwork)(param);case 16:e.t0=e.sent;case 17:1e4===(c=e.t0).status.code&&(c.data.has_more?t.isLock=!1:t.isLock=!0,t.relatedImages=t.relatedImages.concat(Object(l.o)(c.data.items)),t.isReq=!1,1===t.queryParam.page&&(t.queryParam.offset=c.data.offset),t.queryParam.page++);case 19:case"end":return e.stop()}}),e)})))()},intList:function(){this.relatedImages=[],this.isReq=!1,this.isLock=!1,this.queryParam.page=1,this.queryParam.offset="",this.getList()},handleTimeCommand:function(t){this.timeName=t.name,this.intList()},handleCommand:function(t){this.queryParam.order_by=t,this.intList()},debounceImgPGScroll:Object(tt.debounce)((function(){this.getList()}),500)}},St=(n(4969),n(4970),Object(C.a)(It,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"related-recommend"},[o("div",{staticClass:"title-div"},[o("span",{staticClass:"title"},[n._v(n._s(n.$t("ExploreRelated")))]),n._v(" "),o("div",{staticClass:"Screening"},["hot"===n.queryParam.order_by?o("el-dropdown",{attrs:{trigger:"hover"},on:{command:n.handleTimeCommand}},[o("div",{staticClass:"el-dropdown-link selectTime"},[o("div",[o("i",{staticClass:"el-icon-time"}),n._v(" "),o("span",[n._v(n._s(n.$t(n.timeName)))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})]),n._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},n._l(n.timeTypeOption,(function(t,e){return o("el-dropdown-item",{key:e,attrs:{command:t}},[o("div",{staticClass:"el-dropdown-item el-dropdown-item-time"},[o("span",[n._v(n._s(n.$t(t.name)))])])])})),1)],1):n._e(),n._v(" "),o("el-dropdown",{attrs:{trigger:"hover"},on:{command:n.handleCommand}},[o("div",{staticClass:"el-dropdown-link"},[o("div",[o("i",{staticClass:"iconfont",class:"icon-".concat(n.setIcon())}),n._v(" "),o("span",[n._v(n._s(n.$t((null===(t=n.queryParam)||void 0===t||null===(t=t.order_by)||void 0===t?void 0:t.charAt(0).toUpperCase())+(null===(e=n.queryParam)||void 0===e||null===(e=e.order_by)||void 0===e?void 0:e.slice(1)))))])]),n._v(" "),o("i",{staticClass:"el-icon-arrow-down"})]),n._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},n._l(n.newTypeOption,(function(t,e){return o("el-dropdown-item",{key:e,attrs:{command:t.id}},[o("div",{staticClass:"el-dropdown-item"},[o("i",{staticClass:"iconfont",class:"icon-".concat(t.icon)}),n._v(" "),o("span",[n._v(n._s(n.$t(t.name)))])])])})),1)],1)],1)]),n._v(" "),o("div",{ref:"relatewraper",staticClass:"related-images"},[o("HyWaterfallFlowList",{attrs:{container:"relatewraper",list:n.relatedImages,logEventData:{dataInfo:n.dataInfo}},on:{load:n.debounceImgPGScroll}}),n._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.isReq,expression:"isReq"}],staticClass:"loadBox"})],1)])}),[],!1,null,"1ae2c76a",null).exports),Lt={name:"ModelDetail",components:{TabsNavNew:w,PictureWall:$,Tags:O,ModelIntroduction:R,CmtComments:A.default,UserProfile:U,CreateCollectDownload:Q,VersionDetail:ft,VersionIntroduction:xt,LicenseScope:Dt,RelatedRecommend:St},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,m,v,f,data,h,_,y,C,w,x,k;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,o=t.query,r=t.$axios,l=t.error,t.from,t.app,c=null==n?void 0:n.id,d=o.v,m="/api/v1/model/detail","other"==(null==o?void 0:o.type)&&(m="/api/v1/model/auditDetail"),n.ss=I.e.TitleDescription,e.prev=6,v={id:c},d&&(v.ver_id=d),e.next=11,r.$post(m,v);case 11:return f=e.sent,data=f.data,h={page:1,page_size:50,model_no:c,order_by:"hot",artwork_types:[1,3,4,6,7],model_nos:[c]},e.next=16,r.$post("/api/v1/square/v3/artwork/list",h);case 16:return _=e.sent,y=_.data,w=(C=y||{}).items,x=C.offset,h.page++,h.offset=x,k={relatedImages:w,queryParam:h},data&&(k.modelInfo=data,["none","-"].includes(data.refer)&&(k.modelInfo.refer="")),e.abrupt("return",k);case 26:e.prev=26,e.t0=e.catch(6),console.log("模型详情页-> asyncData错误啦：",e.t0),l({statusCode:404,message:e.t0});case 30:case"end":return e.stop()}}),e,null,[[6,26]])})))()},head:function(){var t,e=this.modelInfo||{},n=e.name,desc=e.desc,o=e.tags,r=e.author,l=e.stat,c=e.samples,d=e.cover;desc=desc&&desc.replace(/<[^>]*>/g,"");var m=o?o.map((function(t){return t.title})).toString():"",title=this.$t(n?"ModelDetailsTitle":"DisabledModel",{name:n});return{title:title,meta:[{hid:"description",name:"description",content:this.$t("modelDetailDesc",{name:n})},{hid:"keywords",name:"keywords",content:n,tag:m},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:this.$t("modelDetailDesc",{name:n})},{hid:"og:image",name:"og:image",content:c&&(null===(t=c[0])||void 0===t?void 0:t.url)||d}],script:[{type:"application/ld+json",json:{"@context":"https://schema.org","@type":"SoftwareApplication",name:n||title,offers:{"@type":"Offer",price:"0"},aggregateRating:{"@type":"AggregateRating",ratingValue:"4.9",ratingCount:(null==l?void 0:l.num_of_task)||1e3},creator:{name:(null==r?void 0:r.name)||"SeaArt","@type":"Person"}}}],__dangerouslyDisableSanitizers:["script"]}},data:function(){return{modelDetailInfo:{},versionId:this.$route.query.v||"",commentCount:0,formatNumberForeign:l.p,dotReportInfo:{category:"default",view_domain:"details_model",batch_id:"",action:"",obj_no:"",obj_type:1,negative_ids:[]},loading:!1}},mounted:function(){this.getModelDetail()},activated:function(){this.getModelDetail()},methods:{getModelDetail:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,Object(r.d)({id:t.$route.params.id,ver_id:t.versionId||"",scene:"model_detail_v2"});case 3:1e4===(n=e.sent).status.code&&(t.modelDetailInfo=n.data||{},t.versionId||(t.versionId=t.modelDetailInfo.model_ver_no),t.$xyLogEvent({front_operation:"exposure",entity_name:"model-detail-v2",entity_type:"model-detail-v2",data_info:JSON.stringify({model_id:t.$route.params.id,model_ver_id:null===(o=t.modelDetailInfo)||void 0===o||null===(o=o.model_ver_info_v2)||void 0===o?void 0:o.model_ver_id,base_model:null===(l=t.modelDetailInfo)||void 0===l?void 0:l.base_model,type:null===(c=t.modelDetailInfo)||void 0===c?void 0:c.type})})),t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},onChange:function(t){var e=this;this.versionId!==t.id&&(this.versionId=t.id,this.$router.replace({path:this.$route.path,query:{v:t.id}}),this.$nextTick((function(){e.getModelDetail()})))},updateCountNum:function(t){this.commentCount=t}}},jt=(n(4971),Object(C.a)(Lt,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"model-detail",on:{click:function(t){return t.target!==t.currentTarget?null:n.$router.back()}}},[o("div",{staticClass:"mobile-back-to",on:{click:function(t){return t.stopPropagation(),n.$router.back()}}},[o("i",{staticClass:"el-icon-back"})]),n._v(" "),o("div",{staticClass:"model-detail-main"},[o("TabsNavNew",{attrs:{info:n.modelDetailInfo,chooseId:n.versionId},on:{onChange:n.onChange}}),n._v(" "),o("div",{staticClass:"model-detail-content"},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticClass:"model-detail-content-left"},[o("PictureWall",{attrs:{info:n.modelDetailInfo}}),n._v(" "),o("Tags",{attrs:{tags:n.modelDetailInfo.tags}}),n._v(" "),o("ModelIntroduction",{attrs:{info:n.modelDetailInfo,versionId:n.versionId}}),n._v(" "),o("div",{staticClass:"cmt-comments-container"},[o("div",{staticClass:"cmt-comments-container-title"},[o("span",{staticClass:"title"},[n._v(n._s(n.$t("comment")))]),n._v(" "),o("span",{staticClass:"count"},[n._v(n._s(n.formatNumberForeign(n.commentCount)))])]),n._v(" "),null!==(t=n.modelDetailInfo)&&void 0!==t&&t.id?o("CmtComments",{ref:"cmtComments",attrs:{type:2,infos:n.modelDetailInfo,inputPosition:"top",isShowCommentCount:!1},on:{updateCountNum:n.updateCountNum}}):n._e()],1)],1),n._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticClass:"model-detail-content-right",attrs:{"data-group":"model-version-info"}},[o("UserProfile",{attrs:{modelInfo:n.modelDetailInfo}}),n._v(" "),o("div",{staticClass:"model-detail-content-right-container"},[o("CreateCollectDownload",{attrs:{modelInfo:n.modelDetailInfo,dotReportInfo:n.dotReportInfo}}),n._v(" "),o("VersionDetail",{attrs:{modelInfo:n.modelDetailInfo},on:{updateData:n.getModelDetail}}),n._v(" "),o("VersionIntroduction",{attrs:{modelInfo:n.modelDetailInfo}}),n._v(" "),o("LicenseScope",{attrs:{modelInfo:n.modelDetailInfo}})],1)],1)])],1),n._v(" "),o("RelatedRecommend",{attrs:{versionId:n.versionId,baseModel:null===(e=n.modelDetailInfo)||void 0===e?void 0:e.base_model}})],1)}),[],!1,null,"63f61fee",null));e.default=jt.exports;installComponents(jt,{CmtComments:n(116).default})},5727:function(t,e,n){"use strict";n.r(e);n(11),n(6),n(12),n(13),n(8),n(4),n(7);var o=n(3),r=n(2),l=(n(20),n(38)),c=(n(18),n(1)),d=n(145),m=(n(19),n(24),n(10)),v={name:"ImageViewer",props:{imageUrl:{type:String,required:!0},showThumbnail:{type:Boolean,default:!1},alt:{type:String,default:""}},data:function(){return{isShow:!1}},methods:{closeViewer:function(){this.isShow=!1,this.$emit("close")},showViewer:function(){this.imageUrl&&(this.isShow=!0,this.$emit("open"))}}},f=(n(5505),n(0)),h={name:"TavernCardDetailHeader",components:{ImageViewer:Object(f.a)(v,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"base-image-viewer"},[t.showThumbnail?e("div",{staticClass:"thumbnail-container",on:{click:t.showViewer}},[e("img",{staticClass:"thumbnail-image",attrs:{src:t.imageUrl,alt:t.alt}})]):t._e(),t._v(" "),e("transition",{attrs:{name:"fade"}},[t.isShow?e("div",{staticClass:"custom-image-viewer",on:{click:t.closeViewer}},[e("div",{staticClass:"viewer-container"},[e("img",{ref:"viewerImage",staticClass:"viewer-image",attrs:{src:t.imageUrl,alt:t.alt}})])]):t._e()])],1)}),[],!1,null,"2d8a9215",null).exports},props:{item:{type:Object,default:function(){return{}}},name:{type:String,default:""},imageUrl:{type:String,default:""},chatNum:{type:[String,Number],default:"0"},messageNum:{type:[String,Number],default:"0"},cover:{type:Object,default:function(){return{}}}},computed:{ribbonTooltip:function(){return"".concat(this.$t("Total"),": ").concat(this.$t("ST_Frontpage_msgcount",{num1:this.messageNum}))}},data:function(){return{formatNumberForeign:m.p}},methods:{showImageViewer:function(){1!==this.item.nsfw&&this.$refs.imageViewer.showViewer()}}},y=(n(5506),n(5507),Object(f.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"character-card-header"},[e("div",{staticClass:"character-name-box"},[e("h2",{staticClass:"character-name"},[e("span",[t._v(t._s(t.name))])]),t._v(" "),e("el-tooltip",{attrs:{effect:"dark",content:t.ribbonTooltip,placement:"bottom","popper-class":"card-detailtext-tooltip"}},[e("div",{staticClass:"detail-card-ribbon"},[e("div",{staticClass:"ribbon-content"},[e("i",{staticClass:"iconfont icon-a-Component1"}),t._v(" "),e("p",{staticClass:"stats-text"},[t._v(t._s(t.formatNumberForeign(t.messageNum)||0))])])])])],1),t._v(" "),e("div",{staticClass:"character-image"},[e("img",{class:{"nsfw-bg":1===t.item.nsfw},attrs:{src:t.cover.url||t.imageUrl,alt:t.name},on:{click:t.showImageViewer}})]),t._v(" "),e("client-only",[e("ImageViewer",{ref:"imageViewer",attrs:{imageUrl:t.cover.url||t.imageUrl,alt:t.name}})],1)],1)}),[],!1,null,"8b142baa",null).exports),C=(n(72),n(9)),w=n(211);function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var D={name:"TavernCardDetailInfo",props:{authorName:{type:String,default:""},authorId:{type:[String,Number],default:""},description:{type:String,default:""},createdDate:{type:[String,Number],default:""},updatedDate:{type:[String,Number],default:""},publishedDate:{type:[String,Number],default:""}},computed:k(k({},Object(c.c)("user",["userInfo"])),{},{isOwner:function(){var t,e;return!(!this.authorId||null===(t=this.userInfo)||void 0===t||!t.id)&&this.authorId===(null===(e=this.userInfo)||void 0===e?void 0:e.id)}}),data:function(){return{formatMsgForStCard:w.b,formatTimestamp:C.V}},methods:{authorUrl:function(){return this.isOwner?this.localePath("/personal"):this.localePath("/user/".concat(this.authorId))}}},$=(n(5508),Object(f.a)(D,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"character-card-info"},[e("div",{staticClass:"author-info"},[e("div",{staticClass:"author"},[e("div",{staticClass:"author-inner"},[e("div",{staticClass:"by-text"},[t._v("by: ")]),t._v(" "),e("a",{staticClass:"author-name",attrs:{href:t.authorUrl(),target:"_blank"}},[t._v("@"+t._s(t.authorName||t.authorId))])])]),t._v(" "),t._m(0)]),t._v(" "),t.description?e("div",{staticClass:"description-content",domProps:{innerHTML:t._s(t.formatMsgForStCard(t.description,!1,this))}}):t._e(),t._v(" "),e("div",{staticClass:"date-info"},[e("div",{staticClass:"date-item"},[t._v("\n      "+t._s(t.$t("ST_Detailed_createtime"))+"\n      "),e("span",[t._v(t._s(t.formatTimestamp(t.createdDate,"yyyy/mm/dd")))])]),t._v(" "),e("div",{staticClass:"date-item"},[t._v("\n      "+t._s(t.$t("ST_Detailed_updatetime"))+"\n      "),e("span",[t._v(t._s(t.formatTimestamp(t.updatedDate,"yyyy/mm/dd")))])]),t._v(" "),e("div",{staticClass:"date-item"},[t._v("\n      "+t._s(t.$t("ST_Detailed_publishtime"))+"\n      "),e("span",[t._v(t._s(t.formatTimestamp(t.publishedDate,"yyyy/mm/dd")))])])])])}),[function(){var t=this._self._c;return t("div",{staticClass:"favorite-button"},[t("div",{staticClass:"favorite-icon"})])}],!1,null,"2e281cf9",null).exports),T={name:"TavernCardDetailTagList",props:{tags:{type:Array,default:function(){return[]}}},data:function(){return{EMOJI_ENUM_ST:C.f}}},O=(n(5509),Object(f.a)(T,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"character-card-tag-list"},t._l(t.tags,(function(n){return e("div",{key:n.id,staticClass:"tag-item"},[e("div",{staticClass:"tag-content"},[t.EMOJI_ENUM_ST(n.id)?e("span",{staticClass:"tag-emoji"},[t._v(t._s(t.EMOJI_ENUM_ST(n.id))+" ")]):t._e(),t._v(" "),e("span",{staticClass:"tag-text"},[t._v(t._s(n.title))])])])})),0)}),[],!1,null,"7c04c319",null).exports),I=n(53),S={name:"TavernCardDetailProfileItem",components:{BaseAvatar:I.default},props:{userData:{type:Object,default:function(){return{}}}}},L=(n(5510),Object(f.a)(S,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"profile-item"},[e("div",{staticClass:"avatar-container"},[e("BaseAvatar",{class:{"nsfw-bg":1===t.userData.nsfw},attrs:{userData:t.userData,size:96,alt:t.userData.name}})],1),t._v(" "),e("div",{staticClass:"profile-name"},[t._v(t._s(t.userData.name))])])}),[],!1,null,"0a39a556",null)),j=L.exports;installComponents(L,{BaseAvatar:n(53).default});var E={name:"TavernCardDetailActionButton",props:{text:{type:String,required:!0},icon:{type:String,default:"iconfont icon-duihua11"}}},P=(n(5511),Object(f.a)(E,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"action-button"},[e("div",{staticClass:"action-button-inner"},[e("i",{staticClass:"button-icon",class:t.icon}),t._v(" "),e("div",{staticClass:"button-text"},[t._v(t._s(t.text))])])])}),[],!1,null,"5e5dcc10",null).exports);function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function N(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var R={name:"TavernCardDetailAction",components:{TavernCardDetailProfileItem:j,TavernCardDetailActionButton:P},props:{characterData:{type:Object,required:!0,default:function(){return{}}}},computed:N(N({},Object(c.c)("user",["userInfo","isLoggedIn"])),{},{characterUserData:function(){var t;return{name:this.characterData.name,head:null===(t=this.characterData.cover)||void 0===t?void 0:t.url,id:this.characterData.id}}}),data:function(){return{}},methods:{goChat:function(){this.$emit("goChat")}}},A=(n(5512),Object(f.a)(R,(function(){var t,e,n=this,o=n._self._c;return o("div",{staticClass:"character-card-action"},[o("div",{staticClass:"character-profiles"},[o("TavernCardDetailProfileItem",{attrs:{userData:n.userInfo}}),n._v(" "),o("i",{staticClass:"iconfont icon-liandongliaotian profile-separator"}),n._v(" "),o("TavernCardDetailProfileItem",{attrs:{userData:n.characterUserData}})],1),n._v(" "),o("div",{staticClass:"action-buttons"},[(null===(t=n.characterData.latest_session)||void 0===t?void 0:t.active_at)>0||null!==(e=n.characterData.latest_session)&&void 0!==e&&e.id?[o("TavernCardDetailActionButton",{attrs:{"data-event":"click_tavern_card_chat","data-id":n.characterData.id,text:n.$t("ST_Detailed_chatcontbtn")},nativeOn:{click:function(t){return n.goChat.apply(null,arguments)}}})]:o("TavernCardDetailActionButton",{attrs:{"data-event":"click_tavern_card_chat","data-id":n.characterData.id,text:n.$t("ST_Detailed_chatbtn",{name:n.characterData.name})},nativeOn:{click:function(t){return n.goChat.apply(null,arguments)}}})],2)])}),[],!1,null,"55e45fa1",null)),F=A.exports,B={name:"TavernCardDetailBg"},V=(n(5513),Object(f.a)(B,(function(){this._self._c;return this._m(0)}),[function(){var t=this,e=t._self._c;return e("div",{staticClass:"character-card-bg"},[e("div",{staticClass:"detail-card-border"}),t._v(" "),e("div",{staticClass:"detail-card-bg"}),t._v(" "),e("div",{staticClass:"detail-card-star-img-container"},[e("img",{staticClass:"detail-card-star-img",attrs:{src:"https://image.cdn2.seaart.me/tavern/loading/star.svg",alt:"seaart"}})])])}],!1,null,"d6f73a36",null).exports);function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function H(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var z={name:"TavernCardDetailCard",mixins:[d.a],components:{TavernCardDetailHeader:y,TavernCardDetailInfo:$,TavernCardDetailTagList:O,TavernCardDetailAction:F,TavernCardDetailBg:V,TavernCardDetailActionButton:P},props:{characterData:{type:Object,required:!0,default:function(){return{}}}},computed:H(H({},Object(c.c)("user",["userInfo","isLoggedIn"])),{},{author:function(){var t;return(null===(t=this.characterData)||void 0===t?void 0:t.author)||{}},cover:function(){var t;return(null===(t=this.characterData)||void 0===t?void 0:t.cover)||{}},stat:function(){var t;return(null===(t=this.characterData)||void 0===t?void 0:t.stat)||{}}}),methods:H(H({},Object(c.b)("tavern",["showChatDialog"])),{},{goChat:function(){var t;this.isLoggedIn?(this.showChatDialog(),this.$xyLogEvent({front_operation:"exposure",entity_name:"sillyTavern-show",entity_type:"sillyTavern",obj_id:null===(t=this.characterData)||void 0===t?void 0:t.id})):this.$EventBus.$emit("openLoginDialog")},dataInfo:function(){var t={id:this.characterData.id,position:"tavern-detail"};return JSON.stringify(t)}})},W=(n(5514),Object(f.a)(z,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"detail-card"},[n("TavernCardDetailBg"),e._v(" "),n("div",{staticClass:"detail-card-content"},[n("TavernCardDetailHeader",{attrs:{item:e.characterData,name:e.characterData.name,cover:e.cover,chatNum:e.stat.num_of_task,messageNum:e.stat.num_of_token}}),e._v(" "),n("TavernCardDetailInfo",{attrs:{authorName:e.author.name,authorId:e.author.id,description:(null===(t=e.characterData.creator_notes)||void 0===t?void 0:t.content)||"",createdDate:e.characterData.create_at,updatedDate:e.characterData.update_at,publishedDate:e.characterData.publish_at}}),e._v(" "),n("TavernCardDetailTagList",{attrs:{tags:e.characterData.tags}}),e._v(" "),n("TavernCardDetailAction",{attrs:{characterData:e.characterData},on:{goChat:e.goChat}})],1)],1)}),[],!1,null,"1deccd30",null).exports),G=(n(41),n(26),n(257)),K=(n(777),n(47),n(511)),Y=n.n(K),X=(n(778),n(512)),J={name:"TavernCardDetailDefinition",components:{ElCollapse:n.n(X).a,ElCollapseItem:Y.a},props:{total:{type:Number,default:0},permanent:{type:Number,default:0},sections:{type:Array,default:function(){return[]}}},data:function(){return{activeSections:[],formatMsgForStCard:w.b}}},Q=(n(5515),Object(f.a)(J,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"character-card-definition"},[e("div",{staticClass:"definition-sections"},[e("el-collapse",{model:{value:t.activeSections,callback:function(e){t.activeSections=e},expression:"activeSections"}},[t._l(t.sections,(function(section,n){return[e("el-collapse-item",{key:n,attrs:{name:section.titleKey}},[e("template",{slot:"title"},[e("div",{staticClass:"section-title"},[t._v(t._s(t.$t(section.titleKey)))])]),t._v(" "),section.entries&&section.entries.length>0?t._l(section.entries,(function(n){return e("div",{key:n.id,staticClass:"section-content section-content-world-book"},[e("div",[t._v(t._s(n.comment))]),t._v(" "),e("div",{domProps:{innerHTML:t._s(t.formatMsgForStCard(n.content,!1,!1))}})])})):t._e(),t._v(" "),section.content?[e("div",{staticClass:"section-content",domProps:{innerHTML:t._s(t.formatMsgForStCard(section.content,!1,this))}})]:t._e()],2)]}))],2)],1)])}),[],!1,null,"286485bb",null).exports),Z=n(30),tt=(n(185),n(243),n(40),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(32),n(50),n(16),n(22),n(31),n(49),n(43),n(21),n(77),n(141),n(142),n(109),n(39)),et=n(45),at=n(63),it=n(83),nt=n(209),ot=n(162),main=n(811),st=n.n(main),lt=n(1233),ct=n(14),ut={props:{value:{type:Array,default:function(){return[]}}},methods:{removeImage:function(t){var e=Object(ct.a)(this.value);e.splice(t,1),this.$emit("input",e),this.$emit("image-urls-change")}}},mt=(n(5516),Object(f.a)(ut,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"image-preview"},t._l(t.value,(function(n,o){return e("div",{key:o,staticClass:"image-preview-item"},[e("img",{attrs:{src:n,alt:""}}),t._v(" "),e("div",{staticClass:"remove-btn",on:{click:function(e){return t.removeImage(o)}}},[e("i",{staticClass:"el-icon-close"})])])})),0)}),[],!1,null,"4b405316",null).exports),pt=(n(69),{name:"AppendToBody",props:{visible:{type:Boolean,default:!0},target:{type:String,default:"body"},zIndex:{type:Number,default:2e3}},data:function(){return{originalParent:null,originalPosition:null,appendedNode:null}},mounted:function(){var t=this;this.$nextTick((function(){t.appendToTarget()}))},beforeDestroy:function(){this.removeFromTarget()},methods:{getTargetElement:function(){return"string"==typeof this.target?document.querySelector(this.target)||document.body:this.target instanceof HTMLElement?this.target:document.body},appendToTarget:function(){var t=this.$refs.wrapper;t&&(this.originalParent=t.parentNode,this.originalPosition=Array.from(t.parentNode.childNodes).indexOf(t),t.style.zIndex=this.zIndex,this.getTargetElement().appendChild(t),this.appendedNode=t,this.$emit("appended"))},removeFromTarget:function(){if(this.appendedNode&&this.originalParent){try{this.originalPosition<this.originalParent.childNodes.length?this.originalParent.insertBefore(this.appendedNode,this.originalParent.childNodes[this.originalPosition]):this.originalParent.appendChild(this.appendedNode)}catch(e){var t=this.appendedNode.parentNode;t&&t.removeChild(this.appendedNode)}this.appendedNode=null,this.$emit("removed")}},updateVisible:function(){this.appendedNode&&(this.appendedNode.style.display=this.visible?"":"none")}},watch:{visible:function(t){var e=this;this.$nextTick((function(){e.updateVisible()}))},target:function(){var t=this;this.removeFromTarget(),this.$nextTick((function(){t.appendToTarget()}))}}}),vt=(n(5517),Object(f.a)(pt,(function(){var t=this;return(0,t._self._c)("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],ref:"wrapper"},[t._t("default")],2)}),[],!1,null,"2ec97e9f",null).exports);function ft(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ft(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _t={name:"CmtComments",mixins:[et.a],props:{infos:{type:Object,default:function(){}},type:{type:Number,default:1},dotReportInfo:{type:Object,default:function(){return{view_domain:"",batch_id:"",action:"",obj_no:"",obj_type:1,negative_ids:[],category:"default"}}},naturalScroll:{type:Boolean,default:!1},inputPosition:{type:String,default:"bottom"},isReverseLoad:{type:Boolean,default:!1},inputIcons:{type:Array,default:function(){return["emoji","picture","send"]}},showLoadMore:{type:Boolean,default:!1},showCommentNum:{type:Boolean,default:!1},scrollContainer:{default:function(){return null}}},components:{CollectPopover:at.default,BaseAvatar:I.default,EmojiPicker:st.a,HyUploadMoald:it.default,ImagePreview:mt,ViewImage:nt.a,AppendToBody:vt},data:function(){return{formatNumberForeign:m.p,commListData:{obj_id:"",obj_type:1,page:1,sort:"like"},commList:[],commTotal:0,pubTxt:"",replyTxt:"",isReplyId:"",loading:!1,noMoreData:!1,pubLoading:!1,replyPubLoading:!1,repMorLoading:!1,likeLoading:!1,typeKey:"",selectedImageUrls:[],inEditMode:!1,inReplyEditMode:!1,replyMeta:{item:null,index:null,toUser:!1},showEmojiPanel:!1,emojiTable:lt.a,currentTrigger:null,scrollHandler:null,throttledUpdatePosition:null}},computed:ht(ht(ht({},Object(c.c)("user",["isLoggedIn"])),Object(c.e)("user",["userInfo","adminOff"])),{},{isAuthor:function(){var t=this;return function(e){var n;return e===(null===(n=t.infos.author)||void 0===n?void 0:n.id)}},canDelete:function(){var t=this;return function(e){var n;return 1===t.adminOff||e.user_info.user_id===(null===(n=t.userInfo)||void 0===n?void 0:n.id)}}}),watch:{commTotal:{handler:function(t){this.$emit("updateCountNum",t||0)},immediate:!0},"infos.id":{handler:function(t,e){t&&e&&t!==e&&(this.commListData.obj_id=t,this.commListData.obj_type=this.type,this.getCommentList(!0))},immediate:!0},inEditMode:{handler:function(t){var e=this;t?this.$nextTick((function(){e.lockEmojiPicker()})):this.showEmojiPanel=!1}},showEmojiPanel:{handler:function(t){t?(this.initEmojiTable(),this.$refs.popoverEditorRef.$el.style.display="block"):this.$refs.popoverEditorRef.$el.style.display="none"}},scrollContainer:{handler:function(t){if(this.naturalScroll){var e=this.isReverseLoad?this.reverseLoadFn:this.checkLoadMoreAll;window.removeEventListener("scroll",e)}else this.$refs.list&&this.$refs.list.removeEventListener("scroll",this.checkLoadMore);t.addEventListener("scroll",this.checkLoadMore)}}},mounted:function(){if(this.initData(),this.getCommentList(!0),!this.showLoadMore)if(this.naturalScroll){var t=this.isReverseLoad?this.reverseLoadFn:this.checkLoadMoreAll;window.addEventListener("scroll",t)}else this.$refs.list&&this.$refs.list.addEventListener("scroll",this.checkLoadMore)},beforeDestroy:function(){if(this.naturalScroll){var t=this.isReverseLoad?this.reverseLoadFn:this.checkLoadMoreAll;window.removeEventListener("scroll",t)}else this.scrollContainer?this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this.checkLoadMore):this.$refs.list&&this.$refs.list.removeEventListener("scroll",this.checkLoadMore);this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler,!0),this.scrollHandler=null),this.throttledUpdatePosition&&(this.throttledUpdatePosition.cancel(),this.throttledUpdatePosition=null)},methods:{initData:function(){switch(this.type){case 1:this.typeKey="artwork";break;case 2:this.typeKey="model";break;case 4:this.typeKey="gallery";break;case 5:this.typeKey="lookbook";break;case 9:this.typeKey="character";break;case 11:this.typeKey="palette";break;case 13:this.typeKey="workflow";break;case 15:this.typeKey="ai_video";break;case 21:this.typeKey="ai_novel"}this.commListData.obj_id=this.infos.id,this.commListData.obj_type=this.type},clickTransBtn:function(t){null!=t&&t.showTranslation?this.$set(t,"showTranslation",!1):(this.$logEvent("log_actions",{operation:"view_translation",behavior_info:this.type,behavior_info_sub:this.infos.id}),null!=t&&t.translationTxt?this.$set(t,"showTranslation",!0):this.translateContent(t))},translateContent:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,text;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o=t.content,r=localStorage.getItem("translate_language")||e.$i18n.locale,r=(null==(l={zhCN:"zh-cn",zhTW:"zh-tw"})?void 0:l[r])||r,e.$set(t,"isLoading",!0),n.next=8,Object(ot.a)(o,{to:r});case 8:c=n.sent,text=c.text,e.$set(t,"isLoading",!1),text&&(e.$set(t,"translationTxt",text),e.$set(t,"showTranslation",!0)),n.next=20;break;case 14:throw n.prev=14,n.t0=n.catch(0),e.$set(t,"isLoading",!1),localStorage.removeItem("translate_".concat(e.sessionId)),console.error("谷歌翻译报错",n.t0),new n.t0("谷歌翻译报错",n.t0);case 20:case"end":return n.stop()}}),n,null,[[0,14]])})))()},handleMark:function(){this.isLoggedIn?this.setCollectData(this.infos).includes("collect_selected")?(this.$refs.collectPopover.visible=!1,this.setCollect(this.infos,this.typeKey)):(console.log("收藏"),this.$refs.collectPopover.visible=!0):this.$EventBus.$emit("openLoginDialog")},setTiem:function(t){var e=t?new Date(t):new Date,n=new Date;if(e.toDateString()===n.toDateString())return"".concat(this.$t("today")," ").concat(e.getHours().toString().padStart(2,"0"),":").concat(e.getMinutes().toString().padStart(2,"0"));var o=new Date;return o.setDate(n.getDate()-1),e.toDateString()===o.toDateString()?"".concat(this.$t("yesterday")," ").concat(e.getHours().toString().padStart(2,"0"),":").concat(e.getMinutes().toString().padStart(2,"0")):e.getFullYear()===n.getFullYear()?"".concat((e.getMonth()+1).toString().padStart(2,"0"),"-").concat(e.getDate().toString().padStart(2,"0")):"".concat(e.getFullYear(),"-").concat((e.getMonth()+1).toString().padStart(2,"0"),"-").concat(e.getDate().toString().padStart(2,"0"))},onLike:function(t,e,n){var o,r=this;if(this.isLoggedIn){if(!this.likeLoading){this.likeLoading=!0;var l=1;t.is_like&&(l=0),Object(tt.e)({comment_id:t.id,obj_id:this.infos.id,obj_type:this.type,type:l}).then((function(o){1e4==o.status.code&&(n||0==n?(r.commList[e].children[n].is_like=!t.is_like,0==l?r.commList[e].children[n].like_count>0&&r.commList[e].children[n].like_count--:r.commList[e].children[n].like_count++):(r.commList[e].is_like=!t.is_like,0==l?r.commList[e].like_count>0&&r.commList[e].like_count--:r.commList[e].like_count++))})).finally((function(e){r.likeLoading=!1,r.$route.path.includes("/event-center")&&r.$logEvent("log_actions",{operation:1===l?"like":"cancel_like",behavior_info:t.id,obj_type:r.type})}))}}else null!==(o=this.$route)&&void 0!==o&&null!==(o=o.name)&&void 0!==o&&o.includes("aiChat")?this.$EventBus.$emit("openLoginDialog",{callBack:function(){return r.$emit("newChat")}}):this.$EventBus.$emit("openLoginDialog")},openPub:function(){this.$refs.commTitle&&(this.$refs.commTitle.scrollIntoView({behavior:"smooth",block:"center"}),this.$refs.pubInput.focus())},openReply:function(t){var e=this;this.pubTxt="",this.replyTxt="",this.selectedImageUrls=[],this.isReplyId===t?this.isReplyId="":this.isReplyId=t,this.$nextTick((function(){e.$refs.replyInput[0]&&(e.$refs.replyInput[0].scrollIntoView({behavior:"smooth",block:"center"}),e.$refs.replyInput[0].focus())})),this.showEmojiPanel=!1},onkeyRep:function(t,e,n,o){13==o.keyCode&&this.replyComm(t,e,n)},replyComm:function(t,e,n){var o,r=this;if(this.isLoggedIn){if((this.replyTxt||this.selectedImageUrls.length)&&!this.replyPubLoading){this.replyPubLoading=!0;var l,c={content:this.replyTxt,obj_id:this.infos.id,obj_type:this.type,root_id:n?t.root_id:t.id,parent_id:t.id,pictures:this.selectedImageUrls.map((function(t){return{url:new URL(t).pathname}}))};if(9===this.type)c.author_id=(null==this||null===(l=this.infos)||void 0===l||null===(l=l.author)||void 0===l?void 0:l.id)||"";Object(tt.d)(c).then((function(o){if(1e4===o.status.code){var l,c,d={user_info:{avatar:r.userInfo.head,avatar_frame:null===(l=r.userInfo)||void 0===l?void 0:l.avatar_frame,user_id:r.userInfo.id,username:r.userInfo.name,is_author:r.userInfo.id==(null===(c=r.infos)||void 0===c||null===(c=c.author)||void 0===c?void 0:c.id)?1:0},like_count:0,replies_count:0,content:r.replyTxt,id:o.data.comment_id,root_id:n?t.root_id:t.id,pictures:r.selectedImageUrls.map((function(t){return{url:t}}))};n&&(d.target=t.user_info),[null,"",void 0].includes(r.commList[e].children)&&(r.commList[e].children=[]),r.commList[e].children.unshift(d),r.replyTxt="",r.selectedImageUrls=[],r.isReplyId="",r.commTotal++;r.$logEvent("log_actions",{operation:"comment_image",behavior_info:["作品","模型","作品集","视频"][r.type-1]}),r.$emit("onCommentEnd",ht(ht({},o.data),{},{commTotal:r.commTotal}))}else 40007===o.status.code?r.$message.error(r.$t("sensitive_works_comment_prompt")):10628===o.status.code?r.$message({message:r.$t("comments_exterlinks_notion"),duration:7e3,type:"error"}):r.$message.error(r.$t("text_00256"))})).catch((function(){r.$message.error(r.$t("text_00256"))})).finally((function(t){r.replyPubLoading=!1,r.inEditMode=!1}))}}else null!==(o=this.$route)&&void 0!==o&&null!==(o=o.name)&&void 0!==o&&o.includes("aiChat")?this.$EventBus.$emit("openLoginDialog",{callBack:function(){return r.$emit("newChat")}}):this.$EventBus.$emit("openLoginDialog")},onkeyPub:function(t){13===t.keyCode&&this.onPub()},onPub:function(){var t,e=this;if(this.isLoggedIn){if((this.pubTxt||this.selectedImageUrls.length)&&!this.pubLoading){this.pubLoading=!0;var n,o={content:this.pubTxt,obj_id:this.infos.id,obj_type:this.type,pictures:this.selectedImageUrls.map((function(t){return{url:new URL(t).pathname}}))};if(9===this.type||76===this.type)o.author_id=(null==this||null===(n=this.infos)||void 0===n||null===(n=n.author)||void 0===n?void 0:n.id)||"";Object(tt.d)(o).then((function(t){if(1e4===t.status.code){var n,o,r={user_info:{avatar:e.userInfo.head,avatar_frame:null===(n=e.userInfo)||void 0===n?void 0:n.avatar_frame,user_id:e.userInfo.id,username:e.userInfo.name,is_author:e.userInfo.id==(null===(o=e.infos)||void 0===o||null===(o=o.author)||void 0===o?void 0:o.id)?1:0},like_count:0,replies_count:0,children:[],content:e.pubTxt,id:t.data.comment_id,pictures:e.selectedImageUrls.map((function(t){return{url:t}}))};e.commList.unshift(r),e.commTotal++,e.pubTxt="",e.selectedImageUrls=[];e.$logEvent("log_actions",{operation:"comment_image",behavior_info:["作品","模型","作品集","视频"][e.type-1]}),e.$emit("onCommentEnd",ht(ht({},t.data),{},{commTotal:e.commTotal}))}else 40007===t.status.code?e.$message.error(e.$t("sensitive_works_comment_prompt")):10628===t.status.code?e.$message({message:e.$t("comments_exterlinks_notion"),duration:7e3,type:"error"}):e.$message.error(e.$t("text_00256"))})).catch((function(){e.$message.error(e.$t("text_00256"))})).finally((function(t){e.pubLoading=!1,e.inEditMode=!1}))}}else null!==(t=this.$route)&&void 0!==t&&null!==(t=t.name)&&void 0!==t&&t.includes("aiChat")?this.$EventBus.$emit("openLoginDialog",{callBack:function(){return e.$emit("newChat")}}):this.$EventBus.$emit("openLoginDialog")},updateEmojiPanelPosition:function(){if(this.showEmojiPanel&&this.currentTrigger){var t=this.currentTrigger.getBoundingClientRect(),e=this.$refs.popoverEditorRef.$el;e.style.top="".concat(t.top-436-16,"px"),e.style.left="".concat(t.left-306,"px")}},onOpenEmojiPanel:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{item:null,index:null,toUser:!1};this.$logEvent("log_actions",{operation:"click_emoji",behavior_info:"on_detail_page",obj_type:this.type});var o=event.currentTarget;this.inEditMode=!0,this.inReplyEditMode=e,this.replyMeta=n,this.$nextTick((function(){if(t.showEmojiPanel=!t.showEmojiPanel,t.showEmojiPanel){t.currentTrigger=o;var e=t.$refs.popoverEditorRef.$el;e.style.position="fixed",e.style.zIndex="10",t.updateEmojiPanelPosition(),t.throttledUpdatePosition||(t.throttledUpdatePosition=_.throttle(t.updateEmojiPanelPosition,10)),t.scrollHandler=t.throttledUpdatePosition,window.addEventListener("scroll",t.scrollHandler,!0),t.$refs.emojiPicker.display.visible=!0}else{var n,r;if(t.inReplyEditMode)null===(n=t.$refs.replyInput)||void 0===n||null===(n=n[0])||void 0===n||n.focus();else null===(r=t.$refs.pubInput)||void 0===r||r.focus();t.scrollHandler&&(window.removeEventListener("scroll",t.scrollHandler,!0),t.scrollHandler=null),t.currentTrigger=null}}))},onOpenImagePanel:function(){var t,e,n=this,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{item:null,index:null,toUser:!1};(this.$logEvent("log_actions",{operation:"click_upload_image",behavior_info:"on_detail_page",obj_type:this.type}),this.inEditMode=!0,this.inReplyEditMode=o,this.replyMeta=r,this.inReplyEditMode)?null===(t=this.$refs.replyInput)||void 0===t||null===(t=t[0])||void 0===t||t.focus():null===(e=this.$refs.pubInput)||void 0===e||e.focus();this.$nextTick((function(){n.$refs.hyUploadModal.openModal()}))},handleConfirmImageSelect:function(t){var e=this,n=Object(Z.a)(t,1)[0];this.selectedImageUrls=[n.url],this.$nextTick((function(){e.updateEmojiPanelPosition()}))},updateRecentEmojis:function(t){var e=Object.entries(lt.a.CmtCommentsEmojiLook).find((function(e){var n=Object(Z.a)(e,2);n[0];return n[1]===t}))[0],n=JSON.parse(localStorage.getItem("recent_emojis")||"[]");Array.isArray(n)||(n=Object.entries(n).map((function(t){var e=Object(Z.a)(t,2);return{key:e[0],value:e[1]}}))),(n=n.filter((function(e){return e.value!==t}))).unshift({key:e,value:t}),n.length>10&&(n=n.slice(0,10)),localStorage.setItem("recent_emojis",JSON.stringify(n))},insert:function(t){if(this.updateRecentEmojis(t),this.inReplyEditMode){var e=this.$refs.replyInput[0],n=e.selectionStart,o=e.selectionEnd;this.replyTxt=this.replyTxt.substring(0,n)+t+this.replyTxt.substring(o),this.$nextTick((function(){var o=n+t.length;e.setSelectionRange(o,o)}))}else{var r=this.$refs.pubInput,l=r.selectionStart,c=r.selectionEnd;this.pubTxt=this.pubTxt.substring(0,l)+t+this.pubTxt.substring(c),this.$nextTick((function(){var e=l+t.length;r.setSelectionRange(e,e)}))}},lockEmojiPicker:function(){this.$refs.emojiPicker.hide=function(){},document.removeEventListener("keyup",this.$refs.emojiPicker.escape),this.$refs.emojiPicker.display.visible=!0},initEmojiTable:function(){var t=JSON.parse(localStorage.getItem("recent_emojis")||"[]"),e=new Map;t.forEach((function(t){e.set(t.key,t.value)})),this.emojiTable=ht({CmtCommentsRecentUse:e},Object.entries(lt.a).reduce((function(t,e){var n=Object(Z.a)(e,2),o=n[0],r=n[1];return t[o]=new Map(Object.entries(r)),t}),{})),this.$nextTick((function(){var t=document.querySelector(".editor-emoji-panel-section");t&&(t.scrollTop=0)}))},goToPersonal:function(t){var e,n=t.user_info.user_id,o=null===(e=this.userInfo)||void 0===e?void 0:e.id,path="/user/"+encodeURIComponent(n);o==n&&(path="/personal"),window.open(this.localePath(path),"_blank")},checkLoadMore:function(){var t=this.scrollContainer||this.$refs.list,e=t.scrollTop,n=t.scrollHeight,o=t.clientHeight;this.scrollContainer?e+o>=n&&this.getCommentList():e+o>=n-600&&this.getCommentList()},checkLoadMoreAll:function(){console.log("checkLoadMoreAll"),(window.pageYOffset||document.documentElement.scrollTop)+window.innerHeight>=document.documentElement.scrollHeight&&this.getCommentList()},reverseLoadFn:function(){var t=document.querySelector("#reverseLoadDiv"),e=t&&t.getBoundingClientRect(),n=window.innerHeight;t&&e.top<n&&this.getCommentList()},onRepMor:function(t,e){var n=this;console.log(t),this.repMorLoading||(this.repMorLoading=!0,Object(tt.f)({obj_id:this.infos.id,obj_type:this.type,root_id:t.id,page:t.replyPage,sort:"like"}).then((function(o){1e4==o.status.code&&(1==t.replyPage?n.commList[e].children=o.data.items||[]:n.commList[e].children=n.commList[e].children.concat(o.data.items||[]),n.commList[e].replyPage++)})).finally((function(t){n.repMorLoading=!1})))},getCommentList:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n&&(this.noMoreData=!1,this.commListData.page=1),this.loading||this.noMoreData||null===(t=this.commListData)||void 0===t||!t.obj_id||(this.loading=!0,Object(tt.f)(this.commListData).then((function(t){1e4==t.status.code&&(t.data.items.forEach((function(t){t.replies_count>1&&e.$set(t,"replyPage",1)})),n||1===e.commListData.page?e.commList=t.data.items||[]:e.commList=e.commList.concat(t.data.items||[]),e.commTotal=t.data.total,e.commListData.page++,t.data.items&&0!=t.data.items.length&&0!=t.data.has_more||(e.noMoreData=!0))})).finally((function(t){e.loading=!1})))},handleDelete:function(t,e){var n=this;this.$confirm(this.$t("deleteComment"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){n.deleteCommentFun(t,e)})).catch((function(){}))},deleteCommentFun:function(t,e){var n=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var r,l,c,d,m;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,Object(tt.h)({id:t.id});case 3:1e4===o.sent.status.code&&(e?(r=n.commList.findIndex((function(i){return i.id===e.id})))>-1&&(l=n.commList[r].children.findIndex((function(i){return i.id===t.id})))>-1&&(n.commList[r].children.splice(l,1),n.commList[r].replies_count=Math.max(0,n.commList[r].replies_count-1),n.commTotal=Math.max(0,n.commTotal-1)):(c=n.commList.findIndex((function(i){return i.id===t.id})))>-1&&(m=(null===(d=n.commList[c].children)||void 0===d?void 0:d.length)||0,n.commList.splice(c,1),n.commTotal=Math.max(0,n.commTotal-1-m)),n.$message.success(n.$t("deleteSuccess"))),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),console.error("删除评论失败:",o.t0);case 10:case"end":return o.stop()}}),o,null,[[0,7]])})))()},viewImage:function(t,e){this.$refs.viewImage.show(t,e)},isShowIcon:function(t){var e=this.inputIcons;return!(!t||!Array.isArray(e))&&e.includes(t)}}},gt=_t,bt=(n(5518),n(5519),Object(f.a)(gt,(function(){var t,e,n,o,r,l=this,c=l._self._c;return c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.loading,expression:"loading"}],staticClass:"cmt-comments",class:l.naturalScroll&&"natural-view"},["top"===l.inputPosition?c("div",{staticClass:"input-box-container"},[c("div",{staticClass:"input-box-container-inner"},[c("div",{staticClass:"inputBox"},[c("input",{directives:[{name:"model",rawName:"v-model",value:l.pubTxt,expression:"pubTxt"}],ref:"pubInput",attrs:{type:"text",maxlength:"300",placeholder:l.$t("saySom")},domProps:{value:l.pubTxt},on:{focus:function(t){l.isReplyId=""},keyup:l.onkeyPub,click:function(t){l.showEmojiPanel=!1},input:function(t){t.target.composing||(l.pubTxt=t.target.value)}}}),l._v(" "),l.isShowIcon("emoji")?c("div",{staticClass:"icon-btn",on:{click:function(t){return l.onOpenEmojiPanel(!1)}}},[c("Icon",{directives:[{name:"show",rawName:"v-show",value:!l.showEmojiPanel,expression:"!showEmojiPanel"}],attrs:{name:"emoji",size:"22",color:"#646466"}}),l._v(" "),c("Icon",{directives:[{name:"show",rawName:"v-show",value:l.showEmojiPanel,expression:"showEmojiPanel"}],attrs:{name:"jianpan",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),l.isShowIcon("picture")?c("div",{staticClass:"icon-btn",on:{click:function(t){return l.onOpenImagePanel(!1)}}},[c("Icon",{attrs:{name:"picture",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),l.isShowIcon("send")?c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.pubLoading,expression:"pubLoading"}],staticClass:"icon-btn",on:{click:l.onPub}},[c("Icon",{attrs:{name:"Comment_send",size:"22",color:"#646466"}})],1):l._e()]),l._v(" "),c("ImagePreview",{directives:[{name:"show",rawName:"v-show",value:!l.inReplyEditMode&&l.selectedImageUrls.length>0,expression:"!inReplyEditMode && selectedImageUrls.length > 0"}],on:{"image-urls-change":function(t){l.$nextTick((function(){return l.updateEmojiPanelPosition()}))}},model:{value:l.selectedImageUrls,callback:function(t){l.selectedImageUrls=t},expression:"selectedImageUrls"}})],1),l._v(" "),c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.pubLoading,expression:"pubLoading"}],staticClass:"post-review",on:{click:l.onPub}},[l._v(l._s(l.$t("AddComment")))])]):l._e(),l._v(" "),c("div",{ref:"list",staticClass:"commMain"},[l._t("cmtInner"),l._v(" "),21===l.type?[c("div",{staticClass:"action-box"},[c("div",{staticClass:"commFunBar"},[c("div",{staticClass:"funBarBnt"},[c("div",{staticClass:"commFunNum"},[c("i",{staticClass:"iconfont icon-work-show"}),l._v(" "),c("span",[l._v(l._s(l.formatNumberForeign(null===(t=l.infos.stat)||void 0===t?void 0:t.num_of_view)))])]),l._v(" "),c("div",{staticClass:"commFunNum",on:{click:l.openPub}},[c("i",{staticClass:"el-icon-chat-dot-round"}),l._v(" "),c("span",[l._v(l._s(l.commTotal))])]),l._v(" "),c("div",{on:{click:function(t){return t.preventDefault(),l.handleMark.apply(null,arguments)}}},[c("client-only",[c("CollectPopover",{ref:"collectPopover",attrs:{triggerMode:"click",hideBtn:!0,type:l.typeKey,folder:l.infos,dotReportInfo:l.dotReportInfo}},[c("div",{staticClass:"commFunNum"},[c("i",{staticClass:"iconfont",class:l.setCollectData(l.infos)}),l._v(" "),c("span",[l._v(l._s(l.formatNumberForeign(null===(e=l.infos.stat)||void 0===e?void 0:e.num_of_collection)))])])])],1)],1)]),l._v(" "),c("div",{staticClass:"commFunBarRight flex"},[l._t("cmtMore")],2)])]),l._v(" "),l._t("custom-inner")]:l._e(),l._v(" "),c("div",{staticClass:"commCnt"},[l.showCommentNum?c("div",{ref:"commTitle",staticClass:"commNum"},[l._v("\n        "+l._s(l.$t("commNumTotal",{number:l.commTotal}))+"\n      ")]):l._e(),l._v(" "),l.commList.length?c("div",{staticClass:"list"},l._l(l.commList,(function(t,e){var n;return c("div",{key:e,staticClass:"commItem"},[c("div",{staticClass:"avatar-wrapper flex items-center"},[c("div",{staticClass:"avatar",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),l.goToPersonal(t)}}},[c("BaseAvatar",{attrs:{"user-data":null==t?void 0:t.user_info,name:t.user_info.username||t.user_info.user_id,size:32,theme:"dark"}}),l._v(" "),c("div",{staticClass:"avatarName"},[c("span",[l._v(l._s(t.user_info.username||t.user_info.user_id))]),l._v(" "),l.isAuthor(t.user_info.user_id)?c("div",{staticClass:"isAuthor"},[l._v("\n                  "+l._s(l.$t("author"))+"\n                ")]):l._e()])],1),l._v(" "),l.canDelete(t)?c("el-popover",{attrs:{trigger:"hover","popper-class":"cmt-comments-more-popover",placement:"bottom-end"}},[c("div",{staticClass:"btn-item",on:{click:function(e){return l.handleDelete(t)}}},[c("Icon",{attrs:{name:"shanchu5",size:"16",color:"#cfd0d2"}}),l._v("\n                "+l._s(l.$t("Delete"))+"\n              ")],1),l._v(" "),c("div",{staticClass:"more-dots",attrs:{slot:"reference"},slot:"reference"},[c("i",{staticClass:"el-icon-more"})])]):l._e()],1),l._v(" "),c("div",{staticClass:"commListCnt"},[c("div",{staticClass:"commTxt"},[l._v(l._s(null!=t&&t.showTranslation?(null==t?void 0:t.translationTxt)||"":t.content))]),l._v(" "),null!==(n=t.pictures)&&void 0!==n&&n.length?c("div",{staticClass:"comm-images"},l._l(t.pictures,(function(image,t){return c("div",{key:t,staticClass:"comm-image"},[image.nsfw?c("span",[c("Icon",{attrs:{name:"warning",size:"14",color:"#6f6f6f"}}),l._v("\n                  "+l._s(l.$t("CmtCommentsImageViolationNotice"))+"\n                ")],1):c("img",{attrs:{src:image.url,alt:""},on:{click:function(t){return l.viewImage(image.url,t.target)}}})])})),0):l._e(),l._v(" "),c("div",{staticClass:"comm-operation"},[c("div",{staticClass:"date"},[l._v(l._s(l.setTiem(t.create_at)))]),l._v(" "),c("div",{staticClass:"translate",on:{click:function(e){return l.clickTransBtn(t)}}},[c("span",{directives:[{name:"loading",rawName:"v-loading",value:null==t?void 0:t.isLoading,expression:"item?.isLoading"}]},[l._v("\n                  "+l._s(l.$t(null!=t&&t.showTranslation?"ViewOriginal":"ViewTranslation"))+"\n                ")])])]),l._v(" "),c("div",{staticClass:"txt-fun-bar"},[c("div",{staticClass:"fun-num",on:{click:function(n){return l.onLike(t,e)}}},[c("i",{staticClass:"iconfont",class:[t.is_like?"icon-like_selected":"icon-like"]}),l._v(" "),t.like_count>0?c("span",[l._v(l._s(l.formatNumberForeign(t.like_count)))]):c("span",[l._v(l._s(l.$t("CmtCommentsLike")))])]),l._v(" "),c("div",{staticClass:"fun-num",on:{click:function(e){return l.openReply(t.id)}}},[c("i",{staticClass:"el-icon-chat-dot-round"}),l._v(" "),t.replies_count>0?c("span",[l._v(l._s(l.formatNumberForeign(t.replies_count)))]):c("span",[l._v(l._s(l.$t("CmtCommentsReply")))])])]),l._v(" "),c("div",{staticClass:"input-box-container"},[l.isReplyId==t.id?c("div",{staticClass:"inputBox"},[c("input",{directives:[{name:"model",rawName:"v-model",value:l.replyTxt,expression:"replyTxt"}],ref:"replyInput",refInFor:!0,attrs:{type:"text",maxlength:"300",placeholder:"".concat(l.$t("replyTo")," @").concat(t.user_info.username||t.user_info.user_id)},domProps:{value:l.replyTxt},on:{keyup:function(n){return l.onkeyRep(t,e,!1,n)},click:function(t){l.showEmojiPanel=!1},input:function(t){t.target.composing||(l.replyTxt=t.target.value)}}}),l._v(" "),l.isShowIcon("emoji")?c("div",{staticClass:"icon-btn",on:{click:function(n){return l.onOpenEmojiPanel(!0,{item:t,index:e,toUser:!1})}}},[c("Icon",{directives:[{name:"show",rawName:"v-show",value:!l.showEmojiPanel,expression:"!showEmojiPanel"}],attrs:{name:"emoji",size:"22",color:"#646466"}}),l._v(" "),c("Icon",{directives:[{name:"show",rawName:"v-show",value:l.showEmojiPanel,expression:"showEmojiPanel"}],attrs:{name:"jianpan",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),l.isShowIcon("picture")?c("div",{staticClass:"icon-btn",on:{click:function(n){return l.onOpenImagePanel(!0,{item:t,index:e,toUser:!1})}}},[c("Icon",{attrs:{name:"picture",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.replyPubLoading,expression:"replyPubLoading"}],staticClass:"icon-btn",on:{click:function(n){return l.replyComm(t,e,!1)}}},[c("Icon",{attrs:{name:"Comment_send",size:"22",color:"#646466"}})],1)]):l._e(),l._v(" "),c("ImagePreview",{directives:[{name:"show",rawName:"v-show",value:l.inReplyEditMode&&l.isReplyId===t.id&&l.selectedImageUrls.length>0,expression:"inReplyEditMode && isReplyId === item.id && selectedImageUrls.length > 0"}],on:{"image-urls-change":function(t){l.$nextTick((function(){return l.updateEmojiPanelPosition()}))}},model:{value:l.selectedImageUrls,callback:function(t){l.selectedImageUrls=t},expression:"selectedImageUrls"}})],1),l._v(" "),l._l(t.children,(function(n,o){var r,d,m;return c("div",{key:o,staticClass:"replies"},[c("div",{staticClass:"avatar-wrapper flex items-center"},[c("div",{staticClass:"avatar",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),l.goToPersonal(n)}}},[c("BaseAvatar",{attrs:{"user-data":null==n?void 0:n.user_info,name:n.user_info.username||n.user_info.user_id,size:24,theme:"dark"}}),l._v(" "),c("div",{staticClass:"avatarName"},[c("span",[l._v(l._s(n.user_info.username||n.user_info.user_id))]),l._v(" "),l.isAuthor(n.user_info.user_id)?c("div",{staticClass:"isAuthor"},[l._v("\n                      "+l._s(l.$t("author"))+"\n                    ")]):l._e()])],1),l._v(" "),l.canDelete(n)?c("el-popover",{attrs:{trigger:"hover","popper-class":"cmt-comments-more-popover",placement:"bottom-end"}},[c("div",{staticClass:"btn-item",on:{click:function(e){return l.handleDelete(n,t)}}},[c("Icon",{attrs:{name:"shanchu5",size:"16",color:"#cfd0d2"}}),l._v("\n                    "+l._s(l.$t("Delete"))+"\n                  ")],1),l._v(" "),c("div",{staticClass:"more-dots",attrs:{slot:"reference"},slot:"reference"},[c("i",{staticClass:"el-icon-more"})])]):l._e()],1),l._v(" "),c("div",{staticClass:"commListCnt"},[null!==(r=n.target)&&void 0!==r&&r.username?c("div",{staticClass:"commTxt"},[l._v("\n                  "+l._s(l.$t("reply"))+" "),c("span",[l._v(l._s(null===(d=n.target)||void 0===d?void 0:d.username)+":")]),l._v("\n                  "+l._s(null!=n&&n.showTranslation?(null==n?void 0:n.translationTxt)||"":n.content)+"\n                ")]):c("div",{staticClass:"commTxt"},[l._v(l._s(null!=n&&n.showTranslation?(null==n?void 0:n.translationTxt)||"":n.content))]),l._v(" "),null!==(m=n.pictures)&&void 0!==m&&m.length?c("div",{staticClass:"comm-images"},l._l(n.pictures,(function(image,t){return c("div",{key:t,staticClass:"comm-image"},[image.nsfw?c("span",[c("Icon",{attrs:{name:"warning",size:"14",color:"#6f6f6f"}}),l._v("\n                      "+l._s(l.$t("CmtCommentsImageViolationNotice"))+"\n                    ")],1):c("img",{attrs:{src:image.url,alt:""},on:{click:function(t){return l.viewImage(image.url,t.target)}}})])})),0):l._e(),l._v(" "),c("div",{staticClass:"comm-operation"},[c("div",{staticClass:"date"},[l._v(l._s(l.setTiem(n.create_at)))]),l._v(" "),c("div",{staticClass:"translate",on:{click:function(t){return l.clickTransBtn(n)}}},[c("span",{directives:[{name:"loading",rawName:"v-loading",value:null==n?void 0:n.isLoading,expression:"ele?.isLoading"}]},[l._v("\n                      "+l._s(l.$t(null!=n&&n.showTranslation?"ViewOriginal":"ViewTranslation"))+"\n                    ")])])]),l._v(" "),c("div",{staticClass:"txt-fun-bar"},[c("div",{staticClass:"fun-num",on:{click:function(t){return l.onLike(n,e,o)}}},[c("i",{staticClass:"iconfont",class:[n.is_like?"icon-like_selected":"icon-like"]}),l._v(" "),n.like_count>0?c("span",[l._v(l._s(l.formatNumberForeign(n.like_count)))]):c("span",[l._v(l._s(l.$t("CmtCommentsLike")))])]),l._v(" "),c("div",{staticClass:"fun-num",on:{click:function(t){return l.openReply(n.id)}}},[c("i",{staticClass:"el-icon-chat-dot-round"}),l._v(" "),c("span",[l._v(l._s(l.$t("CmtCommentsReply")))])])]),l._v(" "),c("div",{staticClass:"input-box-container"},[l.isReplyId==n.id?c("div",{staticClass:"inputBox"},[c("input",{directives:[{name:"model",rawName:"v-model",value:l.replyTxt,expression:"replyTxt"}],ref:"replyInput",refInFor:!0,attrs:{type:"text",maxlength:"300",placeholder:"".concat(l.$t("reply")," @").concat(n.user_info.username||n.user_info.user_id)},domProps:{value:l.replyTxt},on:{keyup:function(t){return l.onkeyRep(n,e,!0,t)},click:function(t){l.showEmojiPanel=!1},input:function(t){t.target.composing||(l.replyTxt=t.target.value)}}}),l._v(" "),l.isShowIcon("emoji")?c("div",{staticClass:"icon-btn",on:{click:function(t){return l.onOpenEmojiPanel(!0,{item:n,index:e,toUser:!0})}}},[c("Icon",{directives:[{name:"show",rawName:"v-show",value:!l.showEmojiPanel,expression:"!showEmojiPanel"}],attrs:{name:"emoji",size:"22",color:"#646466"}}),l._v(" "),c("Icon",{directives:[{name:"show",rawName:"v-show",value:l.showEmojiPanel,expression:"showEmojiPanel"}],attrs:{name:"jianpan",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),l.isShowIcon("picture")?c("div",{staticClass:"icon-btn",on:{click:function(t){return l.onOpenImagePanel(!0,{item:n,index:e,toUser:!0})}}},[c("Icon",{attrs:{name:"picture",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.replyPubLoading,expression:"replyPubLoading"}],staticClass:"icon-btn",on:{click:function(t){return l.replyComm(n,e,!0)}}},[c("Icon",{attrs:{name:"Comment_send",size:"22",color:"#646466"}})],1)]):l._e(),l._v(" "),c("ImagePreview",{directives:[{name:"show",rawName:"v-show",value:l.inReplyEditMode&&l.isReplyId===n.id&&l.selectedImageUrls.length>0,expression:"inReplyEditMode && isReplyId === ele.id && selectedImageUrls.length > 0"}],on:{"image-urls-change":function(t){l.$nextTick((function(){return l.updateEmojiPanelPosition()}))}},model:{value:l.selectedImageUrls,callback:function(t){l.selectedImageUrls=t},expression:"selectedImageUrls"}})],1)])])})),l._v(" "),t.replies_count>1&&t.children.length<t.replies_count?c("div",{staticClass:"morRep",on:{click:function(n){return l.onRepMor(t,e)}}},[l._v("\n              "+l._s(l.$t("CmtCommentsUnfoldNumReply",{number:t.replies_count-t.children.length}))+"\n            ")]):l._e()],2)])})),0):l._t("empty"),l._v(" "),l.showLoadMore&&!l.noMoreData?c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.loading,expression:"loading"}],staticClass:"load-more",on:{click:l.getCommentList}},[l._v("\n        Load more\n      ")]):l._e()],2)],2),l._v(" "),"bottom"===l.inputPosition?c("div",{staticClass:"commInput",style:l.infos.style||{}},[21!==l.type?c("div",{staticClass:"commFunBar"},[c("div",{staticClass:"funBarBnt"},[c("div",{directives:[{name:"show",rawName:"v-show",value:"model"!==l.typeKey,expression:"typeKey !== 'model'"}],staticClass:"commFunNum",on:{click:function(t){return l.setLike(l.infos,l.typeKey)}}},[c("i",{staticClass:"iconfont",class:l.setlikeData(l.infos)}),l._v(" "),c("span",[l._v(l._s(l.formatNumberForeign(4!=l.type?null===(n=l.infos.stat)||void 0===n?void 0:n.num_of_like:l.infos.num_of_praise)))])]),l._v(" "),c("div",{on:{click:function(t){return t.preventDefault(),l.handleMark.apply(null,arguments)}}},[c("client-only",[c("CollectPopover",{ref:"collectPopover",attrs:{triggerMode:"click",hideBtn:!0,type:l.typeKey,folder:l.infos,dotReportInfo:l.dotReportInfo}},[c("div",{staticClass:"commFunNum"},[c("i",{staticClass:"iconfont",class:l.setCollectData(l.infos)}),l._v(" "),c("span",[l._v(l._s(l.formatNumberForeign(null===(o=l.infos.stat)||void 0===o?void 0:o.num_of_collection)))])])])],1)],1),l._v(" "),c("div",{staticClass:"commFunNum"},[c("i",{staticClass:"iconfont icon-work-show"}),l._v(" "),c("span",[l._v(l._s(l.formatNumberForeign(null===(r=l.infos.stat)||void 0===r?void 0:r.num_of_view)))])]),l._v(" "),c("div",{staticClass:"commFunNum",on:{click:l.openPub}},[c("i",{staticClass:"el-icon-chat-dot-round"}),l._v(" "),c("span",[l._v(l._s(l.commTotal))])])]),l._v(" "),c("div",{staticClass:"commFunBarRight flex"},[l._t("cmtMore")],2)]):l._e(),l._v(" "),c("div",{staticClass:"input-box-container"},[c("div",{staticClass:"inputBox"},[c("input",{directives:[{name:"model",rawName:"v-model",value:l.pubTxt,expression:"pubTxt"}],ref:"pubInput",attrs:{type:"text",maxlength:"300",placeholder:l.$t("saySom")},domProps:{value:l.pubTxt},on:{focus:function(t){l.isReplyId=""},keyup:l.onkeyPub,click:function(t){l.showEmojiPanel=!1},input:function(t){t.target.composing||(l.pubTxt=t.target.value)}}}),l._v(" "),l.isShowIcon("emoji")?c("div",{staticClass:"icon-btn",on:{click:function(t){return l.onOpenEmojiPanel(!1)}}},[c("Icon",{directives:[{name:"show",rawName:"v-show",value:!l.showEmojiPanel,expression:"!showEmojiPanel"}],attrs:{name:"emoji",size:"22",color:"#646466"}}),l._v(" "),c("Icon",{directives:[{name:"show",rawName:"v-show",value:l.showEmojiPanel,expression:"showEmojiPanel"}],attrs:{name:"jianpan",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),l.isShowIcon("picture")?c("div",{staticClass:"icon-btn",on:{click:function(t){return l.onOpenImagePanel(!1)}}},[c("Icon",{attrs:{name:"picture",size:"22",color:"#646466"}})],1):l._e(),l._v(" "),l.isShowIcon("send")?c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.pubLoading,expression:"pubLoading"}],staticClass:"icon-btn",on:{click:l.onPub}},[c("Icon",{attrs:{name:"Comment_send",size:"22",color:"#646466"}})],1):l._e()]),l._v(" "),c("ImagePreview",{directives:[{name:"show",rawName:"v-show",value:!l.inReplyEditMode&&l.selectedImageUrls.length>0,expression:"!inReplyEditMode && selectedImageUrls.length > 0"}],on:{"image-urls-change":function(t){l.$nextTick((function(){return l.updateEmojiPanelPosition()}))}},model:{value:l.selectedImageUrls,callback:function(t){l.selectedImageUrls=t},expression:"selectedImageUrls"}})],1)]):l._e(),l._v(" "),c("div",{attrs:{id:"reverseLoadDiv"}}),l._v(" "),c("el-popover",{directives:[{name:"show",rawName:"v-show",value:l.inEditMode&&l.showEmojiPanel,expression:"inEditMode && showEmojiPanel"}],ref:"popoverEditorRef",staticClass:"popover-editor",attrs:{trigger:"manual","popper-options":{modifiers:[{name:"computeStyles",options:{adaptive:!1,gpuAcceleration:!1}}]},placement:"bottom-start"},model:{value:l.inEditMode,callback:function(t){l.inEditMode=t},expression:"inEditMode"}},[c("div",{directives:[{name:"show",rawName:"v-show",value:l.showEmojiPanel,expression:"showEmojiPanel"}],staticClass:"editor-emoji-panel-section"},[c("EmojiPicker",{ref:"emojiPicker",attrs:{emojiTable:l.emojiTable},on:{emoji:l.insert},scopedSlots:l._u([{key:"emoji-picker",fn:function(t){var e=t.emojis,n=t.insert;return c("div",{},[c("div",{staticClass:"emoji-picker"},[c("div",l._l(e,(function(t,e){return c("div",{key:e},[c("h5",[l._v(l._s(l.$t(e)))]),l._v(" "),c("div",l._l(t instanceof Map?t:new Map(Object.entries(t)),(function(t){var e=Object(Z.a)(t,2),o=e[0],r=e[1];return c("span",{key:o,attrs:{title:o},on:{click:function(t){return n(r)}}},[l._v("\n                    "+l._s(r)+"\n                  ")])})),0)])})),0)])])}}])})],1)]),l._v(" "),c("HyUploadMoald",{ref:"hyUploadModal",attrs:{recentlyUsedQueryObj:{artwork_types:[1,3,4]},personalWorksQueryObj:{artwork_types:[1,3,4]},isSingleSelect:!0},on:{onConfirm:l.handleConfirmImageSelect}}),l._v(" "),c("AppendToBody",[c("ViewImage",{ref:"viewImage"})],1)],1)}),[],!1,null,"1f9ffb6a",null)),yt=bt.exports;function Ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ct(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}installComponents(bt,{CollectPopover:n(63).default,BaseAvatar:n(53).default});var xt={name:"TavernCardDetailMore",components:{TavernCardDetailDefinition:Q,CmtComments:yt,AiChatReport:G.a},props:{characterData:{type:Object,required:!0,default:function(){return{}}}},data:function(){return{count:0,showTip:!1}},computed:wt(wt({},Object(c.e)("app",["topBanner"])),{},{definition:function(){var t=this.toNumber,e=this.characterData,n=e.example_dialog,o=void 0===n?{}:n,r=e.first_message,l=void 0===r?{}:r,c=e.personality,d=void 0===c?{}:c,m=e.scenario,v=void 0===m?{}:m,f=e.world_book,h=void 0===f?{}:f,_=e.desc,desc=void 0===_?"":_,y=(null==h?void 0:h.entries)||[],C=[{titleKey:"ST_Detailed_desc",content:desc},wt({titleKey:"ST_Detailed_scnr"},v),wt({titleKey:"ST_Detailed_personality"},d),wt({titleKey:"ST_Detailed_firstmes"},l),wt({titleKey:"ST_Detailed_ex"},o),{titleKey:"ST_Detailed_book",entries:y}],w=t(v.token)+t(d.token);return{sections:C,permanent:w,total:w+t(l.token)+t(o.token)}},detailMoreStyle:function(){var t=this.topBanner?"108px":"62px";return{maxHeight:"calc(100vh - ".concat(t," )"),top:t}}}),methods:{updateCommentCount:function(t){this.$emit("update-comment-count",t),this.$EventBus.$emit("update-comment-for-st-detail"),this.count=t},openReport:function(){var t;null===(t=this.$refs.aiChatReport)||void 0===t||t.open()},toNumber:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t?Number(t):0},handleShowTip:function(t){var e=this;t.stopPropagation(),this.showTip||(this.showTip=!0,setTimeout((function(){document.addEventListener("click",e.hideReportTip)}),0))},hideReportTip:function(t){t&&t.target.closest(".report-tip")||(this.showTip=!1,document.removeEventListener("click",this.hideReportTip))}},beforeDestroy:function(){document.removeEventListener("click",this.hideReportTip)}},kt=xt,Dt=(n(5520),Object(f.a)(kt,(function(){var t=this,e=t._self._c;return e("div",{ref:"detailMore",staticClass:"detail-more",style:t.detailMoreStyle},[e("div",{staticClass:"more-title"},[e("span",[t._v(t._s(t.$t("ST_Detailed_more")))]),t._v(" "),e("div",{staticClass:"report-button",on:{click:function(e){return e.stopPropagation(),t.handleShowTip.apply(null,arguments)}}},[e("i",{staticClass:"iconfont icon-more"}),t._v(" "),t.showTip?e("div",{staticClass:"report-tip",on:{click:function(e){return e.stopPropagation(),t.openReport.apply(null,arguments)}}},[e("i",{staticClass:"iconfont icon-icon_report"}),t._v(" "),e("span",[t._v(t._s(t.$t("Report")))])]):t._e()])]),t._v(" "),e("TavernCardDetailDefinition",{attrs:{total:t.definition.total,permanent:t.definition.permanent,sections:t.definition.sections}}),t._v(" "),e("div",{staticClass:"review-title"},[e("p",[t._v(t._s(t.$t("ST_Detailed_review"))+" ❤️")]),t._v(" "),e("div",{staticClass:"review-count"},[e("div",{staticClass:"review-count-content"},[t._v(t._s(t.$t("commNumTotal",{number:t.count})))])])]),t._v(" "),e("div",{staticClass:"comments-section"},[e("CmtComments",{attrs:{inputPosition:"top",infos:t.characterData,type:76,naturalScroll:!0,scrollContainer:t.$refs.detailMore,inputIcons:["emoji","picture"]},on:{updateCountNum:t.updateCommentCount}})],1),t._v(" "),e("client-only",[e("AiChatReport",{ref:"aiChatReport",attrs:{skipRequest:!0}})],1)],1)}),[],!1,null,"b6b75990",null)),$t=Dt.exports;function Tt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}installComponents(Dt,{CmtComments:n(116).default});var Ot={name:"TavernDetail",components:{TavernCardDetailCard:W,TavernCardDetailMore:$t},provide:function(){return{characterData:this.characterData,top:this}},data:function(){return{characterData:{},styleElement:null}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Tt(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(c.c)("tavern",["currentCharacter"])),asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,c,d,param,m,data,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.$axios,o=t.params,r=t.error,c=t.store,d=o.id,param={id:d,ss:l.f},e.prev=3,!d){e.next=15;break}return e.next=7,n.$post("/api/v1/tavern-pro/detail",param);case 7:if(m=e.sent,data=m.data,1e4===m.status.code){e.next=12;break}return e.abrupt("return");case 12:return v=data||{},c.dispatch("tavern/setCurrentCharacter",v),e.abrupt("return",{characterData:v});case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.log("角色卡详情页面-> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 21:case"end":return e.stop()}}),e,null,[[3,17]])})))()},mounted:function(){this.createStyleElement(),this.$xyLogEvent({front_operation:"exposure",entity_name:"sillyTavern-detail-page-show",entity_type:"sillyTavern"})},beforeDestroy:function(){this.removeStyleElement()},methods:{createStyleElement:function(){this.styleElement=document.createElement("style"),this.styleElement.textContent="\n        .body-container,\n        .el-container {\n          overflow: visible !important;\n        }\n      ",document.head.appendChild(this.styleElement)},removeStyleElement:function(){this.styleElement&&document.head.removeChild(this.styleElement)}}},It=Ot,St=(n(5521),Object(f.a)(It,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"detail-container"},[e("TavernCardDetailCard",{attrs:{characterData:t.characterData}}),t._v(" "),e("TavernCardDetailMore",{attrs:{characterData:t.characterData}})],1)}),[],!1,null,"f71e590a",null));e.default=St.exports},5729:function(t,e,n){"use strict";n.r(e);n(11),n(6),n(12),n(13),n(7),n(448),n(47);var o=n(259),r=n.n(o),l=n(30),c=n(3),d=n(2),m=(n(20),n(32),n(16),n(22),n(18),n(24),n(8),n(4),n(21),n(40),n(41),n(1));function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h={props:{actIndex:{type:Number,default:1}},data:function(){return{list:[{name:this.$t("ModelEdit")},{name:this.$t("editVersionModel")},{name:this.$t("addImageModel")}]}},methods:{handItem:function(t){var e=this.list[t];this.$emit("onClick",f(f({},e),{},{index:t+1}))}}},_=(n(4885),n(0)),y=Object(_.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"step-max-page flex_c"},[e("div",{staticClass:"step-box flex"},t._l(t.list,(function(n,o){return e("div",{key:o,staticClass:"item flex_m",class:o+1<=t.actIndex&&"highlight",on:{click:function(e){return t.handItem(o)}}},[e("div",{staticClass:"num flex_c_m"},[t._v(t._s(o+1))]),t._v(" "),e("div",{staticClass:"text"},[t._v(t._s(n.name))])])})),0)])}),[],!1,null,"7368faf6",null).exports,C=n(14),w=(n(28),n(218),n(44),n(90),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),{model:{prop:"actVal",event:"onChange"},props:{width:{type:String,default:"auto"},list:{type:Array,default:function(){return[]}},actVal:{type:[String,Number],default:1},dis:{type:Boolean,default:!1}},data:function(){return{}},methods:{handItem:function(t){var e=t.value;!this.dis&&this.$emit("onChange",e)}}}),x=(n(4886),Object(_.a)(w,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"select-line-box flex_m",class:t.dis&&"dis-line",style:{width:t.width}},t._l(t.list,(function(n,o){return e("div",{key:o,staticClass:"item flex_c_m",class:n.value===t.actVal&&"act-item",on:{click:function(e){return t.handItem(n)}}},[t._v("\n    "+t._s(t.$t(n.label))+"\n  ")])})),0)}),[],!1,null,"348e58ec",null).exports),k=(n(19),n(31),n(71)),D=n(82),$=n(9),T={model:{prop:"actVal",event:"onChange"},props:{actVal:{type:Array,default:function(){return[]}}},data:function(){return{tabList:[]}},mounted:function(){this.getRecommendTag()},methods:{getRecommendTag:function(){var t=this;Object(k.d)({show_area:"model"}).then((function(e){if(1e4===e.status.code){var n=e.data||[];t.tabList=n.map((function(e){return{id:e[$.r[t.$i18n.locale]],title:e[$.r[t.$i18n.locale]]}})),t.tabList=t.tabList.concat(t.actVal)}}))},remoteMethod:function(t){var e=this;t&&Object(D.d)({prefix:t,except_num:20,source_type:3}).then((function(t){var n;if(1e4==t.status.code){e.tabList=[];var o=(null==t||null===(n=t.data)||void 0===n?void 0:n.items)||[];e.tabList=o.map((function(t){return{id:t.title,title:t.title}}))}}))},changeTab:function(t){if(t.length>0){var e=t.length-1;t[e]=t[e].slice(0,30)}this.$emit("onChange",t)}}},O=(n(4887),Object(_.a)(T,(function(){var t=this,e=t._self._c;return e("div",[e("el-select",{staticClass:"show-tag",staticStyle:{width:"100%"},attrs:{value:t.actVal,multiple:"",filterable:"","allow-create":"","default-first-option":"",remote:"",placeholder:t.$t("pleaseEnte"),"popper-class":"show-tag-select","remote-method":t.remoteMethod},on:{change:t.changeTab}},t._l(t.tabList,(function(t,n){return e("el-option",{key:"tab"+n,attrs:{label:t.title,value:t.id}})})),1)],1)}),[],!1,null,"6097c276",null).exports),I=n(212),S=n(414);function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E={components:{SelectLine:x,SelectTab:O,MyEditor:I.default},data:function(){return{formData:{name:"",type:"LORA",tags:[],desc:"",publish_status:1,payment:{way:1,fee:0},refer:"",permission:{allow_commercial_use:1,allow_download:1,allow_model_mix:1,allow_resell:1,allow_sell:1,allow_use_in_haiyi:1}},rules:{name:[{required:!0,message:this.$t("pleaseEnte")}],type:{required:!0,message:this.$t("Pls_select")},desc:{required:!0,message:this.$t("pleaseEnte")},refer:{required:!0,message:this.$t("pleaseEnte")}},modelList:S.c,sourceList:S.g,payList:S.f,isOpenList:S.a,modelUseList:S.e,useModelType:1,worksSource:1,editorErr:!1,num_of_task:0,allFormValid:!1}},watch:{formData:{handler:function(){this.checkAllFormValid()},deep:!0,immediate:!0}},computed:j(j({},Object(m.e)("user",["userInfo","openEdit","adminOff"])),{},{isBtnFixed:function(){return this.allFormValid&&!this.$parent.isBottom}}),mounted:function(){var t=this.$route.query,e=t.train,n=t.modelType;if(e&&(this.formData.publish_status=1,this.worksSource=1),n){this.formData.type={LoRA:"LORA",DoRA:"DoRA",LyCORIS:"LoCon"}[n]||"LORA"}},methods:{HandNextStep:function(t){var e=this;this.$refs[t].validate((function(t){if(t){var n=[{field:"name",label:e.$t("ModelName")},{field:"refer",label:e.$t("originalLink")}];e.$emit("onNext",e.formData,n)}else e.editorErr=!e.formData.desc}))},changeEditor:function(t){t?(this.editorErr=!1,this.$refs.modelForm.validateField("desc")):(this.formData.desc="",this.editorErr=!0,this.$refs.modelForm.validateField("desc"))},feeInput:function(t){this.formData.payment.fee=t.replace(/\D/g,"")},setPayNum:function(t){var e=t.target.value;parseInt(e)>3&&(this.formData.payment.fee=3)},changeSource:function(t){2===t&&(this.useModelType=1,this.formData.payment.fee=0),1===t&&(this.formData.refer=""),this.checkAllFormValid()},changeModelUse:function(t){2===this.worksSource&&(this.useModelType=1),1===t&&(this.formData.payment.fee=0)},formDataFill:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.formData.name=t.name,this.formData.type=t.type,this.formData.tags=Object(C.a)(new Set(t.tags.map((function(t){return t.title})))),this.formData.desc=t.desc,this.formData.publish_status=t.publish_status,this.formData.payment.way=t.payment.way||1,this.formData.payment.fee=t.payment.fee,this.formData.refer=t.refer,this.formData.permission=t.permission,this.useModelType=t.payment.fee>0?2:1,this.worksSource=t.refer?2:1,this.formData.permission.allow_use_in_haiyi=1,this.formData.permission.allow_resell=t.permission.allow_resell||2},goPlan:function(){this.$logEvent("log_actions",{operation:"click_creator_revenue_center"}),window.open(path,"/creationCenter")},onChangeOpen:function(t){if(2===t&&this.$route.query.id&&this.num_of_task>=5e3){this.formData.publish_status=1;var e=this.$i18n.locale.startsWith("zh"),n="https://aihelp.net/questionnaire/#/?formId=".concat(e?"d9483db10f694841ba66414325fefbb6":"291ecf705dee4ceaa97af1bcc0d017b8");window.open(n,"_blank")}},checkAllFormValid:function(){var t=this;this.$nextTick((function(){t.$refs.modelForm.validate((function(e){t.allFormValid=e,t.$refs.modelForm.clearValidate()}))}))}}},P=E,M=(n(4888),Object(_.a)(P,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"edit-model-max"},[e("el-form",{ref:"modelForm",staticClass:"custom-form my-edit-model-form",attrs:{"label-position":"top",model:t.formData,rules:t.rules}},[e("div",{staticClass:"content-box flex"},[e("div",{staticClass:"left"},[e("div",{staticClass:"board left-board"},[e("el-form-item",{attrs:{label:t.$t("ModelName"),prop:"name"}},[e("el-input",{attrs:{placeholder:t.$t("pleaseEnte"),maxlength:100},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("ModelType"),prop:"type"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{"popper-class":"custom-select",placeholder:t.$t("Pls_select"),disabled:!!t.$route.query.id||!!t.$route.query.verId},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},t._l(t.modelList,(function(n,o){return e("el-option",{key:"SD_"+o,attrs:{label:n.label,value:n.value}},[e("span",[t._v(t._s(n.label))]),t._v(" "),["Checkpoint","LORA","TextualInversion"].includes(n.value)?e("span",{staticClass:"yes-run-text"},[t._v(t._s(t.$t("yesRun")))]):t._e()])})),1)],1),t._v(" "),e("el-form-item",[e("template",{slot:"label"},[t._v("\n              "+t._s(t.$t("SetTags"))+"\n              "),e("el-tooltip",{attrs:{content:t.$t("setTabsTips"),placement:"top"}},[e("i",{staticClass:"iconfont icon-ruleIcon"})])],1),t._v(" "),e("SelectTab",{model:{value:t.formData.tags,callback:function(e){t.$set(t.formData,"tags",e)},expression:"formData.tags"}})],2),t._v(" "),e("el-form-item",{attrs:{label:t.$t("ModelIntroduction"),prop:"desc"}},[e("MyEditor",{attrs:{isErr:t.editorErr,defaultProps:{mode:"simple"}},on:{onChange:t.changeEditor},model:{value:t.formData.desc,callback:function(e){t.$set(t.formData,"desc",e)},expression:"formData.desc"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("Source")}},[e("SelectLine",{attrs:{list:t.sourceList,dis:!!t.$route.query.train},on:{onChange:t.changeSource},model:{value:t.worksSource,callback:function(e){t.worksSource=e},expression:"worksSource"}})],1),t._v(" "),2===t.worksSource?e("el-form-item",{key:"refer",attrs:{label:t.$t("originalLink"),prop:"refer"}},[e("el-input",{attrs:{placeholder:t.$t("pleaseEnte"),maxlength:100},model:{value:t.formData.refer,callback:function(e){t.$set(t.formData,"refer",e)},expression:"formData.refer"}})],1):t._e(),t._v(" "),e("div",{staticClass:"push-income"},[e("span",[t._v(t._s(t.$t("motivatingTitle"))+"：")]),t._v(" "),e("span",{staticClass:"link-text",on:{click:t.goPlan}},[e("i",{staticClass:"iconfont icon-a-copylink"}),t._v("\n              "+t._s(t.$t("pushIncome"))+"\n            ")])])],1)]),t._v(" "),e("div",{staticClass:"right"},[e("div",{staticClass:"board form-one"},[e("el-form-item",{attrs:{label:t.$t("hasPublic"),prop:"publish_status"}},[e("SelectLine",{attrs:{dis:!!t.$route.query.train,list:t.isOpenList},on:{onChange:t.onChangeOpen},model:{value:t.formData.publish_status,callback:function(e){t.$set(t.formData,"publish_status",e)},expression:"formData.publish_status"}})],1),t._v(" "),t._e()],2),t._v(" "),1===t.worksSource?e("div",{staticClass:"board form-two"},[e("el-form-item",{staticClass:"check-group-list",attrs:{label:t.$t("userEmpower")}},[e("div",{staticClass:"check-item"},[e("el-checkbox",{staticClass:"check-disabled",attrs:{label:t.$t("yesLineUse"),"true-label":1,"false-label":2,disabled:!0},model:{value:t.formData.permission.allow_use_in_haiyi,callback:function(e){t.$set(t.formData.permission,"allow_use_in_haiyi",e)},expression:"formData.permission.allow_use_in_haiyi"}},[t._v("\n                "+t._s(t.$t("yesLineUse"))+"\n                "),e("el-tooltip",{attrs:{content:t.$t("haiyiPluckImg"),placement:"top"}},[e("i",{staticClass:"iconfont icon-ruleIcon"})])],1)],1),t._v(" "),e("div",{staticClass:"check-item"},[e("el-checkbox",{attrs:{label:t.$t("comfyUpLoad9"),"true-label":1,"false-label":2},model:{value:t.formData.permission.allow_download,callback:function(e){t.$set(t.formData.permission,"allow_download",e)},expression:"formData.permission.allow_download"}})],1),t._v(" "),e("div",{staticClass:"check-item"},[e("el-checkbox",{attrs:{label:t.$t("fusionYes"),"true-label":1,"false-label":2},model:{value:t.formData.permission.allow_model_mix,callback:function(e){t.$set(t.formData.permission,"allow_model_mix",e)},expression:"formData.permission.allow_model_mix"}})],1)]),t._v(" "),e("el-form-item",{staticClass:"check-group-list",attrs:{label:t.$t("commercialYes")}},[e("div",{staticClass:"check-item"},[e("el-checkbox",{attrs:{label:t.$t("newCommercialYesImg"),"true-label":1,"false-label":2},model:{value:t.formData.permission.allow_commercial_use,callback:function(e){t.$set(t.formData.permission,"allow_commercial_use",e)},expression:"formData.permission.allow_commercial_use"}})],1),t._v(" "),e("div",{staticClass:"check-item"},[e("el-checkbox",{attrs:{label:t.$t("modelSellYes"),"true-label":1,"false-label":2},model:{value:t.formData.permission.allow_resell,callback:function(e){t.$set(t.formData.permission,"allow_resell",e)},expression:"formData.permission.allow_resell"}})],1)])],1):t._e()])])]),t._v(" "),e("div",{staticClass:"action-btn-box flex_c_m",class:{fixed:t.isBtnFixed},attrs:{"data-event":"first_prev"}},[e("div",{staticClass:"item prenext flex_c_m"},[e("span",[t._v(t._s(t.$t("PreNext")))])]),t._v(" "),e("div",{staticClass:"item nextstep flex_c_m",attrs:{"data-event":"first_next"},on:{click:function(e){return t.HandNextStep("modelForm")}}},[e("span",[t._v("\n        "+t._s(t.$t("NextStep"))+"\n      ")])])]),t._v(" "),t.$parent.isBottom?t._e():e("div",{staticClass:"action-btn-position"})],1)}),[],!1,null,"c4fa19c4",null)),N=M.exports;installComponents(M,{MyEditor:n(212).default});n(69),n(73),n(26),n(49),n(65);var R=n(413),A=n(153),F=n(10),B={props:{existObj:{type:Object,default:function(){return{name:"",url:"",open:!1}}}},data:function(){return{modelExistDialog:!1}},methods:{handleInitHelp:function(){window.SUHelpSupport?SUHelpSupport.show():Object(A.a)((function(){setTimeout((function(){SUHelpSupport.show()}),2e3)}))},copyLink:function(){var text=this.existObj.url;text&&Object(F.g)(text),this.$message.success(this.$t("CopySuccess"))},claimModel:function(){var t="https://aihelp.net/questionnaire/#/?formId=78dea50f5cbb426cb136748154c029aa";this.$i18n.locale.startsWith("zh")&&(t="https://aihelp.net/questionnaire/#/?formId=bffe7a2307454e859f559913e28d4f19"),window.open(t,"_blank")}}};function V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function U(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?V(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var H={props:["value","createId","modelType","disabled","modelTypeName","size32","baseModelFlux"],components:{modelExistDialog:Object(_.a)(B,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticStyle:{"margin-top":"25vh !important"},attrs:{title:t.$t("Tip"),visible:t.modelExistDialog,width:"500px","modal-append-to-body":!1,"close-on-click-modal":!1,"append-to-body":!0,"custom-class":"SaDialog"},on:{"update:visible":function(e){t.modelExistDialog=e}}},[e("div",{staticClass:"flex justify-between flex-wrap",staticStyle:{margin:"20px 0"}},[e("div",{staticClass:"left",staticStyle:{"margin-top":"15px","word-break":"break-word"}},[e("i",{staticClass:"el-icon-warning",staticStyle:{color:"#f19c5c","margin-right":"15px",transform:"scale(1.5)"}}),t._v("\n      "+t._s(t.$t("newUpload_Model_1"))+"，"),t.existObj.url&&t.existObj.open?e("span",[t._v(t._s(t.$t("Upload_Model_2"))),e("a",{staticStyle:{color:"#e5af5d",cursor:"pointer"},attrs:{href:t.existObj.url,target:"_blank"}},[t._v(t._s(t.existObj.name)+"，")])]):t._e(),t._v("\n      "+t._s(t.$t("Upload_Model_3"))+"\n      "),e("span",{staticStyle:{color:"#e5af5d",cursor:"pointer"},on:{click:function(e){return e.preventDefault(),t.handleInitHelp()}}},[t._v(t._s(t.$t("Contact_customer")))])]),t._v(" "),t.existObj.url&&t.existObj.open?e("div",{staticStyle:{color:"#4784ff",cursor:"pointer","margin-top":"15px"},on:{click:t.copyLink}},[e("i",{staticClass:"iconfont icon-link",staticStyle:{"margin-right":"5px"}}),t._v("\n      "+t._s(t.$t("CopyLink"))+"\n    ")]):t._e()]),t._v(" "),e("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.modelExistDialog=!1}}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{on:{click:t.claimModel}},[t._v(t._s(t.$t("ClaimModel")))])],1)])}),[],!1,null,"5115cb1e",null).exports},data:function(){return{uploadStatusIcon:{init:"",pending:"el-icon-loading",complete:"el-icon-circle-check",fail:"el-icon-refresh-left",error:"el-icon-close"},uploadingStatus:"init",uploadConfig:"",fileChunk:[],worker:null,progress:0,errNum:3,waitUploadIndex:[],existObj:{name:"",url:"",open:!1},fileObj:{name:""}}},computed:{isDisabled:function(){return"pending"===this.uploadingStatus||this.disabled},acceptFile:function(){return{Checkpoint:".ckpt,.safetensors,.gguf",LORA:".ckpt,.safetensors"}[this.modelTypeName]||".safetensors,.pt,.zip"}},methods:{startUpload:function(t){var e=this,n=t.size,o=t.name;if(!this.isDisabled){var r=this.validFileSize(n),l=r.limit,c=r.item;if(!l){var d=c.limitTip||{},m=d.max,v=void 0===m?"":m,f=d.min,h=void 0===f?"":f,_=this.$t("HttpErrorCode_30003");return _=h?this.$t("fileMaxLimit",{min:h,max:v}):this.$t("fileMaxLimit2",{max:v}),void this.$message.warning(_)}var y={file_size:n,file_name:o,content_type:"application/octet-stream",category:1,model_type:this.modelType,create_id:this.createId,model_type_name:this.modelTypeName,sub_category:1};this.baseModelFlux||delete y.sub_category,this.uploadingStatus="pending",this.fileObj.name=o;try{Object(R.c)(y).then((function(r){e.uploadConfig=U(U({},r.data),{},{file_size:n,file_name:o}),e.cutFile(t,r.data.chunk_size,e.uploadConfig.presigned.length)}))}catch(t){this.uploadingStatus="init"}}},cutFile:function(t,e,n){var o=this;this.worker=this.$worker.run((function(t,e,n){for(var o=[],r=0;r<t.size;)0===--n&&(e=t.size-r),o.push({file:t.slice(r,r+e)}),r+=e;return o.map((function(t,e){return{uploadStatus:!1,file:t,index:e,progress:0}}))}),[t,e,n]).then((function(t){o.fileChunk=t,o.$set(o,"fileChunk",t),o.uploadFile()}))},uploadFile:function(){this.waitUploadIndex=this.getWaitUplaodChunkIndex(),this.uploadChunk()},reduceQueue:function(){this.waitUploadIndex.splice(0,1),this.uploadChunk()},uploadChunk:function(){var t=this;if(0!=this.waitUploadIndex.length){var e=this.waitUploadIndex[0],n=this.fileChunk[e],o=this.uploadConfig.presigned,r=new XMLHttpRequest;r.open("PUT",o[e]),r.setRequestHeader("Content-Type","application/octet-stream"),r.onerror=function(e){t.errNum--,t.errNum<0?t.uploadingStatus="fail":setTimeout((function(){t.uploadChunk()}),3e3)},r.upload.onprogress=function(e){var n=e.loaded,o=e.total,r=Math.floor(n/o*1e4),l=t.fileChunk.length,c=Math.floor(1/l*1e4);t.updateProgress(c*r/1e4)},r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){if(t.errNum=3,!t.fileChunk[e])return;t.fileChunk[e].uploadStatus=!0,t.reduceQueue()}else 4===r.readyState&&200!==r.status&&0===t.errNum&&t.$message.error(t.$t("uploadError"))},r.send(n.file.file)}else this.chunkUploadCheck()},updateProgress:function(t){var e=this.fileChunk.filter((function(t){return t.uploadStatus})).length,n=this.fileChunk.length;if(n){var o=parseFloat((e/n*1e4).toFixed(2));o+=t,this.progress=parseFloat((o/100).toFixed(2))}},chunkUploadCheck:function(){var t=this,e=this.uploadConfig.file_id;Object(R.a)({create_id:this.createId,file_id:e}).then((function(e){if(e.data.model_id){var n=e.data,o=n.model_id,r=n.model_name,l=void 0===r?"Model":r,c=n.model_status,d=void 0===c?2:c;2===d&&(t.existObj.url="".concat(window.location.origin,"/")+"models/detail/"+o,t.existObj.name=l,t.existObj.open=2===d,t.$refs.modelExist.modelExistDialog=!0),1===d&&t.$alert(t.$t("modelNoUpdates"),t.$t("Tip"),{confirmButtonText:t.$t("Confirm"),type:"error"})}var m=e.data.unconfirmed;m.length?(m.forEach((function(e){t.fileChunk[Number(e)-1].progress=0,t.fileChunk[Number(e)-1].uploadStatus=!1})),t.waitUploadIndex=m.map((function(t){return Number(t)})),t.uploadingStatus="pending",t.uploadFile()):(t.progress=100,t.uploadingStatus="complete",t.$emit("input",t.uploadConfig.file_id),t.$emit("upfinish",U({},t.fileObj)))})).catch((function(e){t.uploadingStatus="error"}))},getWaitUplaodChunkIndex:function(){return this.fileChunk.filter((function(t){return!t.uploadStatus})).map((function(t){return t.index}))},curstomUpload:function(t){this.startUpload(t.file)},refresh:function(){["fail","error"].includes(this.uploadingStatus)&&("error"!==this.uploadingStatus?(this.uploadingStatus="pending",this.errNum=3,this.uploadChunk()):this.clear())},clear:function(){this.errNum=3,this.fileChunk=[],this.uploadConfig="",this.waitUploadIndex=[],this.progress=0,this.uploadingStatus="init"},validFileSize:function(t){var e=this.modelTypeName;this.size32&&(e="max23GBSize");var n=S.d[e],o=S.d[e],r=o.max,l=o.min;return{limit:t<r&&t>l,item:n}}}},z=(n(4889),Object(_.a)(H,(function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{staticClass:"upload-file-item",attrs:{action:"/","http-request":t.curstomUpload,"show-file-list":!1,disabled:t.isDisabled,accept:t.acceptFile}},[e("div",{staticClass:"upload-btn"},[e("div",[e("i",{staticClass:"el-icon-upload2"}),t._v(" "),e("span",{staticClass:"file-name"},[t._v(t._s(t.uploadConfig?t.uploadConfig.file_name:t.value?t.value:t.$t("PickFile")))])]),t._v(" "),e("i",{class:t.uploadStatusIcon[t.uploadingStatus],on:{click:t.refresh}})]),t._v(" "),e("el-progress",{directives:[{name:"show",rawName:"v-show",value:t.uploadConfig,expression:"uploadConfig"}],attrs:{percentage:t.progress,color:"#0d9488"}})],1),t._v(" "),e("modelExistDialog",{ref:"modelExist",attrs:{existObj:t.existObj}})],1)}),[],!1,null,"31684cca",null).exports),W=n(56),G=n(25),K={name:"ILModelVersionPopover",data:function(){return{resolutionList:[{ratio:"1 : 2",general:"768x1536",lu:"768x1536"},{ratio:"9 : 16",general:"864x1536",lu:"810x1440"},{ratio:"2 : 3",general:"1024x1536",lu:"768x1152"},{ratio:"3 : 4",general:"1152x1536",lu:"864x1152"},{ratio:"4 : 5",general:"1152x1440",lu:"1152x1440"},{ratio:"1 : 1",general:"1536x1536",lu:"1024x1024"}]}}},Y=(n(4890),Object(_.a)(K,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"il-model-version-popover"},[e("div",{staticClass:"popover-title"},[t._v(t._s(t.$t("ILModelDefaultResolution")))]),t._v(" "),e("div",{staticClass:"popover-content"},[e("div",{staticClass:"popover-header popover-row"},[e("div",{staticClass:"popover-cell popover-cell-ratio"},[t._v(t._s(t.$t("text_00210")))]),t._v(" "),e("div",{staticClass:"popover-cell"},[t._v("Illustrious-General")]),t._v(" "),e("div",{staticClass:"popover-cell"},[t._v("Illustrious-LU-v0.03")])]),t._v(" "),t._l(t.resolutionList,(function(n,o){return e("div",{key:o,staticClass:"popover-row"},[e("div",{staticClass:"popover-cell popover-cell-ratio"},[t._v(t._s(n.ratio))]),t._v(" "),e("div",{staticClass:"popover-cell"},[t._v(t._s(n.general))]),t._v(" "),e("div",{staticClass:"popover-cell"},[t._v(t._s(n.lu))])])}))],2)])}),[],!1,null,"9bcba6ce",null).exports);function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function J(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Q={inject:["top"],components:{MyEditor:I.default,ModelFileUpload:z,ILModelVersionPopover:Y},props:{baseModels:{type:Array,default:function(){return[]}},item:{type:Object,default:function(){return{}}},idx:{type:Number,default:0},open:{type:Boolean,default:!0},modelType:{type:Number,default:2},modelTypeName:{type:String,default:""},modelName:{type:String,default:""}},data:function(){var t=this,e=function(e,n,o){var r=t.recommendParams,l=r.width,c=r.height;if(!l&&!c||l&&c)o();else{var d=l?"".concat(t.$t("pleaseEnte")," ").concat(t.$t("height")):"".concat(t.$t("pleaseEnte")," ").concat(t.$t("width"));o(new Error(d))}};return{disabledBaseModel:!1,isTriggerWords:!1,formData:{name:"",base_model:"",permission:{allow_same:1},desc:"",file_id:"",file_name:"",trigger_words:[],epoch:1,step:0,train_model_result_no:"",sub_version:""},rules:{name:[{required:!0,message:this.$t("pleaseEnte")}],base_model:{required:!0,message:this.$t("Pls_select")},file_id:{required:!0,message:this.$t("Pls_select")}},fileErr:!1,fileName:"",showRecommendParams:!0,recommendParamsForm:null,recommendParams:{sampler:void 0,vae:void 0,height:void 0,width:void 0,steps:void 0,cfg_scale:void 0,clip_skip:void 0,prompt:void 0,negative_prompt:void 0,max_strength:void 0,min_strength:void 0,strength:void 0},recommendParamsValidate:{width:[{validator:e,trigger:["blur","change"]}],height:[{validator:e,trigger:["blur","change"]}]},recommendParamsFieldList:[[],[],[],[],[]],debounceBaseModelChange:function(){},ilModelSpecialVersions:$.o}},watch:{formData:{deep:!0,handler:function(){this.$emit("onFormChange")}},modelListRender:{handler:function(t){var e=this;this.$nextTick((function(){var n,o,r,l;"yes"===e.item.train_model_no&&null!=e&&null!==(n=e.$route)&&void 0!==n&&null!==(n=n.query)&&void 0!==n&&n.base_model&&(e.formData.base_model=null==e||null===(r=e.$route)||void 0===r||null===(r=r.query)||void 0===r?void 0:r.base_model,e.disabledBaseModel=!0);(1===t.length&&["Flux.1 D","SD 3.5L","SD 3.5M"].includes(t[0])&&(e.formData.base_model=t[0]),["Illustrious","Pony"].includes(null==e||null===(o=e.$route)||void 0===o||null===(o=o.query)||void 0===o?void 0:o.base_model))&&(e.formData.base_model=null==e||null===(l=e.$route)||void 0===l||null===(l=l.query)||void 0===l?void 0:l.base_model,e.disabledBaseModel=!0)}))},immediate:!0,deep:!0},modelTypeName:{handler:function(t){this.modelTypeNameChange(t)}},"recommendParams.max_strength":{handler:function(t){void 0!==t&&void 0!==this.recommendParams.strength&&this.recommendParams.strength>t&&(this.recommendParams.strength=t)}},"recommendParams.min_strength":{handler:function(t){void 0!==t&&void 0!==this.recommendParams.strength&&this.recommendParams.strength<t&&(this.recommendParams.strength=t)}}},computed:J(J(J({},Object(m.e)("payment",["paymentInfo"])),Object(m.c)("user",["isCompanyAccount"])),{},{isIlModel:function(){var t;return"Checkpoint"===this.modelTypeName&&["Illustrious"].includes(null==this||null===(t=this.formData)||void 0===t?void 0:t.base_model)},modelListRender:function(){var t;if("LORA"===this.modelTypeName&&(null===(t=this.item)||void 0===t||!t.id)){var e,n,o;if(null!==(e=this.top)&&void 0!==e&&e.baseModelIsFlux)return["Flux.1 D"];if(null!==(n=this.top)&&void 0!==n&&n.baseModelIsSD35)return[(null===(o=this.$route)||void 0===o||null===(o=o.query)||void 0===o?void 0:o.base_model)||"SD 3.5L"]}return this.disabledBaseModel=!1,$.d},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},modelData:function(){return this.top.allFormData.model},wordsOptions:function(){var t,e=(null===(t=this.formData)||void 0===t?void 0:t.trigger_words)||[];return Array.from(e).map((function(t){return{value:t,label:t}}))},isRecommendParamsFieldListEmpty:function(){return this.recommendParamsFieldList.every((function(t){return 0===t.length}))}}),mounted:function(){this.debounceBaseModelChange=Object(G.debounce)(this.baseModelChange,500)},beforeDestroy:function(){this.debounceBaseModelChange=function(){}},methods:{isValid:function(){var t=this;return new Promise((function(e){t.$nextTick((function(){t.$refs.modelVmForm.validate((function(n){t.$refs.modelVmForm.clearValidate(),e(n)}))}))}))},getFieldMin:function(t){return"strength"===t.field?this.recommendParams.min_strength||t.min||-2.5:t.min},getFieldMax:function(t){return"strength"===t.field?this.recommendParams.max_strength||t.max||7:t.max},handleStrengthChange:function(t){if(["max_strength","min_strength","strength"].includes(t.field)&&(this.recommendParams.strength=Math.min(Math.max(this.recommendParams.strength,this.recommendParams.min_strength||-2.5),this.recommendParams.max_strength||7),this.recommendParams.max_strength<this.recommendParams.min_strength)){var e=this.recommendParams.max_strength;this.recommendParams.max_strength=this.recommendParams.min_strength,this.recommendParams.min_strength=e}},getBaseModels:function(){var t=this;Object(k.a)({scene:4}).then((function(e){var n;1e4===e.status.code&&(t.baseModels=(null===(n=e.data)||void 0===n||null===(n=n.base_model_select_options)||void 0===n?void 0:n.map((function(t){return t.val})))||[])}))},moveUp:function(){this.$emit("onMoveUp",this.item)},moveDown:function(){this.$emit("onMoveDown",this.item)},delItem:function(){this.$emit("onDelItem",this.item)},copyItem:function(){var t=this.formData,e=this.item,n=JSON.parse(JSON.stringify(t));n.file_id="",this.$emit("onCopyItem",{formData:n,item:e,task_gen_custom_meta:this.getRecommendParams()})},commChange:function(t){this.isVip||2!==t||(this.$EventBus.$emit("showBreakDialog","TrainLoraTipWeb","basic"),this.formData.permission.allow_same=1)},fileFinish:function(t){this.fileName=t.name,this.formData.file_name=t.name},fillFormData:function(){var t=this,data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.formData;this.formData=Object(F.i)(e,data),this.formData.trigger_words=Object(C.a)(new Set(this.formData.trigger_words)),this.isTriggerWords=!this.formData.trigger_words.length,this.$refs.MyEditorRef.setHtml(this.formData.desc),Object.keys(this.formData.task_gen_custom_meta).length>0?this.setRecommendParams(data.task_gen_custom_meta):this.$nextTick((function(){t.formData.base_model&&t.baseModelChange(t.formData.base_model)}))},setRecommendParams:function(t){var e=this;this.isRecommendParamsFieldListEmpty&&this.debounceBaseModelChange(this.formData.base_model,(function(){Object.keys(t).forEach((function(n){e.recommendParams[n]=t[n],"max_strength"!==n&&"min_strength"!==n||t[n]||(e.recommendParams[n]="max_strength"===n?7:-2.5)}))}))},getRecommendParams:function(){var t=this,e={};return this.isRecommendParamsFieldListEmpty||Object.keys(this.recommendParams).forEach((function(n){void 0!==t.recommendParams[n]&&(e[n]=t.recommendParams[n])})),e},submitRecommendForm:function(){var t=this;return new Promise((function(e){t.$refs.recommendParamsForm.validate((function(t){e(t)}))}))},submitForm:function(t){var e=this;this.$refs.modelVmForm.validate(function(){var n=Object(c.a)(regeneratorRuntime.mark((function n(o){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=o,e.fileErr=!e.formData.file_id,!o||!e.open||e.isRecommendParamsFieldListEmpty){n.next=6;break}return n.next=5,e.submitRecommendForm();case 5:r=n.sent;case 6:t&&t(r);case 7:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())},handleFieldList:function(t){var e=[[],[],[],[]],n={};return t.forEach((function(t){n[t.field]=void 0,2===t.type?e[0].push(t):["height","width"].includes(t.field)?e[1].push(t):["prompt","negative_prompt"].includes(t.field)?e[3].push(t):e[2].push(t)})),{list:e,paramsField:n}},modelTypeNameChange:function(t){this.formData.base_model&&this.baseModelChange(this.formData.base_model),"Checkpoint"!==t&&(this.recommendParamsFieldList=[[],[],[],[]],this.$set(this,"recommendParams",{}))},baseModelChange:function(t,e){var n=this;return Object(c.a)(regeneratorRuntime.mark((function o(){var r,l,c,data,d,m,v,f,h,_;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return n.formData.sub_version="Illustrious"===t&&"Checkpoint"===n.modelTypeName?(null==n||null===(r=n.formData)||void 0===r?void 0:r.sub_version)||"Illustrious-General":"",o.next=3,Object(W.j)({items:[{base_model_name:t,model_type:n.modelTypeName}]});case 3:if(o.t0=o.sent,o.t0){o.next=6;break}o.t0={};case 6:l=o.t0,c=l.status,data=l.data,d=(data||{}).task_gen_meta_items,m=void 0===d?[]:d,1e4===(null==c?void 0:c.code)&&m.length>0?(f=n.handleFieldList((null===(v=m[0])||void 0===v?void 0:v.task_gen_meta_field_items)||[]),h=f.list,_=f.paramsField,n.recommendParamsFieldList=h,n.$set(n,"recommendParams",J({},_)),e&&e()):(n.recommendParamsFieldList=[[],[],[],[]],n.$set(n,"recommendParams",{}));case 11:case"end":return o.stop()}}),o)})))()}}},Z=Q,tt=(n(4891),Object(_.a)(Z,(function(){var t,e,n,o=this,r=o._self._c;return o.item.showDom?r("div",{staticClass:"vmformbox",attrs:{id:o.item.vmId}},[r("el-form",{ref:"modelVmForm",staticClass:"custom-form",attrs:{"label-position":"top",model:o.formData,rules:o.rules}},[r("div",{staticClass:"item-box board"},[r("h3",{staticClass:"vm-form-title"},[o._v(o._s(o.$t("basic_information")))]),o._v(" "),r("el-form-item",{attrs:{label:o.$t("versionsName"),prop:"name"}},[r("el-row",{attrs:{gutter:16}},[r("el-col",{attrs:{span:20}},[r("el-input",{attrs:{maxlength:100,disabled:!0},model:{value:o.modelName,callback:function(t){o.modelName=t},expression:"modelName"}})],1),o._v(" "),r("el-col",{attrs:{span:4}},[r("el-input",{attrs:{maxlength:50},model:{value:o.formData.name,callback:function(t){o.$set(o.formData,"name",t)},expression:"formData.name"}})],1)],1)],1),o._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:o.open,expression:"open"}],attrs:{label:o.$t("BaseModel"),prop:"base_model"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{disabled:o.disabledBaseModel||!!o.item.id||!!o.formData.train_model_result_no,"popper-class":"custom-select",placeholder:o.$t("Pls_select")},on:{change:o.debounceBaseModelChange},model:{value:o.formData.base_model,callback:function(t){o.$set(o.formData,"base_model",t)},expression:"formData.base_model"}},o._l(o.baseModels,(function(t,e){return r("el-option",{key:"SD_"+e,attrs:{label:t,value:t}})})),1)],1),o._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:o.open&&o.isIlModel,expression:"open && isIlModel"}],attrs:{label:o.$t("ILModelSpecialVersion"),prop:"sub_version"}},[r("template",{slot:"label"},[o._v("\n          "+o._s(o.$t("ILModelSpecialVersion"))+"\n          "),r("el-popover",{attrs:{placement:"bottom",trigger:"hover","popper-class":"il-model-version-popper",width:"auto"}},[r("ILModelVersionPopover"),o._v(" "),r("i",{staticClass:"iconfont icon-ruleIcon",staticStyle:{cursor:"pointer"},attrs:{slot:"reference"},slot:"reference"})],1)],1),o._v(" "),r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:o.$t("Pls_select"),"popper-class":"custom-select"},model:{value:o.formData.sub_version,callback:function(t){o.$set(o.formData,"sub_version",t)},expression:"formData.sub_version"}},o._l(o.ilModelSpecialVersions,(function(t,e){return r("el-option",{key:"IL_"+e,attrs:{label:t,value:t}})})),1)],2),o._v(" "),o.item.train_model_no?r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:o.open,expression:"open"}],staticStyle:{"margin-bottom":"0"}},[r("div",{staticClass:"is_community-item"},[r("span",[o._v(o._s(o.$t("sameModel")))]),o._v(" "),r("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:o.commChange},model:{value:o.formData.permission.allow_same,callback:function(t){o.$set(o.formData.permission,"allow_same",t)},expression:"formData.permission.allow_same"}})],1)]):o._e(),o._v(" "),r("el-form-item",{attrs:{prop:"desc"}},[r("template",{slot:"label"},[o._v("\n          "+o._s(o.$t("verIntroduction"))+"\n          "),r("el-tooltip",{attrs:{content:o.$t("versionInfoTips"),placement:"top"}},[r("i",{staticClass:"iconfont icon-ruleIcon"})])],1),o._v(" "),r("MyEditor",{ref:"MyEditorRef",attrs:{height:"120px",defaultProps:{mode:"simple"}},model:{value:o.formData.desc,callback:function(t){o.$set(o.formData,"desc",t)},expression:"formData.desc"}})],2),o._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:o.open,expression:"open"}],attrs:{label:o.$t("CheckpointFile"),prop:"file_id"}},[r("model-file-upload",{ref:"modelsFileUpload",class:o.fileErr&&"file-err",attrs:{baseModelFlux:(null===(t=o.formData)||void 0===t?void 0:t.base_model.includes("Flux"))||!1,size32:(null===(e=o.formData)||void 0===e?void 0:e.base_model.startsWith("Flux"))||(null===(n=o.formData)||void 0===n?void 0:n.base_model.startsWith("SD 3.5"))||!1,createId:o.modelData.id,modelType:o.modelType,modelTypeName:o.modelTypeName,disabled:!!o.item.id||!!o.formData.train_model_result_no},on:{upfinish:o.fileFinish},model:{value:o.formData.file_id,callback:function(t){o.$set(o.formData,"file_id",t)},expression:"formData.file_id"}})],1),o._v(" "),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:o.$t("TriggerWords"),prop:"trigger_words",rules:[{required:!o.isTriggerWords,message:this.$t("pleaseEnte")}]}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"","popper-class":"custom-select","allow-create":"","default-first-option":"",placeholder:o.$t("pleaseEnte")},model:{value:o.formData.trigger_words,callback:function(t){o.$set(o.formData,"trigger_words",t)},expression:"formData.trigger_words"}},o._l(o.wordsOptions,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),o._v(" "),r("el-switch",{attrs:{"active-text":o.$t("version_no_trigger_words")},on:{change:function(t){return o.$emit("onFormChange")}},model:{value:o.isTriggerWords,callback:function(t){o.isTriggerWords=t},expression:"isTriggerWords"}})],1)],1),o._v(" "),r("h3",{staticClass:"vm-form-title"},[o._v(o._s(o.$t("trainParamete")))]),o._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:o.open,expression:"open"}],attrs:{gutter:16}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:o.$t("epochForNum"),prop:"epoch"}},[r("el-input-number",{staticClass:"my-input-number",attrs:{"controls-position":"right",min:1,max:1e5},model:{value:o.formData.epoch,callback:function(t){o.$set(o.formData,"epoch",t)},expression:"formData.epoch"}})],1)],1),o._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:o.$t("stepsIterationNum"),prop:"step"}},[r("el-input-number",{staticClass:"my-input-number",attrs:{"controls-position":"right",min:0,step:500},model:{value:o.formData.step,callback:function(t){o.$set(o.formData,"step",t)},expression:"formData.step"}})],1)],1)],1),o._v(" "),o.open&&!o.isRecommendParamsFieldListEmpty?[r("div",{staticClass:"recommend-params-form-header"},[r("h3",{staticClass:"vm-form-title"},[o._v(o._s(o.$t("recommend_parameters")))]),o._v(" "),r("div",{staticClass:"change-show-recommend-params",on:{click:function(t){o.showRecommendParams=!o.showRecommendParams}}},[o._v("\n            "+o._s(o.showRecommendParams?o.$t("PackUp"):o.$t("Unfold"))+"\n            "),r("i",{staticClass:"el-icon-arrow-down",class:{"is-rotate":o.showRecommendParams}})])]),o._v(" "),r("transition",{attrs:{name:"viewer-fade"}},[r("div",{directives:[{name:"show",rawName:"v-show",value:o.showRecommendParams,expression:"showRecommendParams"}],staticClass:"recommend-params-form-content"},[r("el-form",{ref:"recommendParamsForm",attrs:{"label-position":"top",model:o.recommendParams,rules:o.recommendParamsValidate}},[o._l(o.recommendParamsFieldList[0],(function(t){return r("el-form-item",{key:t.field,attrs:{label:t.title,prop:t.field}},[r("el-select",{attrs:{"popper-class":"custom-select",clearable:!0,placeholder:" "},model:{value:o.recommendParams[t.field],callback:function(e){o.$set(o.recommendParams,t.field,e)},expression:"recommendParams[item.field]"}},o._l(t.option_vals,(function(option,e){return r("el-option",{key:"item-field-".concat(t.field,"-").concat(e),attrs:{label:option,value:option}})})),1)],1)})),o._v(" "),o.recommendParamsFieldList[1].length>0?r("el-row",{attrs:{gutter:10}},[o._l(o.recommendParamsFieldList[1],(function(t,e){return[r("el-col",{key:t.field,attrs:{span:11}},[r("el-form-item",{attrs:{label:t.title,prop:t.field}},[r("el-input-number",{staticClass:"my-input-number",attrs:{controls:!1,min:t.min,max:t.max},model:{value:o.recommendParams[t.field],callback:function(e){o.$set(o.recommendParams,t.field,e)},expression:"recommendParams[item.field]"}})],1)],1),o._v(" "),1&e?o._e():r("el-col",{key:t.field+"-icon",attrs:{span:2}},[r("div",{staticClass:"special-icon"},[o._v("X")])])]}))],2):o._e(),o._v(" "),o.recommendParamsFieldList[2].length>0?r("el-row",{attrs:{gutter:16}},o._l(o.recommendParamsFieldList[2],(function(t){return r("el-col",{key:t.field,attrs:{span:12}},[r("el-form-item",{attrs:{label:t.title,prop:t.field}},[r("el-input-number",{staticClass:"my-input-number",attrs:{"controls-position":"right",min:o.getFieldMin(t),max:o.getFieldMax(t),step:t.step||1},on:{change:function(e){return o.handleStrengthChange(t)}},model:{value:o.recommendParams[t.field],callback:function(e){o.$set(o.recommendParams,t.field,e)},expression:"recommendParams[item.field]"}})],1)],1)})),1):o._e(),o._v(" "),o._l(o.recommendParamsFieldList[3],(function(t){return r("el-form-item",{key:t.field,attrs:{label:t.title,prop:t.field}},[r("el-input",{attrs:{type:"textarea"},model:{value:o.recommendParams[t.field],callback:function(e){o.$set(o.recommendParams,t.field,e)},expression:"recommendParams[item.field]"}})],1)}))],2)],1)])]:o._e(),o._v(" "),r("div",{staticClass:"action-right-btns"},[r("div",{staticClass:"item flex_c_m",on:{click:o.delItem}},[r("i",{staticClass:"iconfont icon-postDelete"})]),o._v(" "),r("div",{staticClass:"item flex_c_m",on:{click:o.moveUp}},[r("i",{staticClass:"el-icon-arrow-up"})]),o._v(" "),r("div",{staticClass:"item flex_c_m",on:{click:o.moveDown}},[r("i",{staticClass:"el-icon-arrow-down"})]),o._v(" "),r("div",{staticClass:"item flex_c_m",on:{click:o.copyItem}},[r("i",{staticClass:"iconfont icon-fuzhi"})])])],2)])],1):o._e()}),[],!1,null,"c1090550",null)),et=tt.exports;function at(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function it(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?at(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}installComponents(tt,{MyEditor:n(212).default});var nt={inject:["top"],components:{FormItem:et},data:function(){return{versionList:[],baseModels:[],vopen:!0,modelType:2,modelTypeName:"",modelName:"",selectVersionIndex:0,isFixed:!1,originTop:0,orginLeft:0,orginHeight:0,headerHeight:0,headerObserver:null,allFormValid:!1}},created:function(){this.getBaseModels()},computed:{isBtnFixed:function(){return this.allFormValid&&!this.$parent.isBottom},currentVersionList:function(){return this.versionList.filter((function(t){return t.showDom}))}},methods:{getBaseModels:function(){var t=this;Object(k.a)({scene:4}).then((function(e){var n;1e4===e.status.code&&(t.baseModels=(null===(n=e.data)||void 0===n||null===(n=n.base_model_select_options)||void 0===n?void 0:n.map((function(t){return t.val})))||[])}))},addVersion:function(){var t=this,e={prefixName:this.modelName||this.top.allFormData.model.name,vmId:"vm-".concat(Object(F.s)()),showDom:!0};this.versionList.push(e),this.versionList.length>1&&this.$nextTick((function(){var n=document.querySelector("#vmListId"),o=document.querySelector("#".concat(e.vmId)),r=n.querySelector(":first-child");setTimeout((function(){n.insertBefore(o,r),t.checkAllFormValid()}),500)}))},toggleInfo:function(t){this.vopen=!t},onMoveUp:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).vmId,e=document.querySelector("#".concat(t));e.previousElementSibling&&e.parentNode.insertBefore(e,e.previousElementSibling),this.domScroll(e)},onMoveDown:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).vmId,e=document.querySelector("#".concat(t));e.nextElementSibling&&e.parentNode.insertBefore(e.nextElementSibling,e),this.domScroll(e)},onDelItem:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.vmId,o=e.id,r=this.$route.query.id;this.$confirm(this.$t("deleteModelVer"),this.$t("Tip"),{confirmButtonText:this.$t("Delete"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){o?Object(W.g)({model_id:r,ver_id:o}).then((function(){t.versionList.forEach((function(e){e.vmId===n&&(e.showDom=!1,t.checkAllFormValid())}))})):t.versionList.forEach((function(e){e.vmId===n&&(e.showDom=!1,t.checkAllFormValid())}))}))},onCopyItem:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).formData;this.addVersion();var e=this.$refs.FormItemRef,n=this.versionList.length-1,o=this.versionList[n];this.$nextTick((function(){e.forEach((function(e){e.item.vmId===o.vmId&&e.fillFormData(t)}))}))},NextUp:function(){this.$emit("onStepUp")},NextStep:function(){var t=this.$refs.FormItemRef||[],e=t.map((function(t){return it(it(it({},t.formData),t.item),{},{task_gen_custom_meta:(null==t?void 0:t.getRecommendParams())||{}})})).filter((function(t){return t.showDom}));if(e.length){var n=Array.from(document.querySelector("#vmListId").querySelectorAll(".vmformbox")).map((function(t){return t.id})).map((function(t){return e.find((function(em){return em.vmId===t}))})),o=[];t.filter((function(t){return t.item.showDom})).forEach((function(t){t.submitForm&&t.submitForm((function(t){!t&&o.push(t)}))}));this.$route.query.id;if(Object(F.E)(this.$route.query))if(this.modelvFile(n))return;if(o.length)this.vopen=!0;else{var r=[{field:"name",label:this.$t("versionsName")}],l=[{field:"trigger_words",label:this.$t("TriggerWords"),getter:function(t){var e;return null==t||null===(e=t.trigger_words)||void 0===e?void 0:e.join(",")}},{field:"task_gen_custom_meta.prompt",label:"Prompt",getter:function(t){var e;return null==t||null===(e=t.task_gen_custom_meta)||void 0===e?void 0:e.prompt}}];this.$emit("onNext",n,r,l)}}},modelvFile:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=S.b.find((function(e){return e.name===t.modelTypeName})),o=e.filter((function(t){var e=t.file_name.split(".").pop();return!n.fileTypes.includes(e)}));if(o.length>0){var r=o.map((function(t){return t.name})).filter((function(t){return t})),l=r.length?"：[".concat(r.join(),"]"):"",c="".concat(this.$t("modelFileOut")).concat(l);this.$message(c)}return o.length>0},versionFill:function(t){var e=this;this.versionList=t.map((function(t){var n={prefixName:e.top.allFormData.model.name,vmId:"vm-".concat(Object(F.s)()),showDom:!0,id:t.id,train_model_no:t.train_model_no};return e.top.allFormData.ver_list.push({id:t.id,vmId:n.vmId,samples:t.samples||[]}),n})),console.log(this.versionList,"this.versionList"),this.$nextTick((function(){var n;((null===(n=e.$refs)||void 0===n?void 0:n.FormItemRef)||[]).forEach((function(e,i){var n,o,r,l,c,d=t[i],m="Illustrious"===(null==d?void 0:d.base_model)?(null==d?void 0:d.sub_version)||"Illustrious-General":"",v={name:d.name||"",base_model:d.base_model||"",sub_version:m,desc:(null==d?void 0:d.desc)||"",file_id:(null==d||null===(n=d.resource)||void 0===n?void 0:n.name)||"",trigger_words:d.trained_words||[],train_model_result_no:d.train_model_result_no||"",epoch:(null==d||null===(o=d.train_param)||void 0===o?void 0:o.epoch)||1,step:(null==d||null===(r=d.train_param)||void 0===r?void 0:r.step)||0,clip_skip:(null==d||null===(l=d.train_param)||void 0===l?void 0:l.clip_skip)||1,permission:{allow_same:(null==d||null===(c=d.permission)||void 0===c?void 0:c.allow_same)||1},task_gen_custom_meta:(null==d?void 0:d.task_gen_custom_meta)||{}};e.fillFormData(v)}))}))},domScroll:function(t){var e=this.isFixed?this.orginHeight:2*this.orginHeight-55,n=t.getBoundingClientRect().top+window.scrollY;window.scrollTo({top:n-e-this.headerHeight,behavior:"smooth"})},selectVersion:function(t){var e=Array.from(document.querySelectorAll(".vmformbox"))[t];this.domScroll(e)},handleScroll:function(){var t=window.scrollY||document.documentElement.scrollTop,e=this.$refs.vmListId;this.orginLeft=e.getBoundingClientRect().left,this.isFixed=t>=this.originTop;var n=Array.from(e.querySelectorAll(".vmformbox"));if(n.length)for(var o=this.orginHeight+1,i=n.length-1;i>=0;i--){if(n[i].getBoundingClientRect().top-o-this.headerHeight<=0){this.selectVersionIndex=i;break}}},addScrollEvent:function(){var t=this;this.removeScrollEvent(),this.$nextTick((function(){t.updateHeaderHeight();var e=t.$refs.stickyTarget.getBoundingClientRect(),n=e.top,o=e.height;t.orginHeight=o,t.originTop=n+window.scrollY-t.headerHeight,window.addEventListener("scroll",t.handleScroll,{passive:!0}),t.observeHeaderResize()}))},removeScrollEvent:function(){var t;this.selectVersionIndex=0,this.isFixed=!1,this.orginLeft=0,this.orginHeight=0,this.headerHeight=0,this.originTop=0,window.removeEventListener("scroll",this.handleScroll),null===(t=this.headerObserver)||void 0===t||t.disconnect()},updateHeaderHeight:function(){var t=document.querySelector(".el-header");t&&(this.headerHeight=t.offsetHeight)},observeHeaderResize:function(){var t=this,e=document.querySelector(".el-header");e&&"undefined"!=typeof ResizeObserver&&(this.headerObserver=new ResizeObserver((function(){t.updateHeaderHeight()})),this.headerObserver.observe(e))},checkAllFormValid:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$refs.FormItemRef||[],e.next=3,Promise.all(n.filter((function(t){return t.item.showDom})).map((function(t){return t.isValid()})));case 3:o=e.sent,t.allFormValid=o.every(Boolean);case 5:case"end":return e.stop()}}),e)})))()}},beforeDestroy:function(){this.removeScrollEvent()}},ot=nt,st=(n(4892),Object(_.a)(ot,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"edit-version-max"},[e("div",{staticClass:"top-btntab flex_c_m"},[e("div",{staticClass:"item flex_c_m",on:{click:t.addVersion}},[e("i",{staticClass:"iconfont icon-workflow_icon_new"}),t._v("\n      "+t._s(t.$t("pubLora2"))+"\n    ")]),t._v(" "),e("div",{staticClass:"item flex_c_m",on:{click:function(e){return t.toggleInfo(t.vopen)}}},[e("i",{staticClass:"iconfont",class:t.vopen?"icon-shousuo":"icon-icon-zhankai"}),t._v("\n      "+t._s(t.$t("toggleVersionInfo"))+"\n    ")])]),t._v(" "),e("div",{staticClass:"versions-tips flex_c"},[t._v(t._s(t.$t("versionsTips")))]),t._v(" "),t.isFixed?e("div",{staticStyle:{height:"55px"}}):t._e(),t._v(" "),e("div",{ref:"stickyTarget",staticClass:"versions-tags",class:{fixed:t.isFixed},style:{left:t.orginLeft+"px",top:t.headerHeight+"px"}},[e("div",{staticClass:"tags-container flex_m"},t._l(t.currentVersionList,(function(n,o){return e("div",{key:o,class:["item flex_c_m",{active:t.selectVersionIndex===o}],on:{click:function(e){return t.selectVersion(o)}}},[t._v("\n        "+t._s(t.$t("Versions"))+" "+t._s(o+1)+"\n      ")])})),0)]),t._v(" "),e("div",{ref:"vmListId",staticClass:"version-bord-list",attrs:{id:"vmListId"}},t._l(t.versionList,(function(n,i){return e("FormItem",{key:i,ref:"FormItemRef",refInFor:!0,attrs:{item:n,idx:i,open:t.vopen,modelType:t.modelType,modelTypeName:t.modelTypeName,modelName:t.modelName,baseModels:t.baseModels},on:{onMoveUp:t.onMoveUp,onMoveDown:t.onMoveDown,onDelItem:t.onDelItem,onCopyItem:t.onCopyItem,onFormChange:t.checkAllFormValid}})})),1),t._v(" "),e("div",{staticClass:"action-btn-box flex_c_m",class:{fixed:t.isBtnFixed}},[e("div",{staticClass:"item prenext flex_c_m",attrs:{"data-event":"second_prev"},on:{click:t.NextUp}},[e("span",[t._v(t._s(t.$t("PreNext")))])]),t._v(" "),e("div",{staticClass:"item nextstep flex_c_m",attrs:{"data-event":"second_next"},on:{click:t.NextStep}},[e("span",[t._v(t._s(t.$t("NextStep")))])])]),t._v(" "),t.$parent.isBottom?t._e():e("div",{staticClass:"action-btn-position"})])}),[],!1,null,"6756dde8",null).exports),lt=(n(92),n(51)),ct=n(61),ut=n(83);function mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var pt={provide:{isShowCheckIcon:!0},inject:["top"],components:{HyUploadMoald:ut.default},props:{vmId:{type:String,default:""},verId:{type:String,default:""}},data:function(){return{uploading:!1,UPLOAD:new lt.a({type:55}),realWidth:0,realHeight:0,style:{}}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(m.e)("user",["token"])),methods:{handleClick:function(){this.$refs.HyUploadMoaldRef.openModal({verId:this.verId,model_id:this.top.allFormData.model.id,openType:"model-edit"})},handleSelectImg:function(){var t={arr:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){var e;return{url:t.url,width:t.width,height:t.height,has_meta:1,id:null==t||null===(e=t.info)||void 0===e?void 0:e.obj_parent_no}})),vmId:this.vmId};this.$emit("onSuccess",t)},handleBeforeUpload:function(t,e){var n=this;return Object(c.a)(regeneratorRuntime.mark((function o(){var r,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(n.token){o.next=3;break}return n.$EventBus.$emit("openLoginDialog"),o.abrupt("return");case 3:if(r=n.UPLOAD,["image/jpeg","image/png","image/jpg","image/webp"].includes(t.type)){o.next=8;break}return n.$message.error(n.$t("AllowImageFiles")),o.abrupt("return",!1);case 8:if(!(l=t)||l.size){o.next=11;break}return o.abrupt("return",!1);case 11:if(!(l.size/1024/1024>10)){o.next=21;break}return o.prev=12,o.next=15,Object(ct.a)(l,10485760);case 15:l=o.sent,o.next=21;break;case 18:return o.prev=18,o.t0=o.catch(12),o.abrupt("return",!1);case 21:if(!n.uploading){o.next=23;break}return o.abrupt("return");case 23:return n.uploading=!0,r.startUpload(l).then((function(t){n.getImgwh(t,l).then((function(t){n.uploading=!1;var o={info:t,vmId:n.vmId};e?e(o):n.$emit("onSuccess",o)})).catch((function(t){n.uploading=!1}))})).catch((function(t){n.uploading=!1,n.$message.error(n.$t("uploadError"))})),o.abrupt("return",!1);case 26:case"end":return o.stop()}}),o,null,[[12,18]])})))()},getImgwh:function(t,e){var n=this;return new Promise((function(o,r){var img=new Image;img.src=t,img.onload=function(){var l={width:img.width,height:img.height,url:t,has_meta:2,bytes:e.size},param={art_model_ver_no:n.verId||"",action:3,img_url:t,source:5};Object(W.i)(param).then((function(t){l.has_meta=1,10404===t.status.code&&(l.has_meta=2),o(l)})).catch((function(){l.has_meta=2,r(l)}))},img.error=function(){r({})}}))},handleBeforeUploadEmpty:function(){}}},vt=pt,ft=(n(4893),Object(_.a)(vt,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"upload-box",on:{click:t.handleClick}},[e("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:t.uploading,expression:"uploading"}],attrs:{drag:"",action:"#",disabled:"","show-file-list":!1}},[e("i",{staticClass:"el-icon-upload"}),t._v(" "),e("div",{staticClass:"el-upload__text_1"},[t._v("\n        "+t._s(t.$t("uploadWarnTips"))+"\n      ")])])],1),t._v(" "),e("HyUploadMoald",{ref:"HyUploadMoaldRef",attrs:{category:55,scene:"model_save_work_select",verId:t.verId,isMultiSelect:!0,uploadObj:{multiple:!0,limit:10}},on:{onConfirm:t.handleSelectImg}})],1)}),[],!1,null,"09b382fb",null).exports),ht=n(128);function _t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var bt={data:function(){return{dialogVisible:!1,nodataimg:n(1031),params:{page:1,page_size:30,model_no:this.$route.query.id,order:"new",time_to:0},list:[],loading:!1,isEnd:!1,actItem:{}}},methods:{showModel:function(t){this.dialogVisible=!0,this.actItem=t,this.refreshList()},hideModel:function(){this.dialogVisible=!1},refreshList:function(){this.params.page=1,this.params.time_to=0,this.list=[],this.getWorkList()},getWorkList:function(){var t=this;this.loading=!0,Object(W.n)(this.params).then((function(e){var n=e.data,o=n.items,r=n.has_more,l=o.map((function(t){return gt(gt({},t),{},{active:!1})}));t.list=t.list.concat(l||[]),1===t.params.page&&(t.params.time_to=e.data.time_ms),t.isEnd=!r,t.loading=!1})).catch((function(e){t.loading=!1}))},handleScroll:function(){var t=this.$refs.scrollContainer;t.scrollTop+t.clientHeight>=t.scrollHeight&&(this.params.page++,this.getWorkList())},checkImg:function(t){t.active=!t.active},submitImg:function(){var t=this.list.filter((function(t){return t.active}));this.hideModel(),this.$emit("onClick",{list:t,item:this.actItem})},goCreateImg:function(){var t=this,e=this.$route.query.id;Object(ht.d)({id:e}).then((function(e){t.hideModel(),t.$EventBus.$emit("openGenerate",{action:1,data:{source:Object.assign({},e.data,{taskSource:3,hsaModelEdit:!0})}})}))}}},yt=(n(4894),Object(_.a)(bt,(function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{staticClass:"my-relate-dialog",attrs:{title:t.$t("RelatedWorks"),visible:t.dialogVisible,top:"4vh",width:"1080px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.list.length?e("div",{ref:"scrollContainer",staticClass:"img-list-box flex",on:{scroll:t.handleScroll}},[e("div",{staticClass:"add-item flex_c_m",on:{click:t.goCreateImg}},[e("i",{staticClass:"iconfont icon-add-icon"})]),t._v(" "),t._l(t.list,(function(n,i){return e("div",{key:"img"+i,staticClass:"item",class:n.active&&"act-item"},[e("el-image",{staticClass:"image",attrs:{src:n.cover},on:{click:function(e){return t.checkImg(n)}}})],1)}))],2):t._e(),t._v(" "),t.list.length?t._e():e("div",{staticClass:"no-data-box flex_c_m"},[e("img",{staticClass:"image",attrs:{src:t.nodataimg}}),t._v(" "),e("div",{staticClass:"text flex_c"},[t._v("\n        "+t._s(t.$t("noRelatedWorks"))+"，\n        "),e("span",{on:{click:t.goCreateImg}},[t._v("\n          "+t._s(t.$t("GotoGenerate"))+"\n          "),e("i",{staticClass:"iconfont icon-right"})])])]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"cancel-btn",on:{click:t.hideModel}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{staticClass:"submit-btn",attrs:{type:"primary"},on:{click:t.submitImg}},[t._v(t._s(t.$t("Confirm")))])],1)])],1)}),[],!1,null,"26761ca4",null).exports),Ct=n(362),wt=n(316),xt=n(277),kt={inject:["top"],components:{draggable:n.n(xt).a,UploadImg:ft,RelatedWorksModal:yt,MetaTooltipVue:Ct.default,HyUploadMoald:ut.default},data:function(){return{imgInfo:{},visiblePop:!1}},computed:{imgList:function(){return this.top.allFormData.ver_list},allFormValid:function(){return this.imgList.every((function(t){return t.samples.length>0&&t.samples.some((function(t){return t.url&&""!==t.url.trim()}))}))},isBtnFixed:function(){return this.allFormValid&&!this.$parent.isBottom}},methods:{handleMove:function(t){console.log(t)},handleDragEnd:function(t){console.log(t)},fileSuccess:function(data){var t=data.arr,e=data.vmId;this.top.allFormData.ver_list.forEach((function(n){if(n.vmId===e){n.samples=[].concat(Object(C.a)(n.samples),Object(C.a)(t)).slice(-10);var o=Object(C.a)(new Set(n.samples.map((function(t){return t.url}))));n.samples=o.map((function(t){return n.samples.find((function(e){return e.url===t}))}))}}))},showImgModel:function(t){this.$refs.RelatedWorksModalRef.showModel(t)},checkImgok:function(t){var e=t.list,n=t.item,o=e.map((function(t){return{url:t.cover,width:t.cover_width,height:t.cover_height,has_meta:1,meta_id:"1",id:t.id}})),r=n.samples.concat(o),l=Object(C.a)(new Set(r.map((function(t){return t.url})))).map((function(t){return r.find((function(em){return em.url===t}))}));l.length>10&&l.slice(0,10),this.top.allFormData.ver_list.forEach((function(t){t.vmId===n.vmId&&(t.samples=l)}))},delImg:function(t){var e=t.id,n=t.ix;this.top.allFormData.ver_list.forEach((function(t){t.vmId===e&&t.samples.splice(n,1)}))},changeCover:function(data){var t,e=Object(l.a)(data,1)[0],n={url:e.url,width:e.width,height:e.height,has_meta:1,id:null==e||null===(t=e.info)||void 0===t?void 0:t.obj_parent_no};this.top.allFormData.ver_list.forEach((function(t){var e=JSON.parse(JSON.stringify(t.samples));e[0]=n,t.samples=e}))},publishModel:function(){var t=this.top.allFormData.ver_list,e=t.map((function(t){return!t.samples.length})).filter((function(t){return t})),n=t.map((function(t){return!t.samples.length||!t.samples.some((function(t){return t.url&&""!==t.url.trim()}))})).filter(Boolean);e.length||n.length?this.$message(this.$t("PleaseUploadExampleImages")):this.$emit("onPublish")},nextUp:function(){this.$emit("onStepUp")},showImageInfo:function(t,em){em.meta_id?this.getRelatedImg(em.id):this.getUploadImg(t,em)},getUploadImg:function(t,em){var e=this,param={art_model_ver_no:(null==t?void 0:t.id)||"",action:3,img_url:em.url,source:3},n=r.a.service();Object(W.i)(param).then((function(t){var n,o,r=(t||{}).data,data=void 0===r?{}:r;e.imgInfo.meta=data.meta,e.imgInfo.model_id=null===(n=data.art_model)||void 0===n?void 0:n.id,e.imgInfo.model_name=null===(o=data.art_model)||void 0===o?void 0:o.name,e.imgInfo.category=data.type,e.visiblePop=!e.visiblePop})).finally((function(){e.$nextTick((function(){n.close()}))}))},getRelatedImg:function(t){var e=this,n=r.a.service();Object(wt.b)({id:t}).then((function(t){var n=(t||{}).data,data=void 0===n?{}:n;e.imgInfo.meta=data.meta,e.imgInfo.model_id=data.model_id,e.imgInfo.model_name=data.model_name,e.imgInfo.category=data.type,e.visiblePop=!e.visiblePop})).finally((function(){e.$nextTick((function(){n.close()}))}))},showRelated:function(t){var e=this.top.allFormData.model.type,n=t.base_model,o=["Checkpoint","LORA","TextualInversion"].includes(e),r=this.$route.query.id,l=t.id,c=!(null!=n&&n.includes("Hunyuan")||null!=n&&n.includes("Wan"));return o&&r&&l&&c}}};n(4895);function Dt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function $t(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(n),!0).forEach((function(e){Object(d.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Tt={provide:function(){return{top:this}},components:{Step:y,EditModel:N,EditVersion:st,AddImage:Object(_.a)(kt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-image-max"},[e("div",{staticClass:"image-edit-list"},t._l(t.imgList,(function(n,i){return e("div",{key:n.vmId,staticClass:"img-item board"},[e("div",{staticClass:"title-text"},[t._v(t._s(t.$t("versionsName"))+"："+t._s(n.name))]),t._v(" "),e("div",{staticClass:"update-img-title flex_m"},[e("div",{staticClass:"left"},[e("span",{staticClass:"text-1",attrs:{"data-star":"*"}},[t._v(t._s(t.$t("versionWork")))]),t._v(" "),e("span",{staticClass:"text-2"},[t._v("("+t._s(t.$t("numScoped"))+"1-10)")]),t._v(" "),e("el-tooltip",{attrs:{placement:"top"}},[e("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n              "+t._s(t.$t("coverUploadTip"))),e("br"),t._v("\n              "+t._s(t.$t("coverQualityTip"))+"\n            ")]),t._v(" "),e("i",{staticClass:"iconfont icon-ruleIcon"})])],1),t._v(" "),t.showRelated(n)?e("div",{staticClass:"right flex_m"},[e("span",{on:{click:function(e){return t.showImgModel(n)}}},[t._v(t._s(t.$t("checkInWorks")))]),t._v(" "),e("el-tooltip",{attrs:{content:t.$t("oneStyleWorkTips"),placement:"top"}},[e("i",{staticClass:"iconfont icon-ruleIcon"})])],1):t._e()]),t._v(" "),e("upload-img",{ref:"uploadImgRef",refInFor:!0,attrs:{vmId:n.vmId,verId:n.id},on:{onSuccess:t.fileSuccess}}),t._v(" "),n.samples.length>0?e("draggable",{staticClass:"img-list-box flex",attrs:{scroll:!0,disabled:n.samples.length<2,"force-fallback":!0,animation:1e3,delay:0,"fallback-tolerance":50,move:t.handleMove},on:{end:t.handleDragEnd},model:{value:n.samples,callback:function(e){t.$set(n,"samples",e)},expression:"e.samples"}},t._l(n.samples,(function(em,o){return e("div",{key:o,staticClass:"item"},[e("el-image",{staticClass:"image",attrs:{src:em.url}}),t._v(" "),1===em.has_meta?e("div",{staticClass:"btn info",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"iconfont icon-tips",on:{click:function(e){return t.showImageInfo(n,em)}}})]):t._e(),t._v(" "),e("div",{staticClass:"btn del",on:{click:function(e){return t.delImg({id:n.vmId,ix:o})}}},[e("i",{staticClass:"iconfont icon-postDelete"})]),t._v(" "),0===o&&0===i?e("div",{staticClass:"change-cover",on:{click:function(){return t.$refs.HyUploadMoaldRef.openModal(em,"model-edit")}}},[t._v("\n            "+t._s(t.$t("chgangeCover"))+"\n          ")]):t._e(),t._v(" "),2!==em.has_meta&&em.has_meta?t._e():e("div",{staticClass:"no-img-info flex_c_m"},[t._v("\n            "+t._s(t.$t("noImageInfo"))+"\n          ")])],1)})),0):t._e()],1)})),0),t._v(" "),e("RelatedWorksModal",{ref:"RelatedWorksModalRef",on:{onClick:t.checkImgok}}),t._v(" "),e("div",{staticClass:"action-btn-box flex_c_m",class:{fixed:t.isBtnFixed}},[e("div",{staticClass:"item prenext flex_c_m",attrs:{"data-event":"third_prev"},on:{click:t.nextUp}},[e("span",[t._v(t._s(t.$t("PreNext")))])]),t._v(" "),e("div",{staticClass:"item nextstep flex_c_m",attrs:{"data-event":"final_save"},on:{click:t.publishModel}},[e("span",[t._v(t._s(t.$t("Save")))])])]),t._v(" "),t.$parent.isBottom?t._e():e("div",{staticClass:"action-btn-position"}),t._v(" "),t.visiblePop?e("div",{staticClass:"img-info-box"},[e("div",{staticClass:"mask-box",on:{click:function(e){t.visiblePop=!1}}}),t._v(" "),e("div",{staticClass:"info"},[e("MetaTooltipVue",{attrs:{meta:t.imgInfo.meta,model:t.imgInfo.model_id,category:t.imgInfo.category,"model-name":t.imgInfo.model_name,showCreate:!1,"source-from":"imageDetail"}})],1)]):t._e(),t._v(" "),e("HyUploadMoald",{ref:"HyUploadMoaldRef",attrs:{category:55,isSingleSelect:!0},on:{onConfirm:t.changeCover}})],1)}),[],!1,null,"cab505d4",null).exports},data:function(){return{versLength:0,tabIndex:1,syncAllFormData:{},allFormData:{model:{id:""},ver_list:[]},isBottom:!1}},computed:$t($t({},Object(m.e)("user",["token"])),{},{baseModelIsFlux:function(){var t;return(null===(t=this.$route)||void 0===t||null===(t=t.query)||void 0===t||null===(t=t.base_model)||void 0===t?void 0:t.includes("Flux"))||!1},baseModelIsSD35:function(){var t;return(null===(t=this.$route)||void 0===t||null===(t=t.query)||void 0===t||null===(t=t.base_model)||void 0===t?void 0:t.includes("SD 3.5"))||!1}}),watch:{tabIndex:function(t){this.$nextTick((function(){window.scrollTo({top:0,behavior:"smooth"})}))}},mounted:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.token){e.next=4;break}return t.$router.push(t.localePath({path:"/"})),t.$EventBus.$emit("openLoginDialog"),e.abrupt("return");case 4:if(!t.$route.query.addVersion){e.next=11;break}return t.tabIndex=2,e.next=8,t.getModelInfo();case 8:t.editModelNext(t.$refs.EditModelRef.formData),e.next=12;break;case 11:t.getModelInfo();case 12:window.addEventListener("scroll",t.handleScrollBottom,{passive:!0});case 13:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){window.removeEventListener("scroll",this.handleScrollBottom)},methods:{handleScrollBottom:function(){var t=(window.scrollY||document.documentElement.scrollTop)+window.innerHeight>=document.documentElement.scrollHeight-100;this.isBottom=!!t},changeTab:function(t){t.index},editModelNext:function(data,t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=6;break}return n.next=3,Object(F.f)(data,t);case 3:if(n.sent){n.next=6;break}return n.abrupt("return");case 6:e.allFormData.model=Object(F.i)(e.allFormData.model,data),e.tabIndex=2,o=e.$route.query,r=o.id,l=o.verId,c=o.addVersion,r&&e.$nextTick((function(){if(l){var t,n={train_model_result_no:l,resource:{name:l},train_model_no:"yes"},o=e.versLength+1;(null===(t=e.syncAllFormData.vers)||void 0===t?void 0:t.length)<o&&e.syncAllFormData.vers.unshift(n)}e.$refs.EditVersionRef.versionFill(e.syncAllFormData.vers)})),!r&&l&&(d={train_model_result_no:l,resource:{name:l},train_model_no:"yes"},e.syncAllFormData={vers:[d]},e.$refs.EditVersionRef.versionFill(e.syncAllFormData.vers)),Object(F.E)(e.$route.query)&&e.$nextTick((function(){e.$refs.EditVersionRef.versionList.length||e.$refs.EditVersionRef.addVersion()})),e.$nextTick((function(){var t=e.allFormData.model,n=t.type,o=t.name,r="Checkpoint"===n?1:2;e.$refs.EditVersionRef.modelType=r,e.$refs.EditVersionRef.modelTypeName=n,e.$refs.EditVersionRef.modelName=o,e.$refs.EditVersionRef.addScrollEvent(),c&&e.$nextTick((function(){e.$refs.EditVersionRef.addVersion()}))}));case 13:case"end":return n.stop()}}),n)})))()},editVersionNext:function(data,t,e){var n=this;return Object(c.a)(regeneratorRuntime.mark((function o(){var r,c,d,m,v;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,Promise.all([Object(F.f)(data,t),Object(F.f)(data,e,$.e.GenerateCreate)]);case 3:if(r=o.sent,c=Object(l.a)(r,2),d=c[0],m=c[1],d&&m){o.next=9;break}return o.abrupt("return");case 9:o.next=13;break;case 11:o.prev=11,o.t0=o.catch(0);case 13:v=n.allFormData.ver_list,n.allFormData.ver_list=data.map((function(t){var e=$t({},t),n=v.find((function(em){return em.vmId===t.vmId}))||{};return e.samples=(null==n?void 0:n.samples)||[],e.id=null==n?void 0:n.id,e})),n.tabIndex=3,n.$nextTick((function(){n.handleScrollBottom()}));case 17:case"end":return o.stop()}}),o,null,[[0,11]])})))()},editVersionUp:function(){this.tabIndex=1},addImageStepUp:function(){this.tabIndex=2},onPublish:function(){var t=this,e=JSON.parse(JSON.stringify(this.allFormData));e.model.tags=e.model.tags.map((function(t){return{id:"",title:t}})),e.model.cover=e.ver_list[0].samples[0],e.model.payment.fee=Number(e.model.payment.fee),e.ver_list=e.ver_list.map((function(t){var e=$t({},t);return t.train_model_no&&(e.file_id=""),!t.train_model_no&&(e.train_model_result_no=""),e})),1===this.$refs.EditModelRef.worksSource&&(e.model.refer="-");var n=r.a.service({text:this.$t("Announcing")});e.model.payment=void 0,Object(W.u)(e).then((function(e){var n=e.data,o=n.model,r=n.ver,l=0===o.code,c=r.every((function(t){return 0===t.code}));if(l&&c&&t.$alert(t.$t("publishOkTips"),t.$t("Tip"),{confirmButtonText:t.$t("Confirm"),type:"success",callback:function(){t.$router.back()}}),!l){if(10408===o.code)return void t.$message(t.$t("CreativeCenterPopup41"));t.$message(t.$t("HttpErrorCode_30009"))}c||t.$message(t.$t("modelNoUpdates"))})).finally((function(e){t.$nextTick((function(){n.close()}))}))},getModelInfo:function(){var t=this,e=this.$route.query.id;if(e){this.allFormData.model.id=e;var n=r.a.service();return Object(W.k)({id:e}).then((function(e){var n;t.syncAllFormData=e.data,t.versLength=(null===(n=t.syncAllFormData.vers)||void 0===n?void 0:n.length)||0,t.syncAllFormData.vers||(t.syncAllFormData.vers=[]),console.log("获取模型信息",e.data);var o=e.data.model;t.$route.query.id&&(["-","none"].includes(e.data.model.refer)&&(e.data.model.refer=""),t.$refs.EditModelRef.formDataFill(e.data.model),t.$refs.EditModelRef.num_of_task=o.stat.num_of_task||0)})).finally((function(e){t.$nextTick((function(){n.close()}))}))}}}},Ot=(n(4896),Object(_.a)(Tt,(function(){var t=this,e=t._self._c;return e("div",{attrs:{"data-group":"model_train_publish_setting_popup"}},[e("step",{attrs:{actIndex:t.tabIndex},on:{onClick:t.changeTab}}),t._v(" "),e("EditModel",{directives:[{name:"show",rawName:"v-show",value:1===t.tabIndex,expression:"tabIndex === 1"}],ref:"EditModelRef",on:{onNext:t.editModelNext}}),t._v(" "),e("EditVersion",{directives:[{name:"show",rawName:"v-show",value:2===t.tabIndex,expression:"tabIndex === 2"}],ref:"EditVersionRef",on:{onNext:t.editVersionNext,onStepUp:t.editVersionUp}}),t._v(" "),e("AddImage",{directives:[{name:"show",rawName:"v-show",value:3===t.tabIndex,expression:"tabIndex === 3"}],ref:"AddImageRef",on:{onPublish:t.onPublish,onStepUp:t.addImageStepUp}})],1)}),[],!1,null,"2fda9b6c",null));e.default=Ot.exports},5735:function(t,e,n){"use strict";n.r(e);n(11),n(6),n(12),n(13),n(4),n(7);var o=n(3),r=n(120),l=n(2),c=(n(20),n(19),n(22),n(18),n(8),n(28),n(113),n(44),n(26),n(1121),n(47),n(682)),d=n.n(c),m=(n(90),n(63)),v=n(1),f=n(10),h=n(45),_=n(56),y=n(128),C=n(138),w=n(359),x=n(610),k=n(9);function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function $(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var T={components:{CollectPopover:m.default,modelPayNum:C.default,AppealDialog:w.default,modelExistDialog:x.a},mixins:[h.a],props:["item"],filters:{formatNumberForeign:f.p},computed:$($($({},Object(v.e)("user",["userInfo"])),Object(v.c)("user",["isCompanyAccount"])),{},{url:function(){var t=this.item.banner,e=t.nsfw,o=t.url;return 1===e?n(217):Object(f.K)(o,"low")}}),data:function(){return{appealShow:!1,appealData:{obj_no:"",obj_type:2,remark:""},existObj:{name:"",url:"",open:!1}}},methods:{handleClick:function(t,e){switch(e){case"COLLECT":this.setCollect(t,"model");break;case"RELEASE":this.setRelease(t);break;case"GENERATE":this.openGenerate(t);break;case"appeal":this.openAppeal(t)}},openGenerate:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(y.d)({id:t.id,refer:"task"});case 2:o=n.sent,r=Object(k.Y)(e.$route.name),l=Object.assign({},null==o?void 0:o.data,{taskSource:1,logEventSource:r}),e.$EventBus.$emit("openGenerate",{action:1,data:{source:l}});case 6:case"end":return n.stop()}}),n)})))()},openAppeal:function(t){console.log("申诉",t),this.appealData.obj_no=t.id,this.appealShow=!0},setRelease:function(t){var e=t.banner;this.$logEvent("log_actions",{action:"LORA"===t.type?"click_publish_style":"click_publish_model",action_info:t.id}),e.url?this.publishModel(t):this.$router.push({path:this.localePath("/modelEditStep"),query:{id:t.id}})},publishModel:function(t){var e=this;Object(_.x)({id:t.id}).then((function(n){var o;if(1e4==n.status.code)if(null!==(o=n.data)&&void 0!==o&&o.model_id){var r=n.data,l=r.model_id,c=r.model_name,d=void 0===c?"Model":c,m=r.model_status,v=void 0===m?2:m;e.existObj.url="".concat(window.location.origin,"/")+"models/detail/"+l,e.existObj.name=d,e.existObj.open=1===v,e.$refs.modelExist.modelExistDialog=!0}else e.$message.success(e.$t("PulishSuccess")),e.$emit("change");else 10403!=n.status.code&&40303!=n.status.code||e.$router.push({path:e.localePath("/modelEditStep"),query:{id:t.id}})}))},viewDetail:function(){var t=this.item.id;this.$logEvent("log_actions",{operation:"click_model",behavior_info:t}),this.$router.push(this.localePath("/models/detail/".concat(t)))},toUserPage:function(){var t=this.item.author.id,path="/user/"+encodeURIComponent(t);this.userInfo.id==t&&(path="/personal"),this.$router.push(this.localePath(path))},editItemFn:function(){var t=this.item.id;this.$router.push({path:this.localePath("/modelEditStep"),query:{id:t}})},reportItemFn:function(){var t=this,e=this.item.id;Object(y.f)({id:e}).then((function(e){t.$message.success(t.$t("ReportSuccess"))}))},offShelfItemFn:function(){var t=this,e=this.item.id;this.$confirm(this.$t("modelDelistTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(n){Object(_.r)({id:e}).then((function(e){if(1e4==e.status.code)t.$message.success(t.$t("modelDelistSuccess")),t.$emit("onReseList",t.item);else if(10500==e.status.code){var n="https://aihelp.net/questionnaire/#/?formId=291ecf705dee4ceaa97af1bcc0d017b8";t.$i18n.locale.startsWith("zh")&&(n="https://aihelp.net/questionnaire/#/?formId=d9483db10f694841ba66414325fefbb6"),window.open(n,"_blank")}}))}))},deleteItemFn:function(){var t=this,e=this.item.id;this.$confirm(this.$t("newDeleteModelDesc"),this.$t("Tip"),{confirmButtonText:this.$t("Delete"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(n){Object(_.y)({model_id:e}).then((function(e){t.$emit("onReseList",t.item)}))}))}}},O=(n(4856),n(0)),component=Object(O.a)(T,(function(){var t,e,n,o,r,l,c,d,m,v=this,f=v._self._c;return f("div",{staticClass:"model-box"},[v.item.is_agency_fee?f("div",{staticClass:"payNum",attrs:{num:""}},[f("modelPayNum",{attrs:{number:v.item.agency_fee}})],1):v._e(),v._v(" "),f("div",{staticClass:"img-box",style:{backgroundImage:"url("+v.url+")"},on:{click:v.viewDetail}},[v.url?v._e():f("p",[v._v(v._s(v.$t(v.isCompanyAccount?"PleaseSetCover":"EmptyBannerModelText")))])]),v._v(" "),f("div",{staticClass:"box-mask",class:{show:2===(null===(t=v.item)||void 0===t?void 0:t.status)},on:{click:v.viewDetail}}),v._v(" "),v.isLoggedIn&&1==v.item.status&&1===v.item.publish_status?f("div",{staticClass:"cltpop"},[f("collect-popover",{attrs:{type:"model",folder:v.item},on:{newCreate:function(t){return v.$emit("newCreate")}}})],1):v._e(),v._v(" "),f("div",{directives:[{name:"show",rawName:"v-show",value:2!==(null===(e=v.item)||void 0===e?void 0:e.status),expression:"item?.status !== 2"}],staticClass:"btn-group"},[f("el-button",{directives:[{name:"show",rawName:"v-show",value:1===v.item.publish_status||v.isCompanyAccount,expression:"item.publish_status === 1 || isCompanyAccount"}],staticClass:"try-btn",on:{click:function(t){return t.stopPropagation(),v.handleClick(v.item,"GENERATE")}}},[v._v(v._s(v.$t("Try")))]),v._v(" "),f("el-button",{directives:[{name:"show",rawName:"v-show",value:2===v.item.publish_status&&!v.isCompanyAccount,expression:"item.publish_status === 2 && !isCompanyAccount"}],staticClass:"release-btn",on:{click:function(t){return t.stopPropagation(),v.handleClick(v.item,"RELEASE")}}},[v._v(v._s(v.$t("createSetting1")))])],1),v._v(" "),f("div",{staticClass:"model-info"},[f("div",{staticClass:"model-author",on:{click:function(t){return t.stopPropagation(),v.toUserPage.apply(null,arguments)}}},[v.item.author.head?f("img",{staticClass:"author-img",attrs:{src:v.item.author.head,alt:""}}):f("span",{staticClass:"author-img"},[v._v(v._s((v.item.author.name||v.item.author.id)[0]))]),v._v(" "),f("span",{staticClass:"author-name ellipsis"},[v._v(v._s(v.item.name))])]),v._v(" "),f("div",{staticClass:"model-handle"},[f("div",{staticClass:"collect-info",attrs:{"data-event":"ai_model_collect","data-id":v.item.id},on:{click:function(t){return t.preventDefault(),v.handleClick(v.item,"COLLECT")}}},[f("i",{staticClass:"iconfont",class:v.setCollectData(v.item)}),v._v(" "),(null===(n=v.item.stat)||void 0===n?void 0:n.num_of_collection)>0?f("span",[v._v(v._s(v._f("formatNumberForeign")(v.item.stat.num_of_collection)))]):v._e()]),v._v(" "),f("div",{directives:[{name:"show",rawName:"v-show",value:2!==(null===(o=v.item)||void 0===o?void 0:o.status),expression:"item?.status !== 2"}],staticClass:"generate-info",on:{click:function(t){return t.preventDefault(),v.handleClick(v.item,"GENERATE")}}},[f("i",{staticClass:"iconfont icon-play"}),v._v(" "),(null===(r=v.item.stat)||void 0===r?void 0:r.num_of_task)>0?f("span",[v._v(v._s(v._f("formatNumberForeign")(v.item.stat.num_of_task)))]):v._e()]),v._v(" "),f("el-popover",{attrs:{trigger:"hover"}},[f("div",{staticClass:"popBox"},[v.userInfo.id==(null===(l=v.item.author)||void 0===l?void 0:l.id)&&3!=v.item.status?f("div",{on:{click:v.editItemFn}},[v._v("\n            "+v._s(v.$t("Edit"))+"\n          ")]):v._e(),v._v(" "),1==v.item.publish_status?f("div",{on:{click:v.reportItemFn}},[v._v("\n            "+v._s(v.$t("Report"))+"\n          ")]):v._e(),v._v(" "),v.userInfo.id==(null===(c=v.item.author)||void 0===c?void 0:c.id)&&2===v.item.publish_status?f("div",{on:{click:v.deleteItemFn}},[v._v("\n            "+v._s(v.$t("Delete"))+"\n          ")]):v._e(),v._v(" "),v.userInfo.id==(null===(d=v.item.author)||void 0===d?void 0:d.id)&&2!=v.item.publish_status?f("div",{on:{click:v.offShelfItemFn}},[v._v("\n            "+v._s(v.$t("offShelf"))+"\n          ")]):v._e()]),v._v(" "),f("div",{staticClass:"generate-info more-btn",attrs:{slot:"reference"},slot:"reference"},[f("i",{staticClass:"iconfont icon-editModel"})])])],1)]),v._v(" "),2===(null===(m=v.item)||void 0===m?void 0:m.status)?f("div",{staticClass:"mid-banded flex flex-col items-center"},[f("i",{staticClass:"iconfont icon-forbidden forbidden-icon"}),v._v(" "),f("div",{staticClass:"disabled-text"},[v._v(v._s(v.$t("Model"))+" "+v._s(v.$t("Disabled")))]),v._v(" "),f("div",{staticClass:"disabled-btn",on:{click:function(t){return t.stopPropagation(),v.handleClick(v.item,"appeal")}}},[v._v("\n      "+v._s(v.$t("appeal"))+"\n    ")])]):v._e(),v._v(" "),v.appealShow?f("AppealDialog",{attrs:{"appeal-data":v.appealData,"is-appealing":v.isAppealLoading,"submit-callback":v.setResourceAppeal,"dialog-visible":v.appealShow},on:{"update:dialogVisible":function(t){v.appealShow=t},"update:dialog-visible":function(t){v.appealShow=t}}}):v._e(),v._v(" "),f("modelExistDialog",{ref:"modelExist",attrs:{existObj:v.existObj}})],1)}),[],!1,null,"076bcc09",null),I=component.exports;function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}installComponents(component,{CollectPopover:n(63).default,AppealDialog:n(359).default});var j={components:{ModelItem:I,ElEmpty:d.a},props:{tabData:{type:Object,default:function(){return{publish_status:"ALL",type:"LORA",list:[],loading:!1,isEnd:!1}}},getList:{type:Function}},data:function(){return{statusList:["All","createSetting1","createSetting2"]}},computed:L(L(L({},Object(v.e)("user",["userInfo","cdnHost"])),Object(v.c)("user",["isCompanyAccount"])),{},{emptyImgUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230617/804ae1a7-d655-4a59-a93b-775bfe4ebb5d.png")},loadingText:function(){var t=this.tabData,e=t.isEnd,n=t.loading;return e?this.$t("NoMoreData"):n?this.$t("Loading")+"...":""},isShowLoading:function(){var t=this.tabData,e=t.isEnd,n=t.loading,o=t.page;return n||1!==o&&e},publish_status:function(){var t=this.tabData.publish_status;return this.statusList[t]}}),methods:{handlEvent:function(t,e){this.$emit("handle",{type:t,val:this.statusList.indexOf(e)})}}},E=(n(4857),Object(O.a)(j,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tabData.loading,expression:"tabData.loading"}],ref:"modelList",staticClass:"model-list"},[e("div",{staticClass:"filter-panel custom-form"},[t.isCompanyAccount?t._e():e("el-select",{attrs:{value:t.publish_status,"popper-class":"custom-select"},on:{change:function(e){return t.handlEvent("STATUS",e)}}},t._l(t.statusList,(function(n,i){return e("el-option",{key:n+i,attrs:{label:t.$t(n),value:n}})})),1),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:t.tabData.list.length,expression:"tabData.list.length"}],staticClass:"upload-btn",attrs:{type:"primary"},on:{click:function(e){return t.handlEvent("UPLOAD")}}},[e("i",{staticClass:"iconfont icon-shangchuan"}),t._v("\n      "+t._s(t.$t("Checkpoint"===t.tabData.type?"UploadModels":"UploadLORA"))+"\n    ")])],1),t._v(" "),t.tabData.list.length?e("div",{staticClass:"list-panel",attrs:{id:t.tabData.type+"Model"}},[t._l(t.tabData.list,(function(n,i){return e("model-item",{key:"model_"+i,attrs:{item:n},on:{change:function(e){return t.handlEvent("REFRESH")},onReseList:function(e){return t.$emit("onReseList")}}})})),t._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.isShowLoading,expression:"isShowLoading"}],staticClass:"loading"},[t._v(t._s(t.loadingText))])],2):t.tabData.isEnd?e("el-empty",{attrs:{description:t.$t("ModelEmptyText",{modelType:"Checkpoint"===t.tabData.type?"Checkpoint":"LoRA"}),image:t.emptyImgUrl}},[e("el-button",{staticClass:"upload-btn",attrs:{type:"primary"},on:{click:function(e){return t.handlEvent("UPLOAD")}}},[e("i",{staticClass:"iconfont icon-shangchuan"}),t._v("\n      "+t._s(t.$t("Checkpoint"===t.tabData.type?"UploadModels":"UploadLORA"))+"\n    ")])],1):t._e()],1)}),[],!1,null,"df51612a",null).exports);n(16),n(21),n(32);function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var M={name:"TrainBaseModelModal",components:{StyleModal:n(303).default},props:{width:{type:String,default:"508px"},modelId:{type:String,default:""}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(v.c)("user",["isCompanyAccount"])),data:function(){return{visible:!1,loading:!1,modelType:"Checkpoint",selectList:[],modelList:[],selectModel:"",modelName:"",urlList:[],modelTypeVal:"SD 1.5",modelTypeList:[{name:"SD",id:"SD 1.5"},{name:"SDXL",id:"SDXL 1.0"}],urlLoading:!1,EHpower:null}},watch:{visible:{handler:function(t){t?(this.getModelList(),this.getTrainModelEstimate()):(this.EHpower=null,this.selectModel="",this.modelName="",this.modelTypeVal="SD 1.5")}}},methods:{openModal:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.urlList=t,this.visible=!0},getTrainModelEstimate:function(){var t=this;Object(_.D)({id:this.modelId}).then((function(e){1e4==e.status.code&&(t.EHpower=e.data)}))},getModelList:function(){var t=this;this.urlLoading||(this.urlLoading=!0,Object(_.w)({type:"Checkpoint",urls:this.urlList,base_model:"SDXL 1.0"==this.modelTypeVal?"SDXL":this.modelTypeVal}).then((function(e){1e4==e.status.code&&(t.modelList=Array.isArray(e.data.items)?e.data.items:[],t.selectModel=t.modelList.length?t.modelList[0].id:"")})).finally((function(){t.urlLoading=!1})))},handleSelectModelType:function(t){this.getModelList()},handleSelectModel:function(t){"MoreModel"!==t?(this.selectModel=t,this.$refs.styleModal.handleClose()):this.$refs.styleModal.openModal()},selectLoraHandle:function(t){console.log(t,"选中的风格-----")},selectModelHandle:function(t){if(console.log(t,"选中的模型-----"),this.$refs.styleModal.handleClose(),["",void 0,null].includes(t))this.selectModel="";else{var e=this.modelList.find((function(e){return e.id===t.id}));["",void 0,null].includes(e)&&(this.modelList.push(t),this.selectModel=t.id)}},handleCancel:function(){this.visible=!1},handleConfirm:function(){["",null,void 0].includes(this.modelName)?this.$message.warning(this.$t("loraNameNotEmpty")):/\S/.test(this.modelName)?/^[a-zA-Z0-9\s_\u4e00-\u9fa5.\-]+$/.test(this.modelName)?this.$emit("confirm",{id:this.selectModel,modelName:this.modelName,type:this.modelTypeVal}):this.$message.warning(this.$t("newModelNameFormatWarn")):this.$message.warning(this.$t("namePurewhitespace"))}}},N=M,R=(n(4858),n(4859),Object(O.a)(N,(function(){var t,e,n=this,o=n._self._c;return o("el-dialog",{ref:"trainBaseModelModal",attrs:{title:n.$t("trainModel"),visible:n.visible,width:n.width,top:"30vh","custom-class":"c-train-base-model-modal custom-dialog","close-on-click-modal":!1,"modal-append-to-body":!1,center:""},on:{"update:visible":function(t){n.visible=t}}},[o("div",{staticClass:"train-model-main custom-form"},[o("div",{staticClass:"train-model-main-item"},[o("div",{staticClass:"train-model-main-item-label"},[n._v("\n        "+n._s(n.$t("loraName"))+"\n      ")]),n._v(" "),o("el-input",{attrs:{maxlength:50},model:{value:n.modelName,callback:function(t){n.modelName=t},expression:"modelName"}})],1),n._v(" "),o("div",{staticClass:"train-model-main-item"},[o("div",{staticClass:"train-model-main-item-label"},[n._v("\n        "+n._s(n.$t("Training")+n.$t("Type"))+"\n      ")]),n._v(" "),o("el-select",{staticClass:"train-model-main-item-select",attrs:{placeholder:"","popper-class":"custom-select","popper-append-to-body":!1},on:{change:n.handleSelectModelType},model:{value:n.modelTypeVal,callback:function(t){n.modelTypeVal=t},expression:"modelTypeVal"}},n._l(n.modelTypeList,(function(t,i){return o("el-option",{key:"modelType_"+i,attrs:{label:t.name,value:t.id}})})),1)],1),n._v(" "),o("div",{staticClass:"train-model-main-item"},[o("div",{staticClass:"train-model-main-item-label"},[n._v("\n        "+n._s(n.$t("BaseModel"))+"\n        "),o("el-tooltip",{attrs:{"popper-class":"custom-tips-popper",effect:"light",content:n.$t("baseModelTips"),placement:"top-start"}},[o("span",{staticClass:"el-icon-warning custom-tips"})])],1),n._v(" "),o("el-select",{staticClass:"train-model-main-item-select",attrs:{value:n.selectModel,placeholder:"","popper-class":"custom-select","popper-append-to-body":!1},on:{change:n.handleSelectModel}},[n._l(n.modelList,(function(t,i){return o("el-option",{key:"model_"+i,attrs:{label:t.name,value:t.id}})})),n._v(" "),o("el-option",{attrs:{label:n.$t("selectMoreModel"),value:"MoreModel"}})],2)],1),n._v(" "),n.EHpower&&!n.isCompanyAccount?o("div",{staticClass:"eHpower"},[o("span",[n._v(n._s(n.$t("estimatedCost"))+"："+n._s(n.$t("approximately"))+"\n        "+n._s("SD 1.5"==n.modelTypeVal?null===(t=n.EHpower)||void 0===t?void 0:t.sd_hashrate:null===(e=n.EHpower)||void 0===e?void 0:e.sdxl_hashrate)+"\n        "+n._s(n.$t("tempCoins"))+"/"+n._s(n.$t("calculateCoins")))]),n._v(" "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:n.$t("eHpowerTip"),placement:"bottom"}},[o("i",{staticClass:"el-icon-warning-outline"})])],1):n._e()]),n._v(" "),o("div",{staticClass:"train-model-btn-box",attrs:{slot:"footer"},slot:"footer"},[o("span",{staticClass:"train-model-btn train-model-btn__cancel",on:{click:n.handleCancel}},[n._v(n._s(n.$t("Cancel")))]),n._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:n.urlLoading,expression:"urlLoading"}],staticClass:"train-model-btn train-model-btn__confirm"},[o("div",{staticClass:"train-model-btn-text",on:{click:n.handleConfirm}},[n._v(n._s(n.$t("Confirm")))])])]),n._v(" "),o("style-modal",{ref:"styleModal",attrs:{"model-type":n.modelType,"select-list":n.selectList,isSDXL:"SDXL 1.0"==n.modelTypeVal,inTask:!0},on:{selectModel:n.selectModelHandle}})],1)}),[],!1,null,"3e575aea",null).exports),A={props:{url:{typl:String,default:""}},data:function(){return{src:""}},mounted:function(){var t=this,img=new Image;img.src=Object(f.K)(this.url,"low"),img.onload=function(){t.src=img.src},img.onerror=function(){t.src=t.url}}},F=Object(O.a)(A,(function(){var t=this;return(0,t._self._c)("img",{directives:[{name:"show",rawName:"v-show",value:t.src,expression:"src"}],staticClass:"trainImg",attrs:{src:t.src,alt:""}})}),[],!1,null,"30a74f5c",null).exports,B={components:{DataSetSwiperlist:n(942).a},data:function(){return{loading:!1,hotDataSetObj:{0:[],1:[]}}},computed:{hasData:function(){return this.hotDataSetObj[0].length||this.hotDataSetObj[1].length}},methods:{handleClick:function(t){this.$router.push(this.localePath("/loraTrainingEdit?id=".concat(t.id,"&DSType=").concat(t.train_task_type,"&isAdd=true")))},getHotDataSetList:function(){var t=this;this.loading=!0,Object(_.h)().then((function(e){var n;if(1e4===e.status.code){var o=null!==(n=e.data)&&void 0!==n?n:{},r=o.image_datasets,l=o.video_datasets;t.hotDataSetObj={0:r,1:l}}})).finally((function(){t.loading=!1}))},handleViewMore:function(){this.$router.push(this.localePath("/lora_train")),this.$xyLogEvent({front_operation:"click",entity_type:"Training_Main_StartTrain",entity_name:"no_dataset_view_more"})}},mounted:function(){this.getHotDataSetList()}};n(4861);function V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function U(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?V(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var H={components:{TrainBaseModelModal:R,trainImg:F,TrainDefBox:Object(O.a)(B,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"trainDefBox"},[t.hasData?[e("div",{staticClass:"title"},[t._v(t._s(t.$t("quickTrainTemplate")))]),t._v(" "),e("div",{staticClass:"subTitle"},[t._v(t._s(t.$t("trainPresetTip")))]),t._v(" "),t.hotDataSetObj[0].length?e("div",{staticClass:"category"},[e("div",{staticClass:"category-name"},[t._v(t._s(t.$t("Image")))]),t._v(" "),e("DataSetSwiperlist",{attrs:{cardRunderList:t.hotDataSetObj[0]},on:{cardItemClick:t.handleClick}})],1):t._e(),t._v(" "),t.hotDataSetObj[1].length?e("div",{staticClass:"category"},[e("div",{staticClass:"category-name"},[t._v(t._s(t.$t("Video")))]),t._v(" "),e("DataSetSwiperlist",{attrs:{cardRunderList:t.hotDataSetObj[1]},on:{cardItemClick:t.handleClick}})],1):t._e(),t._v(" "),e("div",{staticClass:"tip flex_lr_m"},[t._v("\n      "+t._s(t.$t("noDataset"))+"\n      "),e("el-button",{attrs:{type:"primary"},on:{click:t.handleViewMore}},[t._v(t._s(t.$t("viewMore")))])],1)]:t._e()],2)}),[],!1,null,"098246d4",null).exports,ScrollLoadMore:n(1180).default},data:function(){return{defShow:!1,dialogVisible:!1,type:1,loading:!1,progressShow:!1,playLoading:!1,progressNum:0,hitTimes:"",modelId:"",typeOption:[{value:0,label:this.$t("realisticCharacter")},{value:1,label:this.$t("animeCharacter")},{value:2,label:this.$t("c_style")}],dataCreate:{name:"",meta:{images:[],type:0}},createLoading:!1,datas:{},inTimes:"",dataSetNo:[],ModelPgsList:[],messageBoxShown:!1,progressShowPopover:!1,dataSetList:_.f,hasReportedExposure:!1}},computed:U(U(U(U({},Object(v.e)("user",["userInfo","token"])),Object(v.c)("user",["isCompanyAccount","isLoggedIn"])),Object(v.c)("payment",["paymentInfo"])),{},{isShowVipTip:function(){var t=["Member","ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][this.paymentInfo.productLevel]||"";return t&&"MasterPlan"!==t},currentVipLevel:function(){var t=["Member","ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][this.paymentInfo.productLevel]||"",e="basic";return t&&(["Member","ToB_beginnerPlan","StandardPlan"].includes(t)&&(e="professional"),["ToB_professionalPlan"].includes(t)&&(e="master")),e},canTrainQue:function(){var t,e,n;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.productLevel)&&(null===(e=this.paymentInfo)||void 0===e?void 0:e.productLevel)>=3&&(null===(n=this.paymentInfo)||void 0===n?void 0:n.svipActiveState)||this.isCompanyAccount},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount}}),watch:{dialogVisible:{handler:function(t){t||(this.dataCreate.name="",this.dataCreate.meta.type=0)}},progressShow:{handler:function(t){var e=!!t;this.setTrainState(e)},immediate:!0}},mounted:function(){var t=this;this.token||this.$cookies.get("T")?this.getTrainModelList():this.defShow=!0,clearTimeout(this.inTimes),this.$once("hook:beforeDestroy",(function(){clearTimeout(t.inTimes)}))},methods:U(U({},Object(v.d)("user",["setTrainState"])),{},{goDetail:function(t){window.open(this.localePath("/loraTrainingDet?id=".concat(t)),"_blank")},getTrainModelTypeText:function(t){return 0==t?this.$t("Image"):1==t?this.$t("Video"):this.$t("trainListTag")},handleOpenVip:function(){this.$logEvent("log_actions",{operation:"click_upgrade",behavior_info:"on_model_train_page"});var t;t="professional"===this.currentVipLevel?"NoExpireTimeTipWeb1":"NoExpireTimeTipWeb2";var e=this.currentVipLevel;e&&this.$EventBus.$emit("showBreakDialog",t,e)},goHistory:function(){this.$logEvent("log_actions",{operation:"click_train_history",behavior_info:"on_train_dataset_page"}),this.$emit("goHistory")},player:function(t){var e=this,n={data_set_no:this.datas.id,name:t.modelName,related_model_no:t.id,model_category:t.type,type:2};Object(_.C)(n).then((function(t){1e4==t.status.code&&(e.$message({message:e.$t("trainingStarted"),type:"success"}),e.$refs.trainModel.handleCancel(),e.getTrainModelList())}))},getData:function(t){var e=this;this.playLoading||(this.isVip?!this.progressShow||this.canTrainQue?(this.playLoading=!0,Object(_.d)({id:t.id}).then((function(n){if(1e4==n.status.code){if(e.datas=n.data,e.datas.meta.images.length<9)return e.$message.warning(e.$t("least9")),void(e.playLoading=!1);var o=[];n.data.meta.images.forEach((function(t,i){i<10&&o.push(t.url)})),e.modelId=t.id,e.$refs.trainModel.openModal(o),e.playLoading=!1}})).catch((function(t){e.playLoading=!1}))):this.$EventBus.$emit("showUpgradeDialog","LoRATrainQueVipTipWeb","professional"):this.$EventBus.$emit("showBreakDialog","LoRATrainTipWeb","professional"))},setTrainType:function(t){var e="waiting";return this.ModelPgsList.forEach((function(n){t==n.data_set_no&&(e=n.state_desc)})),e},getTrainModelList:function(){var t=this;Object(_.E)().then((function(e){var n;if(1e4==e.status.code)if((null===(n=e.data)||void 0===n||null===(n=n.items)||void 0===n?void 0:n.length)>0){var o,r=[];null===(o=e.data)||void 0===o||o.items.forEach((function(t){r.push(t.id)})),t.progressShow=!0,clearTimeout(t.inTimes),t.getTrainModelProgress(r)}else t.progressShow=!1}))},getTrainModelProgress:function(t){var e=this;Object(_.F)({ids:t}).then((function(n){if(1e4==n.status.code){var o,r,c,d,m,v,f,h,_,y;if(null!==(o=n.data)&&void 0!==o&&o.items.some((function(t){return"sysTimeoutDesc"===t.state_desc})))return clearTimeout(e.inTimes),void e.getTrainModelList();if(!(null!==(r=n.data)&&void 0!==r&&r.items.some((function(t){return"processing"===t.state_desc}))||null!==(c=n.data)&&void 0!==c&&c.items.some((function(t){return"waiting"===t.state_desc}))))return e.progressShow=!1,e.dataSetNo=[],void clearTimeout(e.inTimes);if(e.ModelPgsList=null===(d=n.data)||void 0===d?void 0:d.items,e.dataSetNo=[],null===(m=n.data)||void 0===m||m.items.forEach((function(t){3!=t.state&&4!=t.state&&5!=t.state&&e.dataSetNo.push(t.data_set_no),"processing"==t.state_desc&&(e.progressNum=t.process)})),null!==(v=n.data)&&void 0!==v&&v.items.some((function(t){return 4===t.state}))||null!==(f=n.data)&&void 0!==f&&f.items.some((function(t){return 5===t.state})))return e.messageBoxShown||(e.messageBoxShown=!0,e.$alert(e.$t("newTrainingCompletederr"),e.$t("Tip"),Object(l.a)({confirmButtonText:e.$t("Confirm"),callback:function(t){e.messageBoxShown=!1}},"callback",(function(t){e.messageBoxShown=!1})))),clearTimeout(e.inTimes),void e.getTrainModelList();if(null!==(h=n.data)&&void 0!==h&&h.items.some((function(t){return 3===t.state})))return e.messageBoxShown||(e.messageBoxShown=!0,e.$alert(e.$t("trainingCompleted"),e.$t("Tip"),Object(l.a)({confirmButtonText:e.$t("Confirm"),callback:function(t){e.messageBoxShown=!1}},"callback",(function(t){e.messageBoxShown=!1})))),clearTimeout(e.inTimes),void e.getTrainModelList();null!==(_=n.data)&&void 0!==_&&_.items.some((function(t){return"processing"===t.state_desc}))||null!==(y=n.data)&&void 0!==y&&y.items.some((function(t){return"waiting"===t.state_desc}))?(clearTimeout(e.inTimes),e.inTimes=setTimeout((function(){e.getTrainModelProgress(t)}),6e4)):(e.progressShow=!1,e.dataSetNo=[],clearTimeout(e.inTimes))}else clearTimeout(e.inTimes),e.inTimes=setTimeout((function(){e.getTrainModelProgress(t)}),6e4)}))},onCreate:function(){var t=this;this.dataCreate.name?this.createLoading||(this.createLoading=!0,Object(_.b)(this.dataCreate).then((function(e){1e4===e.status.code&&(t.dialogVisible=!1,t.loading=!1,t.$refs.scrollLoadMore.reset())})).finally((function(){t.createLoading=!1}))):this.$message.warning(this.$t("trainEnterName"))},loadEnd:function(t){this.hasReportedExposure||(this.hasReportedExposure=!0,this.defShow=0===t.length,this.$xyLogEvent({front_operation:"exposure",entity_type:"Training_Main_StartTrain",entity_name:"training_interface",obj_info:{status:this.defShow}}))}})},z=(n(4863),n(4864),Object(O.a)(H,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],class:["LoraTrainingList",t.defShow?"LoraTrainingList-def":""],attrs:{"data-group":"lora-train-list"}},[e("div",{staticClass:"cntTop"},[t.progressShow?[e("el-popover",{attrs:{placement:"bottom",trigger:"click","popper-class":"progress-popover"},model:{value:t.progressShowPopover,callback:function(e){t.progressShowPopover=e},expression:"progressShowPopover"}},[e("div",{staticClass:"progress-content"},t._l(t.ModelPgsList,(function(n,o){return e("div",{key:n.id,staticClass:"progress",attrs:{"data-event":"lora-train-list-progress-item","data-desc":"训练进度点击"},on:{click:function(e){return e.stopPropagation(),t.goDetail(n.id)}}},[e("span",[t._v("\n              "+t._s(n.train_task_record_name)+"\n            ")]),t._v(" "),e("span",[t._v("\n              "+t._s("processing"===n.state_desc?"".concat(n.process||0,"%"):t.$t("Queuing"))+"\n            ")])])})),0),t._v(" "),e("div",{attrs:{slot:"reference","data-event":"lora-train-list-progress-popover","data-desc":"展开收起训练进度"},slot:"reference"},[e("div",{staticClass:"wait-box"},[e("div",{staticClass:"wait-box-left"},[e("i",{staticClass:"iconfont",class:t.progressShowPopover?"icon-zhankaizhuangtai":"icon-shouqizhuangtai"}),t._v(" "),e("div",{staticClass:"wait-text"},[t._v("\n                "+t._s(t.$t("trainingModelTip",{num:t.ModelPgsList.length}))+"\n              ")])]),t._v(" "),e("div",{staticClass:"loading-dots"},[e("div",{staticClass:"dot"}),t._v(" "),e("div",{staticClass:"dot"}),t._v(" "),e("div",{staticClass:"dot"})])])])])]:t._e()],2),t._v(" "),t.defShow?e("div",{staticClass:"defBox"},[e("TrainDefBox")],1):t._e(),t._v(" "),t.isLoggedIn&&!t.defShow?e("ScrollLoadMore",{ref:"scrollLoadMore",staticClass:"cnt",attrs:{loadData:t.dataSetList,useWindow:""},on:{loadEnd:t.loadEnd},scopedSlots:t._u([{key:"default",fn:function(n){var o=n.list;return[e("div",{staticClass:"list"},t._l(o,(function(n,o){return e("div",{key:o,staticClass:"item",on:{click:function(e){t.$router.push(t.localePath("/loraTrainingEdit?id=".concat(n.id,"&DSType=").concat(n.train_task_type)))}}},[e("div",{staticClass:"DSTypeStyle"},[t._v("\n            "+t._s(t.getTrainModelTypeText(n.train_model_type))+"\n          ")]),t._v(" "),n.covers&&n.covers[0]?e("trainImg",{attrs:{url:n.covers[0]}}):t._e(),t._v(" "),n.covers&&n.covers[1]?e("trainImg",{attrs:{url:n.covers[1]}}):t._e(),t._v(" "),n.covers&&n.covers[2]?e("trainImg",{attrs:{url:n.covers[2]}}):t._e(),t._v(" "),e("div",{staticClass:"name overflow-ellipsis"},[t._v(t._s(n.name))]),t._v(" "),e("div",{staticClass:"bntBox"}),t._v(" "),t.dataSetNo.includes(n.id)?e("div",{staticClass:"TrainType",class:{TrainIngType:"waiting"!=t.setTrainType(n.id)},on:{click:function(e){return e.stopPropagation(),t.goHistory.apply(null,arguments)}}},[t._v("\n            "+t._s("waiting"==t.setTrainType(n.id)?t.$t("waitingTraining"):t.$t("TrainingIng"))+"\n          ")]):t._e()],1)})),0)]}}],null,!1,1546316419)}):t._e(),t._v(" "),e("el-dialog",{attrs:{title:t.$t("createNewDataset"),visible:t.dialogVisible,top:"30vh",width:"510px","modal-append-to-body":!1,"close-on-click-modal":!1,"custom-class":"SaDialog train"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"main"},[e("div",{staticClass:"diaTitle",staticStyle:{"margin-top":"14px"}},[t._v(t._s(t.$t("trainName")))]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.dataCreate.name,expression:"dataCreate.name"}],attrs:{maxlength:"50",type:"text",placeholder:t.$t("myNewDataset")},domProps:{value:t.dataCreate.name},on:{input:function(e){e.target.composing||t.$set(t.dataCreate,"name",e.target.value)}}}),t._v(" "),e("div",{staticClass:"diaTitle",staticStyle:{"margin-top":"24px"}},[t._v(t._s(t.$t("Category")))]),t._v(" "),e("el-select",{staticClass:"showType custom-select",attrs:{"popper-class":"custom-select"},model:{value:t.dataCreate.meta.type,callback:function(e){t.$set(t.dataCreate.meta,"type",e)},expression:"dataCreate.meta.type"}},t._l(t.typeOption,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.createLoading,expression:"createLoading"}],staticClass:"addBox",staticStyle:{width:"100%"},attrs:{slot:"footer"},on:{click:t.onCreate},slot:"footer"},[e("div",{staticClass:"add",staticStyle:{"background-color":"#1c1d2a"}},[e("span",[t._v(t._s(t.$t("createDataset")))])])])]),t._v(" "),e("TrainBaseModelModal",{ref:"trainModel",attrs:{modelId:t.modelId},on:{confirm:t.player}})],1)}),[],!1,null,"ba3f56ca",null)),W=z.exports;installComponents(z,{ScrollLoadMore:n(1180).default});n(65);function G(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function K(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?G(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Y={components:{ModelFileUpload:n(611).a},data:function(){var t=this;return{isShow:!1,formData:{create_id:"",name:"",base_model:"",type:"Checkpoint",file_id:""},SDList:k.w,submitLoading:!1,rules:{name:[{required:!0,message:this.$t("PleaseEnterModelsName")},{validator:function(e,n,o){/^[a-zA-Z0-9\s_\u4e00-\u9fa5.\-]+$/.test(n)?o():o(new Error(t.$t("newModelNameFormatWarn")))}}],file_id:[{required:!0,message:this.$t("PleaseUploadModelsFIle")},{validator:function(e,n,o){var r=n?n.split("/")[1]:0;r=parseFloat((r/1e9).toFixed(2)),console.log(t.formData,r);var l=t.formData.type;if("Checkpoint"===l?r<1:r>1){var c="Checkpoint"===l?"Model":"LORA";o(new Error(t.$t(c+"FileSizeError")))}else o()}}],base_model:[{required:!0,message:this.$t("PleaseSelectBaseName")}]}}},computed:K(K(K({},Object(v.e)("user",["userInfo"])),Object(v.c)("user",["isCompanyAccount"])),{},{modelType:function(){return"Checkpoint"===this.formData.type?1:2}}),methods:{show:function(t){this.formData.type=t,this.isShow=!0,this.getModelConfig()},getModelConfig:function(){var t=this;this.submitLoading=!0,Object(_.o)({account_no:this.userInfo.id}).then((function(e){t.submitLoading=!1,t.formData.create_id=e.data.create_id})).catch((function(t){}))},closeDialog:function(t){var e=this;this.getEditStatus()&&!t?this.$confirm(this.$t("ModelCancelTips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.isShow=!1,e.$refs.modelsFileUpload.clear(),e.$refs.modelForm.resetFields(),e.$emit("hide")})):(this.isShow=!1,this.$refs.modelsFileUpload.clear(),this.$refs.modelForm.resetFields(),this.$emit("hide"))},getEditStatus:function(){var t=this.formData.file_id,e=this.$refs.modelsFileUpload.uploadingStatus;return t||"init"!==e},submit:function(){var t=this;this.$refs.modelForm.validate((function(e){e&&t.submiData()}))},submiData:function(){var t=this;this.submitLoading=!0;var e=K(K({},this.formData),{},{file_id:this.formData.file_id.split("/")[0]});Object(_.B)(e).then((function(e){console.log("上传模型",e),t.submitLoading=!1,t.isCompanyAccount?t.$message.success(t.$t("SaveSuccess")):t.$message.success(t.$t("CreateModelTips")),t.$emit("change",t.formData.type),t.closeDialog(!0)})).catch((function(){t.submitLoading=!1}))},getTranslationKey:function(t){return"Checkpoint"===this.formData.type?t:t.replace("Model","LORA")}}},X=(n(4866),Object(O.a)(Y,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"upload-model-dialog custom-dialog",attrs:{visible:t.isShow,title:t.$t("UploadModel"),"append-to-body":"","close-on-click-modal":!1,"before-close":t.closeDialog},on:{"update:visible":function(e){t.isShow=e}}},[e("div",{staticClass:"dialog-form"},[e("el-form",{ref:"modelForm",staticClass:"custom-form",attrs:{"label-position":"top",model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{label:t.$t("ModelsName"),required:"",prop:"name"}},[e("el-input",{attrs:{placeholder:t.$t("PleaseEnterModelsName"),maxlength:100},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("BaseModel"),required:"",prop:"base_model"}},[e("el-select",{attrs:{"popper-class":"custom-select",placeholder:t.$t("Pls_select")},model:{value:t.formData.base_model,callback:function(e){t.$set(t.formData,"base_model",e)},expression:"formData.base_model"}},t._l(t.SDList,(function(t,n){return e("el-option",{key:"SD_"+n,attrs:{label:t,value:t}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:t.$t("Type"),required:""}},[e("div",{staticClass:"type-select"},[e("span",{class:{active:"Checkpoint"===t.formData.type},on:{click:function(e){t.formData.type="Checkpoint"}}},[t._v("CheckPoint")]),t._v(" "),e("span",{class:{active:"LORA"===t.formData.type},on:{click:function(e){t.formData.type="LORA"}}},[t._v("LoRA")])])]),t._v(" "),e("el-form-item",{attrs:{label:t.$t("CheckpointFile"),required:"",prop:"file_id"}},[e("model-file-upload",{ref:"modelsFileUpload",attrs:{createId:t.formData.create_id,modelType:t.modelType},model:{value:t.formData.file_id,callback:function(e){t.$set(t.formData,"file_id",e)},expression:"formData.file_id"}})],1)],1),t._v(" "),t.isCompanyAccount?e("p",{staticClass:"upload-tips"},[t._v(t._s(t.$t("ToBModelsUploadTips")))]):e("p",{staticClass:"upload-tips"},[t._v(t._s(t.$t("ModelsUploadTips")))])],1),t._v(" "),e("div",{staticClass:"dialog-btn",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"cancel-btn",on:{click:function(e){return t.closeDialog()}}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{staticClass:"save-btn",attrs:{type:"primary",loading:t.submitLoading},on:{click:t.submit}},[t._v(t._s(t.$t("Save")))])],1)])}),[],!1,null,"ec1c6370",null).exports),J=n(250),Q=(n(1120),n(680)),Z=n.n(Q),tt=(n(24),n(43),n(125)),et=n.n(tt),at=n(570),it=n(174),nt={components:{EllipsisTooltip:at.default,ElPagination:Z.a,ElEmpty:d.a},data:function(){return{editingKey:null,setDate:f.O,formData:{limit:10,time_from:0,page:1},list:[],total:0,noMoreData:!1,loading:!1,emptyImgUrl:n(1075)}},computed:{useModelName:function(){return function(t){var e=t.base_model_name,n=t.base_model_ver_name;return n?"".concat(e,"-").concat(n):e}}},methods:{isItemViewable:function(t){return 4!==t.state&&5!==t.state},getItemStyle:function(t){return{opacity:this.isItemViewable(t)?1:.5,color:this.isItemViewable(t)?null:"#FCFCFC"}},handleClick:function(t){this.isItemViewable(t)&&this.goTrainDet(t)},getItemText:function(t){return this.isItemViewable(t)?this.$t("viewTraining"):this.$t("cannotView")},goTrainDet:function(t){window.open("/loraTrainingDet?id="+t.id,"_blank")},goTrain:function(){this.$router.push(this.localePath("/loraTrainingEdit?DSType=0")),this.$logEvent("log_actions",{operation:"click_go_immediately",behavior_info:"on_train_dataset_page"})},getList:function(){var t=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this.formData.page=1),this.loading=!0,Object(it.h)(this.formData).then((function(e){if(1e4==e.status.code){e.data.items.forEach((function(e){e.record_name=t.formatTimestampOrValue(e.record_name)}));var n=e.data,o=n.total,r=n.items;t.list=r,t.total=o,t.list.length.length>0&&(t.formData.time_from=t.list[t.list.length-1].create_at)}})).finally((function(){t.loading=!1}))},setStatus:function(t){var e="expired";switch(t){case 1:e=this.$t("Queuing");break;case 2:e=this.$t("TrainingIng");break;case 3:e=this.$t("Completed");break;case 4:e=this.$t("systemCancel");break;case 5:e=this.$t("expired")}return e},setSateClass:function(t){var e="";switch(t){case 1:e="Queuing";break;case 2:e="TrainingIng"}return e},getExpireTime:function(t){var e=(new Date).getTime();if(t&&t>e){var n=t-e,o=Math.floor(n/864e5);return o?this.$t("TaskExpireTime",{param:o}):this.$t("ExpiresSoon")}return this.$t("ExpiresSoon")},handleConfirm:function(t,e,n){var o=this;this.loading=!0,Object(it.m)({train_model_record_no:t.id,record_name:e}).then((function(){o.editingKey=null,t.record_name=e,o.$message.success(o.$t("SuccessfullyModified")),n()})).finally((function(){o.loading=!1}))},formatTimestampOrValue:function(t){if(!t)return"-";var e=Number(t);if(!isNaN(e)&&e>0){var n,o=e.toString();if(10===o.length?n=et.a.unix(e):13===o.length&&(n=et()(e)),n&&n.isValid())return n.format("YYYY-MM-DD HH:mm:ss")}return t},handleCurrentChange:function(t){this.formData.page=t,this.getList()}}},ot=nt,st=(n(4883),Object(O.a)(ot,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"loraTrainingHistory",staticClass:"LoraTrainingHistory"},[t.list.length?e("div",{staticClass:"list-container"},[e("div",{staticClass:"title row"},[e("span",[t._v(t._s(t.$t("trainingTaskName")))]),t._v(" "),e("span",{staticClass:"name-span"},[t._v(t._s(t.$t("datasetName")))]),t._v(" "),e("span",[t._v(t._s("ID"))]),t._v(" "),e("span",[t._v(t._s(t.$t("trainingTime")))]),t._v(" "),e("span",[t._v(t._s(t.$t("trainExpirationTime")))]),t._v(" "),e("span",{staticClass:"name-span"},[t._v(t._s(t.$t("useModel")))]),t._v(" "),e("span",[t._v(t._s(t.$t("status")))]),t._v(" "),e("span",{staticClass:"custom-col"},[t._v(t._s(t.$t("operation")))])]),t._v(" "),t._l(t.list,(function(n,o){return e("div",{key:n.data_set_no+","+o,ref:"list",refInFor:!0,staticClass:"list row"},[e("div",{staticClass:"name-col"},[e("EllipsisTooltip",{attrs:{iconPosition:"right",itemKey:n.id,editingKey:t.editingKey,asyncClose:""},on:{"update:editingKey":function(e){t.editingKey=e},confirm:function(e,o){return t.handleConfirm(n,e,o)}},model:{value:n.record_name,callback:function(e){t.$set(n,"record_name",e)},expression:"item.record_name"}})],1),t._v(" "),e("span",{staticClass:"name-span"},[e("EllipsisTooltip",{attrs:{value:n.data_set_name}})],1),t._v(" "),e("span",[t._v(t._s(n.id))]),t._v(" "),e("span",[t._v(t._s(t.setDate(n.create_at)))]),t._v(" "),e("span",[t._v(t._s(5==n.state?t.$t("expired"):t.getExpireTime(n.expiration_time)))]),t._v(" "),e("span",{staticClass:"name-span"},[e("EllipsisTooltip",{attrs:{value:t.useModelName(n)}})],1),t._v(" "),e("div",{staticClass:"stateBox"},[e("div",{class:t.setSateClass(n.state)},[t._v(t._s(t.setStatus(n.state)))])]),t._v(" "),e("span",{staticClass:"custom-col",style:t.getItemStyle(n),on:{click:function(e){return t.handleClick(n)}}},[t._v("\n        "+t._s(t.getItemText(n))+"\n      ")])])})),t._v(" "),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","page-size":t.formData.limit,layout:"prev, pager, next","current-page":t.formData.page,total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.formData,"page",e)},"update:current-page":function(e){return t.$set(t.formData,"page",e)}}})],1)],2):t._e(),t._v(" "),t.list.length||t.loading?t._e():e("el-empty",{attrs:{description:t.$t("taskEmptyText"),image:t.emptyImgUrl}},[e("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.goTrain}},[t._v("\n      "+t._s(t.$t("trainNow"))+"\n    ")])],1)],1)}),[],!1,null,"c74836c8",null)),lt=st.exports;installComponents(st,{EllipsisTooltip:n(570).default});var ct=["activateTab","autoOpen"],ut=["content"];function mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function pt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var vt={name:"AIModel",components:{ModelList:E,CreateModelPopup:X,LoraTrainingList:W,PageSeo:J.a,LoraTrainingHistory:lt},data:function(){return{activeTab:"Training",tabData:{Checkpoint:{type:"Checkpoint",list:[],page:1,loading:!1,isEnd:!1,publish_status:0,time_to:""},LORA:{type:"LORA",list:[],page:1,loading:!1,isEnd:!1,publish_status:0,time_to:""}},pageSEO:{tempList:[]},trainingList:[{title:this.$t("imageTrain"),bg:"https://image.cdn2.seaart.me/static/web/model-train-img-bg.webp",desc:this.$t("imageTrainDesc")},{title:this.$t("videoTrain"),bg:"https://image.cdn2.seaart.me/static/web/model-train-video-bg.webp",desc:this.$t("videoTrainDesc")}],isFixed:!1,headerHeight:0,headerObserver:null,savedScrollY:0}},computed:pt(pt({},Object(v.e)("user",["token"])),{},{isShowSEO:function(){var t;return(null===(t=this.pageSEO)||void 0===t||null===(t=t.tempList)||void 0===t?void 0:t.length)&&!this.token}}),beforeRouteLeave:function(t,e,n){null!==this.$refs.training.inTimes&&clearTimeout(this.$refs.training.inTimes),this.savedScrollY=window.scrollY||document.documentElement.scrollTop,n()},activated:function(){var t=this;this.$nextTick((function(){window.scrollTo({top:t.savedScrollY||0,behavior:"auto"})}))},mounted:function(){var t=this;this.initTab(),this.$nextTick((function(){t.updateHeaderHeight(),window.addEventListener("scroll",t.handleScroll,{passive:!0}),t.observeHeaderResize()}))},beforeDestroy:function(){var t;window.removeEventListener("scroll",this.handleScroll),null===(t=this.headerObserver)||void 0===t||t.disconnect()},watch:{$route:function(t){"AIModel"===t.name?(this.activeTab=localStorage.getItem("AIModelTab")||"Training",this.reflectList()):localStorage.setItem("AIModelTab",this.activeTab)},"$route.query.autoOpen":function(t){"true"===t&&this.$route.path.endsWith("/models")&&this.showUploadPopup()},"$route.query.activateTab":function(t){t&&(this.activeTab=t,localStorage.setItem("AIModelTab",this.activeTab))}},methods:{handleScroll:function(){var t,e=window.scrollY||document.documentElement.scrollTop,n=((null===(t=this.$refs.tabsRef)||void 0===t||null===(t=t.$el)||void 0===t?void 0:t.offsetTop)||0)-this.headerHeight;!this.isFixed&&e>=n+30?this.isFixed=!0:this.isFixed&&e<n-30&&(this.isFixed=!1)},updateHeaderHeight:function(){var t=document.querySelector(".el-header");t&&(this.headerHeight=t.offsetHeight,document.documentElement.style.setProperty("--tabs-fixed-top","".concat(this.headerHeight,"px")))},observeHeaderResize:function(){var t=this,e=document.querySelector(".el-header");e&&"undefined"!=typeof ResizeObserver&&(this.headerObserver=new ResizeObserver((function(){t.updateHeaderHeight()})),this.headerObserver.observe(e))},initTab:function(){var t,e,n;null!==(t=this.$route)&&void 0!==t&&null!==(t=t.query)&&void 0!==t&&t.activateTab&&(this.activeTab=null===(e=this.$route)||void 0===e||null===(e=e.query)||void 0===e?void 0:e.activateTab,"true"===(null===(n=this.$route)||void 0===n||null===(n=n.query)||void 0===n?void 0:n.autoOpen)&&(this.reflectList(this.activeTab),this.showUploadPopup()))},clearQuery:function(){var t=this.$route.query,e=t.activateTab,n=t.autoOpen,o=Object(r.a)(t,ct);(e||n)&&this.$router.replace({path:this.$route.path,query:o})},goHistory:function(){this.activeTab="TaskList"},handleClick:function(t){var e=this.$refs.tabsRef.$el.offsetTop;if(window.scrollY>e&&window.scrollTo({top:e-this.headerHeight-60,behavior:"auto"}),"Training"!==this.activeTab)if("TaskList"!==this.activeTab){var n=this.tabData[this.activeTab],o=n.isEnd,r=n.list;n.loading||r.length||o||this.getModelList()}else this.$refs.loraTrainingHistory.getList(!0)},changeStatus:function(t,e){this.tabData[e].publish_status=t,this.reflectList()},listHandle:function(t,e){var n=t.type,o=t.val;switch(n){case"UPLOAD":this.$router.push({path:this.localePath("/modelEditStep")});break;case"STATUS":this.changeStatus(o,e);break;default:this.reflectList()}},showUploadPopup:function(){this.token?(this.$logEvent("log_actions",{operation:"LORA"===this.activeTab?"click_upload_style":"click_upload_model",action_info:"LORA"===this.activeTab?"style_id":"model_id"}),this.$refs.uploadModelPopup.show(this.activeTab)):this.$EventBus.$emit("openLoginDialog")},reflectList:function(t){t?this.activeTab=t:t=this.activeTab,this.tabData[t]=pt(pt({},this.tabData[t]),{},{page:1,list:[],loading:!1,isEnd:!1,time_to:""}),this.getModelList()},getModelList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.activeTab,n=this.tabData[e],o=this.getParams(e);n.loading=!0,Object(_.s)(o).then((function(o){t.setModelList(o,e),n.loading=!1,setTimeout((function(){t.addScrollEvent(e)}),1500)})).catch((function(t){n.loading=!1}))},getParams:function(t){var e=this.tabData[t],n=e.page,o=e.time_to,r={publish_status:e.publish_status,model_type:t,order_by:"new",page:n,page_size:30,type:"user_upload"};return o&&(r.time_to=o),r},setModelList:function(t,e){var n=t.data,o=n.items,r=n.has_more,l=n.time_ms,c=this.tabData[e];c.isEnd=!r,c.time_to=l,o&&(c.list=c.list.concat(o||[])),this.$set(this.tabData,e,c)},addScrollEvent:function(t){var e=this,n=this.tabData[t],o=document.querySelector("#"+t+"Model");!n.isEnd&&o&&(window.removeEventListener("scroll",(function(){})),window.addEventListener("scroll",(function(){!((window.scrollY||document.documentElement.scrollTop)+window.innerHeight>=document.documentElement.scrollHeight-10)||n.loading||n.isEnd||(n.page++,e.getModelList(t))})))},handleTrain:function(t){this.$router.push(this.localePath("/loraTrainingEdit?DSType="+t)),this.$logEvent("log_actions",{operation:"click_create_dataset",behavior_info:"on_train_dataset_page"})}},head:function(){var t=this.pageSEO,title=t.title,e=t.key_words,n=t.meta_description;return{title:title=this.$t(title),meta:[{hid:"description",name:"description",content:n=this.$t(n)},{hid:"keywords",name:"keywords",content:e=this.$t(e)},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:n}]}},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,data,l,c,title,d,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,t.params,t.error,e.prev=1,e.next=4,n.$post("/api/v1/fast_ai/detail",{name:"train_model"});case 4:return o=e.sent,data=o.data,c=(l=data||{}).module,title=l.title,d=l.meta_description,m=l.key_words,v=null!=c&&c.length?c.map((function(t){var content=t.content;return pt(pt({},Object(r.a)(t,ut)),{},{content:JSON.parse(content)})})):[],e.abrupt("return",{pageSEO:{tempList:v,title:title,key_words:m,meta_description:d}});case 11:e.prev=11,e.t0=e.catch(1);case 13:case"end":return e.stop()}}),e,null,[[1,11]])})))()}},ft=vt,ht=(n(4884),Object(O.a)(ft,(function(){var t,e=this,n=e._self._c;return n("div",{staticClass:"model-container",attrs:{"data-group":"ai_model_training"}},[n("el-backtop",{attrs:{bottom:30,right:30}},[n("i",{staticClass:"el-icon-top"})]),e._v(" "),n("div",{staticClass:"training-container"},e._l(e.trainingList,(function(t,o){return n("div",{key:o,staticClass:"training-card flex_b",style:{backgroundImage:"url(".concat(t.bg,")")}},[n("div",{staticClass:"training-content flex_m"},[n("div",{staticClass:"info"},[n("div",{staticClass:"title"},[e._v(e._s(t.title))]),e._v(" "),n("div",{staticClass:"desc"},[e._v(e._s(t.desc))])]),e._v(" "),n("div",{staticClass:"trainBtn",on:{click:function(t){return e.handleTrain(o)}}},[e._v(e._s(e.$t("trainNow")))])])])})),0),e._v(" "),e.isFixed?n("div",{staticStyle:{height:"55px"}}):e._e(),e._v(" "),n("div",{class:{"fixed-tabs":e.isFixed}},[n("el-tabs",{ref:"tabsRef",on:{"tab-click":e.handleClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[n("el-tab-pane",{attrs:{label:e.$t("Training"),name:"Training"}},[n("lora-training-list",{ref:"training",style:{"margin-bottom":e.isShowSEO?"100px":""},attrs:{type:"model"},on:{upload:e.showUploadPopup,goHistory:e.goHistory}})],1),e._v(" "),n("el-tab-pane",{attrs:{label:e.$t("TaskList"),name:"TaskList"}},[n("lora-training-history",{ref:"loraTrainingHistory"})],1),e._v(" "),n("el-tab-pane",{attrs:{label:e.$t("Model"),name:"Checkpoint"}},[n("model-list",{attrs:{type:"model",tabData:e.tabData.Checkpoint},on:{handle:function(t){return e.listHandle(t,"Checkpoint")},onReseList:function(t){return e.reflectList()}}})],1),e._v(" "),n("el-tab-pane",{attrs:{label:e.$t("LoRA"),name:"LORA"}},[n("model-list",{attrs:{type:"lora",tabData:e.tabData.LORA},on:{handle:function(t){return e.listHandle(t,"LORA")},onReseList:function(t){return e.reflectList()}}})],1)],1)],1),e._v(" "),e.isShowSEO?n("page-seo",{attrs:{tempList:null===(t=e.pageSEO)||void 0===t?void 0:t.tempList}}):e._e(),e._v(" "),n("client-only",[n("create-model-popup",{ref:"uploadModelPopup",on:{change:e.reflectList,hide:e.clearQuery}})],1)],1)}),[],!1,null,"695e8397",null));e.default=ht.exports},5737:function(t,e,n){"use strict";n.r(e);n(11),n(6),n(12),n(13),n(8),n(7);var o=n(30),r=n(3),l=n(2),c=(n(20),n(19),n(4),n(40),n(41),{name:"BannerLoop"}),d=(n(5496),n(0)),m=Object(d.a)(c,(function(){this._self._c;return this._m(0)}),[function(){var t=this,e=t._self._c;return e("div",{staticClass:"banner-loop-box"},[e("div",{staticClass:"center-txt-image"}),t._v(" "),e("div",{staticClass:"star-box"},[e("img",{staticClass:"star-img",attrs:{src:"https://pics.janitorai.com/anouncements/stars.webp",alt:"carousel gif"}}),t._v(" "),e("img",{staticClass:"star-img",attrs:{src:"https://pics.janitorai.com/anouncements/stars.webp",alt:"carousel gif"}})]),t._v(" "),e("div",{staticClass:"corner-top-left"},[e("img",{staticClass:"corner-img",attrs:{src:"https://ella.janitorai.com/events/Corner2.webp",alt:"carousel gif"}})]),t._v(" "),e("div",{staticClass:"corner-top-right"},[e("img",{staticClass:"corner-img",attrs:{src:"https://ella.janitorai.com/events/Corner2.webp",alt:"carousel gif"}})]),t._v(" "),e("div",{staticClass:"corner-bottom-left"},[e("img",{staticClass:"corner-img",attrs:{src:"https://ella.janitorai.com/events/Corner1.webp",alt:"carousel gif"}})]),t._v(" "),e("div",{staticClass:"corner-bottom-right"},[e("img",{staticClass:"corner-img",attrs:{src:"https://ella.janitorai.com/events/Corner1.webp",alt:"carousel gif"}})]),t._v(" "),e("div",{staticClass:"duck-peep-1"}),t._v(" "),e("div",{staticClass:"duck-peep-2"}),t._v(" "),e("div",{staticClass:"duck-peep-3"}),t._v(" "),e("div",{staticClass:"duck-peep-4"}),t._v(" "),e("div",{staticClass:"duck-peep-5"}),t._v(" "),e("div",{staticClass:"duck-peep-6"}),t._v(" "),e("div",{staticClass:"duck-peep-7"}),t._v(" "),e("div",{staticClass:"duck-peep-8"}),t._v(" "),e("div",{staticClass:"duck-peep-9"}),t._v(" "),e("div",{staticClass:"duck-peep-11"}),t._v(" "),e("div",{staticClass:"duck-peep-10"}),t._v(" "),e("div",{staticClass:"duck-peep-12"})])}],!1,null,"eff9edc0",null).exports,v={name:"BannerLoop"},f=(n(5497),Object(d.a)(v,(function(){return(0,this._self._c)("div",{staticClass:"banner-loop-box"})}),[],!1,null,"03e27865",null).exports),h=n(52),_=n(10),y=n(211),C=n(145),w=n(617),x=n(1);function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var $={name:"Card",mixins:[C.a],components:{StarLine:w.a},props:{item:{type:Object,default:function(){}}},data:function(){return{timeAgo:_.T}},methods:D(D({},Object(x.b)("tavern",["showChatDialog"])),{},{formatMsgForStCard:y.b,goCardDetail:function(){var t,path=this.localePath("/tavern/".concat(null===(t=this.item)||void 0===t?void 0:t.id));this.$router.push(path)},goCardChats:function(){var t,e;this.showChatDialog({characterId:null===(t=this.item)||void 0===t?void 0:t.id}),this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-chat-btn-click",entity_type:"sillyTavern"}),this.$xyLogEvent({front_operation:"exposure",entity_name:"sillyTavern-show",entity_type:"sillyTavern",obj_id:null===(e=this.item)||void 0===e?void 0:e.id})},dataInfo:function(t){var e={id:t.id,position:"tavern-home"};return JSON.stringify(e)}})},T=(n(5498),n(5499),Object(d.a)($,(function(){var t,e,n,o,r,l,c,d,m,v,f=this,h=f._self._c;return h("div",{staticClass:"card-box"},[h("div",{staticClass:"border-bg"}),f._v(" "),h("div",{staticClass:"card-box-inner"},[h("div",{staticClass:"nav-box flex_m",attrs:{"data-event":"view-character","data-id":null===(t=f.item)||void 0===t?void 0:t.id},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),f.goCardDetail.apply(null,arguments)}}},[h("div",{staticClass:"title line-one"},[f._v(f._s((null===(e=f.item)||void 0===e?void 0:e.title)||""))])]),f._v(" "),h("div",{staticClass:"role-info flex_m"},[h("a",{staticClass:"head-img",attrs:{href:f.localePath("/tavern/".concat(null===(n=f.item)||void 0===n?void 0:n.id)),"data-event":"view-character","data-id":null===(o=f.item)||void 0===o?void 0:o.id},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),f.goCardDetail.apply(null,arguments)}}},[h("img",{staticClass:"head-img-item",class:{"nsfw-bg":1===(null===(r=f.item)||void 0===r?void 0:r.nsfw)},attrs:{src:null===(l=f.item)||void 0===l||null===(l=l.cover)||void 0===l?void 0:l.url,alt:""}})]),f._v(" "),h("div",{staticClass:"desc-box"},[h("div",{staticClass:"desc",domProps:{innerHTML:f._s(f.formatMsgForStCard((null===(c=f.item)||void 0===c?void 0:c.sub_title)||"",!1,this))}}),f._v(" "),h("StarLine")],1)]),f._v(" "),h("div",{staticClass:"role-action-box flex_m"},[h("div",{staticClass:"left"},[h("div",{staticClass:"item flex_m"},[h("i",{staticClass:"iconfont icon-jilu"}),f._v(" "),h("span",{staticClass:"line-one"},[f._v(f._s(f.timeAgo(null===(d=f.item)||void 0===d?void 0:d.create_at)))])]),f._v(" "),h("div",{staticClass:"item flex_m"},[h("i",{staticClass:"iconfont icon-xiaoxi"}),f._v(" "),h("span",{staticClass:"line-one"},[f._v(f._s(f.$t("ST_Frontpage_msgcount",{num1:(null===(m=f.item)||void 0===m||null===(m=m.stat)||void 0===m?void 0:m.num_of_token)||0}))+" ")])])]),f._v(" "),h("div",{staticClass:"right"},[h("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:f.handleVisibility,expression:"handleVisibility"}],staticClass:"btn",attrs:{"data-event":"next-ai-chat","data-info":f.dataInfo(f.item),"data-id":null===(v=f.item)||void 0===v?void 0:v.id},on:{click:f.goCardChats}},[h("span",{staticClass:"flex_c_m"},[f._v(f._s(f.$t("Continue")))])])])])])])}),[],!1,null,"3e3ce760",null)),O=T.exports,I={name:"MyChats",components:{SwipeableList:h.default,Card:O},props:{list:{type:Array,default:function(){return[]}}},data:function(){return{}}},S=(n(5500),Object(d.a)(I,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"my-chats-box",attrs:{"data-group":"my-chats"}},[e("div",{staticClass:"nav-box flex_m"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("myChatRule")))])]),t._v(" "),e("SwipeableList",t._b({staticClass:"my-chats-list",attrs:{list:t.list,listGap:"16px",top:"0px",listAlignItems:"flex-start"}},"SwipeableList",t.$attrs,!1),t._l(t.list,(function(t){return e("Card",{key:t.id,attrs:{item:t}})})),1)],1)}),[],!1,null,"36b92d93",null)),L=S.exports;installComponents(S,{SwipeableList:n(52).default});n(16),n(21),n(22);var j=n(467),E=(n(24),{name:"Tabs",model:{prop:"activeTab",event:"change"},props:{activeTab:{type:[String,Number],default:""},list:{type:Array,default:function(){return[]}}},data:function(){return{underline:{width:0,left:0}}},watch:{activeTab:{handler:function(){this.$nextTick(this.updateUnderline)}}},mounted:function(){var t=this;this.$nextTick((function(){t.updateUnderline(),window.addEventListener("resize",t.updateUnderline)}))},beforeDestroy:function(){window.removeEventListener("resize",this.updateUnderline)},methods:{setActiveTab:function(t){this.$emit("change",t)},updateUnderline:function(){var t,e=(null===(t=this.$refs)||void 0===t?void 0:t["tabitem-".concat(this.activeTab)])||[],n=Object(o.a)(e,1)[0];if(n){var r=n.offsetLeft,l=n.offsetWidth;this.underline={width:l,left:r}}}},computed:{underlineStyle:function(){return{width:this.underline.width+"px",left:this.underline.left+"px"}}}}),P=(n(5501),Object(d.a)(E,(function(){var t=this,e=t._self._c;return e("div",{ref:"tabs",staticClass:"tabs"},[t._l(t.list,(function(n){var o;return e("div",{key:n.value,ref:"tabitem-".concat(n.value),refInFor:!0,staticClass:"tab",class:{active:t.activeTab===n.value||(null===(o=n.values)||void 0===o?void 0:o.includes(t.activeTab))},attrs:{"data-event":"change-tab","data-id":n.value},on:{click:function(e){return t.setActiveTab(n.value)}}},[n.icon?e("i",{class:["iconfont",n.icon]}):t._e(),t._v(" "),n.emoji?e("span",{staticClass:"emoji"},[t._v(t._s(n.emoji)+"  ")]):t._e(),t._v(" "),e("span",[t._v(t._s(t.$t(n.label)))])])})),t._v(" "),e("div",{staticClass:"underline",style:t.underlineStyle})],2)}),[],!1,null,"2ec9dc68",null).exports),M=n(14),N=(n(31),n(9)),R={name:"TagGroup",model:{prop:"value",event:"change"},props:{tags:{type:Array,required:!0,default:function(){return[]}},value:{type:Array,default:function(){return[]}}},data:function(){return{EMOJI_ENUM_ST:N.f,isExpanded:!1,maxVisibleTags:11}},computed:{visibleTags:function(){return this.isExpanded?this.tags:this.tags.slice(0,this.maxVisibleTags)}},methods:{handleClick:function(t){var e=Object(M.a)(this.value);if(e.includes(t))e=e.filter((function(e){return e!==t}));else{if(e.length>=3)return this.$message.warning(this.$t("ST_Lable_maxtoast"));e.push(t)}this.$emit("change",e)},toggleExpand:function(){this.isExpanded=!this.isExpanded}}},A=(n(5502),Object(d.a)(R,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"base-tag-group"},[t._l(t.visibleTags,(function(n){return e("div",{key:n.value,class:["tag-item",{active:t.value.includes(n.value)}],attrs:{"data-event":"change-tag","data-id":n.value},on:{click:function(e){return t.handleClick(n.value)}}},[e("div",{staticClass:"tag-item-inner"},[n.icon?e("span",{staticClass:"tag-icon",domProps:{innerHTML:t._s(n.icon)}}):t._e(),t._v(" "),t.EMOJI_ENUM_ST(n.value)?e("span",{staticClass:"tag-emoji"},[t._v(t._s(t.EMOJI_ENUM_ST(n.value))+" ")]):t._e(),t._v(" "),e("span",{staticClass:"tag-label"},[t._v(t._s(n.label))])])])})),t._v(" "),e("div",{staticClass:"toggle-button-container"},[t.tags.length>t.maxVisibleTags?e("div",{staticClass:"toggle-button",on:{click:t.toggleExpand}},[t._v("\n      "+t._s(t.isExpanded?t.$t("hideAllTags"):t.$t("showAllTags"))+"\n      ")]):t._e()])],2)}),[],!1,null,"67ef5905",null).exports),F=n(580);function B(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function V(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?B(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var U={name:"ScreenForm",components:{Tabs:P,Tags:A,PreferenceSelect:j.default},data:function(){return{timeList:[{name:"days",id:"day_hot",show:!0},{name:"week",id:"week_hot",show:!0},{name:"months",id:"month_hot",show:!0}],formData:{green:0,order_by:"hot",tag_ids:[]},visibleTabsList:[{label:"ST_Frontpage_ctg1_1",value:1,icon:"icon-bukejian"},{label:"All",value:0,icon:"icon-kejian"}],orderByList:[{label:"Trending",value:"week_hot",values:["day_hot","week_hot","month_hot"],emoji:"🚀"},{label:"Hot",value:"hot",emoji:"🔥"},{label:"New",value:"new",emoji:"🆕"}],tagListAll:[],tagListLimited:[]}},computed:V(V({},Object(x.c)("user",["isLoggedIn"])),{},{getLangCode:function(){var t=this.$i18n.locale;return"zhTW"===t?"zh_tw":"zhCN"===t?"zh_cn":t||"en"},tagList:function(){var t=this;return this[1===this.formData.green?"tagListLimited":"tagListAll"].map((function(e){return{label:e[t.getLangCode],value:e.id}}))}}),mounted:function(){this.getTagList()},methods:{handleNotification:function(){this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-guide-btn",entity_type:"sillyTavern-home-page"}),this.$router.push(this.localePath("/tavernInstruction"))},getTagList:function(){var t=this,e={show_areas:["tavern-pro-limited","tavern-pro-all"],lang:this.$i18n.locale||"en"};Object(F.a)(e).then((function(e){t.tagListAll=e.data["tavern-pro-all"],t.tagListLimited=e.data["tavern-pro-limited"]}))},handleAddBtn:function(){this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-add-btn",entity_type:"sillyTavern-home-page"}),this.isLoggedIn?this.$router.push(this.localePath("/tavern/create/chat")):this.$EventBus.$emit("openLoginDialog")},changeForm:function(t,e){"green"===e&&(this.formData.tag_ids=[]);var n=Object.assign({},this.formData);this.$emit("change",n)}}},H=(n(5503),Object(d.a)(U,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"screen-form-box"},[e("div",{staticClass:"explore-nav"},[e("h1",[t._v(t._s(t.$t("square")))])]),t._v(" "),e("div",{staticClass:"tabs-box"},[e("Tabs",{attrs:{list:t.visibleTabsList},on:{change:function(e){return t.changeForm(e,"green")}},model:{value:t.formData.green,callback:function(e){t.$set(t.formData,"green",e)},expression:"formData.green"}}),t._v(" "),e("div",{staticClass:"add-btn flex_c_m",on:{click:t.handleAddBtn}},[e("span",{staticClass:"add-text"},[t._v(t._s(t.$t("ST_Frontpage_create")))]),t._v(" "),e("el-tooltip",{attrs:{content:t.$t("Guides"),placement:"right"}},[e("i",{staticClass:"iconfont icon-notification",on:{click:function(e){return e.stopPropagation(),t.handleNotification.apply(null,arguments)}}})])],1)],1),t._v(" "),e("div",{staticClass:"tabs-box"},[e("Tabs",{attrs:{list:t.orderByList},on:{change:function(e){return t.changeForm(e,"order_by")}},model:{value:t.formData.order_by,callback:function(e){t.$set(t.formData,"order_by",e)},expression:"formData.order_by"}})],1),t._v(" "),t.formData.order_by.includes("_hot")?e("div",{staticClass:"tabs-box"},[e("PreferenceSelect",{staticClass:"item",attrs:{list:t.timeList},on:{onChange:function(e){return t.changeForm(e,"order_by")}},model:{value:t.formData.order_by,callback:function(e){t.$set(t.formData,"order_by",e)},expression:"formData.order_by"}})],1):t._e(),t._v(" "),e("Tags",{attrs:{tags:t.tagList},on:{change:function(e){return t.changeForm(e,"tag_ids")}},model:{value:t.formData.tag_ids,callback:function(e){t.$set(t.formData,"tag_ids",e)},expression:"formData.tag_ids"}})],1)}),[],!1,null,"50373731",null)),z=H.exports,W=n(64),G=n(38);function K(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?K(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var X={green:0,order_by:"hot",tag_ids:[]},J={name:"Home",components:{BannerLoop:m,BannerLoopImg:f,MyChats:L,ScreenForm:z,HyWaterfallFlowList:W.default},data:function(){return{waterfallListData:[],myChatsListData:[],hsaLoading:!1,queryParam:{offset:"",page:2,page_size:35},hasMore:!0,screenFormData:Y({},X)}},activated:function(){var t=this;this.$nextTick((function(){t.$EventBus.$emit("$_closeLeftMenu")}))},mounted:function(){var t=this;this.$nextTick((function(){t.$EventBus.$emit("$_closeLeftMenu"),t.$xyLogEvent({front_operation:"exposure",entity_name:"sillyTavern-home-page",entity_type:"home-page"})}))},methods:{initList:function(){var t=this;this.hasMore=!0,this.queryParam.offset="",this.queryParam.page=1,this.getList({afterCall:function(){t.waterfallListData=[]}})},getList:function(){var t=this,e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).afterCall;if(!this.hsaLoading&&this.hasMore){this.hsaLoading=!0;var param=Y(Y({},this.queryParam),this.screenFormData);Object(F.b)(param).then((function(n){var o,r,l;e&&e(),t.hasMore=(null===(o=n.data)||void 0===o?void 0:o.has_more)||!1;var c=(null===(r=n.data)||void 0===r?void 0:r.items)||[];t.waterfallListData=t.waterfallListData.concat(c),t.queryParam.offset=(null===(l=n.data)||void 0===l?void 0:l.offset)||"",t.queryParam.page++,t.hsaLoading=!1})).catch((function(){t.hsaLoading=!1}))}},changeForm:function(t){this.screenFormData=t,this.initList()}},asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,l,c,d,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.store,n=t.$axios,t.app,t.params,t.error,t.req,t.redirect,e.prev=1,e.next=4,Promise.all([n.$post("/api/v1/square/v3/tavern-pro/list",Y(Y({page:1,page_size:35},X),{},{ss:G.f})),n.$post("/api/v1/square/v3/tavern-pro/history",{page:1,page_size:20,ss:G.f})]);case 4:return r=e.sent,l=Object(o.a)(r,2),c=l[0].data,d=void 0===c?{}:c,m=l[1].data,v=void 0===m?{}:m,e.abrupt("return",{waterfallListData:(null==d?void 0:d.items)||[],myChatsListData:(null==v?void 0:v.items)||[]});case 13:e.prev=13,e.t0=e.catch(1),console.log("首页配置 -> asyncData错误啦：",e.t0),e.t0({statusCode:404,message:e.t0});case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))()}},Q=J,Z=(n(5504),Object(d.a)(Q,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"tavern-chats-home-box"},[t.myChatsListData.length?[e("MyChats",{attrs:{list:t.myChatsListData}})]:t._e(),t._v(" "),e("ScreenForm",{staticClass:"screen-form",on:{change:t.changeForm}}),t._v(" "),e("div",{ref:"wraper1"},[e("HyWaterfallFlowList",{attrs:{list:t.waterfallListData,container:"wraper1",isRole:!0},on:{load:t.getList}})],1),t._v(" "),t.hsaLoading?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.hsaLoading,expression:"hsaLoading"}],staticClass:"loadBox"}):t._e(),t._v(" "),e("el-backtop",{attrs:{bottom:30,right:30}},[e("i",{staticClass:"el-icon-top"})])],2)}),[],!1,null,"75a7a29d",null));e.default=Z.exports},5740:function(t,e,n){"use strict";n.r(e);n(16),n(18),n(21),n(11),n(6),n(12),n(13),n(8),n(4),n(7);var o=n(3),r=n(2),l=(n(20),n(28),n(44),n(1)),c=(n(525),n(90),n(30)),d=(n(19),n(32),n(22),n(24),n(40),n(41),n(125)),m=n.n(d),v=n(25),f=n(174),h=(n(73),n(14)),_=(n(69),n(49),n(113),n(26),n(141),n(142),n(109),n(51)),y=n(61),C={props:{url:{type:String,default:""},prompt:{type:String,default:""},width:{type:Number,default:159},height:{type:Number,default:159}},data:function(){return{src:"",imgW:0,imgH:0,isVideo:!1}},watch:{url:{handler:function(t){t&&this.loadImg()}}},created:function(){this.loadImg()},methods:{imgDelete:function(){this.$emit("imgDelete")},checkIsVideo:function(t){return[".mp4",".webm",".ogg",".mov",".avi",".flv",".wmv",".m4v"].some((function(e){return t.toLowerCase().endsWith(e)}))},onVideoLoad:function(){this.$refs.videoElement&&(this.imgW=this.$refs.videoElement.videoWidth||this.width,this.imgH=this.$refs.videoElement.videoHeight||this.height,this.$emit("imgLoad",{width:this.imgW,height:this.imgH}))},loadImg:function(){var t=this;if(this.isVideo=this.checkIsVideo(this.url),this.isVideo)this.src=this.url,this.imgW=this.width,this.imgH=this.height;else{var img=new Image;img.src=this.url,img.onload=function(){img.width&&(t.imgW=img.width),img.height&&(t.imgH=img.height),t.src=t.url,t.$emit("imgLoad",{width:t.imgW,height:t.imgH})},img.onerror=function(){t.$emit("imgLoad",{width:t.width,height:t.height})}}}}},w=(n(4900),n(4901),n(0)),x=Object(w.a)(C,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.src,expression:"!src"}],staticClass:"imgItem",style:{width:t.width+"px",height:t.height+"px"},on:{click:function(e){return t.$emit("click")}}},[t.imgW&&t.imgH?e("div",{staticClass:"imgSize"},[t._v(t._s("".concat(t.imgW,"*").concat(t.imgH)))]):t._e(),t._v(" "),t.src&&!t.isVideo?e("img",{attrs:{src:t.src,alt:""}}):t._e(),t._v(" "),t.src&&t.isVideo?e("video",{ref:"videoElement",attrs:{src:t.src},on:{loadedmetadata:t.onVideoLoad,error:t.onVideoLoad}}):t._e(),t._v(" "),t.src&&t.isVideo?e("div",{staticClass:"videoBox"},[e("i",{staticClass:"iconfont icon-zanting1"})]):t._e(),t._v(" "),t.prompt?e("el-popover",{attrs:{placement:"top-start",trigger:"hover","popper-class":"popoverPrompt","visible-arrow":!1}},[e("div",{staticClass:"promptTxt"},[t._v(t._s(t.prompt))]),t._v(" "),e("div",{staticClass:"prompt",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"iconfont icon-Union"})])]):t._e(),t._v(" "),e("div",{staticClass:"deleteBox"},[e("i",{staticClass:"iconfont icon-shanchu1",on:{click:t.imgDelete}})])],1)}),[],!1,null,"2581f748",null).exports,k=n(29),D=n(831),$=n(83),T=n(181);function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var S={props:{value:{type:Array,default:function(){return[]}},trigger:{type:String,default:""},DSType:{type:Number,default:0},type:{type:String,default:"default"},defConfig:{type:Object,default:function(){return[]}},leftHeight:{type:Number,default:null}},computed:I(I({},Object(l.c)("user",["isLoggedIn"])),{},{featureButtonText:function(){return 1===this.DSType?this.isImgsComplete?this.$t("trainModelbnt2"):this.$t("trainModelbnt1"):this.isImgsComplete?this.$t("newTrainIntr10"):this.$t("newTrainIntr9")},imgs:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},isImgsComplete:function(){for(var t=0,i=0;i<this.imgs.length;i++){var e,n;((null===(e=this.imgs[i])||void 0===e?void 0:e.tags.length)>1||null!==(n=this.imgs[i])&&void 0!==n&&n.raw_url)&&t++}return t==this.imgs.length&&0!=this.imgs.length},isFeatureBoxVisible:function(){return 2!=this.uploadType&&1==this.uploadType&&!this.isUploading},imgBoxMaxHeightValue:function(){if(!this.leftHeight)return"541px";var t=this.isFeatureBoxVisible?90:0;return this.leftHeight-235-t+"px"}}),components:{imgItem:x,imgDet:D.a,HyUploadMoald:$.default},watch:{type:{handler:function(t){this.setConfig()}},imgs:{handler:function(t){var e=this;0!==t.length?this.$nextTick((function(){e.checkAllImagesLoaded()})):this.$emit("allImagesLoaded")},immediate:!0}},data:function(){return{isUploading:!1,setTagLoading:!1,inTimes:null,unmatchedImages:[],maxImgNum:200,loadingProgress:0,uploadType:-1,handleImgFormData:{cutting_plan:2,marking_plan:3,process_height:512,process_width:512,deepbooru_threshold:.3,image_url:[]},cropSizeIndex:"512*512",videoMarkingPlan:8,cropType:[{value:1,label:this.$t("newTrainIntr14")},{value:2,label:this.$t("newTrainIntr15")},{value:3,label:this.$t("newTrainIntr16")}],cropSize:[{value:"512*512",label:"512*512"},{value:"512*768",label:"512*768"},{value:"768*512",label:"768*512"},{value:"1024*1024",label:"1024*1024"}],videoLabeling:[{value:8,label:"cogvlm2  video"},{value:3,label:this.$t("newTrainIntr17")},{value:4,label:this.$t("newTrainIntr18")}],labeling:[{value:1,label:"BLIP"},{value:2,label:"Deepbooru"},{value:3,label:this.$t("newTrainIntr17")},{value:4,label:this.$t("newTrainIntr18")},{value:5,label:"wd 1.4 tagger"},{value:6,label:"joy2"},{value:7,label:"Llava"},{value:10,label:"wd-swinv2-tagger-v3"},{value:11,label:"wd-v1-4-convnext-tagger-v2"},{value:12,label:"wd-v1-4-vit-tagger-v2"},{value:13,label:"januspro"},{value:14,label:"florence2"}]}},created:function(){this.setConfig()},beforeDestroy:function(){clearTimeout(this.inTimes)},methods:{checkAllImagesLoaded:function(){this.imgs.every((function(img){return img.width&&img.height}))&&this.$emit("allImagesLoaded")},onImgLoad:function(t,e){var n=e.width,o=e.height;this.imgs[t].width=n,this.imgs[t].height=o,this.checkAllImagesLoaded()},setConfig:function(){["sdxl_default","flux_default","sd35_default","pony_default","illustrious_default","portrait_default","anime_default","style_default","sd35L_default","sd35M_default"].includes(this.type)?this.cropSize=[{value:"512*512",label:"512*512"},{value:"512*768",label:"512*768"},{value:"768*512",label:"768*512"},{value:"768*768",label:"768*768"},{value:"1024*1024",label:"1024*1024"}]:this.cropSize=[{value:"512*512",label:"512*512"},{value:"512*768",label:"512*768"},{value:"768*512",label:"768*512"}];var t=["sd35L_default","sd35M_default","flux_default"].includes(this.type);this.handleImgFormData.cutting_plan=this.defConfig.crop_method,this.handleImgFormData.marking_plan=this.defConfig.crop_algorithm,this.handleImgFormData.process_height=this.defConfig.crop_height,this.handleImgFormData.process_width=this.defConfig.crop_width,this.handleImgFormData.deepbooru_threshold=this.defConfig.deepbooru_threshold;var e="".concat(this.defConfig.crop_width,"*").concat(this.defConfig.crop_height);this.cropSizeIndex=this.cropSize.some((function(t){return t.value==e}))?e:this.cropSize[0].value,t&&(this.handleImgFormData.marking_plan=6)},openDel:function(t){this.$refs.imgDet.show(t)},markChange:function(){4==this.handleImgFormData.marking_plan&&3==this.handleImgFormData.cutting_plan&&(this.handleImgFormData.cutting_plan=this.defConfig.crop_method)},cuttingChange:function(){3==this.handleImgFormData.cutting_plan&&4==this.handleImgFormData.marking_plan&&(this.handleImgFormData.marking_plan=this.defConfig.crop_algorithm)},resFeature:function(){var t=this;this.$confirm(this.$t("reAddTagTip"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){1==t.DSType?t.onVideoFeature():t.onFeature()})).catch((function(){}))},onFeature:function(){var t,e=this;if(!this.setTagLoading)if(this.imgs.length>this.maxImgNum)this.$message.error(this.$t("newTrainIntrTip3"));else{if(3==this.handleImgFormData.marking_plan){if(!this.trigger)return this.$message.error(this.$t("newTrainIntrTip1")),void(this.setTagLoading=!1);if(this.imgs.forEach((function(t,i){e.trigger&&(e.imgs[i].tags=[],e.imgs[i].tags.unshift(e.trigger))})),3==this.handleImgFormData.cutting_plan)return void(this.setTagLoading=!1)}if(this.handleImgFormData.image_url=[],this.imgs.forEach((function(t){var n;e.isImgsComplete?e.handleImgFormData.image_url.push(t.raw_url||t.url):t.tags&&0!=(null===(n=t.tags)||void 0===n?void 0:n.length)&&t.raw_url||(e.handleImgFormData.image_url.push(t.url),t.width=void 0,t.height=void 0)})),this.loadingProgress=0,(null===(t=this.handleImgFormData)||void 0===t||null===(t=t.image_url)||void 0===t?void 0:t.length)>0){this.setTagLoading=!0;var n=I({},this.handleImgFormData);2!=n.marking_plan&&5!==n.marking_plan&&delete n.deepbooru_threshold,3==n.marking_plan&&(n.marking_plan=4),Object(f.b)(n).then((function(t){1e4==t.status.code&&e.onBatchFetchTaskProcess([t.data.task_id])})).catch((function(t){e.setTagLoading=!1}))}}},onVideoFeature:function(){var t=this;if(!this.setTagLoading)if(this.imgs.length>this.maxImgNum)this.$message.error(this.$t("newTrainIntrTip3"));else{this.setTagLoading=!0;var e=[],n=[];if(this.imgs.forEach((function(o){var r;t.isImgsComplete?0===o.material_type?e.push(o.raw_url||o.url):1===o.material_type&&n.push(o.raw_url||o.url):o.tags&&0!==(null===(r=o.tags)||void 0===r?void 0:r.length)&&o.raw_url||(0===o.material_type?e.push(o.url):1===o.material_type&&n.push(o.url))})),this.loadingProgress=0,e.length>0||n.length>0){var o=[];if(e.length>0)if(3==this.handleImgFormData.marking_plan)this.trigger?this.imgs.forEach((function(e,i){0==e.material_type&&(t.imgs[i].tags=[],t.imgs[i].tags.unshift(t.trigger))})):this.$message.error(this.$t("newTrainIntrTip1"));else if(4!=this.handleImgFormData.marking_plan){var r;1==this.DSType?(r={image_url:e,marking_plan:this.handleImgFormData.marking_plan,cutting_plan:3},[2,5,6].includes(this.handleImgFormData.marking_plan)&&(r.deepbooru_threshold=this.handleImgFormData.deepbooru_threshold)):((r=I({},this.handleImgFormData)).image_url=e,2!=r.marking_plan&&5!==r.marking_plan&&6!==r.marking_plan&&delete r.deepbooru_threshold);var l=Object(f.b)(r);o.push(l)}if(n.length>0)if(3==this.videoMarkingPlan)this.trigger?this.imgs.forEach((function(e,i){1==e.material_type&&(t.imgs[i].tags=[],t.imgs[i].tags.unshift(t.trigger))})):this.$message.error(this.$t("newTrainIntrTip1"));else if(4!=this.videoMarkingPlan){var c={marking_plan:this.videoMarkingPlan,video_url:n};[2,5,6].includes(this.videoMarkingPlan)&&(c.deepbooru_threshold=this.handleImgFormData.deepbooru_threshold);var d=Object(f.b)(c);o.push(d)}Promise.all(o).then((function(e){var n=e.filter((function(t){return 1e4===t.status.code})).map((function(t){return t.data.task_id}));n.length>0?t.onBatchFetchTaskProcess(n):t.setTagLoading=!1})).catch((function(){t.setTagLoading=!1}))}}},isSameResource:function(t,e){return!t||!e||new URL(t).pathname===new URL(e).pathname},onBatchFetchTaskProcess:function(t){var e=this;Object(k.batchFetchTaskProcess)({task_ids:t}).then((function(n){var o=!1,r=0,l=0,c=100;if(1e4==n.status.code)return n.data.items.forEach((function(t){t&&"number"==typeof t.process&&t.process<c&&(c=t.process)})),e.loadingProgress=c,n.data.items.forEach((function(t){1!=t.status&&2!=t.status||(o=!0),t&&3==t.status?(l++,null==t||t.image_tags.forEach((function(t){e.imgs.forEach((function(n,i){e.isSameResource(n.raw_url||n.url,t.url)&&(e.imgs[i].raw_url||(e.imgs[i].raw_url=e.imgs[i].url),e.imgs[i].url=t.crop_url||t.url,e.imgs[i].tags=t.tags,e.trigger&&-1==e.imgs[i].tags.indexOf(e.trigger)&&(3===e.handleImgFormData.marking_plan&&0==e.DSType?e.imgs[i].tags=[e.trigger]:e.imgs[i].tags.unshift(e.trigger)))}))}))):t&&4==t.status&&r++})),r>0&&r===n.data.items.length?(clearTimeout(e.inTimes),e.$message.warning(e.$t("newTrainIntrTip4")),void(e.setTagLoading=!1)):l>0&&l===n.data.items.length?(clearTimeout(e.inTimes),void e.onSave()):void((o||l+r<n.data.items.length)&&(e.inTimes=setTimeout((function(){e.onBatchFetchTaskProcess(t)}),3e3)))})).catch((function(t){e.setTagLoading=!1}))},imgDelete:function(t){this.imgs.splice(t,1),0==this.imgs.length&&(this.unmatchedImages=[],this.uploadType=-1)},onDeleteAll:function(){this.imgs=[],this.unmatchedImages=[],this.uploadType=-1},sizeChange:function(){this.handleImgFormData.process_width=parseInt(this.cropSizeIndex.split("*")[0]),this.handleImgFormData.process_height=parseInt(this.cropSizeIndex.split("*")[1])},uploadFolder:function(){var t;this.isLoggedIn?this.isUploading||null!==(t=this.$refs)&&void 0!==t&&t.foldeInput&&(this.$refs.foldeInput.value=null,this.$refs.foldeInput.click(),this.$logEvent("log_actions",{operation:"click_upload_dataset",behavior_info:"on_training_detail_page"})):this.$EventBus.$emit("openLoginDialog")},openImgModal:function(){this.isLoggedIn?(this.$logEvent("log_actions",{operation:"click_upload",behavior_info:"on_model_train_detail_page",behavior_info_sub:"personal_center"}),this.$refs.HyUploadMoaldRef.openModal()):this.$EventBus.$emit("openLoginDialog")},handleSelectImg:function(data){var t=this,e=data.map((function(e){var n=t.isVideoFile(e.url);return{url:e.url,tags:[],material_type:n?1:0}})),n=this.imgs,o=e.filter((function(t){return!n.some((function(e){return e.url===t.url}))})),r=[].concat(Object(h.a)(n),Object(h.a)(o));this.imgs=r,this.uploadType=1,this.$emit("changeUploadType",1),this.$emit("changeUploadTypeSource",1),this.$xyLogEvent({event_name:"log_model",update_status:1,update_type:1,upload_nums:this.imgs.length,front_operation:"click",entity_type:"model_train"})},uploadImg:function(){var t;this.isLoggedIn?this.isUploading||null!==(t=this.$refs)&&void 0!==t&&t.imgInput&&(this.$refs.imgInput.value=null,this.$refs.imgInput.click(),this.$logEvent("log_actions",{operation:"click_upload_image",behavior_info:"on_training_detail_page"})):this.$EventBus.$emit("openLoginDialog")},handleImgUpload:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,i,c,d,m,v,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.isUploading){n.next=2;break}return n.abrupt("return");case 2:if(!((o=t.target.files||[]).length>50)){n.next=6;break}return e.$message(e.$t("newTrainIntrTip3")),n.abrupt("return");case 6:if(!(e.maxImgNum-e.imgs.length<o.length)){n.next=9;break}return e.$message(e.$t("newTrainIntrTip3")),n.abrupt("return");case 9:if(e.isUploading=!0,e.loadingProgress=0,e.uploadType=1,e.$emit("changeUploadType",1),e.$emit("changeUploadTypeSource",2),r=0,l=o.length,!o||!o.length){n.next=66;break}i=0;case 18:if(!(i<o.length)){n.next=64;break}if(c=o[i],n.prev=20,(d=c.type.includes("video"))||!(c.size/1024/1024>2)){n.next=37;break}return n.prev=23,n.next=26,Object(y.a)(c,2097152);case 26:c=n.sent,n.next=37;break;case 29:return n.prev=29,n.t0=n.catch(23),console.error("Compression failed:",n.t0),r++,e.loadingProgress=parseInt(r/l*100),e.unmatchedImages.push({name:c.name,tip:e.$t(n.t0.message)}),r===l&&(e.isUploading=!1,e.imgs.length>0&&e.$xyLogEvent({event_name:"log_model",update_status:1,update_type:2,upload_nums:e.imgs.length,front_operation:"click",entity_type:"model_train"}),e.unmatchedImages.length&&e.$xyLogEvent({event_name:"log_model",update_status:0,update_type:2,upload_nums:e.unmatchedImages.length,front_operation:"click",entity_type:"model_train"})),n.abrupt("continue",61);case 37:if(m=void 0,!d){n.next=45;break}return v=new T.a({file:c,category:65,maxSize:104857600}),n.next=42,v.beforeUpload();case 42:m=n.sent,n.next=49;break;case 45:return f=new _.a({type:2}),n.next=48,f.startUpload(c,{name:"train_img".concat(Date.now(),"_").concat(i,".png"),type:"png",category:31,size:c.size});case 48:m=n.sent;case 49:e.imgs.push({url:d?m.url:m,tags:[],material_type:d?1:0}),e.$nextTick((function(){e.$refs.imgBox.scrollTo(0,e.$refs.imgBox.scrollHeight)})),n.next=56;break;case 53:n.prev=53,n.t1=n.catch(20),30005==n.t1.code?e.unmatchedImages.push({name:c.name,tip:e.$t("uploadImageViolatesRules")}):e.unmatchedImages.push({name:c.name,tip:e.$t("uploadError")});case 56:return n.prev=56,r++,e.loadingProgress=parseInt(r/l*100),r===l&&(e.isUploading=!1,e.imgs.length>0&&e.$xyLogEvent({event_name:"log_model",update_status:1,update_type:2,upload_nums:e.imgs.length,front_operation:"click",entity_type:"model_train"}),e.unmatchedImages.length&&e.$xyLogEvent({event_name:"log_model",update_status:0,update_type:2,upload_nums:e.unmatchedImages.length,front_operation:"click",entity_type:"model_train"})),n.finish(56);case 61:i++,n.next=18;break;case 64:n.next=67;break;case 66:e.isUploading=!1;case 67:case"end":return n.stop()}}),n,null,[[20,53,56,61],[23,29]])})))()},handleFolderUpload:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,i,c,d,m,v,f,h,C,w,x;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.isUploading){n.next=2;break}return n.abrupt("return");case 2:o=t.target.files,e.isUploading=!0,e.loadingProgress=0,e.uploadType=2,e.$emit("changeUploadType",2),e.$emit("changeUploadTypeSource",3),r=[],l=regeneratorRuntime.mark((function t(){var n,l,c,d,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=o[i],l=1==e.DSType?["image/png","image/jpeg","image/jpg","image/webp","video/mp4"]:["image/png","image/jpeg","image/jpg","image/webp"],!(n.type.startsWith("image/")&&l.includes(n.type)||1==e.DSType&&"video/mp4"===n.type)){t.next=13;break}if(c=n.name.split(".")[0],!(d=Array.from(o).find((function(t){return t.name===c+".txt"})))){t.next=12;break}return t.next=8,e.readTextFile(d);case 8:m=t.sent,r.push({file:n,tags:m.split(",")}),t.next=13;break;case 12:e.unmatchedImages.push({name:n.name,tip:e.$t("newTrainIntr19")});case 13:case"end":return t.stop()}}),t)})),i=0;case 11:if(!(i<o.length)){n.next=16;break}return n.delegateYield(l(),"t0",13);case 13:i++,n.next=11;break;case 16:if(!(e.maxImgNum-e.imgs.length<r.length)){n.next=21;break}return e.isUploading=!1,0==e.imgs.length&&(e.uploadType=-1),e.$message(e.$t("newTrainIntrTip3")),n.abrupt("return");case 21:if(0!=r.length){n.next=24;break}return e.isUploading=!1,n.abrupt("return");case 24:c=0,d=r.length,m=0;case 27:if(!(m<r.length)){n.next=74;break}if(v=r[m],f=v.file,n.prev=30,(h=f.type.includes("video"))||!(f.size/1024/1024>2)){n.next=47;break}return n.prev=33,n.next=36,Object(y.a)(f,2097152);case 36:f=n.sent,n.next=47;break;case 39:return n.prev=39,n.t1=n.catch(33),c++,e.loadingProgress=parseInt(c/d*100),e.unmatchedImages.push({name:f.name,tip:e.$t(n.t1.message)}),c===d&&(e.isUploading=!1,e.imgs.length>0&&e.$xyLogEvent({event_name:"log_model",update_status:1,update_type:3,upload_nums:e.imgs.length,front_operation:"click",entity_type:"model_train"}),e.unmatchedImages.length&&e.$xyLogEvent({event_name:"log_model",update_status:0,update_type:3,upload_nums:e.unmatchedImages.length,front_operation:"click",entity_type:"model_train"})),console.error("Compression failed:",n.t1,n.t1.message),n.abrupt("continue",71);case 47:if(C=void 0,!h){n.next=55;break}return w=new T.a({file:f,category:65,maxSize:104857600}),n.next=52,w.beforeUpload();case 52:C=n.sent,n.next=59;break;case 55:return x=new _.a({type:2}),n.next=58,x.startUpload(f,{name:"train_img".concat(Date.now(),"_").concat(m,".png"),type:"png",category:31,size:f.size});case 58:C=n.sent;case 59:e.imgs.push({url:h?C.url:C,tags:v.tags,material_type:h?1:0}),e.$nextTick((function(){e.$refs.imgBox.scrollTo(0,e.$refs.imgBox.scrollHeight)})),n.next=66;break;case 63:n.prev=63,n.t2=n.catch(30),30005==n.t2.code?e.unmatchedImages.push({name:f.name,tip:e.$t("uploadImageViolatesRules")}):e.unmatchedImages.push({name:f.name,tip:e.$t("uploadError")});case 66:return n.prev=66,c++,e.loadingProgress=parseInt(c/d*100),c===d&&(e.isUploading=!1,e.imgs.length>0&&e.$xyLogEvent({event_name:"log_model",update_status:1,update_type:3,upload_nums:e.imgs.length,front_operation:"click",entity_type:"model_train"}),e.unmatchedImages.length&&e.$xyLogEvent({event_name:"log_model",update_status:0,update_type:3,upload_nums:e.unmatchedImages.length,front_operation:"click",entity_type:"model_train"})),n.finish(66);case 71:m++,n.next=27;break;case 74:case"end":return n.stop()}}),n,null,[[30,63,66,71],[33,39]])})))()},readTextFile:function(t){return new Promise((function(e,n){var o=new FileReader;o.onload=function(t){e(t.target.result)},o.onerror=n,o.readAsText(t)}))},isVideoFile:function(t){if(!t)return!1;var e=t.toLowerCase();return[".mp4",".webm",".mov",".avi",".flv",".wmv"].some((function(t){return e.endsWith(t)}))},viewHelpManual:function(){this.$emit("viewHelpManual")}}},L=(n(4905),n(4906),Object(w.a)(S,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"TrainUploadImgBox"},[e("div",{staticClass:"imgBoxTit"},[e("div",{staticClass:"imgBoxTitLeft"},[e("div",{staticClass:"imgNumBox"},[e("span",[t._v(t._s("".concat(t.imgs.length,"/").concat(t.maxImgNum)))])]),t._v(" "),t.unmatchedImages.length>0?e("el-popover",{attrs:{placement:"bottom-start",trigger:"hover","popper-class":"popoverUnmatched","visible-arrow":!1}},[e("div",{staticClass:"unmatchedCnt"},t._l(t.unmatchedImages,(function(n,o){return e("div",{key:o,staticClass:"unmatchedItem"},[e("div",{staticClass:"unmatchedItemName"},[t._v(t._s(n.name))]),t._v(" "),e("div",{staticClass:"unmatchedItemTip"},[t._v(t._s(n.tip))])])})),0),t._v(" "),e("div",{staticClass:"imgErrBox",attrs:{slot:"reference"},slot:"reference"},[e("i",{staticClass:"el-icon-warning"}),t._v(" "),e("span",[t._v(t._s(t.$t("newTrainIntr11",{number:t.unmatchedImages.length})))])])]):t._e()],1),t._v(" "),e("div",{staticClass:"otherUploadBtn"},[t.imgs.length>0?[2==t.uploadType?e("div",{on:{click:function(e){!t.isUploading&&t.uploadFolder()}}},[t._v("\n          "+t._s(t.$t("newTrainIntr2"))+"\n          "),e("input",{ref:"foldeInput",staticStyle:{display:"none"},attrs:{type:"file",webkitdirectory:""},on:{change:t.handleFolderUpload}})]):t._e(),t._v(" "),1==t.uploadType?e("div",{on:{click:function(e){!t.isUploading&&t.uploadImg()}}},[t._v("\n          "+t._s(0==t.DSType?t.$t("UploadImg"):t.$t("trainUploadImg_uploadImgVideo"))+"\n          "),e("input",{ref:"imgInput",staticStyle:{display:"none"},attrs:{type:"file",accept:1==t.DSType?"image/png, image/jpeg, image/jpg, image/webp, video/mp4":"image/png, image/jpeg, image/jpg, image/webp",multiple:""},on:{change:t.handleImgUpload}})]):t._e(),t._v(" "),1==t.uploadType?e("div",{on:{click:function(e){!t.isUploading&&t.openImgModal()}}},[t._v("\n          "+t._s(t.$t("CreativeCenterPopup21"))+"\n        ")]):t._e()]:t._e(),t._v(" "),e("div",{on:{click:t.viewHelpManual}},[t._v(t._s(t.$t("trainingHelpManual")))])],2)]),t._v(" "),e("div",{staticClass:"main"},[t.isFeatureBoxVisible?e("div",{staticClass:"featureBox"},[1!=this.uploadType||t.isUploading?e("div",{staticClass:"featureBoxZg"}):t._e(),t._v(" "),e("div",{staticClass:"featureForm"},[0==t.DSType?e("div",{staticClass:"formItem"},[e("div",{staticClass:"formLabel"},[t._v(t._s(t.$t("newTrainIntr6")))]),t._v(" "),e("el-select",{attrs:{"popper-class":"custom-select"},on:{change:t.cuttingChange},model:{value:t.handleImgFormData.cutting_plan,callback:function(e){t.$set(t.handleImgFormData,"cutting_plan",e)},expression:"handleImgFormData.cutting_plan"}},t._l(t.cropType,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e(),t._v(" "),0==t.DSType&&3!==t.handleImgFormData.cutting_plan?e("div",{staticClass:"formItem"},[e("div",{staticClass:"formLabel"},[t._v(t._s(t.$t("newTrainIntr7")))]),t._v(" "),e("el-select",{attrs:{"popper-class":"custom-select"},on:{change:t.sizeChange},model:{value:t.cropSizeIndex,callback:function(e){t.cropSizeIndex=e},expression:"cropSizeIndex"}},t._l(t.cropSize,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e(),t._v(" "),1==t.DSType?e("div",{staticClass:"formItem videoFormItem"},[e("div",{staticClass:"formLabel"},[t._v(t._s(t.$t("trainUploadImg_videoCaptionAlgorithm")))]),t._v(" "),e("el-select",{attrs:{"popper-class":"custom-select"},on:{change:t.markChange},model:{value:t.videoMarkingPlan,callback:function(e){t.videoMarkingPlan=e},expression:"videoMarkingPlan"}},t._l(t.videoLabeling,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e(),t._v(" "),e("div",{staticClass:"formItem videoFormItem"},[e("div",{staticClass:"formLabel"},[t._v("\n            "+t._s(0==t.DSType?t.$t("newTrainIntr8"):t.$t("trainUploadImg_imageCaptionAlgorithm"))+"\n          ")]),t._v(" "),e("el-select",{attrs:{"popper-class":"custom-select"},on:{change:t.markChange},model:{value:t.handleImgFormData.marking_plan,callback:function(e){t.$set(t.handleImgFormData,"marking_plan",e)},expression:"handleImgFormData.marking_plan"}},t._l(t.labeling,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),[2,5,6].includes(t.handleImgFormData.marking_plan)?e("div",{staticClass:"formItem videoFormItem"},[e("div",{staticClass:"formLabel"},[t._v(t._s(t.$t("newTrainIntr20")))]),t._v(" "),e("el-input-number",{attrs:{"controls-position":"right",min:0,max:1,step:.05},model:{value:t.handleImgFormData.deepbooru_threshold,callback:function(e){t.$set(t.handleImgFormData,"deepbooru_threshold",e)},expression:"handleImgFormData.deepbooru_threshold"}})],1):t._e()]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.setTagLoading,expression:"setTagLoading"}],staticClass:"featureBtn",attrs:{"data-group":"Training_UploadImgBox_FeatureBtn","data-desc":"模型训练打标裁剪"},on:{click:function(e){t.isImgsComplete?t.resFeature():1==t.DSType?t.onVideoFeature():t.onFeature()}}},[t._v("\n        "+t._s(t.featureButtonText)+"\n      ")])]):t._e(),t._v(" "),t.isUploading||t.setTagLoading?e("div",{staticClass:"loadingBox"},[e("div",{staticClass:"progressBox"},[e("el-progress",{attrs:{type:"circle",percentage:t.loadingProgress,width:104,"stroke-width":10,color:"#22D19D","text-color":"#ffffff"}}),t._v(" "),e("div",{staticClass:"progressTip"},[t._v(t._s(t.isUploading?t.$t("newTrainIntr12"):t.$t("newTrainIntr13")))])],1)]):t._e(),t._v(" "),0==t.imgs.length?e("div",{staticClass:"uplaodBox"},[1==t.DSType?e("div",{staticClass:"mainTip"},[t._v(t._s(t.$t("trainUploadImg_maxMaterials")))]):t._e(),t._v(" "),e("div",{staticClass:"btnItem"},[e("div",{attrs:{"data-group":"Training_UploadImgBox_UploadImgBtn","data-desc":"模型训练选择个人图片"},on:{click:t.openImgModal}},[e("i",{staticClass:"iconfont icon-gerenzuopin"}),t._v(" "),e("span",{staticClass:"uploadBtn"},[t._v(t._s(t.$t("CreativeCenterPopup21")))])]),t._v(" "),e("div",{attrs:{"data-group":"Training_UploadImgBox_UploadImgBtn","data-desc":"模型训练选择图片"},on:{click:t.uploadImg}},[e("i",{staticClass:"iconfont icon-shangchuantupianheshipin"}),t._v(" "),e("span",{staticClass:"uploadBtn"},[t._v(t._s(0==t.DSType?t.$t("UploadImg"):t.$t("trainUploadImg_uploadImgVideo")))]),t._v(" "),e("span",{staticClass:"tips"},[t._v(t._s(0==t.DSType?t.$t("trainUploadImg_supportType"):t.$t("trainUploadImg_supportVideoType")))]),t._v(" "),e("input",{ref:"imgInput",staticStyle:{display:"none"},attrs:{type:"file",accept:1==t.DSType?"image/png, image/jpeg, image/jpg, image/webp, video/mp4":"image/png, image/jpeg, image/jpg, image/webp",multiple:""},on:{change:t.handleImgUpload}})]),t._v(" "),e("div",{attrs:{"data-group":"Training_UploadImgBox_UploadFolderBtn","data-desc":"模型训练选择文件夹"},on:{click:t.uploadFolder}},[e("i",{staticClass:"iconfont icon-shangchuanshujuji"}),t._v(" "),e("span",{staticClass:"uploadBtn"},[t._v(t._s(t.$t("newTrainIntr2")))]),t._v(" "),e("span",{staticClass:"tips"},[t._v(t._s(t.$t("trainUploadImg_imgVideoMatchTip")))]),t._v(" "),e("input",{ref:"foldeInput",staticStyle:{display:"none"},attrs:{type:"file",webkitdirectory:""},on:{change:t.handleFolderUpload}})])])]):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.imgs.length>0,expression:"imgs.length > 0"}],ref:"imgBox",staticClass:"imgBox",style:{maxHeight:t.imgBoxMaxHeightValue}},t._l(t.imgs,(function(n,o){var r;return e("imgItem",{key:n.url+"_"+o,attrs:{url:n.url,prompt:null===(r=n.tags)||void 0===r?void 0:r.join(",")},on:{imgDelete:function(e){return t.imgDelete(o)},click:function(e){return t.openDel(o)},imgLoad:function(e){return t.onImgLoad(o,e)}}})})),1),t._v(" "),t.imgs.length>0?e("div",{staticClass:"allDelete",on:{click:t.onDeleteAll}},[t._v(t._s(t.$t("DeleteAll")))]):t._e()]),t._v(" "),e("imgDet",{ref:"imgDet",model:{value:t.imgs,callback:function(e){t.imgs=e},expression:"imgs"}}),t._v(" "),e("HyUploadMoald",{ref:"HyUploadMoaldRef",attrs:{category:31,isMultiSelect:!0,tabListKeys:["pick"],fileTypes:1==t.DSType?["image","video"]:["image"]},on:{onConfirm:t.handleSelectImg}})],1)}),[],!1,null,"67a75916",null).exports),j=(n(50),n(10)),E={props:{value:{type:Array,default:function(){return[]}},createId:{type:String,default:""},max:{type:Number,default:500},category:{type:Number,default:2},compressSize:{type:Number,default:2}},components:{HyUploadMoald:$.default},data:function(){return{replaceImageType:j.K,isUploading:!1,accept:".jpg,.jpeg,.png,.svg,.webp,.bmp,.tif",fileList:[],tempList:[],batchSize:2,selectedFilesCount:0}},computed:{showImgLoading:function(){return function(img){return!img.tags&&!img.disabled_tag&&"check"!=img.type&&(100!=img.uploadStatus||!img.error&&!img.ready)}}},watch:{value:function(t){t&&this.$set(this,"fileList",t)}},mounted:function(){this.value&&this.value&&this.$set(this,"fileList",this.value)},methods:{curstomUpload:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.isUploading=!0,!((o=t.file).size/1024/1024>e.compressSize)){n.next=14;break}return n.prev=3,n.next=6,Object(y.a)(o,1024*e.compressSize*1024);case 6:o=n.sent,n.next=14;break;case 9:return n.prev=9,n.t0=n.catch(3),e.isUploading=!1,console.error("error:",n.t0),n.abrupt("return");case 14:e.addFileByUpload(o).then((function(t){console.log("自定义id",t);var n=new _.a({type:2});n.startUpload(o,{name:"train_img".concat(Date.now(),"_").concat(o.name),category:e.category||2,size:o.size}).then((function(o){var r=e.fileList.find((function(e){return e.id===t}));r.url=o,r.uploadStatus=100,r.ready=!0,r.file_id=n.fileId})).catch((function(n){var o=e.fileList.findIndex((function(e){return e.id===t}));e.deleteFile(o)})).finally((function(){console.log("finally"),e.isUploading=!1}))}));case 15:case"end":return n.stop()}}),n,null,[[3,9]])})))()},openImgModal:function(){this.$refs.HyUploadMoaldRef.openModal()},handleSelectImg:function(data){var t=this,e=data.map((function(t){return{id:t.id,url:t.url,ready:!0,uploadStatus:100}})),n=[].concat(Object(h.a)(this.fileList),Object(h.a)(e)).splice(-this.max).filter((function(t,e,n){return e===n.findIndex((function(e){return e.url===t.url}))}));this.tempList=n,this.$emit("input",n),setTimeout((function(){t.$emit("handleChange",n)}),500)},handleChange:function(t,e){var n=this;this.tempList=e,this.$emit("input",this.fileList),setTimeout((function(){n.$emit("handleChange",n.fileList)}),500)},addFileByUpload:function(t){var e=this;return new Promise((function(n,o){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){var o={id:e.fileList.length+t.name,uploadStatus:0,ready:!1};e.fileList.push(o),n(o.id)},r.onerror=function(t){return o(t)}}))},addFile:function(t){var e=t.id,n=t.url;this.fileList.push({file_id:e,url:n,uploadStatus:100,ready:!0})},updateProgress:function(t,e){var n=t.loaded,o=t.total,r=Math.round(n/o*100),l=this.fileList.findIndex((function(t){return t.file_id==e.file_id}));l>-1&&(this.fileList[l].uploadStatus=r)},clear:function(){var t=this;this.$confirm(this.$t("DeleteAllFiles"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){t.fileList=[],t.$emit("clearAll",t.fileList),t.$emit("handleChange",t.fileList)})).catch((function(){}))},deleteFile:function(t){var e=this.fileList[t];this.fileList.splice(t,1),this.$emit("delete",e),this.$emit("handleChange",this.fileList)},fileExceed:function(){this.$message({type:"warning",message:this.$t("UploadImageExceed",{max:this.max})})},refreshUpload:function(t){var e=this.fileList[t].file_id;this.fileList[t].error=!1,this.fileList[t].uploadStatus=0,e?this.startUpload(e):this.getUploadSign(e)},imgError:function(t){var e="imgError".concat(t.url);this[e]?this[e]+=1:this[e]=1,this[e]>3||(console.log("load img error",this.$refs[t.url]),this.$refs[t.url][0].src=t.url)}}},P=(n(4907),Object(w.a)(E,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"upload-image-item flex flex-col"},[e("div",{staticClass:"upload-content flex flex-wrap"},[e("div",{on:{click:t.openImgModal}},[e("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:t.isUploading,expression:"isUploading"}],ref:"imageUpload",staticClass:"upload-image",attrs:{action:"/",drag:"",disabled:"",multiple:"","http-request":t.curstomUpload,limit:t.max,"on-exceed":t.fileExceed,accept:t.accept,"file-list":t.fileList,"show-file-list":!1,"on-change":t.handleChange,"data-event":"ai_model_training_upload_file_list"}},[e("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),t._l(t.fileList,(function(img,i){return e("div",{key:"upload_".concat(i),staticClass:"image-item flex"},[e("div",{staticClass:"img-handle"},[e("i",{staticClass:"el-icon-delete",on:{click:function(e){return t.deleteFile(i)}}}),t._v(" "),e("i",{directives:[{name:"show",rawName:"v-show",value:img.error,expression:"img.error"}],staticClass:"el-icon-refresh-left refresg-icon",on:{click:function(e){return t.refreshUpload(i)}}})]),t._v(" "),img.url?e("img",{ref:img.url,refInFor:!0,attrs:{src:t.replaceImageType(img.url,"low")},on:{error:function(e){return t.imgError(img)}}}):t._e(),t._v(" "),t.showImgLoading(img)?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.showImgLoading(img),expression:"showImgLoading(img)"}],staticClass:"loading"}):t._e()])}))],2),t._v(" "),t.fileList.length>0?e("el-button",{staticClass:"clear text-right",attrs:{type:"text"},on:{click:t.clear}},[e("i",{staticClass:"iconfont icon-moveDelete"}),t._v("\n    "+t._s(t.$t("DeleteAll"))+"\n  ")]):t._e(),t._v(" "),e("HyUploadMoald",{ref:"HyUploadMoaldRef",attrs:{category:32,isMultiSelect:!0,uploadObj:{multiple:!0,limit:t.max,accept:t.accept}},on:{onConfirm:t.handleSelectImg}})],1)}),[],!1,null,"27c917e2",null).exports),M=n(914),N=n(56),R=n(407),A=n(570),F=n(942),B={provide:function(){return{CardApp:this}},props:{cardRunderList:{type:Array,default:function(){return[]}},type:{type:Number,default:0}},components:{DataSetSwiperlist:F.a},data:function(){return{dialogVisible:!1,fromCloseButton:!1}},methods:{show:function(){this.dialogVisible=!0},handleClick:function(t){this.dialogVisible=!1,this.$emit("hotDialogClick",t)},closeDialog:function(){this.fromCloseButton=!0,this.dialogVisible=!1,this.$xyLogEvent({front_operation:"click",entity_type:"hot_dataset_dialog",entity_name:"hot_dataset_close",obj_desc:0===this.type?"1":"2"})}},watch:{dialogVisible:function(t){var e=this;this.fromCloseButton?this.fromCloseButton=!1:(this.cardRunderList.forEach((function(t){t.obj_desc=0===e.type?"1":"2"})),this.$xyLogEvent({front_operation:t?"exposure":"click",entity_type:"dataset_swiperlist",entity_name:t?"dataset_guidance_popup":"hot_dataset_close",obj_desc:0===this.type?"1":"2",obj_info_group:this.cardRunderList}))}}},V=(n(4910),Object(w.a)(B,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.dialogVisible,"destroy-on-close":"",width:t.cardRunderList.length<5?"1150px":"1250px",top:"10vh","custom-class":"hotDialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"content"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("quickTrainTemplate")))]),t._v(" "),e("div",{staticClass:"subTitle"},[t._v(t._s(t.$t("trainPresetTip")))]),t._v(" "),e("DataSetSwiperlist",{attrs:{isDialog:"",cardRunderList:t.cardRunderList},on:{cardItemClick:t.handleClick}}),t._v(" "),e("div",{staticClass:"tip flex_lr_m"},[t._v("\n      "+t._s(t.$t("noDataset"))+"\n      "),e("el-button",{attrs:{type:"primary"},on:{click:t.closeDialog}},[t._v(t._s(t.$t("customTrain")))])],1)],1)])}),[],!1,null,"70798640",null).exports),U=n(9),H=n(3184);function z(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?z(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var G={name:"TrainingMain",provide:function(){return{easyTop:this}},components:{TrainUploadImgBox:L,UploadImageItem:P,TarinAdvSet:M.a,HyUploadMoald:$.default,CombinedSelectDialog:R.default,EllipsisTooltip:A.default,HotDialog:V},props:{DSType:{type:Number,default:0},defConfig:{type:Object,default:null},orgDSType:{type:Number,default:null}},data:function(){return{currentTab:"imageTrainModel",showEditName:!1,trigger:"",train_task_record_name:"",pageLaoding:!0,selectModelDisabled:!1,isLoading:!1,deleteLoading:!1,saveLoading:!1,selectModel:"",selectWorkModel:"",modelList:[],workModelList:[],trainCostNum:0,debounceGetTrainCost:Object(v.debounce)(this.getTrainCost,500),formData:{name:"",meta:null,mode:1,category:1,related_model_no:"",related_model_ver_no:""},typeIndex:1===this.DSType?"hunyuan_default":"default",activeName:"training",intSeed:null,train_estimated:{hashrate_base_value:2.5,reg_image_base_value:2,sdxl_base_value:6,sd35_base_value:6,sd_batch_size_base_value:{1:2.8,2:2.5,3:1.8,4:1.5,5:1.3,6:1.1,7:.9,8:.8},sdxl_batch_size_base_value:{1:4.5,2:4},flux_batch_size_base_value:{1:5.5},sd35l_batch_size_base_value:{1:6,2:4},sd35m_batch_size_base_value:{1:18,2:12}},videoTabList:[{name:"newGenerate105",value:"wan_t2v_default"},{name:"newGenerate106",value:"wan_i2v_default"}],videoTypeList:[{name:this.$t("Hunyuan"),value:"hunyuan_default",url:"https://image.cdn2.seaart.me/static/upload/20250519/9263e3c4-d80b-4bc5-b41b-e878e6caaecf.gif"},{name:this.$t("Wan"),value:"wan_default",url:"https://image.cdn2.seaart.me/static/upload/20250519/bb72b978-128c-4e6d-9293-4109939f4438.gif"}],typeList:[{name:this.$t("Customization"),value:"default",baseModel:Object(U.X)("default")},{name:"FLUX",value:"flux_default",url:"https://image.cdn2.seaart.me/train/trainIcon0.png",baseModel:Object(U.X)("FLUX")},{name:"SDXL",value:"sdxl_default",url:"https://image.cdn2.seaart.me/train/trainIcon1.png",baseModel:Object(U.X)("SDXL")},{name:"pony",value:"pony_default",url:"https://image.cdn2.seaart.me/static/upload/20250227/199a2193-04a9-47bf-b2b1-09b3301cba5e.webp",baseModel:Object(U.X)("pony")},{name:"IIlustrious",value:"illustrious_default",url:"https://image.cdn2.seaart.me/static/upload/20250227/8ca81af8-078c-4120-9778-b5e06d42ae16.webp",baseModel:Object(U.X)("Illustrious")},{name:this.$t("trainPortrait"),value:"portrait_default",url:"https://image.cdn2.seaart.me/train/trainIcon2.png",baseModel:Object(U.X)("default")},{name:this.$t("animation"),value:"anime_default",url:"https://image.cdn2.seaart.me/train/trainIcon3.png",baseModel:Object(U.X)("default")},{name:this.$t("c_style"),value:"style_default",url:"https://image.cdn2.seaart.me/train/trainIcon4.png",baseModel:Object(U.X)("default")},{name:"SD 3.5L",value:"sd35L_default",url:"https://image.cdn2.seaart.me/train/trainIcon6.png",baseModel:Object(U.X)("SD 3.5L")},{name:"SD 3.5M",value:"sd35M_default",url:"https://image.cdn2.seaart.me/train/trainIcon7.png",baseModel:Object(U.X)("SD 3.5M")},{name:this.$t("viewMore"),value:"more"}],leftHeight:0,hotDataSetObj:{0:[],1:[]}}},computed:W(W(W({},Object(l.c)("user",["isLoggedIn","isCompanyAccount"])),Object(l.e)("payment",["paymentInfo"])),{},{baseModelList:function(){var t,e=this;return null===(t=this.typeList.find((function(t){return t.value===e.typeIndex})))||void 0===t?void 0:t.baseModel},targetFramesValue:{get:function(){return this.formData.meta&&this.formData.meta.target_frames&&Array.isArray(this.formData.meta.target_frames)?parseInt(this.formData.meta.target_frames[0]):1},set:function(t){var e=Number(t);this.$set(this.formData.meta,"target_frames",[e])}},intTypeList:function(){return 1==this.DSType?this.videoTypeList:this.typeList},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)},intStep:function(){var t,e,n,o,r,l,c=parseInt((null===(t=this.formData)||void 0===t||null===(t=t.meta)||void 0===t?void 0:t.repeat)*(null===(e=this.formData)||void 0===e||null===(e=e.meta)||void 0===e?void 0:e.epoch)/(null===(n=this.formData)||void 0===n||null===(n=n.meta)||void 0===n?void 0:n.train_batch_size));(null===(o=this.formData)||void 0===o||null===(o=o.meta)||void 0===o?void 0:o.reg_images.length)>0?c*=this.train_estimated.reg_image_base_value*(null===(r=this.formData)||void 0===r||null===(r=r.meta)||void 0===r||null===(r=r.images)||void 0===r?void 0:r.length):c*=null===(l=this.formData)||void 0===l||null===(l=l.meta)||void 0===l||null===(l=l.images)||void 0===l?void 0:l.length;return c},intVideoStep:function(){return function(t){var e,n,o,r,l,c=0;0===t?c=(null===(r=this.formData)||void 0===r||null===(r=r.meta)||void 0===r||null===(r=r.images)||void 0===r||null===(r=r.filter((function(img){return 0===img.material_type})))||void 0===r?void 0:r.length)||0:c=(null===(l=this.formData)||void 0===l||null===(l=l.meta)||void 0===l||null===(l=l.images)||void 0===l||null===(l=l.filter((function(img){return 1===img.material_type})))||void 0===l?void 0:l.length)||0;return parseInt(c*(null===(e=this.formData)||void 0===e||null===(e=e.meta)||void 0===e?void 0:e.repeat)*(null===(n=this.formData)||void 0===n||null===(n=n.meta)||void 0===n?void 0:n.epoch)/(null===(o=this.formData)||void 0===o||null===(o=o.meta)||void 0===o?void 0:o.train_batch_size))}},steps:function(){var t;return(null===(t=this.formData)||void 0===t||null===(t=t.meta)||void 0===t||null===(t=t.images)||void 0===t?void 0:t.length)>0?this.intStep:this.$t("calculateAfter")},videoSteps:function(){return function(t){var e;return(null===(e=this.formData)||void 0===e||null===(e=e.meta)||void 0===e||null===(e=e.images)||void 0===e?void 0:e.length)>0?this.intVideoStep(t):this.$t("trainMain_calcAfterUpload")}},inFluxActivity:function(){var t=Date.now();return t>17276544e5&&t<17294688e5},getSdTime:function(){var t,e,n,o,r,l,c=0;switch(this.typeIndex){case"sdxl_default":c=this.intStep/this.train_estimated.sdxl_batch_size_base_value[null===(t=this.formData.meta)||void 0===t?void 0:t.train_batch_size];break;case"flux_default":c=this.intStep/this.train_estimated.flux_batch_size_base_value[null===(e=this.formData.meta)||void 0===e?void 0:e.train_batch_size];break;case"sd35_default":c=this.intStep/this.train_estimated.sd35l_batch_size_base_value[null===(n=this.formData.meta)||void 0===n?void 0:n.train_batch_size];break;case"sd35M_default":c=this.intStep/this.train_estimated.sd35m_batch_size_base_value[null===(o=this.formData.meta)||void 0===o?void 0:o.train_batch_size];break;case"sd35L_default":c=this.intStep/this.train_estimated.sd35l_batch_size_base_value[null===(r=this.formData.meta)||void 0===r?void 0:r.train_batch_size];break;default:c=this.intStep/this.train_estimated.sd_batch_size_base_value[null===(l=this.formData.meta)||void 0===l?void 0:l.train_batch_size]}return c},EtdCost:function(){var t=this.getSdTime,e=t*this.train_estimated.sdxl_base_value,n="sdxl_default"==this.typeIndex||"flux_default"===this.typeIndex?parseInt(e/this.train_estimated.hashrate_base_value):parseInt(t/this.train_estimated.hashrate_base_value);return n=["sd35_default","sd35L_default","sd35M_default"].includes(this.typeIndex)?parseInt(t/this.train_estimated.hashrate_base_value*this.train_estimated.sd35_base_value):n,"flux_default"===this.typeIndex&&this.inFluxActivity&&(n=parseInt(n/2)),n},canLoadDetail:function(){var t,e;return!(!(null!==(t=this.$route)&&void 0!==t&&null!==(t=t.query)&&void 0!==t&&t.id||null!==(e=this.$route)&&void 0!==e&&null!==(e=e.query)&&void 0!==e&&e.dataSetNo)||!this.isLoggedIn)&&(null==this.orgDSType||this.orgDSType===this.DSType)}}),mounted:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:t.pageLaoding=!1,t.isLoggedIn&&t.getPaymentInfo(),t.getHotDataSetList();case 5:case"end":return e.stop()}}),e)})))()},watch:{EtdCost:{handler:function(){this.debounceGetTrainCost()},deep:!0,immediate:!0},"formData.meta.target_frames":{handler:function(){this.debounceGetTrainCost()},deep:!0,immediate:!0},"formData.meta.frame_sample":{handler:function(){this.debounceGetTrainCost()},deep:!0,immediate:!0}},methods:W(W(W({},Object(l.b)("payment",["getPaymentInfo"])),Object(l.b)("creation",["setCombinedDialogStatus"])),{},{getHotDataSetList:function(){var t=this;Object(N.h)().then((function(e){var n,o;if(1e4===e.status.code){var r=null!==(n=e.data)&&void 0!==n?n:{},l=r.image_has_created,c=r.video_has_created,d=r.image_datasets,m=r.video_datasets;t.hotDataSetObj={0:d,1:m};var v={0:{hasCreated:l,cacheKey:"canOpenHotSetImage"},1:{hasCreated:c,cacheKey:"canOpenHotSetVideo"}}[t.DSType],f=t.$route.query,h=f.id,_=f.dataSetNo;h||_||!v||v.hasCreated||null!==(o=H.a.getCache(v.cacheKey))&&void 0!==o&&!o||(t.$nextTick((function(){t.openHotDialog()})),H.a.setCache(v.cacheKey,!1))}}))},openHotDialog:function(){this.$refs.hotDialog.show()},handleHotDialogClick:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.id,e.isLoggedIn){n.next=4;break}return e.$EventBus.$emit("openLoginDialog"),n.abrupt("return");case 4:return n.prev=4,n.next=7,Object(N.d)({id:o});case 7:if(1e4===(r=n.sent).status.code){n.next=10;break}return n.abrupt("return");case 10:return n.next=12,e.updateFormDataFromResponse(r.data);case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(4),console.error("Failed to load existing dataset:",n.t0);case 17:case"end":return n.stop()}}),n,null,[[4,14]])})))()},openImgModal:function(){this.isLoggedIn?this.$refs.HyUploadMoaldRef.openModal():this.$EventBus.$emit("openLoginDialog")},handleSelectImg:function(data){this.formData.meta.text_to_img.image_path=data[0].url},getItemClass:function(t){return"wan_t2v_default"!==this.typeIndex&&"wan_i2v_default"!==this.typeIndex||"wan_default"!==t.value?this.typeIndex===t.value?"activateItem":"defItem":"activateItem"},onSave:function(){var t=arguments,e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,d,v,h,_,y,i,C,w,x,k,D,$,T,O,I,S,L,E,P,M;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(h=t.length>0&&void 0!==t[0]&&t[0],e.isLoggedIn){n.next=4;break}return e.$EventBus.$emit("openLoginDialog"),n.abrupt("return");case 4:if(e.formData.name){n.next=7;break}return e.$message.error(e.$t("myNewDataset")),n.abrupt("return");case 7:if(e.selectModel){n.next=10;break}return e.$message.error(e.$t("PleaseSelectBaseName")),n.abrupt("return");case 10:if(null!==(o=e.formData)&&void 0!==o&&null!==(o=o.meta)&&void 0!==o&&o.images&&0!=(null===(r=e.formData)||void 0===r||null===(r=r.meta)||void 0===r?void 0:r.images.length)){n.next=13;break}return 0==e.DSType?e.$message.error(e.$t("pleaseUoloadImage")):e.$message.error(e.$t("PleaseUploadVideo")),n.abrupt("return");case 13:if("wan_i2v_default"!=e.typeIndex||e.formData.meta.text_to_img.image_path){n.next=16;break}return e.$message.error(e.$t("PleaseUploadInitialFrame")),n.abrupt("return");case 16:if(!h){n.next=24;break}for(y=0,i=0;i<(null===(C=e.formData)||void 0===C||null===(C=C.meta)||void 0===C?void 0:C.images.length);i++)((null===(w=e.formData)||void 0===w||null===(w=w.meta)||void 0===w||null===(w=w.images[i])||void 0===w||null===(w=w.tags)||void 0===w?void 0:w.length)>0||null!==(x=e.formData)&&void 0!==x&&null!==(x=x.meta)&&void 0!==x&&null!==(x=x.images[i])&&void 0!==x&&x.raw_url)&&y++;if(!(y<(null===(_=e.formData)||void 0===_||null===(_=_.meta)||void 0===_?void 0:_.images.length))){n.next=22;break}return e.$message.error(0==e.DSType?e.$t("newAddTagNoneTip"):e.$t("trainSaveErrTip")),n.abrupt("return");case 22:n.next=25;break;case 24:e.$logEvent("log_actions",{operation:"click_save_dataset",behavior_info:"on_training_detail_pager"});case 25:return k=[{field:"prompt",label:e.$t("ModelPrompt"),getter:function(t){var e;return null==t||null===(e=t.meta)||void 0===e||null===(e=e.text_to_img)||void 0===e?void 0:e.prompt}},{field:"trigger",label:e.$t("TriggerWords"),getter:function(){return e.trigger}}],D=[{field:"name",label:e.$t("datasetName")}],n.prev=27,n.next=30,Promise.all([Object(j.f)(e.formData,k,U.e.GenerateCreate),Object(j.f)(e.formData,D,U.e.TitleDescription)]);case 30:if($=n.sent,T=Object(c.a)($,2),O=T[0],I=T[1],O&&I){n.next=36;break}return n.abrupt("return");case 36:n.next=40;break;case 38:n.prev=38,n.t0=n.catch(27);case 40:if(!e.isLoading&&!e.saveLoading){n.next=42;break}return n.abrupt("return");case 42:if(h?e.isLoading=!0:e.saveLoading=!0,S=e.formData.meta.images.some((function(t){return 0===t.material_type})),L=e.formData.meta.images.some((function(t){return 1===t.material_type})),e.formData.train_model_type=S&&L?2:L?1:0,null===(l=e.$route)||void 0===l||null===(l=l.query)||void 0===l||!l.dataSetNo){n.next=52;break}return e.formData.model_ver_no=null===(E=e.$route)||void 0===E||null===(E=E.query)||void 0===E?void 0:E.modelVerNo,e.formData.train_task_type=e.DSType,e.formData.resolutions=e.formData.meta.images.map((function(t){return{width:t.width,height:t.height}})),Object(f.f)(e.formData).then((function(t){1e4==t.status.code&&window.open("/loraTrainingDet?id="+t.data.id,"_blank")})).finally((function(){h?e.isLoading=!1:e.saveLoading=!1})),n.abrupt("return");case 52:P=N.b,null===(d=e.$route)||void 0===d||null===(d=d.query)||void 0===d||!d.id||null!==(v=e.$route)&&void 0!==v&&null!==(v=v.query)&&void 0!==v&&v.isAdd||e.orgDSType!==e.DSType?e.formData.train_task_type=e.DSType:(P=N.e,e.formData.id=null===(M=e.$route)||void 0===M||null===(M=M.query)||void 0===M?void 0:M.id),e.formData.meta.trigger_words=e.trigger.split(","),"wan_i2v_default"!=e.typeIndex&&(e.formData.meta.text_to_img.image_path=""),P(e.formData).then((function(t){if(1e4==t.status.code)if(h){var n=t.data.id||t.data.data_set_id,o=e.formData.meta.images.map((function(t){return{width:t.width,height:t.height}}));Object(N.C)({data_set_no:n,name:e.train_task_record_name||m()().format("YYYY-MM-DD HH:mm"),resolutions:o}).then((function(t){var n;1e4==t.status.code&&(null!==(n=e.$route)&&void 0!==n&&null!==(n=n.query)&&void 0!==n&&n.id||e.$router.back(),window.open("/loraTrainingDet?id="+t.data.id,"_blank"))})).finally((function(){h?e.isLoading=!1:e.saveLoading=!1}))}else h?e.isLoading=!1:e.saveLoading=!1,e.$message.success(e.$t("SaveSuccess")),e.$router.back()})).catch((function(){h?e.isLoading=!1:e.saveLoading=!1}));case 57:case"end":return n.stop()}}),n,null,[[27,38]])})))()},onDelete:function(){var t=this;this.isLoggedIn?(this.$confirm(this.$t("confirmDeletion"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),customClass:"collectConfirm",type:"warning"}).then((function(){var e;t.deleteLoading=!0,Object(N.c)({ids:[null===(e=t.$route)||void 0===e||null===(e=e.query)||void 0===e?void 0:e.id]}).then((function(e){1e4==e.status.code&&t.$router.back()})).finally((function(){t.deleteLoading=!1}))})).catch((function(){})),this.$logEvent("log_actions",{operation:"click_delete_dataset",behavior_info:"on_training_detail_page"})):this.$EventBus.$emit("openLoginDialog")},getRandomSeed:function(){return Math.floor(4294967294*Math.random())+1},openAdSet:function(){this.$refs.advset.show(),this.$logEvent("log_actions",{operation:"click_advanced_setting",behavior_info:"on_training_detail_page"})},setTarinType:function(){return{default:1,anime_default:2,style_default:3,portrait_default:4,sdxl_default:5,flux_default:6,sd35L_default:7,sd35M_default:8,pony_default:9,illustrious_default:10,hunyuan_default:11,wan_default:12,wan_t2v_default:12,wan_i2v_default:12}[this.typeIndex]||1},setEditTarinType:function(data){var t;return 12==data.category?null!=data&&null!==(t=data.meta)&&void 0!==t&&null!==(t=t.text_to_img)&&void 0!==t&&t.image_path?"wan_i2v_default":"wan_t2v_default":{1:"default",2:"anime_default",3:"style_default",4:"portrait_default",5:"sdxl_default",6:"flux_default",7:"sd35L_default",8:"sd35M_default",9:"pony_default",10:"illustrious_default",11:"hunyuan_default",12:"wan_default"}[data.category]||"default"},setformData:function(t){var e,n,o,l,c,d,m,v,f,h,_,y,C,w,x,k,D=this.typeIndex.startsWith("sd35")?"sd35_default":this.typeIndex,$=W({},this.defConfig[D]),T={};(t&&($=t,T=W({},this.defConfig[D])),null!==(e=this.formData.meta)&&void 0!==e&&e.reg_images&&(null===(n=this.formData.meta)||void 0===n?void 0:n.reg_images.length)>0)&&($.reg_images=null===(x=this.formData.meta)||void 0===x?void 0:x.reg_images);null!==(o=this.formData.meta)&&void 0!==o&&o.images&&(null===(l=this.formData.meta)||void 0===l?void 0:l.images.length)>0&&($.images=null===(k=this.formData.meta)||void 0===k?void 0:k.images);var O=$,I=O.repeat,S=O.epoch,L=O.text_to_img,j=O.train_batch_size,E=O.mixed_precision,P=O.resolution,M=O.save_every_n_epochs,N=O.save_precision_as,R=O.learning_rate,A=O.unet_lr,F=O.te_lr,B=O.lr_warmup,V=O.lr_scheduler,U=O.optimizer,H=O.lr_scheduler_num_cycles,z=O.min_snr_gamma,G=O.enable_block_weights,K=O.network_dim,Y=O.network_alpha,X=O.shuffle_caption,J=O.weighted_captions,Q=O.keep_tokens,Z=O.noise_offset,tt=O.max_token_length,et=O.multires_noise_iterations,at=O.multires_noise_discount,it=O.clip_skip,nt=O.reg_images,ot=O.images,st=O.down_lr_weight,lt=O.mid_lr_weight,ct=O.up_lr_weight,ut=O.block_lr_zero_threshold,mt=O.enable_train_unet,pt=O.enable_train_text_encoder,vt=O.target_frames,ft=O.frame_sample,ht=O.duraction,_t=O.image_path,gt=O.network_dropout,bt=O.flow_shift,yt=O.time_step_sampler,Ct=O.gradient_checkpointing,wt=void 0!==Ct&&Ct,xt=O.enable_bucket,kt=void 0!==xt&&xt,Dt=O.bucket_reso_steps,$t=void 0===Dt?64:Dt,Tt=O.min_bucket_reso,Ot=void 0===Tt?512:Tt,It=O.max_bucket_reso,St=void 0===It?2048:It,Lt=O.color_aug,jt=void 0!==Lt&&Lt,Et=O.flip_aug,Pt=void 0!==Et&&Et,Mt=O.caption_dropout_rate,Nt=void 0===Mt?0:Mt,Rt=O.caption_dropout_every_n_epochs,At=void 0===Rt?0:Rt;!L||null!=L&&L.seed||(L.seed=this.getRandomSeed()),this.formData.meta=Object(r.a)(Object(r.a)(Object(r.a)({repeat:I||T.repeat,epoch:S||T.epoch,text_to_img:L||T.text_to_img,train_batch_size:j||T.train_batch_size,mixed_precision:E||T.mixed_precision,resolution:P||T.resolution||"512*512",seed:-1,save_every_n_epochs:M||T.save_every_n_epochs,save_precision_as:N||T.save_precision_as,learning_rate:R||T.learning_rate,reg_images:nt||[],images:ot||[],unet_lr:A||0==A?A:T.unet_lr,te_lr:F||0==F?F:T.te_lr,lr_warmup:B||T.lr_warmup,lr_scheduler:V||T.lr_scheduler,optimizer:U||T.optimizer,lr_scheduler_num_cycles:H||T.lr_scheduler_num_cycles,min_snr_gamma:z||T.min_snr_gamma,enable_block_weights:G||T.enable_block_weights,network_dim:K||T.network_dim,network_alpha:Y||T.network_alpha,shuffle_caption:X||T.shuffle_caption,weighted_captions:J||T.weighted_captions,keep_tokens:Q||T.keep_tokens,noise_offset:Z||T.noise_offset,max_token_length:tt||T.max_token_length,multires_noise_iterations:et||T.multires_noise_iterations,multires_noise_discount:at||T.multires_noise_discount,clip_skip:it||T.clip_skip,resolutionWidth:(null==L?void 0:L.width)||(null===(c=T.text_to_img)||void 0===c?void 0:c.width),resolutionHeight:(null==L?void 0:L.height)||(null===(d=T.text_to_img)||void 0===d?void 0:d.height),down_lr_weight:st||T.down_lr_weight,mid_lr_weight:lt||T.mid_lr_weight,up_lr_weight:ct||T.up_lr_weight,block_lr_zero_threshold:ut||T.block_lr_zero_threshold,trigger_words:[],enable_train_unet:mt||T.enable_train_unet,enable_train_text_encoder:pt||T.enable_train_text_encoder,train_model_network_module:this.selectWorkModel||T.train_model_network_module,target_frames:vt||T.target_frames,frame_sample:ft||T.frame_sample,duraction:ht||T.duraction||0,image_path:_t||T.image_path||"",network_dropout:gt||T.network_dropout||0,flow_shift:bt||T.flow_shift,time_step_sampler:yt||T.time_step_sampler||"sigma",gradient_checkpointing:wt||T.gradient_checkpointing||!1,enable_bucket:kt||T.enable_bucket||!1,bucket_reso_steps:$t||(null===(m=T)||void 0===m?void 0:m.bucket_reso_steps)||64,min_bucket_reso:Ot||(null===(v=T)||void 0===v?void 0:v.min_bucket_reso)||512,max_bucket_reso:St||(null===(f=T)||void 0===f?void 0:f.max_bucket_reso)||2048,color_aug:jt||(null===(h=T)||void 0===h?void 0:h.color_aug)||!1,flip_aug:Pt||(null===(_=T)||void 0===_?void 0:_.flip_aug)||!1},"network_dropout",gt||(null===(y=T)||void 0===y?void 0:y.network_dropout)||0),"caption_dropout_rate",Nt||(null===(C=T)||void 0===C?void 0:C.caption_dropout_rate)||0),"caption_dropout_every_n_epochs",At||(null===(w=T)||void 0===w?void 0:w.caption_dropout_every_n_epochs)||0),["flux_default","sdxl_default","pony_default","illustrious_default","sd35L_default","sd35M_default"].includes(this.typeIndex)&&this.formData.meta.train_batch_size>=2&&(this.formData.meta.gradient_checkpointing=!0)},setDefaultTypeByUrl:function(){var t,e=null===(t=this.$route)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.defaultType;if(e){var n=this.typeList.find((function(t){return t.name===e}));n&&this.changeType(n)}},changeType:function(t){var e,n,o,r,l,c,d=this;if("more"===t.value)return window.open("/lora_train","_blank"),void this.$logEvent("log_actions",{operation:"click_view_more",behavior_info:"on_training_detail_page"});this.typeIndex=t.value,"wan_default"==this.typeIndex&&(this.typeIndex="wan_t2v_default");var m=this.typeIndex.startsWith("sd35")?"sd35_default":this.typeIndex;if(this.defConfig[m]){if(t.value,"flux_default"===t.value&&this.$logEvent("log_actions",{operation:"click_train",behavior_info:"on_model_train_page",behavior_info_sub:"flux"}),["pony_default","illustrious_default"].includes(t.value)){this.$logEvent("log_actions",{operation:{pony_default:"click_pony",illustrious_default:"click_IL"}[t.value],behavior_info:"on_model_train_page"})}switch(this.selectModel="",this.selectWorkModel="",this.modelList=(null===(e=this.defConfig[m])||void 0===e?void 0:e.models)||[],this.workModelList=this.setModelNetworkList((null===(n=this.defConfig[m])||void 0===n?void 0:n.train_model_network_modules)||[]),this.formData.related_model_no=(null===(o=this.modelList[0])||void 0===o?void 0:o.model_no)||"",this.formData.related_model_ver_no=(null===(r=this.modelList[0])||void 0===r?void 0:r.model_ver_no)||"",this.selectModel=(null===(l=this.modelList[0])||void 0===l?void 0:l.model_ver_no)||"",this.selectWorkModel=(null===(c=this.workModelList[0])||void 0===c?void 0:c.value)||"",t.value){case"flux_default":this.selectModel="FLUX";break;case"sd35_default":this.selectModel="SD 3.5";break;case"sd35L_default":this.selectModel="SD 3.5L";break;case"sd35M_default":this.selectModel="SD 3.5M"}var v=this.modelList.find((function(t){return d.selectModel===t.base_model_name}))||null;["SD 3.5L","SD 3.5M"].includes(this.selectModel)&&v&&(this.formData.related_model_no=v.model_no||"",this.formData.related_model_ver_no=v.model_ver_no||""),this.selectModelDisabled=["sd35_default","flux_default","sd35L_default","sd35M_default"].includes(t.value),this.formData.category=this.setTarinType(),this.setformData()}else this.$message.error("not model config")},getModelData:function(t){console.log(t)},handleSelectModel:function(t){var e=this;"MoreModel"!==t?(this.modelList.forEach((function(n){n.model_ver_no===t&&(e.formData.related_model_no=n.model_no,e.formData.related_model_ver_no=n.model_ver_no)})),this.selectModel=t,this.debounceGetTrainCost()):this.setCombinedDialogStatus({visible:!0,instanceId:"trainModelId"+this.DSType})},handleSelectWorkModel:function(t){this.selectWorkModel=t,this.setformData(),this.$logEvent("log_actions",{operation:"click_lora_variant",behavior_info:"on_model_train_page",behavior_info_sub:t})},setModelNetworkList:function(t){var e={lora:"LoRA",dora:"DoRA",locon:"LyCORIS"};return 1===this.DSType?[{label:e.lora,value:"lora"}]:t.map((function(t){return{label:e[t],value:t}}))},selectModelHandle:function(t){var e=t.data;if(e){var n=this.modelList.find((function(t){return t.model_no===e.id})),o={name:"".concat(e.name,"-").concat(e.version_name),model_no:e.id,model_ver_no:e.model_ver_no};n?Object.assign(n,o):this.modelList.push(o),this.formData.related_model_no=e.id,this.formData.related_model_ver_no=e.model_ver_no,this.selectModel=e.model_ver_no,this.debounceGetTrainCost()}else this.selectModel=""},init:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.defConfig){e.next=2;break}return e.abrupt("return");case 2:return 1===t.DSType&&"hunyuan_default"!==t.typeIndex&&(t.typeIndex="hunyuan_default"),t.formData.category=t.setTarinType(),e.next=6,t.initModelList();case 6:if(!t.canLoadDetail){e.next=11;break}return e.next=9,t.loadExistingDataset();case 9:e.next=12;break;case 11:t.setformData();case 12:t.setDefaultTypeByUrl(),t.$nextTick((function(){t.updateLeftHeight()}));case 14:case"end":return e.stop()}}),e)})))()},initModelList:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,v,f,h,_,y,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v=t.typeIndex.startsWith("sd35")?"sd35_default":t.typeIndex,t.modelList=(null===(n=t.defConfig[v])||void 0===n?void 0:n.models)||[],t.workModelList=t.setModelNetworkList((null===(o=t.defConfig[v])||void 0===o?void 0:o.train_model_network_modules)||[]),t.selectWorkModel=(null===(r=t.workModelList[0])||void 0===r?void 0:r.value)||"",null!==(l=t.$route)&&void 0!==l&&null!==(l=l.query)&&void 0!==l&&l.id&&(null===(c=t.$route)||void 0===c||null===(c=c.query)||void 0===c?void 0:c.DSType)==t.DSType||(t.formData.related_model_no=(null===(f=t.modelList[0])||void 0===f?void 0:f.model_no)||"",t.formData.related_model_ver_no=(null===(h=t.modelList[0])||void 0===h?void 0:h.model_ver_no)||"",t.selectModel=(null===(_=t.modelList[0])||void 0===_?void 0:_.model_ver_no)||""),y=m()().format("YYYY-MM-DD"),C=(null===(d=t.modelList)||void 0===d||null===(d=d[0])||void 0===d?void 0:d.name)||"",t.formData.name=C?"".concat(C,"-").concat(y):y;case 8:case"end":return e.stop()}}),e)})))()},loadExistingDataset:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,d,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l=null!==(n=t.$route)&&void 0!==n&&null!==(n=n.query)&&void 0!==n&&n.dataSetNo?f.l:N.d,c=null!==(o=t.$route)&&void 0!==o&&null!==(o=o.query)&&void 0!==o&&o.dataSetNo?{train_model_no:t.$route.query.dataSetNo}:{id:t.$route.query.id},e.next=5,l(c);case 5:if(1e4===(d=e.sent).status.code){e.next=8;break}return e.abrupt("return");case 8:return void 0!==(m=null===(r=d.data)||void 0===r?void 0:r.category)&&(v=[11,12].includes(Number(m))?1:0,t.$emit("changeDSType",v)),e.next=12,t.updateFormDataFromResponse(d.data);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Failed to load existing dataset:",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))()},updateFormDataFromResponse:function(data){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.formData.name=data.name,t.selectModel=t.getSelectModelValue(data),t.selectModelDisabled=[6,7,8].includes(data.category),t.formData.mode=null!==(n=t.$route)&&void 0!==n&&null!==(n=n.query)&&void 0!==n&&n.dataSetNo?1:data.mode,t.formData.source=null!=data&&data.source?null==data?void 0:data.source:1,t.formData.category=data.category,t.formData.related_model_no=data.related_model_no,t.formData.related_model_ver_no=data.related_model_ver_no,t.formData.trigger_words=data.trigger_words||[],t.typeIndex=t.setEditTarinType(data),e.next=12,t.updateModelList(data);case 12:t.setformData(data.meta),t.$nextTick((function(){t.updateTrainUploadImgBox(data)}));case 14:case"end":return e.stop()}}),e)})))()},getSelectModelValue:function(data){return 6===data.category?"FLUX":7===data.category?"SD 3.5L":8===data.category?"SD 3.5M":data.related_model_ver_no},updateModelList:function(data){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=t.typeIndex.startsWith("sd35")?"sd35_default":t.typeIndex,t.modelList=(null===(n=t.defConfig[o])||void 0===n?void 0:n.models)||[],data.model&&(t.modelList.some((function(t){return t.model_no===data.model.model_no}))||t.modelList.push(data.model));case 3:case"end":return e.stop()}}),e)})))()},updateTrainUploadImgBox:function(data){var t,e=this;this.$refs.TrainUploadImgBox&&(this.$refs.TrainUploadImgBox.uploadType=null!==(t=this.$route)&&void 0!==t&&null!==(t=t.query)&&void 0!==t&&t.dataSetNo?1:data.mode);this.$nextTick((function(){e.updateLeftHeight()}))},getTrainCost:function(){var t,e,n=this,o=JSON.parse(JSON.stringify(this.formData));if(null!=o&&o.meta&&this.isLoggedIn){if(o.meta.reg_images_num=(null==o||null===(t=o.meta)||void 0===t||null===(t=t.reg_images)||void 0===t?void 0:t.length)||0,o.meta.images_num=(null==o||null===(e=o.meta)||void 0===e||null===(e=e.images)||void 0===e?void 0:e.length)||0,delete o.meta.reg_images,0==this.DSType)delete o.meta.images,o.train_task_type=0;else{var r;if(o.resolutions=((null==o||null===(r=o.meta)||void 0===r?void 0:r.images)||[]).map((function(t){return{width:t.width,height:t.height}})).filter((function(t){var e=t.width,n=t.height;return"number"==typeof e&&"number"==typeof n})),o.resolutions.length!==o.meta.images_num)return;o.train_task_type=1}Object(N.D)(o).then((function(t){var e;n.trainCostNum=(null==t||null===(e=t.data)||void 0===e?void 0:e.calculate_coins)||0}))}},updateLeftHeight:function(){this.$refs.leftContainer&&(this.leftHeight=this.$refs.leftContainer.clientHeight)},viewHelpManual:function(){var t="https://docs.seaart.ai/guide-1/3-advanced-guide/3-2-lora-training-advance/".concat(1==this.DSType?"video":"image","-training");window.open(t,"_blank")},handleAllImagesLoaded:function(){1==this.DSType&&this.debounceGetTrainCost()}})},K=G,Y=(n(4911),n(4912),Object(w.a)(K,(function(){var t,e,o,r,l=this,c=l._self._c;return c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.pageLaoding,expression:"pageLaoding"}],staticClass:"training-main"},[l.formData.meta?c("div",{ref:"main",staticClass:"main"},[c("div",{ref:"leftContainer",staticClass:"left",attrs:{"data-group":"Training_Main_Left"}},[c("div",{staticClass:"typeRow"},l._l(l.intTypeList,(function(t,e){return c("div",{key:e,staticClass:"typeRowItem",class:l.getItemClass(t),attrs:{"data-group":"Training_Main_Left_TypeRow_Item","data-id":t.value,"data-desc":"切换训练基模"},on:{click:function(e){return l.changeType(t)}}},["FLUX"===t.name&&l.inFluxActivity?[c("div",{staticClass:"discount flex justify-center items-center"},[c("span",[l._v(l._s(l.$t("disc50")))]),l._v(" "),c("img",{attrs:{src:n(667),width:"12",height:"12",alt:"fire-icon",loading:"lazy"}})])]:l._e(),l._v(" "),c("div",{staticClass:"itemCnt"},["more"!=t.value?c("div",{staticClass:"typeCnt"},[t.url?c("img",{attrs:{src:t.url,alt:""}}):"default"==t.value?c("i",{staticClass:"iconfont icon-zidingyi"}):l._e(),l._v(" "),c("div",{staticClass:"typeName"},[l._v(l._s(t.name))])]):c("span",[l._v(l._s(t.name))])])],2)})),0),l._v(" "),c("div",{staticClass:"typeParamet"},[c("div",{staticClass:"typeParamet_tit"},[c("div",{staticClass:"typeParamet_titTxt"},[c("i",{staticClass:"iconfont icon-shezhi1"}),l._v(" "),c("span",[l._v(l._s(l.$t("parameterSetting")))])]),l._v(" "),c("div",{staticClass:"typeParamet_titBnt",on:{click:l.openAdSet}},[l._v(l._s(l.$t("AdvSet")))])]),l._v(" "),0===l.DSType?c("div",{staticClass:"allStepTip"},[c("i",{staticClass:"el-icon-warning"}),l._v(" "),c("span",[l._v(l._s(l.$t("totalSteps"))+l._s(l.steps))])]):l._e(),l._v(" "),1===l.DSType?c("div",{staticClass:"videoStepTip"},[c("div",{staticClass:"stepItem"},[c("i",{staticClass:"el-icon-warning"}),l._v(" "),c("span",[l._v(l._s(l.$t("trainMain_imgStepCount"))+l._s(l.videoSteps(0)))])]),l._v(" "),c("div",{staticClass:"stepItem"},[c("span",[l._v(l._s(l.$t("trainMain_videoStepCount"))+l._s(l.videoSteps(1)))])])]):l._e(),l._v(" "),1===l.DSType?c("div",{staticClass:"videoTab"},l._l(l.videoTabList,(function(t,e){return c("div",{key:e,staticClass:"videoTabItem",class:{videoTabItemActive:l.typeIndex===t.value||!l.typeIndex.includes("wan")&&1!=e,disabledItem:!l.typeIndex.includes("wan")&&1==e},on:{click:function(e){l.typeIndex.includes("wan")&&l.changeType(t)}}},[l._v("\n            "+l._s(l.$t(t.name))+"\n          ")])})),0):l._e(),l._v(" "),c("div",{staticClass:"formMain"},[c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("taskName")))])])]),l._v(" "),c("div",{staticClass:"formCnt"},[c("el-input",{attrs:{placeholder:l.$t("taskNameEnter"),resize:"none"},model:{value:l.train_task_record_name,callback:function(t){l.train_task_record_name=t},expression:"train_task_record_name"}})],1)]),l._v(" "),c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("BaseModel")))])])]),l._v(" "),c("div",{staticClass:"formCnt"},[l.selectModelDisabled?c("el-input",{attrs:{disabled:""},model:{value:l.selectModel,callback:function(t){l.selectModel=t},expression:"selectModel"}}):c("el-select",{staticClass:"train-model-main-item-select",attrs:{value:l.selectModel,"popper-class":"custom-select","popper-append-to-body":!1,placeholder:l.$t("PleaseSelectBaseName")},on:{change:l.handleSelectModel}},[l._l(l.modelList,(function(t,i){return c("el-option",{key:"model_"+(t.name+i),attrs:{label:t.name,value:t.model_ver_no}})})),l._v(" "),0===l.DSType?c("el-option",{attrs:{label:l.$t("selectMoreModel"),value:"MoreModel"}}):l._e()],2)],1)]),l._v(" "),c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("trainNetworkModule")))])])]),l._v(" "),c("div",{staticClass:"formCnt"},[c("el-select",{staticClass:"train-model-main-item-select",attrs:{value:l.selectWorkModel,"popper-class":"custom-select","popper-append-to-body":!1,placeholder:l.$t("PleaseSelectBaseName")},on:{change:l.handleSelectWorkModel}},l._l(l.workModelList,(function(t,i){return c("el-option",{key:"workModel_"+t+i,attrs:{label:t.label,value:t.value}})})),1)],1)]),l._v(" "),c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("TriggerWords")))])])]),l._v(" "),c("div",{staticClass:"formCnt"},[c("el-input",{attrs:{placeholder:l.$t("pleaseEnte"),resize:"none"},model:{value:l.trigger,callback:function(t){l.trigger=t},expression:"trigger"}})],1)]),l._v(" "),1===l.DSType?[c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("trainAdvSet_numFrames")))]),l._v(" "),c("el-popover",{attrs:{placement:"right",trigger:"hover","visible-arrow":!1,"popper-class":"trainModelHover"}},[c("div",{staticClass:"trainModelHoverContent"},[c("div",{staticClass:"title"},[l._v(l._s(l.$t("trainModelHover1")))]),l._v(" "),c("img",{attrs:{src:"https://image.cdn2.seaart.me/static/upload/20250514/9d77d028-95f2-4c8e-b06c-1d14b6a82fbd.png",alt:""}}),l._v(" "),c("div",{staticClass:"itemList"},l._l(4,(function(t,e){return c("div",{key:e},[l._v(l._s(l.$t("trainModelHover2",{num:10})))])})),0)]),l._v(" "),c("i",{staticClass:"el-icon-warning",attrs:{slot:"reference"},slot:"reference"})])],1)]),l._v(" "),l.formData.meta.text_to_img?c("div",{staticClass:"formCnt"},[c("el-slider",{attrs:{"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:25},model:{value:l.targetFramesValue,callback:function(t){l.targetFramesValue=t},expression:"targetFramesValue"}})],1):l._e()]),l._v(" "),c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("trainAdvSet_numSlices")))]),l._v(" "),c("el-popover",{attrs:{placement:"right",trigger:"hover","visible-arrow":!1,"popper-class":"trainModelHover"}},[c("div",{staticClass:"trainModelHoverContent"},[c("div",{staticClass:"title"},[l._v(l._s(l.$t("trainModelHover3")))]),l._v(" "),c("img",{attrs:{src:"https://image.cdn2.seaart.me/static/upload/20250514/9d77d028-95f2-4c8e-b06c-1d14b6a82fbd.png",alt:""}}),l._v(" "),c("div",{staticClass:"itemList"},l._l(4,(function(t,e){return c("div",{key:e},[l._v("\n                          "+l._s(l.$t("trainModelHover4",{num:e+1}))+"\n                        ")])})),0)]),l._v(" "),c("i",{staticClass:"el-icon-warning",attrs:{slot:"reference"},slot:"reference"})])],1)]),l._v(" "),c("div",{staticClass:"formCnt"},[c("el-slider",{attrs:{"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:50},model:{value:l.formData.meta.frame_sample,callback:function(t){l.$set(l.formData.meta,"frame_sample",t)},expression:"formData.meta.frame_sample"}})],1)])]:l._e(),l._v(" "),c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("singleCount")))]),l._v(" "),c("span",[l._v("Repeat")])])]),l._v(" "),c("div",{staticClass:"formCnt"},[c("el-slider",{attrs:{"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:1===l.DSType?20:50},model:{value:l.formData.meta.repeat,callback:function(t){l.$set(l.formData.meta,"repeat",t)},expression:"formData.meta.repeat"}})],1)]),l._v(" "),c("div",{staticClass:"formBox",staticStyle:{"margin-bottom":"18px"}},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("numberCycles")))]),l._v(" "),c("span",[l._v("Epoch")])])]),l._v(" "),c("div",{staticClass:"formCnt"},[c("el-slider",{attrs:{"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:1===l.DSType?100:20},model:{value:l.formData.meta.epoch,callback:function(t){l.$set(l.formData.meta,"epoch",t)},expression:"formData.meta.epoch"}})],1)]),l._v(" "),c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("ModelPrompt")))]),l._v(" "),c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:l.$t("ModelPromptTip"),placement:"top"}},[c("i",{staticClass:"el-icon-warning"})])],1)]),l._v(" "),l.formData.meta.text_to_img?c("div",{staticClass:"formCnt"},[c("el-input",{attrs:{type:"textarea",rows:2,placeholder:l.$t("pleaseEnte"),resize:"none"},model:{value:l.formData.meta.text_to_img.prompt,callback:function(t){l.$set(l.formData.meta.text_to_img,"prompt",t)},expression:"formData.meta.text_to_img.prompt"}})],1):l._e()]),l._v(" "),"wan_i2v_default"===l.typeIndex?c("div",{staticClass:"formBox"},[c("div",{staticClass:"formTit"},[c("div",{staticClass:"formTitLeft"},[c("div",[l._v(l._s(l.$t("trainMain_initFrame")))]),l._v(" "),c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:l.$t("trainMain_i2vFrameTip"),placement:"top"}},[c("i",{staticClass:"el-icon-warning"})])],1)]),l._v(" "),c("div",{staticClass:"formCnt"},[c("div",{staticClass:"imagePpath",on:{click:function(t){!l.formData.meta.text_to_img.image_path&&l.openImgModal()}}},[l.formData.meta.text_to_img.image_path?[c("img",{attrs:{src:l.formData.meta.text_to_img.image_path,alt:""}}),l._v(" "),c("i",{staticClass:"iconfont icon-shanchu1",on:{click:function(t){t.stopPropagation(),l.formData.meta.text_to_img.image_path=""}}})]:[c("i",{staticClass:"iconfont icon-icon-picture"}),l._v(" "),c("span",[l._v(l._s(l.$t("UploadImg")))])]],2)])]):l._e()],2)])]),l._v(" "),c("div",{staticClass:"right"},[c("div",{staticClass:"trainBtn"},[null!==(t=l.$route)&&void 0!==t&&null!==(t=t.query)&&void 0!==t&&t.dataSetNo?l._e():c("div",{staticClass:"tranEdit"},[null!==(e=l.$route)&&void 0!==e&&null!==(e=e.query)&&void 0!==e&&e.id?c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:l.$t("Delete"),placement:"top"}},[c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.deleteLoading,expression:"deleteLoading"}],staticClass:"tranEditBtn",on:{click:l.onDelete}},[c("i",{staticClass:"iconfont icon-shanchu3"})])]):l._e(),l._v(" "),c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:l.$t("SaveImage"),placement:"top"}},[c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.saveLoading,expression:"saveLoading"}],staticClass:"tranEditBtn",attrs:{"data-group":"Training_Main_EditBtn","data-desc":"模型训练保存"},on:{click:function(t){return l.onSave(!1)}}},[c("i",{staticClass:"iconfont icon-baocun"})])])],1),l._v(" "),c("div",{staticClass:"formSubBox"},[c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.isLoading,expression:"isLoading"}],staticClass:"formSub",attrs:{"data-group":"Training_Main_StartTrain","data-desc":"模型训练开始"},on:{click:function(t){return l.onSave(!0)}}},[c("div",[l._v(l._s(l.$t("trainNow")))]),l._v(" "),c("div",[c("span",[l._v(l._s(l.$t("PhysicalExertion"))+" "+l._s(l.trainCostNum))]),l._v(" "),c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:1===l.DSType?l.$t("trainModelbnt3"):l.$t("trainNowTip"),placement:"top"}},[c("i",{staticClass:"el-icon-warning"})])],1)]),l._v(" "),1==l.defConfig.activity_code||l.inFluxActivity&&"flux_default"===l.typeIndex?c("div",{staticClass:"logBox"},[c("img",{attrs:{src:n(1456),alt:""}}),l._v(" "),c("div",[l._v(l._s(l.$t("disc50")))])]):l._e()])]),l._v(" "),c("el-tabs",{model:{value:l.activeName,callback:function(t){l.activeName=t},expression:"activeName"}},[c("el-tab-pane",{attrs:{label:l.$t("trainingDataset"),name:"training"}},[c("div",{staticClass:"trainName flex_m"},[c("EllipsisTooltip",{attrs:{iconSize:"22px",maxlength:"99",iconPosition:"left",placeholder:l.$t("datasetName"),requiredMsg:l.$t("myNewDataset")},model:{value:l.formData.name,callback:function(t){l.$set(l.formData,"name",t)},expression:"formData.name"}})],1),l._v(" "),c("TrainUploadImgBox",{ref:"TrainUploadImgBox",attrs:{defConfig:null===(o=l.defConfig[l.typeIndex.startsWith("sd35")?"sd35_default":l.typeIndex])||void 0===o?void 0:o.train_model_crop_tag,type:l.typeIndex,trigger:l.trigger,leftHeight:l.leftHeight,DSType:l.DSType},on:{changeUploadType:function(t){return l.formData.mode=t},changeUploadTypeSource:function(t){return l.formData.meta.source=t},viewHelpManual:l.viewHelpManual,allImagesLoaded:l.handleAllImagesLoaded},model:{value:l.formData.meta.images,callback:function(t){l.$set(l.formData.meta,"images",t)},expression:"formData.meta.images"}}),l._v(" "),null!==(r=l.formData)&&void 0!==r&&null!==(r=r.meta)&&void 0!==r&&null!==(r=r.images)&&void 0!==r&&r.length?l._e():c("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:l.$t("hotDataSet"),placement:"left"}},[c("div",{staticClass:"hot-tip",attrs:{"data-event":"hot_dataset_open"},on:{click:l.openHotDialog}},[c("i",{staticClass:"iconfont icon-zhankai1",attrs:{slot:"reference"},slot:"reference"})])])],1),l._v(" "),0==l.DSType?c("el-tab-pane",{attrs:{label:l.$t("regularDataset"),name:"regular"}},[c("UploadImageItem",{attrs:{category:32},on:{clearAll:function(t){l.formData.meta.reg_images=[]}},model:{value:l.formData.meta.reg_images,callback:function(t){l.$set(l.formData.meta,"reg_images",t)},expression:"formData.meta.reg_images"}})],1):l._e()],1)],1)]):l._e(),l._v(" "),l.formData.meta?c("TarinAdvSet",{ref:"advset",attrs:{defData:l.defConfig[l.typeIndex],type:l.typeIndex,config:l.defConfig.config,DSType:l.DSType},on:{viewHelpManual:l.viewHelpManual},model:{value:l.formData.meta,callback:function(t){l.$set(l.formData,"meta",t)},expression:"formData.meta"}}):l._e(),l._v(" "),c("HyUploadMoald",{ref:"HyUploadMoaldRef",attrs:{category:2,isSingleSelect:!0,tabListKeys:["upload","pick"]},on:{onConfirm:l.handleSelectImg}}),l._v(" "),c("CombinedSelectDialog",{ref:"combinedSelectDialog",attrs:{source:"trainModel",subSource:"imageTrainModel",instanceId:"trainModelId"+l.DSType,baseModelList:l.baseModelList},on:{getData:l.selectModelHandle}}),l._v(" "),c("HotDialog",{ref:"hotDialog",attrs:{cardRunderList:l.hotDataSetObj[l.DSType],type:l.DSType},on:{hotDialogClick:l.handleHotDialogClick}})],1)}),[],!1,null,"6f45ea05",null)),X=Y.exports;function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}installComponents(Y,{EllipsisTooltip:n(570).default});var Z={name:"LoraTrainingEdit",components:{TrainingMain:X},data:function(){return{pageLaoding:!0,defConfig:null,DSType:0,tabList:[{name:this.$t("Image"),value:0},{name:this.$t("Video"),value:1}],isShowBanner:!1,showList:[0],orgDSType:null}},mounted:function(){var t,e;null!==(t=this.$route)&&void 0!==t&&null!==(t=t.query)&&void 0!==t&&t.DSType&&(this.DSType=parseInt(null===(e=this.$route)||void 0===e||null===(e=e.query)||void 0===e?void 0:e.DSType),this.showList=[this.DSType]);this.isShowBanner=!(this.isCompanyAccount||sessionStorage.getItem("HideTopBanner")&&sessionStorage.getItem("HideActivityBanner")||this.isVip),this.getTrainConfig()},computed:Q({},Object(l.c)("activity",["isShowActivityBanner"])),methods:{handleChangeDSType:function(t){var e,n=this.$route.query;if(String(null!==(e=n.DSType)&&void 0!==e?e:"")!==String(t)){var o=Q(Q({},this.$route.query),{},{DSType:t});this.$router.replace({query:o})}this.DSType=t,this.orgDSType=t,this.showList=[t]},goBack:function(){window.history.length>2?this.$router.back():this.$router.push(this.localePath("/"))},handleTabClick:function(t){this.DSType=t,this.showList.includes(t)||this.showList.push(t),this.$router.replace({query:Q(Q({},this.$route.query),{},{DSType:t})})},getTrainConfig:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(f.a)();case 3:if(1e4===(n=e.sent).status.code){e.next=6;break}return e.abrupt("return");case 6:t.defConfig=n.data,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to get train config:",e.t0);case 12:return e.prev=12,t.pageLaoding=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})))()}}},tt=(n(4913),Object(w.a)(Z,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.pageLaoding,expression:"pageLaoding"}],staticClass:"loraTrainingEdit hide-scrollbar",attrs:{"data-group":"ai_model_training_edit"}},[e("div",{staticClass:"back",style:{top:t.isShowBanner||t.isShowActivityBanner?"150px":null},on:{click:t.goBack}},[e("i",{staticClass:"el-icon-back"})]),t._v(" "),t.defConfig?[e("div",{staticClass:"tabs"},t._l(t.tabList,(function(n,o){return e("div",{key:o,staticClass:"tabItem",class:{activeItem:t.DSType===n.value},attrs:{"data-event":"Training_Tab_Click","data-id":0==n.value?"Image":"Video","data-desc":"模型训练顶部tab点击"},on:{click:function(e){return t.handleTabClick(n.value)}}},[t._v("\n        "+t._s(n.name)+"\n      ")])})),0),t._v(" "),t.showList.includes(0)?e("TrainingMain",{directives:[{name:"show",rawName:"v-show",value:0===t.DSType,expression:"DSType === 0"}],attrs:{DSType:0,defConfig:t.defConfig,orgDSType:t.orgDSType},on:{changeDSType:t.handleChangeDSType}}):t._e(),t._v(" "),t.showList.includes(1)?e("TrainingMain",{directives:[{name:"show",rawName:"v-show",value:1===t.DSType,expression:"DSType === 1"}],attrs:{DSType:1,defConfig:t.defConfig,orgDSType:t.orgDSType},on:{changeDSType:t.handleChangeDSType}}):t._e()]:t._e()],2)}),[],!1,null,"65f2bf48",null));e.default=tt.exports},5757:function(t,e,n){"use strict";n.r(e);n(19),n(11),n(12),n(13);var o=n(3),r=n(14),l=n(2),c=(n(20),n(6),n(50),n(16),n(18),n(8),n(4),n(7),n(26),n(831)),d=n(56),m=n(174),v=n(1),f=(n(32),n(28),n(139)),h=n(82),_=n(9);function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={data:function(){var t=this;return{dialogVisible:!1,is_agency_fee:!1,sources:"Original",formData:{},loading:!1,loraSteps:1,recommendList:[],intRmdTag:[],modelName:"",selectArgumentList:[{label:"computingPower",value:1},{label:"diamond",value:2,disabled:!0}],SDList:_.w,sample:"",newRules:{model_name:[{required:!0,message:this.$t("PleaseEnterLORAName")},{validator:function(e,n,o){/^[a-zA-Z0-9\s_\u4e00-\u9fa5.\-]+$/.test(n)?o():o(new Error(t.$t("newModelNameFormatWarn")))}}],ver_name:[{required:!0,message:this.$t("PleaseEnterVer")},{validator:function(e,n,o){/^[a-zA-Z0-9_.-]+$/.test(n)?o():o(new Error(t.$t("ModelVerFormatWarn")))}}],base_model:[{required:!0,message:this.$t("PleaseSelectBaseModel")}]}}},computed:C(C(C({},Object(v.e)("payment",["paymentInfo"])),Object(v.c)("user",["isCompanyAccount"])),{},{isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},checkboxDownload:{get:function(){var t;return 1===(null===(t=this.formData.model_permission)||void 0===t?void 0:t.allow_download)},set:function(t){this.formData.model_permission.allow_download=t?1:2}},checkboxCommercial:{get:function(){var t;return 1===(null===(t=this.formData.model_permission)||void 0===t?void 0:t.allow_commercial_use)},set:function(t){this.formData.model_permission.allow_commercial_use=t?1:2}},checkboxMix:{get:function(){var t;return 1===(null===(t=this.formData.model_permission)||void 0===t?void 0:t.allow_model_mix)},set:function(t){this.formData.model_permission.allow_model_mix=t?1:2}},isCommunity:{get:function(){return 1===this.formData.allow_creation},set:function(t){this.formData.allow_creation=t?1:2}}}),watch:{dialogVisible:{handler:function(t){t||(this.formData={},this.loraSteps=1)}},is_agency_fee:{handler:function(t){t?(this.formData.model_payment.fee=1,this.formData.model_payment.way=1):(this.formData.model_payment.fee=0,this.formData.model_payment.way=0)}}},methods:{commChange:function(t){this.isVip||t||(this.$EventBus.$emit("showBreakDialog","TrainLoraTipWeb","basic"),this.formData.allow_creation=1)},updateCover:function(t){t&&t.url?(this.formData.model_cover.url=null==t?void 0:t.url,this.formData.model_cover.width=null==t?void 0:t.width,this.formData.model_cover.height=null==t?void 0:t.height):this.formData.model_cover={url:"",width:0,height:0}},onNext:function(){this.formData.model_name?this.loraSteps=2:this.$message.error(this.$t("PleaseEnterLORAName"))},setPayNum:function(){var t,e,n;(null===(t=this.formData.model_payment)||void 0===t?void 0:t.fee)<1&&(this.formData.model_payment.fee=1),(null===(e=this.formData.model_payment)||void 0===e?void 0:e.fee)>3&&(this.formData.model_payment.fee=3),this.formData.model_payment.fee=parseInt(null===(n=this.formData.model_payment)||void 0===n?void 0:n.fee)},show:function(t){var e=this;t.id?(this.formData={ver_name:"",base_model:"",model_ver_desc:"",allow_creation:1,trigger_words:[]},this.formData.bind_model_no=t.id,this.loraSteps=2):(this.formData={base_model:"",model_cover:{height:0,width:0,url:""},model_name:"",model_payment:{fee:0,way:1},model_permission:{allow_commercial_use:2,allow_download:2,allow_model_mix:2},model_tags:[],model_ver_desc:"",allow_creation:1,ver_name:"",trigger_words:[]},0==this.recommendList.length&&this.getTagRecommend()),t.base_model&&(this.formData.base_model=t.base_model),this.formData.train_no=t.no,t.trigger_words.forEach((function(t){t&&e.formData.trigger_words})),this.sample=t.cover,this.modelName=t.name,this.dialogVisible=!0},onPub:function(){var t=this;this.$refs.modelForm.validate((function(e){if(e){if(t.formData.model_tags&&t.formData.model_tags.forEach((function(e,n){"string"==typeof e&&(t.formData.model_tags[n]={title:e,id:e})})),t.loading)return;t.loading=!0,Object(m.d)(t.formData).then((function(e){1e4==e.status.code&&(t.$message.success(t.$t("PulishSuccess")),t.dialogVisible=!1,t.$emit("pubSucs"))})).finally((function(){t.loading=!1}))}}))},setIntRmdTag:function(t){var e,n=this;t&&(this.recommendList=[].concat(Object(r.a)(this.intRmdTag),Object(r.a)(null===(e=this.formData)||void 0===e?void 0:e.model_tags.filter((function(t){return!n.intRmdTag.find((function(e){return e.title===t.title}))})))))},getTagRecommend:function(){var t=this;Object(f.h)({size:1e3}).then((function(e){var n;1e4===e.status.code&&(t.intRmdTag=null==e||null===(n=e.data)||void 0===n?void 0:n.items,t.setIntRmdTag(!0))}))},remoteMethod:function(t){var e=this;t&&Object(h.d)({prefix:t,except_num:20,source_type:3}).then((function(t){var n;1e4==t.status.code&&(e.recommendList=[],null==t||null===(n=t.data)||void 0===n||n.items.forEach((function(t){e.recommendList.push({title:t.title,id:t.title})})))}))}}},x=(n(4914),n(4915),n(0)),component=Object(x.a)(w,(function(){var t,e,o=this,r=o._self._c;return r("el-dialog",{attrs:{visible:o.dialogVisible,"custom-class":"trainDialog",fullscreen:!0},on:{"update:visible":function(t){o.dialogVisible=t}}},[r("div",{staticClass:"LoraPub"},[r("div",{staticClass:"model-edit"},[r("i",{staticClass:"el-icon-error",on:{click:function(t){o.dialogVisible=!1}}}),o._v(" "),r("div",{staticClass:"form-title"},[o._v("\n        "+o._s(1==o.loraSteps?o.$t("LORAEdit"):o.$t("Versions")+o.$t("Edit"))+"\n        "),o.formData.bind_model_no?r("div",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],staticClass:"btn-group"},[r("el-button",{staticClass:"save-btn",attrs:{type:"primary"},on:{click:o.onPub}},[o._v("\n            "+o._s(o.$t("Publish"))+"\n          ")])],1):r("div",{staticClass:"btn-group"},[2==o.loraSteps?r("el-button",{staticClass:"cancel-btn",on:{click:function(t){o.loraSteps=1}}},[o._v("\n            "+o._s(o.$t("PreNext"))+"\n          ")]):o._e(),o._v(" "),1==o.loraSteps?r("el-button",{staticClass:"save-btn",attrs:{type:"primary"},on:{click:o.onNext}},[o._v("\n            "+o._s(o.$t("NextStep"))+"\n          ")]):o._e(),o._v(" "),2==o.loraSteps?r("el-button",{staticClass:"save-btn",attrs:{type:"primary"},on:{click:o.onPub}},[o._v("\n            "+o._s(o.$t("Publish"))+"\n          ")]):o._e()],1)]),o._v(" "),o.dialogVisible?r("div",{staticClass:"edit-form",attrs:{id:"editModelForm"}},[r("el-form",{ref:"modelForm",staticClass:"custom-form",attrs:{"label-position":"top",model:o.formData,rules:o.newRules}},[o.formData.bind_model_no?o._e():r("div",{directives:[{name:"show",rawName:"v-show",value:1==o.loraSteps,expression:"loraSteps == 1"}],staticClass:"formBox"},[r("div",{staticClass:"formCnt"},[r("el-form-item",{attrs:{label:o.$t("LORAName"),required:"",prop:"model_name"}},[r("el-input",{attrs:{placeholder:o.$t("PleaseEnterLORAName"),maxlength:100},model:{value:o.formData.model_name,callback:function(t){o.$set(o.formData,"model_name",t)},expression:"formData.model_name"}})],1),o._v(" "),r("el-form-item",{attrs:{label:o.$t("Type")}},[r("div",{staticClass:"type-select"},[r("span",{class:{active:!1}},[o._v(" CheckPoint ")]),o._v(" "),r("span",{class:{active:!0}},[o._v("LoRA")])])]),o._v(" "),r("el-form-item",[r("template",{slot:"label"},[o._v("\n                  "+o._s(o.$t("SetTags"))+"\n                ")]),o._v(" "),r("el-select",{staticClass:"show-tag",attrs:{"value-key":"title",multiple:"",filterable:"",remote:"","allow-create":"","popper-class":"show-tag-select","default-first-option":"",placeholder:o.$t("pleaseEnte"),"remote-method":o.remoteMethod},on:{"visible-change":o.setIntRmdTag},model:{value:o.formData.model_tags,callback:function(t){o.$set(o.formData,"model_tags",t)},expression:"formData.model_tags"}},o._l(o.recommendList,(function(t,e){return r("el-option",{key:"tag_".concat(t.id+e),attrs:{label:t.title,value:t}})})),1)],2),o._v(" "),r("el-form-item",{attrs:{label:o.$t("LORASources")}},[r("el-radio-group",{attrs:{disabled:!0},model:{value:o.sources,callback:function(t){o.sources=t},expression:"sources"}},[r("el-radio",{attrs:{label:"Original"}},[o._v(o._s(o.$t("Original")))]),o._v(" "),r("el-radio",{attrs:{label:"Reship"}},[o._v(o._s(o.$t("Reship")))])],1)],1),o._v(" "),r("el-form-item",{attrs:{prop:"cover"}},[r("template",{slot:"label"},[o._v("\n                  "+o._s(o.$t("LORACover"))+"\n                  "),r("p",{staticClass:"form-item-tips"},[o._v("\n                    "+o._s(o.$t("modelCoverDesc",{modelCover:o.$t("LORACover")}))+"\n                  ")])]),o._v(" "),r("SingleImageUpload",{on:{upload:function(t){return o.updateCover(t)}}})],2)],1),o._v(" "),r("div",{staticClass:"formCnt"},[r("el-form-item",{attrs:{label:o.$t("ModelPayment")}},[r("div",{staticClass:"type-select model-payment"},[r("span",{class:{active:!1===o.is_agency_fee},on:{click:function(t){o.is_agency_fee=!1}}},[o._v("\n                    "+o._s(o.$t("Free"))+"\n                  ")]),o._v(" "),r("span",{class:{active:!0===o.is_agency_fee},on:{click:function(t){o.is_agency_fee=!0}}},[o._v("\n                    "+o._s(o.$t("ModelEditPay"))+"\n                  ")])]),o._v(" "),!0===o.is_agency_fee?r("div",{staticClass:"payBox"},[r("div",{staticClass:"payCnt"},[r("div",{staticClass:"payTit"},[o._v(o._s(o.$t("paymentMethod")))]),o._v(" "),r("el-select",{attrs:{"popper-class":"payType"},model:{value:o.formData.model_payment.way,callback:function(t){o.$set(o.formData.model_payment,"way",t)},expression:"formData.model_payment.way"}},o._l(o.selectArgumentList,(function(t){return r("el-option",{key:t.label,attrs:{label:o.$t(t.label),value:t.value,disabled:t.disabled}})})),1)],1),o._v(" "),r("div",{staticClass:"payCnt"},[r("div",{staticClass:"payTit"},[o._v(o._s(o.$t("paymentAmount")))]),o._v(" "),r("div",{staticClass:"inputBox"},[r("input",{directives:[{name:"model",rawName:"v-model.number",value:o.formData.model_payment.fee,expression:"formData.model_payment.fee",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:o.formData.model_payment.fee},on:{blur:[function(t){return o.setPayNum()},function(t){return o.$forceUpdate()}],input:function(t){t.target.composing||o.$set(o.formData.model_payment,"fee",o._n(t.target.value))}}}),o._v(" "),1==(null===(t=o.formData.model_payment)||void 0===t?void 0:t.way)?r("img",{attrs:{src:n(169),alt:""}}):o._e(),o._v(" "),2==(null===(e=o.formData.model_payment)||void 0===e?void 0:e.way)?r("img",{attrs:{src:n(1044),alt:""}}):o._e()])])]):o._e()]),o._v(" "),r("el-form-item",[r("template",{slot:"label"},[o._v("\n                  "+o._s(o.$t("ModelPermissions"))+"\n                  "),r("span",{staticClass:"item-tips"},[o._v("("+o._s(o.$t("MultipleChoice"))+")")])]),o._v(" "),r("div",{staticClass:"checkbox-container"},[r("el-checkbox",{model:{value:o.checkboxDownload,callback:function(t){o.checkboxDownload=t},expression:"checkboxDownload"}},[o._v("\n                    "+o._s(o.$t("IsModelDownload"))+"\n                  ")])],1),o._v(" "),r("div",{staticClass:"checkbox-container"},[r("el-checkbox",{model:{value:o.checkboxCommercial,callback:function(t){o.checkboxCommercial=t},expression:"checkboxCommercial"}},[o._v("\n                    "+o._s(o.$t("IsCommercialUse"))+"\n                  ")])],1),o._v(" "),r("div",{staticClass:"checkbox-container"},[r("el-checkbox",{model:{value:o.checkboxMix,callback:function(t){o.checkboxMix=t},expression:"checkboxMix"}},[o._v("\n                    "+o._s(o.$t("IsModelMerging"))+"\n                  ")])],1)],2)],1)]),o._v(" "),2==o.loraSteps?r("div",{staticClass:"formBox"},[r("div",{staticClass:"formCnt"},[r("el-form-item",{attrs:{label:o.$t("Versions")+o.$t("trainName"),required:"",prop:"ver_name"}},[r("div",{staticClass:"VnAddBox"},[r("el-input",{attrs:{value:o.formData.model_name||o.modelName,maxlength:100,disabled:""}}),o._v(" "),r("el-input",{attrs:{placeholder:o.$t("pleaseEnte"),maxlength:10},model:{value:o.formData.ver_name,callback:function(t){o.$set(o.formData,"ver_name",t)},expression:"formData.ver_name"}})],1)]),o._v(" "),r("el-form-item",{attrs:{label:o.$t("BaseModel"),prop:"base_model"}},[r("el-select",{attrs:{"popper-class":"custom-select"},model:{value:o.formData.base_model,callback:function(t){o.$set(o.formData,"base_model",t)},expression:"formData.base_model"}},o._l(o.SDList,(function(t,e){return r("el-option",{key:"SD_"+e,attrs:{label:t,value:t}})})),1)],1),o._v(" "),r("el-form-item",[r("div",{staticClass:"isCommunityBox"},[r("span",[o._v(o._s(o.$t("sameModel")))]),o._v(" "),r("el-switch",{on:{change:o.commChange},model:{value:o.isCommunity,callback:function(t){o.isCommunity=t},expression:"isCommunity"}})],1)]),o._v(" "),r("el-form-item",[r("div",{staticClass:"sample"},[r("div",[o._v(o._s(o.$t("Versions")+o.$t("Work")))]),o._v(" "),r("img",{attrs:{src:o.sample,alt:""}})])])],1),o._v(" "),r("div",{staticClass:"formCnt"},[r("el-form-item",{attrs:{prop:"trigger_words"}},[r("template",{slot:"label"},[o._v("\n                  "+o._s(o.$t("TriggerWords"))+"\n                ")]),o._v(" "),r("el-select",{attrs:{multiple:"",filterable:"","popper-class":"custom-select","allow-create":"","default-first-option":"",placeholder:o.$t("pleaseEnte")},model:{value:o.formData.trigger_words,callback:function(t){o.$set(o.formData,"trigger_words",t)},expression:"formData.trigger_words"}},o._l([],(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],2),o._v(" "),r("el-form-item",{attrs:{label:o.$t("verIntroduction"),prop:"desc"}},[r("el-input",{attrs:{placeholder:o.$t("pleaseEnte"),maxlength:1e4,"show-word-limit":"",type:"textarea"},model:{value:o.formData.model_ver_desc,callback:function(t){o.$set(o.formData,"model_ver_desc",t)},expression:"formData.model_ver_desc"}})],1)],1)]):o._e()])],1):o._e()])])])}),[],!1,null,"ed068002",null),k=component.exports;function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function $(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}installComponents(component,{SingleImageUpload:n(571).default});var T={props:{trainTypeTxt:{type:String,default:"LoRA"}},data:function(){return{loraData:{},formData:{model_type:"Lora",order_by:"new",page:1,page_size:60,type:"user_original",time_to:0},list:[],dialogVisible:!1,noMoreData:!1,loading:!1}},components:{LoraPub:k},watch:{dialogVisible:{handler:function(t){t?0==this.list.length&&this.getList():(this.noMoreData=!1,this.formData.page=0,this.list=[])}}},methods:{show:function(t,e,n){this.loraData=t,e&&(this.loraData.trigger_words=e),n&&(this.loraData.base_model=n),this.dialogVisible=!0},openPub:function(t){var e=$($({},t),this.loraData);if(this.dialogVisible=!1,e.id)this.$router.push({path:this.localePath("/modelEditStep"),query:{id:e.id,verId:e.no,verNo:e.model_ver_no,train:"yes",base_model:this.loraData.base_model}});else{var n={verId:e.no,verNo:e.model_ver_no,train:"yes",base_model:this.loraData.base_model,modelType:this.trainTypeTxt};this.$router.push({path:this.localePath("/modelEditStep"),query:n})}},getList:function(){var t=this;if(!this.loading&&!this.noMoreData){this.loading=!0;this.formData.model_type={LoRA:"Lora",DoRA:"Dora",LyCORIS:"LoCon"}[this.trainTypeTxt],Object(d.s)(this.formData).then((function(e){var n;1e4==e.status.code&&((n=t.list).push.apply(n,Object(r.a)(e.data.items)),t.formData.page++,t.formData.time_to=e.data.time_ms,e.data.has_more||(t.noMoreData=!0))})).finally((function(){t.loading=!1}))}},checkLoadMore:function(){var t=this.$refs.list,e=t.scrollTop,n=t.scrollHeight;e+t.clientHeight>=n-300&&this.getList()}}},O=(n(4917),Object(x.a)(T,(function(){var t=this,e=t._self._c;return e("div",[e("el-dialog",{attrs:{title:t.$t("releaseName"),visible:t.dialogVisible,width:"885px",top:"10vh","custom-class":"trainDialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"list",staticClass:"LoraDialogList",on:{scroll:t.checkLoadMore}},[e("div",{staticClass:"listItem",on:{click:t.openPub}},[e("div",{staticClass:"tipCnt"},[e("i",{staticClass:"iconfont icon-xinjianLoRA"}),t._v(" "),e("span",[t._v(t._s(t.$t("workFlow15"))+t._s(t.trainTypeTxt))])])]),t._v(" "),t._l(t.list,(function(n,o){var r;return e("div",{key:"list"+o,staticClass:"listItem",on:{click:function(e){return t.openPub(n)}}},[e("img",{attrs:{src:null===(r=n.banner)||void 0===r?void 0:r.url,alt:""}}),t._v(" "),e("div",{staticClass:"name"},[t._v(t._s(n.name))]),t._v(" "),e("div",{staticClass:"itemHover"},[e("div",{staticClass:"tipCnt"},[e("i",{staticClass:"iconfont icon-tianjiabanbenhao"}),t._v(" "),e("span",[t._v(t._s(t.$t("pubLora2")))])])])])}))],2)]),t._v(" "),e("LoraPub",{ref:"LoraPub",on:{pubSucs:function(e){return t.$emit("pubSucs")}}})],1)}),[],!1,null,"15ab1345",null).exports),I=n(914),S=n(4918);function L(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?L(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E={components:{imgDet:c.a,LoraDialogList:O,TarinAdvSet:I.a},computed:j(j({},Object(v.c)("payment",["paymentInfo"])),{},{trainOk:function(){return 3==this.trainStatus},reverseList:function(){return Object(r.a)(this.loraList).filter((function(t){return t.cover}))},percentSteps:function(){return parseInt(this.progData.cur_steps/this.progData.steps*100)+"%"},isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},checkeAll:function(){return this.checkList.length==this.loraList.length&&3==this.trainStatus},currentVipLevel:function(){var t=["Member","ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][this.paymentInfo.productLevel]||"",e="basic";return t&&(["Member","ToB_beginnerPlan","StandardPlan"].includes(t)&&(e="professional"),["ToB_professionalPlan"].includes(t)&&(e="master")),e},isShowVipTip:function(){var t=["Member","ToB_beginnerPlan","StandardPlan","ToB_professionalPlan","MasterPlan"][this.paymentInfo.productLevel]||"";return t&&"MasterPlan"!==t},trainTypeTxt:function(){return this.intMeta&&this.intMeta.train_model_network_module&&{lora:"LoRA",dora:"DoRA",locon:"LyCORIS"}[this.intMeta.train_model_network_module]||"LoRA"}}),data:function(){var t=this;return{openChart:!1,checkList:[],loraList:[],loraCharts:[],trainStatus:-1,pageLoading:!0,progTimes:null,progData:{},stopLoading:!1,saveLoading:!1,downLoading:!1,intChart:null,hashrate:0,prompt:"",triggerWords:"",dataSetNo:"",intMeta:{},baseModel:"",DSType:0,chartOption:{grid:{show:!0,left:"3%",right:"4%",bottom:"3%",containLabel:!0,backgroundColor:"rgba(0,0,0,0)"},title:{text:"loss/average",textStyle:{color:"#ffffff"}},tooltip:{trigger:"axis",formatter:function(e){var n=e[0].name,o=e[0].dataIndex,r=e[0].value;return t.trainTypeTxt+(o+1)+": Step: "+n+", loss: "+r}},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{name:"loss",data:[],type:"line",smooth:!0}]}}},mounted:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.$route)&&void 0!==n&&null!==(n=n.query)&&void 0!==n&&n.id){e.next=3;break}return t.errBack(),e.abrupt("return");case 3:t.getDet();case 4:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){clearTimeout(this.progTimes)},methods:{handleOpenVip:function(){this.$logEvent("log_actions",{operation:"click_upgrade",behavior_info:"on_model_train_page"});var t;t="professional"===this.currentVipLevel?"NoExpireTimeTipWeb1":"NoExpireTimeTipWeb2";var e=this.currentVipLevel;this.$EventBus.$emit("showBreakDialog",t,e)},onDownLoad:function(){var t=this;0!=this.checkList.length&&(this.downLoading||(this.downLoading=!0,Object(m.e)({train_result_no:this.checkList[0].no}).then((function(t){1e4==t.status.code&&window.open(t.data.url,"_blank")})).finally((function(){t.downLoading=!1})),this.$logEvent("log_actions",{operation:"click_download_train_lora",behavior_info:"ton_training_detail_page",behavior_info_sub:this.checkList[0].no})))},opTrainPage:function(t){var path="/loraTrainingEdit";t?this.$logEvent("log_actions",{operation:"click_new_train",behavior_info:"on_train_result_page",behavior_info_sub:"train_model_result_no"}):(path=this.localePath("/loraTrainingEdit?id=".concat(this.dataSetNo,"&DSType=").concat(this.DSType)),this.$logEvent("log_actions",{operation:"click_retrain",behavior_info:"on_train_result_page",behavior_info_sub:"train_model_result_no"})),window.open(path,"_blank")},loraSave:function(){var t=this;if(0!=this.checkList.length)if(this.checkList[0].is_saved)this.$message(this.$t("newTrainDet13"));else if(!this.saveLoading){this.saveLoading=!0;var e={train_result_nos:[this.checkList[0].no]};Object(m.j)(e).then((function(e){1e4==e.status.code&&(t.$message(t.$t("newTrainDet15")),t.loraList.forEach((function(n,i){t.checkList[0].no==n.no&&(t.$set(t.loraList[i],"is_saved",!0),t.$set(t.loraList[i],"result",{model_no:e.data.model_nos[0]}))})),t.checkList=[],t.loraList.forEach((function(e,n){t.$set(t.loraList[n],"isCheck",!1)})))})).finally((function(){t.saveLoading=!1})),this.$logEvent("log_actions",{operation:"click_release_train_lora",behavior_info:"ton_training_detail_page",behavior_info_sub:this.checkList[0].no})}},loraPublish:function(){var t,e;0!=this.checkList.length?this.checkList[0].is_saved?null!==(t=this.checkList[0].result)&&void 0!==t&&t.model_no?this.$router.push(this.localePath("/models/detail/".concat(null===(e=this.checkList[0].result)||void 0===e?void 0:e.model_no))):this.$message(this.$t("newTrainDet13")):this.$refs.LoraDialogList.show(this.checkList[0],this.triggerWords,this.baseModel):this.$message(this.$t("newTrainDet14"))},pubSucs:function(t){var e=this;this.loraList.forEach((function(t,n){t.isCheck&&e.$set(e.loraList[n],"is_saved",!0)}))},onCheckeAll:function(){var t=this,e=!1;this.checkList.length<this.loraList.length?(this.checkList=JSON.parse(JSON.stringify(this.loraList)),e=!0):this.checkList=[],this.loraList.forEach((function(n,o){t.$set(t.loraList[o],"isCheck",e)})),console.log(this.checkList)},carouselChange:function(t){console.log(t,"index"),this.checkSelect(t)},checkSelect:function(t){var e=this;if(0!=this.loraList.length){if(this.loraList.forEach((function(n,o){o!=t&&e.$set(e.loraList[o],"isCheck",!1)})),this.checkList=[this.loraList[t]],this.$set(this.loraList[t],"isCheck",!0),this.loraList[t].isCheck&&this.loraList[t].cover&&this.$refs.loraCarousel){var n=this.reverseList.findIndex((function(n){return n.no===e.loraList[t].no}));-1!==n&&this.$refs.loraCarousel.setActiveItem(n)}console.log(this.checkList,this.$refs.loraCarousel,"checkList")}},openChartChange:function(){var t=this;this.openChart&&this.$refs.chartBox&&this.$nextTick(Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.intChart){e.next=6;break}return console.log(t.$refs.chartBox),e.next=4,Object(S.a)();case 4:n=e.sent,t.intChart=n.init(t.$refs.chartBox);case 6:t.chartOption.xAxis.data=[],t.chartOption.series[0].data=[],t.loraCharts&&t.loraCharts.length>0&&t.loraCharts.forEach((function(e){t.chartOption.xAxis.data.push(e.step),t.chartOption.series[0].data.push(e.loss)})),t.intChart.setOption(t.chartOption);case 10:case"end":return e.stop()}}),e)}))))},formatTime:function(t){var e=Math.floor(t/3600),n=Math.floor(t%3600/60),o=t%60;return this.pad(e)+":"+this.pad(n)+":"+this.pad(o)},pad:function(t){return t<10?"0"+t:t},opStop:function(){var t;this.stopLoading||(this.stopLoading=!0,Object(m.k)({train_model_no:null===(t=this.$route)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.id}).then((function(t){t.status.code})).finally((function(){})),this.$logEvent("log_actions",{operation:"click_stop_training",behavior_info:"ton_training_detail_page"}))},getDet:function(){var t,e=this;Object(m.g)({train_model_no:null===(t=this.$route)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.id}).then((function(t){var n,o;1e4==t.status.code&&(e.trainStatus=t.data.status,e.prompt=t.data.prompt,t.data.meta&&(e.intMeta=t.data.meta),e.DSType=t.data.train_task_type||0,e.loraCharts=(null===(n=t.data)||void 0===n?void 0:n.loss_charts)||[],e.openChartChange(),e.dataSetNo=t.data.data_set_no,3==e.trainStatus?(e.loraList=(null===(o=t.data)||void 0===o?void 0:o.loras)||[],e.loraList.forEach((function(t,n){e.$set(e.loraList[n],"isCheck",!1),e.$set(e.loraList[n],"curProcess",0)})),e.hashrate=t.data.hashrate,e.triggerWords=t.data.trigger_words,e.baseModel=t.data.base_model,e.pageLoading=!1,e.stopLoading=!1,e.$nextTick((function(){e.checkSelect(0)}))):1==e.trainStatus||2==e.trainStatus?e.progTimes||e.getTrainModelProgress():(e.pageLoading=!1,e.errBack()))})).catch((function(){e.pageLoading=!1}))},getTrainModelProgress:function(){var t,e=this;clearTimeout(this.progTimes),Object(d.F)({ids:[null===(t=this.$route)||void 0===t||null===(t=t.query)||void 0===t?void 0:t.id]}).then((function(t){if(1e4==t.status.code){if(e.progData=t.data.items[0],e.trainStatus=e.progData.state,0==e.loraList.length)for(var i=1;i<=e.progData.epoch;i++)e.loraList.push({resultNo:""});e.progData.result_nos&&e.progData.result_nos.forEach((function(t,n){e.loraList[n]&&!e.loraList[n].no&&(e.loraList[n].resultNo=t)}));var n=!1;if(e.loraList.forEach((function(t,o){t.resultNo&&(n=!0,Object(m.i)({train_result_no:t.resultNo}).then((function(t){if(1e4==t.status.code){var n=j({},t.data);n.isCheck=!1,e.$set(e.loraList,o,n)}})))})),n&&e.getDet(),e.progData.estimate_hashrate&&(e.hashrate=e.progData.estimate_hashrate),e.loraList[e.progData.cur_epoch-1])e.progData.cur_process&&e.$set(e.loraList[e.progData.cur_epoch-1],"curProcess",e.progData.cur_process),e.$refs.listItem[e.progData.cur_epoch-1].scrollIntoView({behavior:"smooth",block:"center"});1==e.trainStatus||2==e.trainStatus?e.progTimes=setTimeout((function(){e.getTrainModelProgress()}),1e4):3==e.trainStatus?(clearTimeout(e.progTimes),e.getDet()):4!=e.trainStatus&&5!=e.trainStatus||(clearTimeout(e.progTimes),e.$alert(e.$t("trainModelErrorTip"),e.$t("Tip"),Object(l.a)({confirmButtonText:e.$t("Confirm"),callback:function(t){}},"callback",(function(t){}))))}else e.progTimes=setTimeout((function(){e.getTrainModelProgress()}),1e4)})).catch((function(){e.progTimes=setTimeout((function(){e.getTrainModelProgress()}),1e4)})).finally((function(){e.pageLoading=!1}))},errBack:function(){clearTimeout(this.progTimes),this.$alert(this.$t("newTrainDet2"),this.$t("Tip"),Object(l.a)({confirmButtonText:this.$t("Confirm"),callback:function(t){}},"callback",(function(t){})))}}},P=(n(4919),n(4920),Object(x.a)(E,(function(){var t,e,o,r,l=this,c=l._self._c;return c("div",{staticClass:"loraTrainingDet",attrs:{"data-group":"Training_Detail"}},[c("div",{staticClass:"main"},[c("div",{staticClass:"left"},[-1!==l.trainStatus?c("div",{staticClass:"progBox"},[c("div",{staticClass:"progTxt"},["waiting"===l.progData.state_desc?["waiting_push"===l.progData.state_sub_desc?[c("div",{staticClass:"progTxt-2"},[l._v(l._s(l.$t("waiteLoading")))])]:l._e(),l._v(" "),"waiting_train"===l.progData.state_sub_desc?[l.progData.queue_position?c("div",{staticClass:"progTxt-2"},[l._v("\n                "+l._s(l.$t("upgradeLoading",{current:null===(t=l.progData)||void 0===t?void 0:t.queue_position,total:null===(e=l.progData)||void 0===e?void 0:e.queue_total}))+"\n              ")]):l._e(),l._v(" "),l.isShowVipTip?c("div",{staticClass:"update-tips",on:{click:l.handleOpenVip}},[c("img",{attrs:{src:n(375),alt:"seaArtVip"}}),l._v(" "),c("p",[l._v(l._s(l.$t("upgrade")))])]):l._e()]:l._e()]:[c("div",[l._v("\n              "+l._s(2===l.trainStatus?l.$t("TrainingIng"):4===l.trainStatus||5===l.trainStatus?l.$t("newTrainDet2"):l.$t("Completed"))+"\n            ")]),l._v(" "),2===l.trainStatus?[c("span",[l._v(l._s(l.$t("newTrainDet1")))]),l._v(" "),l.progData.id?c("span",[l._v(l._s(l.formatTime(l.progData.time_left)))]):l._e()]:l._e()]],2),l._v(" "),2===l.trainStatus&&l.progData.id?c("div",{staticClass:"progBar"},[c("div",{staticClass:"progItem",style:{width:l.progData.process+"%"}}),l._v(" "),c("div",{staticClass:"progBarInfo"},[l._v("\n            "+l._s("steps: ".concat(l.progData.cur_steps,"/").concat(l.progData.steps," (").concat(l.percentSteps,")   loss : ").concat(l.progData.loss,"  epoch: ").concat(l.progData.cur_epoch,"/").concat(l.progData.epoch))+"\n          ")])]):l._e()]):l._e(),l._v(" "),c("div",{staticClass:"trainDet"},[c("div",{staticClass:"detTop"},[l.progData.id?c("div",{staticClass:"detTopLeft"},[c("span",[l._v(l._s(l.trainTypeTxt))]),l._v(" "),c("span",[l._v(l._s("".concat(l.progData.cur_epoch,"/").concat(l.progData.epoch)))])]):c("div"),l._v(" "),c("div",{staticClass:"detTopRight"},[c("div",{staticClass:"topItem",staticStyle:{cursor:"pointer"},on:{click:function(t){return l.$refs.advset.show()}}},[c("i",{staticClass:"iconfont icon-eye"}),l._v(" "),c("span",[l._v(l._s(l.$t("trainParamete")))])]),l._v(" "),c("div",{staticClass:"topLine"}),l._v(" "),c("div",{staticClass:"topItem"},[c("span",[l._v(l._s(l.$t("newTrainDet3")))]),l._v(" "),c("el-switch",{on:{change:l.openChartChange},model:{value:l.openChart,callback:function(t){l.openChart=t},expression:"openChart"}})],1)])]),l._v(" "),c("div",{staticClass:"detCnt"},[c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.pageLoading,expression:"pageLoading"},{name:"show",rawName:"v-show",value:!l.openChart,expression:"!openChart"}],staticClass:"detList"},l._l(l.loraList,(function(t,e){return c("div",{key:"imgs"+e,ref:"listItem",refInFor:!0,staticClass:"listItem"},[t.cover?c("div",{staticClass:"loraBox",on:{click:function(t){return l.checkSelect(e)}}},[c("img",{attrs:{src:t.cover,alt:""}}),l._v(" "),c("div",{staticClass:"loraCheck"},[c("el-checkbox",{model:{value:t.isCheck,callback:function(e){l.$set(t,"isCheck",e)},expression:"item.isCheck"}})],1),l._v(" "),c("div",{staticClass:"loraNmae"},[l._v(l._s(l.trainTypeTxt)+" "+l._s(t.num))]),l._v(" "),c("div",{staticClass:"loraZG"})]):c("div",{staticClass:"listProgBox"},[c("div",{staticClass:"listProg"},[c("div",{staticClass:"progLine"}),l._v(" "),c("el-progress",{attrs:{type:"circle",percentage:t.curProcess,width:52,"stroke-width":2,"text-color":"#FFFFFF","define-back-color":"rgba(155, 155, 155, 0)"}})],1)])])})),0),l._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:l.openChart,expression:"openChart"}]},[c("div",{ref:"chartBox",staticClass:"chartBox"}),l._v(" "),c("div",{staticClass:"minLoraList"},l._l(l.loraList,(function(t,e){return c("div",{key:"imgs"+e,staticClass:"minLoraItem",class:{minLoraItemActivate:t.isCheck},on:{click:function(t){return l.checkSelect(e)}}},[l._m(0,!0),l._v(" "),c("span",[l._v(l._s(l.trainTypeTxt)+" "+l._s(t.num))])])})),0)])]),l._v(" "),c("div",{directives:[{name:"show",rawName:"v-show",value:l.isVip,expression:"isVip"}],staticClass:"detBottom",style:{opacity:l.trainOk?1:.5}},[l.trainOk?l._e():c("div",{staticClass:"detBottomZg"}),l._v(" "),c("div",{staticClass:"detBottomLeft"}),l._v(" "),c("div",{staticClass:"detBottomRight"},[c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.downLoading,expression:"downLoading"}],staticClass:"detBottomBtn",style:{opacity:0==l.checkList.length?.5:1},attrs:{"data-event":"ai_model_training_detail_download","data-id":null===(o=l.checkList[0])||void 0===o?void 0:o.no},on:{click:l.onDownLoad}},[c("i",{staticClass:"iconfont icon-icon_xiazai"}),l._v(" "),c("span",[l._v(l._s(l.$t("Download")))])]),l._v(" "),c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.saveLoading,expression:"saveLoading"}],staticClass:"detBottomBtn",style:{opacity:0==l.checkList.length?.5:1},attrs:{"data-event":"ai_model_training_detail_save","data-id":null===(r=l.checkList[0])||void 0===r?void 0:r.no},on:{click:l.loraSave}},[c("i",{staticClass:"iconfont icon-baocun"}),l._v(" "),c("span",[l._v(l._s(l.$t("Save")))])])])])])]),l._v(" "),c("div",{staticClass:"right"},[c("div",{staticClass:"rifhtTop"},[c("div",{staticClass:"rifhtTopBtn",attrs:{slot:"reference"},slot:"reference"},[c("span",[l._v(l._s("".concat(l.$t("newTrainDet4"),": ").concat(l.hashrate)))])]),l._v(" "),1==l.trainStatus||2==l.trainStatus?c("div",{directives:[{name:"loading",rawName:"v-loading",value:l.stopLoading,expression:"stopLoading"}],staticClass:"rifhtTopBtn",attrs:{"data-event":"ai_model_training_detail_stop","data-desc":"模型训练停止"},on:{click:l.opStop}},[l._v("\n          "+l._s(l.stopLoading?l.$t("newTrainDet7"):l.$t("newTrainDet6"))+"\n        ")]):l._e()]),l._v(" "),c("div",{staticClass:"imgDet"},[c("div",[c("div",{staticClass:"imgDetTop"},[l._v(l._s(l.$t("newTrainDet8")))]),l._v(" "),l.reverseList.length>0?c("div",{staticClass:"imgInfo"},[c("el-carousel",{ref:"loraCarousel",attrs:{"indicator-position":"outside",autoplay:!1,trigger:"click"},on:{change:l.carouselChange}},l._l(l.reverseList,(function(t,e){return c("el-carousel-item",{key:t.cover+","+e},[c("div",{staticClass:"imgCnt"},[0===t.train_model_material_type?c("img",{attrs:{src:t.cover,alt:""},on:{click:function(t){return l.$refs.imgDet.show(e)}}}):l._e(),l._v(" "),1===t.train_model_material_type?c("video",{attrs:{src:t.video_url,controls:"",muted:"",alt:""},domProps:{muted:!0},on:{click:function(t){return l.$refs.imgDet.show(e)}}}):l._e(),l._v(" "),c("div",{staticClass:"imgTips"},[c("div",[l._v(l._s("".concat(l.trainTypeTxt," ").concat(t.num," step: ").concat(t.step," loss: ").concat(t.loss)))]),l._v(" "),c("div",[l._v(l._s(l.prompt))])])])])})),1)],1):c("div",{staticClass:"imgDef"},[c("img",{attrs:{src:n(1524),alt:""}}),l._v(" "),c("span",[l._v(l._s(2==l.trainStatus?l.$t("newTrainDet10"):l.$t("newTrainDet9")))])])]),l._v(" "),c("div",{staticClass:"btnBox"},[c("el-button",{staticClass:"onPub",style:{opacity:l.trainOk?1:.5},attrs:{disabled:!l.trainOk,"data-event":"ai_model_training_detail_publish","data-desc":"模型训练发布"},on:{click:l.loraPublish}},[l._v(l._s(l.$t("releaseName")))]),l._v(" "),1!=l.trainStatus&&2!=l.trainStatus?c("div",{staticClass:"btnItem"},[c("div",{attrs:{"data-event":"ai_model_training_detail_retrain","data-desc":"模型训练重训"},on:{click:function(t){return l.opTrainPage(!1)}}},[c("i",{staticClass:"iconfont icon-shuaxin1"}),l._v(" "),c("span",[l._v(l._s(l.$t("newTrainDet11")))])]),l._v(" "),c("div",{attrs:{"data-event":"ai_model_training_detail_new","data-desc":"模型训练新建"},on:{click:function(t){return l.opTrainPage(!0)}}},[c("i",{staticClass:"iconfont icon-xinjianLoRA"}),l._v(" "),c("span",[l._v(l._s(l.$t("newTrainDet12")))])])]):l._e()],1)])])]),l._v(" "),l.reverseList.length>0?c("imgDet",{ref:"imgDet",attrs:{isView:!0},model:{value:l.reverseList,callback:function(t){l.reverseList=t},expression:"reverseList"}}):l._e(),l._v(" "),c("LoraDialogList",{ref:"LoraDialogList",attrs:{trainTypeTxt:l.trainTypeTxt},on:{pubSucs:l.pubSucs}}),l._v(" "),c("TarinAdvSet",{ref:"advset",attrs:{isView:!0,DSType:l.DSType},model:{value:l.intMeta,callback:function(t){l.intMeta=t},expression:"intMeta"}})],1)}),[function(){var t=this._self._c;return t("div",[t("i",{staticClass:"el-icon-check"})])}],!1,null,"48b35640",null));e.default=P.exports},5761:function(t,e,n){"use strict";n.r(e);var o=n(30),r=n(3),l=(n(20),n(4),n(40),n(41),n(613)),c=n(430),d={props:{bList:{type:Array,default:function(){return[]}}},data:function(){return{bannerList:this.bList||[]}},mounted:function(){},methods:{getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c.a)();case 3:n=e.sent,o=n.data.items,r=void 0===o?[]:o,t.bannerList=r;case 7:return e.prev=7,t.loading=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[0,,7,10]])})))()},goDetail:function(t){this.$router.push(this.localePath("/news/".concat(t.id)))}}},m=(n(5404),n(0)),v=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e("el-carousel",{attrs:{"indicator-position":"outside",height:"420px",arrow:"never"}},t._l(t.bannerList,(function(n){return e("el-carousel-item",{key:n.id},[e("a",{staticClass:"banner",attrs:{href:t.localePath("/news/".concat(n.seo_url))}},[e("div",{staticClass:"banner-left"},[e("img",{attrs:{src:n.cover,alt:n.title}})]),t._v(" "),e("div",{staticClass:"banner-right"},[e("span",{staticClass:"banner-right-top"},[t._v("\n          "+t._s(n.post_title)+"\n        ")]),t._v(" "),e("span",{staticClass:"banner-right-content"},[t._v("\n          "+t._s(n.meta_desc)+"\n        ")]),t._v(" "),e("div",{staticClass:"banner-right-bottom"},[e("div",[e("span",[t._v(t._s(n.author))])]),t._v(" "),e("div",[e("i",{staticClass:"el-icon-time"}),t._v(" "),e("span",[t._v(t._s(n.reading_duration)+" "+t._s(t.$t("blog_read")))])])])])])])})),1)}),[],!1,null,"66997318",null).exports,f={components:{SwipeableList:n(52).default},props:{bList:{type:Array,default:function(){return[]}},cList:{type:Array,default:function(){return[]}}},data:function(){return{blogList:this.bList||[],categroyList:this.cList||[],tagList:[{icon:"icon-icon_All_",label:"All",value:"all",i18nKey:"news_all"},{icon:"icon-a-icon_AIArtGuide_",label:"专家见解",value:"newsExpertInsights",i18nKey:"news_newsExpertInsights"},{icon:"icon-a-icon_AIVideoGuide_",label:"AI基础指南",value:"newsAIFundamentals",i18nKey:"news_newsAIFundamentals"},{icon:"icon-a-icon_TrainingGuide_",label:"行业动态",value:"newsIndustryTrends",i18nKey:"news_newsIndustryTrends"},{icon:"icon-icon_news_",label:"产品解读",value:"newsProductAnalysis",i18nKey:"news_newsProductAnalysis"},{icon:"icon-a-icon_AITools_",label:"技术分享",value:"newsTechnicalSharing",i18nKey:"news_newsTechnicalSharing"}],currentIndex:0,paramsData:{keyword:"",category:"",page:1,page_size:30,type:"aiNews"},loading:!1,itemScrollLeft:null}},watch:{"paramsData.keyword":{handler:function(t){t&&!this.loading&&this.getBlogList()}}},mounted:function(){},methods:{getList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c.b)({page:1,page_size:30,type:"aiNews"});case 3:n=e.sent,o=n.data.categories,r=void 0===o?[]:o,t.categroyList=r;case 7:return e.prev=7,t.loading=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[0,,7,10]])})))()},getBlogList:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,Object(c.c)(t.paramsData);case 4:n=e.sent,o=n.data.items,r=void 0===o?[]:o,t.blogList=r;case 8:return e.prev=8,t.loading=!1,e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,,8,11]])})))()},chooseTag:function(t,e){this.currentIndex=e,this.paramsData.category=t,this.getBlogList(),this.$logEvent("log_actions",{operation:"click_news_tab",behavior_info:"on_news_detail_page",behavior_info_sub:t})},goDetail:function(t){this.$router.push(this.localePath("/news/".concat(t.id)))},getAuthorName:function(t){return t?t.split("@")[0]:""}}},h=(n(5405),Object(m.a)(f,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"categroy"},[e("div",{staticClass:"categroy-title"},[e("div",{staticClass:"categroy-title-content"},[t._v("\n      "+t._s(t.$t("news_recent"))+"\n      "),e("el-input",{staticStyle:{width:"320px"},attrs:{placeholder:t.$t("Search"),"suffix-icon":"el-icon-search"},model:{value:t.paramsData.keyword,callback:function(e){t.$set(t.paramsData,"keyword",e)},expression:"paramsData.keyword"}})],1)]),t._v(" "),e("div",{staticClass:"tag-list"},[e("SwipeableList",{attrs:{top:"0px",height:"50px",bntTop:"0px",listAlignItems:"flex-end",listGap:"14px",scrollLeftnum:t.itemScrollLeft}},t._l(t.tagList,(function(n,o){return e("div",{key:n.value,staticClass:"tag-list-item",class:{active:t.currentIndex===o},on:{click:function(e){return t.chooseTag(n.value,o)}}},[e("i",{staticClass:"iconfont",class:t.currentIndex===o?"".concat(null==n?void 0:n.icon,"selected"):"".concat(null==n?void 0:n.icon,"default")}),t._v(" "),e("span",[t._v(t._s(t.$t("".concat(n.i18nKey))))])])})),0)],1),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"categroy-list"},t._l(t.blogList,(function(n,o){return e("a",{key:o,staticClass:"categroy-list-item",attrs:{href:t.localePath("/news/".concat(n.seo_url))}},[e("img",{staticClass:"categroy-list-item-img",attrs:{src:n.cover,alt:n.title}}),t._v(" "),e("span",{staticClass:"categroy-list-item-top"},[t._v("\n        "+t._s(t.$t("news_".concat(n.category)))+"\n      ")]),t._v(" "),e("span",{staticClass:"categroy-list-item-content"},[t._v("\n        "+t._s(n.post_title)+"\n      ")]),t._v(" "),e("div",{staticClass:"categroy-list-item-bottom"},[e("div",[e("span",[t._v(t._s(t.getAuthorName(n.author)))])]),t._v(" "),e("div",[e("i",{staticClass:"el-icon-time"}),t._v(" "),e("span",[t._v(t._s(n.reading_duration)+" "+t._s(t.$t("blog_read")))])])])])})),0),t._v(" "),0!==t.blogList.length||t.loading?t._e():e("div",{staticClass:"defBox"},[e("img",{attrs:{src:n(753),alt:""}}),t._v(" "),e("span",[t._v(t._s(t.$t("no_data")))])])])}),[],!1,null,"1049ba51",null)),_=h.exports;installComponents(h,{SwipeableList:n(52).default});var y={components:{BlogHeader:l.a,FeaturedPosts:v,RecentPosts:_},data:function(){return{blogList:[],categroyList:[],bannerList:[]}},methods:{},head:function(){var title=this.$t("news_tag_title"),desc=this.$t("news_tag_desc");return{title:title,meta:[{hid:"description",name:"description",content:desc},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:desc}]}},asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,l,c,d,data,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,t.params,r=t.error,e.prev=1,e.next=4,Promise.all([n.$post("/api/v1/blog/category",{page:1,page_size:100,type:"aiNews"}),n.$post("/api/v1/blog/home",{keyword:"",category:"",page:1,page_size:100,type:"aiNews"}),n.$post("/api/v1/blog/banner",{type:"aiNews"})]);case 4:return l=e.sent,c=Object(o.a)(l,3),d=c[0].data,data=c[1].data,m=c[2].data,e.abrupt("return",{categroyList:(null==d?void 0:d.categories)||[],blogList:(null==data?void 0:data.items)||[],bannerList:(null==m?void 0:m.items)||[]});case 12:e.prev=12,e.t0=e.catch(1),console.log("blog -> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))()}},C=(n(5406),Object(m.a)(y,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"blog"},[e("BlogHeader"),t._v(" "),e("div",{staticClass:"blog-title"},[e("span",{staticClass:"blog-title-content"},[t._v(t._s(t.$t("news_recommend_article")))])]),t._v(" "),e("FeaturedPosts",{attrs:{bList:t.bannerList}}),t._v(" "),e("RecentPosts",{attrs:{bList:t.blogList,cList:t.categroyList}})],1)}),[],!1,null,"0cec5e84",null));e.default=C.exports},5766:function(t,e,n){"use strict";n.r(e);var o=n(3),r=(n(20),n(6),n(4),n(28),n(671),n(92),n(56)),l=(n(19),n(152),n(7),n(26),n(153)),c={props:{},data:function(){return{dialogVisible:!1,link:"https://starunion.aihelp.net/questionnaire/#/?formId=bffe7a2307454e859f559913e28d4f19",repeatLinks:""}},computed:{repeatLinksHtml:function(){return this.$t("ImportModelFailed",{repeatLinks:this.repeatLinks})}},mounted:function(){},methods:{handleInitHelp:function(){window.SUHelpSupport?SUHelpSupport.show():Object(l.a)((function(){setTimeout((function(){SUHelpSupport.show()}),2e3)}))},open:function(t){var e=this;this.dialogVisible=!0,t.forEach((function(t,n){var o=n>0?"、":"";e.repeatLinks+="".concat(o,'<a class="text-blue" href="/models/detail/').concat(t.model_id,'" target="_blank">').concat(t.model_name,"</a>")})),this.$logEvent("log_actions",{operation:"go_to_claim_popup",behavior_info:"on_import_project_page"})},handleClose:function(t){this.dialogVisible=!1,this.repeatLinks=""},goLink:function(){window.open(this.link,"_blank"),this.handleClose(),this.$logEvent("log_actions",{operation:"click_go_to_claim",behavior_info:"on_import_project_page"})}}},d=(n(4897),n(4898),n(0)),component=Object(d.a)(c,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"repeat-model-pop",attrs:{title:t.$t("ImportModelTips"),visible:t.dialogVisible,"before-close":t.handleClose,width:"462px","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"dialog-text"},[e("span",{staticClass:"dialog-html",domProps:{innerHTML:t._s(t.repeatLinksHtml)}}),t._v(" "),e("span",{staticClass:"text-blue help",on:{click:function(e){return e.preventDefault(),t.handleInitHelp.apply(null,arguments)}}},[t._v(t._s(t.$t("Contact_customer")))])]),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:t.goLink}},[t._v("\n      "+t._s(t.$t("GoClaimModel"))+"\n    ")])],1)])}),[],!1,null,"b9b3b6b8",null),m={name:"ModelImport",components:{RepeatModelPop:component.exports},data:function(){return{form:{textarea:""},loading:!1,rules:{textarea:[{required:!0,message:this.$t("ImportModelRule"),trigger:"blur"}]}}},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},resetForm:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"form";this.$refs[t].resetFields()},submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return!1;e.submit()}))},submit:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,l,data,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.form.textarea.trim()){e.next=3;break}return e.abrupt("return");case 3:return t.loading=!0,o=t.form.textarea.split(/\r?\n/).filter((function(t){return""!=t})),e.next=7,Object(r.p)({urls:o});case 7:l=e.sent,data=l.data,1e4===(c=l.status).code?t.$message.success(t.$t("ImportModelSuccess")):30047===c.code&&null!=data&&null!==(n=data.exist_models)&&void 0!==n&&n.length&&t.$refs.repeatModelPop.open(data.exist_models),t.$logEvent("log_actions",{operation:"click_submit",behavior_info:"on_import_project_page"}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),t.loading=!1;case 17:return e.prev=17,t.loading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[0,14,17,20]])})))()}}},v=m,f=(n(4899),Object(d.a)(v,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"model-import-content"},[e("div",{staticClass:"model-import-back",on:{click:t.goBack}},[e("i",{staticClass:"el-icon-back"})]),t._v(" "),e("div",{staticClass:"model-import"},[e("div",{staticClass:"model-import-title"},[t._v(t._s(t.$t("ImportModel")))]),t._v(" "),e("div",{staticClass:"model-import-subtitle"},[e("span",{staticClass:"text-red"},[t._v("*")]),t._v(" "+t._s(t.$t("SynchronousLink")))]),t._v(" "),e("div",{staticClass:"model-import-subtitle-tips"},[t._v("\n      "+t._s(t.$t("SynchronousLinkTips"))+"\n    ")]),t._v(" "),e("div",{staticClass:"model-import-input custom-form"},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{rules:t.rules,model:t.form}},[e("el-form-item",{attrs:{label:"",prop:"textarea"}},[e("el-input",{staticStyle:{width:"650px"},attrs:{placeholder:t.$t("ImportModelPlaceholder"),maxlength:"100"},model:{value:t.form.textarea,callback:function(e){t.$set(t.form,"textarea",e)},expression:"form.textarea"}})],1),t._v(" "),e("div",{staticClass:"model-import-tips"},[e("span",[t._v(t._s(t.$t("ImportModelTips")))]),t._v(" "),e("span",[t._v(t._s(t.$t("ImportModelTips1")))]),t._v(" "),e("span",[t._v(t._s(t.$t("ImportModelTips2")))]),t._v(" "),e("span",[t._v(t._s(t.$t("ImportModelTips3")))])]),t._v(" "),e("el-form-item",{staticClass:"flex-center"},[e("div",{staticClass:"model-import-btn",on:{click:function(e){return t.submitForm("form")}}},[t._v("\n            "+t._s(t.$t("Submit"))+"\n          ")])])],1)],1)]),t._v(" "),e("RepeatModelPop",{ref:"repeatModelPop"})],1)}),[],!1,null,"263ff662",null));e.default=f.exports},5777:function(t,e,n){"use strict";n.r(e);n(4);var o=n(38),r={name:"tavernInstructionCard",props:{courseInfo:{type:Object,default:function(){return{id:"",cover_url:"",title:"",author_avatar:"",author_name:"",desc:"",author_id:"",detail:""}}}},data:function(){return{avatarLoadError:!1}},methods:{goDetail:function(){if(this.$xyLogEvent({front_operation:"click",entity_type:"tavern_instruction_page",entity_name:"tavern_instruction_card_click",obj_id:this.courseInfo.id}),this.courseInfo.detail)window.open(this.courseInfo.detail,"_self");else if(this.courseInfo.id){var path=this.localePath("/articleDetail/".concat(this.courseInfo.id));this.$router.push(path)}},handleAvatarError:function(){this.avatarLoadError=!0},getFirstChar:function(t){return t?t.charAt(0).toUpperCase():""}}},l=(n(5523),n(0)),c={name:"tavernInstruction",components:{Card:Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"course-card",on:{click:t.goDetail}},[e("div",{staticClass:"course-img",style:{backgroundImage:"url('".concat(t.courseInfo.cover_url,"')")}}),t._v(" "),e("div",{staticClass:"course-title"},[t._v(t._s(t.courseInfo.title))]),t._v(" "),e("div",{staticClass:"course-footer"},[e("div",{staticClass:"author-info"},[e("div",{staticClass:"author-avatar"},[!t.avatarLoadError&&t.courseInfo.author_avatar?e("img",{staticClass:"author-icon",attrs:{src:t.courseInfo.author_avatar,alt:"Seaart.Ai"},on:{error:t.handleAvatarError}}):e("div",{staticClass:"author-text-avatar"},[t._v("\n          "+t._s(t.getFirstChar(t.courseInfo.author_name))+"\n        ")])]),t._v(" "),e("div",{staticClass:"author-name"},[t._v(t._s(t.courseInfo.author_name))])])])])}),[],!1,null,"c5decd7e",null).exports},data:function(){return{list:[{author_avatar:"https://image.cdn2.seaart.me/static/web/st-author.png",author_id:"xuxukkk",author_name:"xuxukkk",cover_url:"https://image.cdn2.seaart.me/static/web/st-course-new.png",desc:"",id:"d13ucmle878c739tgvh0",title:"The Path to Tavern Mastery",detail:"https://www.seaart.ai/zhCN/articleDetail/d13ucmle878c739tgvh0"}],loading:!1}},mounted:function(){},methods:{getList:function(){var t=this;this.loading=!0,Object(o.D)().then((function(e){var n;t.list=(null==e||null===(n=e.data)||void 0===n?void 0:n.items)||[]})).catch((function(e){console.error(e),t.list=[]})).finally((function(){t.loading=!1}))}}},d=(n(5524),Object(l.a)(c,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"tavern-instruction"},[e("div",{staticClass:"course-list"},t._l(t.list,(function(t){return e("Card",{key:t.id,attrs:{courseInfo:t}})})),1)])}),[],!1,null,"36938c71",null));e.default=d.exports},5786:function(t,e,n){"use strict";n.r(e);n(11),n(6),n(12),n(13),n(8),n(4),n(7);var o=n(2),r=n(1),l=n(213),c=n(407),d=n(366);function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={name:"Nexus",components:{LoadingStatus:l.default,CombinedSelectDialog:c.default,workflowStyleModal:d.a},data:function(){return{isReady:!1,getCheckpointId:"",getLoraId:"",instanceId:""}},computed:v(v({},Object(r.c)("user",["token","isLoggedIn","userInfo"])),{},{getIframeUrl:function(){var t,e="";return e=(null===(t=window)||void 0===t||null===(t=t.location)||void 0===t?void 0:t.origin)||"https://www.seaart.ai","".concat(e,"/nexus-web/apps")}}),methods:v(v({},Object(r.b)("creation",["setCombinedDialogStatus"])),{},{sendTokenToIframe:function(){var iframe=this.$el.querySelector("#nexusIframe");if(iframe&&iframe.contentWindow){var t=localStorage.getItem("t")||this.token;if(t)try{this.postMsgToIframe({type:"AUTH_TOKEN",token:t}),console.log("token发送成功",t)}catch(t){console.error("发送token时出错:",t)}else console.warn("用户未登录或token不存在")}else console.warn("iframe或contentWindow不存在，无法发送token")},handleNexusMessage:function(data){var t=data.type,e=data.info;switch(t){case"goBack":console.log("goBack, 消息发来了"),this.$router.push(this.localePath("/"));break;case"openCheckpointSelector":this.instanceId=(null==e?void 0:e.instanceId)||"",null!=e&&e.id&&(this.getCheckpointId=e.id),this.setCombinedDialogStatus({visible:!0,instanceId:"nexus"});break;case"openLoraSelector":this.instanceId=(null==e?void 0:e.instanceId)||"",this.$refs.workflowStyleModal.openModal({modelType:"LORA"});break;case"onloaded":this.sendTokenToIframe(),this.isReady=!0}},getCheckpointData:function(data){console.log("获取checkpoint数据",data),this.postMsgToIframe({type:"GET_CHECKPOINT_DATA",instanceId:this.instanceId,data:(null==data?void 0:data.data)||{}})},getLoraData:function(data){console.log("获取lora数据",data),(null==data?void 0:data.info)&&this.postMsgToIframe({type:"GET_LORA_DATA",instanceId:this.instanceId,data:(null==data?void 0:data.info)||{}})},postMsgToIframe:function(data){var t,e=this.getIframeUrl,iframe=null===(t=document.getElementById("nexusIframe"))||void 0===t?void 0:t.contentWindow;iframe&&iframe.postMessage(data,e)}}),mounted:function(){var t,e=this;if(null===(t=this.userInfo)||void 0===t||!t.show_nexus_button)return console.log("用户无权限访问nexus页面，重定向到首页"),void this.$router.push(this.localePath("/"));window.addEventListener("message",(function(t){t.origin!==location.origin&&"http://localhost:3000"!==t.origin||e.handleNexusMessage(t.data)}))}},h=(n(4730),n(0)),component=Object(h.a)(f,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-nexus"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isReady,expression:"isReady"}],staticClass:"p-nexus-box"},[e("client-only",[e("iframe",{ref:"nexusIframe",attrs:{id:"nexusIframe",src:t.getIframeUrl,width:"100%",height:"100%",frameborder:"0"}})])],1),t._v(" "),e("CombinedSelectDialog",{attrs:{source:"nexus",subSource:"generateImage",checkedId:t.getCheckpointId,instanceId:"nexus"},on:{getData:t.getCheckpointData}}),t._v(" "),e("workflowStyleModal",{ref:"workflowStyleModal",on:{selectModel:t.getLoraData}}),t._v(" "),e("LoadingStatus",{directives:[{name:"show",rawName:"v-show",value:!t.isReady,expression:"!isReady"}],attrs:{bgColor:"#02050e"}})],1)}),[],!1,null,"3f89297b",null);e.default=component.exports;installComponents(component,{LoadingStatus:n(213).default})},5798:function(t,e,n){"use strict";n.r(e);n(18),n(11),n(12),n(13);var o=n(14),r=n(2),l=(n(19),n(6),n(32),n(16),n(49),n(8),n(4),n(28),n(44),n(90),n(7),n(1)),c=n(9),d=n(611),m=n(828),v=n(128),f=n(56),h=n(571),_=n(139),y=n(82),C=n(35),w=n.n(C);function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var D={name:"ModelEdit",components:{ModelFileUpload:d.a,ModelWorkItem:m.a,SingleImageUpload:h.default},data:function(){var t=this;return{formData:{id:this.$route.params.id,name:"",type:"Checkpoint",tags:[],cover:{url:"",cover_width:0,cover_height:0},categories:[],permission:{allow_commercial_use:1,allow_download:1,allow_model_mix:1},is_agency_fee:!1,payment:{fee:"",way:1},refer:""},recommendList:[],intRmdTag:[],sources:"",modelData:null,loading:!1,checkboxDisabled:!1,SDList:c.w,rules:{name:[{required:!0,message:this.$t("PleaseEnterModelName")},{validator:function(e,n,o){/^[a-zA-Z0-9\s_\u4e00-\u9fa5.\-]+$/.test(n)?o():o(new Error(t.$t("newModelNameFormatWarn")))}}],categories:[{required:!0,message:this.$t("PleaseEnterModelCategoryTags")}],refer:[{required:!0,message:this.$t("PleaseEnterLink")}]},selectArgumentList:[{label:"computingPower",value:1},{label:"diamond",value:2,disabled:!0}]}},watch:{sources:{handler:function(t){"Original"==t?this.rules.refer=[]:(this.formData.is_agency_fee=!1,this.formData.payment.fee=0,this.rules.refer=[{required:!0,message:this.$t("PleaseEnterLink")}])}}},computed:k(k({},Object(l.e)("user",["userInfo"])),{},{modelType:function(){return"Checkpoint"===this.formData.type?1:2},checkboxDownload:{get:function(){var t;return 1===(null===(t=this.formData.permission)||void 0===t?void 0:t.allow_download)},set:function(t){this.formData.permission.allow_download=t?1:2}},checkboxCommercial:{get:function(){var t;return 1===(null===(t=this.formData.permission)||void 0===t?void 0:t.allow_commercial_use)},set:function(t){this.formData.permission.allow_commercial_use=t?1:2}},checkboxMix:{get:function(){var t;return 1===(null===(t=this.formData.permission)||void 0===t?void 0:t.allow_model_mix)},set:function(t){this.formData.permission.allow_model_mix=t?1:2}}}),mounted:function(){this.getModelData()},methods:{setCategories:function(){this.formData.categories.length>6&&this.formData.categories.splice(0,1)},setIntRmdTag:function(t){var e,n=this;t&&(this.recommendList=[].concat(Object(o.a)(this.intRmdTag),Object(o.a)(null===(e=this.formData)||void 0===e?void 0:e.tags.filter((function(t){return!n.intRmdTag.find((function(e){return e.title===t.title}))})))))},getTagRecommend:function(){var t=this;Object(_.h)({size:1e3}).then((function(e){var n;1e4===e.status.code&&(t.intRmdTag=null==e||null===(n=e.data)||void 0===n?void 0:n.items,t.setIntRmdTag(!0))}))},remoteMethod:function(t){var e=this;t&&Object(y.d)({prefix:t,except_num:20,source_type:3}).then((function(t){var n;1e4==t.status.code&&(e.recommendList=[],null==t||null===(n=t.data)||void 0===n||n.items.forEach((function(t){e.recommendList.push({title:t.title,id:t.title})})))}))},claimModel:function(){var t="https://aihelp.net/questionnaire/#/?formId=78dea50f5cbb426cb136748154c029aa";this.$i18n.locale.startsWith("zh")&&(t="https://aihelp.net/questionnaire/#/?formId=bffe7a2307454e859f559913e28d4f19"),window.open(t,"_blank")},getModelData:function(){var t=this;if(!this.loading){this.loading=!0;var e={id:this.$route.params.id};Object(v.d)(e).then((function(e){if(1e4==e.status.code){var n=e.data,o=n.type,r=n.name,l=n.download,c=n.commercial,d=n.mix,m=n.payment_way,v=n.agency_fee,f=n.publish_status,h=n.categories,_=n.refer,y=n.tags,C=n.cover,w=n.cover_width;n.cover_height;t.modelData=e.data,t.formData=k(k({},t.formData),{},{name:r,type:o,categories:h,permission:{allow_commercial_use:c,allow_download:l,allow_model_mix:d},payment:{fee:v,way:m||1},refer:_&&"none"!=_?_:"",tags:y||[],cover:{url:C,cover_width:w,cover_height:w}}),t.sources=t.formData.refer?"Reship":"Original",v>0&&(t.formData.is_agency_fee=!0),t.checkboxDisabled=1===f,t.recommendList=t.formData.tags,t.getTagRecommend(),t.$set(t,"formData",t.formData),t.$set(t,"modelData",t.modelData),t.loading=!1}})).catch((function(e){t.loading=!1}))}},submit:function(){var t=this;this.$refs.modelForm.validate((function(e){e&&t.submiData()}))},submiData:function(){var t=this;if(1!=this.loading){var e=this.getParams();this.loading=!0,e.refer="Original"==this.sources?"":e.refer,Object(f.z)(e).then((function(e){if(1e4==e.status.code)if(t.$route.query.VnId){var n=t.formData,o=n.id,r=n.name,l=t.modelData.model_ver_no;t.$router.replace(t.localePath("/models/verEdit/".concat(o,"?VnId=").concat(l,"&name=").concat(r)))}else t.$message.success(t.$t("editSuccess")),t.closePage(!0)})).finally((function(){t.loading=!1}))}},closePage:function(t){var e=this;t?this.$router.back():this.$confirm(this.$t("ModelCancelTips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.$router.back()}))},getParams:function(){var t,e,n=this.formData.is_agency_fee,o=w()(this.formData);n||(null===(t=o.payment)||void 0===t||delete t.fee,null===(e=o.payment)||void 0===e||delete e.way);return o.tags.forEach((function(t,i){t.title||(o.tags[i]={title:t});var e=Object.keys(t);2===e.length&&e.every((function(t){return["title","id"].includes(t)}))&&delete o.tags[i].id})),o},getTranslationKey:function(t){return"Checkpoint"===this.formData.type?t:t.replace("Model","LORA")},setPayNum:function(){var t,e,n;(null===(t=this.formData.payment)||void 0===t?void 0:t.fee)<1&&(this.formData.payment.fee=1),(null===(e=this.formData.payment)||void 0===e?void 0:e.fee)>3&&(this.formData.payment.fee=3),this.formData.payment.fee=parseInt(null===(n=this.formData.payment)||void 0===n?void 0:n.fee)},updateCover:function(t){console.log("emit imgObj",t),t&&t.url?(this.formData.cover.url=null==t?void 0:t.url,this.formData.cover.cover_width=null==t?void 0:t.width,this.formData.cover.cover_height=null==t?void 0:t.height):this.formData.cover={url:"",cover_width:0,cover_height:0}}}},$=(n(4981),n(4982),n(0)),component=Object($.a)(D,(function(){var t,e,o,r=this,l=r._self._c;return l("div",{directives:[{name:"loading",rawName:"v-loading",value:r.loading,expression:"loading"}],staticClass:"model-edit"},[l("i",{staticClass:"el-icon-error",on:{click:r.closePage}}),r._v(" "),l("div",{staticClass:"form-title"},[r._v("\n    "+r._s(r.$t(r.getTranslationKey("ModelEdit")))+"\n    "),l("div",{staticClass:"btn-group"},[l("el-button",{staticClass:"cancel-btn",on:{click:function(t){return r.closePage()}}},[r._v("\n        "+r._s(r.$t("Cancel"))+"\n      ")]),r._v(" "),l("el-button",{staticClass:"save-btn",attrs:{type:"primary",loading:r.loading},on:{click:r.submit}},[r._v("\n        "+r._s(r.$route.query.VnId?r.$t("NextStep"):r.$t("Save"))+"\n      ")])],1)]),r._v(" "),l("div",{staticClass:"edit-form",attrs:{id:"editModelForm"}},[l("el-form",{ref:"modelForm",staticClass:"custom-form",attrs:{"label-position":"top",model:r.formData,rules:r.rules}},[l("div",{staticClass:"formBox"},[l("div",{staticClass:"formCnt"},[l("el-form-item",{attrs:{label:r.$t(r.getTranslationKey("ModelName")),required:"",prop:"name"}},[l("el-input",{attrs:{placeholder:r.$t(r.getTranslationKey("PleaseEnterModelName")),maxlength:100},model:{value:r.formData.name,callback:function(t){r.$set(r.formData,"name",t)},expression:"formData.name"}})],1),r._v(" "),l("el-form-item",{attrs:{label:r.$t("Type")}},[l("div",{staticClass:"type-select"},[l("span",{class:{active:"Checkpoint"===r.formData.type}},[r._v(" CheckPoint ")]),r._v(" "),l("span",{class:{active:"LORA"===r.formData.type}},[r._v("LoRA")])])]),r._v(" "),l("el-form-item",[l("template",{slot:"label"},[r._v("\n              "+r._s(r.$t("SetTags"))+"\n            ")]),r._v(" "),l("el-select",{staticClass:"show-tag",attrs:{"value-key":"title",multiple:"",filterable:"",remote:"","allow-create":"","popper-class":"show-tag-select","default-first-option":"",placeholder:r.$t("pleaseEnte"),"remote-method":r.remoteMethod},on:{"visible-change":r.setIntRmdTag},model:{value:r.formData.tags,callback:function(t){r.$set(r.formData,"tags",t)},expression:"formData.tags"}},r._l(r.recommendList,(function(t,e){return l("el-option",{key:"tag_".concat(t.id+e),attrs:{label:t.title,value:t}})})),1)],2),r._v(" "),l("el-form-item",{attrs:{label:r.$t(r.getTranslationKey("ModelSources")),required:"",prop:"name"}},[l("el-radio-group",{attrs:{disabled:1===(null===(t=r.modelData)||void 0===t?void 0:t.channel)},model:{value:r.sources,callback:function(t){r.sources=t},expression:"sources"}},[l("el-radio",{attrs:{label:"Original"}},[r._v(r._s(r.$t("Original")))]),r._v(" "),l("el-radio",{attrs:{label:"Reship"}},[r._v(r._s(r.$t("Reship")))])],1)],1)],1),r._v(" "),l("div",{staticClass:"formCnt"},[l("el-form-item",{attrs:{label:r.$t("ModelPayment"),required:""}},[l("div",{staticClass:"type-select model-payment"},[l("span",{class:{active:!1===r.formData.is_agency_fee},on:{click:function(t){"Original"==r.sources&&(r.formData.is_agency_fee=!1)}}},[r._v("\n                "+r._s(r.$t("Free"))+"\n              ")]),r._v(" "),l("span",{class:{active:!0===r.formData.is_agency_fee},on:{click:function(t){"Original"==r.sources&&(r.formData.is_agency_fee=!0)}}},[r._v("\n                "+r._s(r.$t("ModelEditPay"))+"\n              ")])]),r._v(" "),!0===r.formData.is_agency_fee?l("div",{staticClass:"payBox"},[l("div",{staticClass:"payCnt"},[l("div",{staticClass:"payTit"},[r._v(r._s(r.$t("paymentMethod")))]),r._v(" "),l("el-select",{attrs:{"popper-class":"payType"},model:{value:r.formData.payment.way,callback:function(t){r.$set(r.formData.payment,"way",t)},expression:"formData.payment.way"}},r._l(r.selectArgumentList,(function(t){return l("el-option",{key:t.label,attrs:{label:r.$t(t.label),value:t.value,disabled:t.disabled}})})),1)],1),r._v(" "),l("div",{staticClass:"payCnt"},[l("div",{staticClass:"payTit"},[r._v(r._s(r.$t("paymentAmount")))]),r._v(" "),l("div",{staticClass:"inputBox"},[l("input",{directives:[{name:"model",rawName:"v-model.number",value:r.formData.payment.fee,expression:"formData.payment.fee",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:r.formData.payment.fee},on:{blur:[function(t){return r.setPayNum()},function(t){return r.$forceUpdate()}],input:function(t){t.target.composing||r.$set(r.formData.payment,"fee",r._n(t.target.value))}}}),r._v(" "),1==(null===(e=r.formData.payment)||void 0===e?void 0:e.way)?l("img",{attrs:{src:n(169),alt:""}}):r._e(),r._v(" "),2==(null===(o=r.formData.payment)||void 0===o?void 0:o.way)?l("img",{attrs:{src:n(1044),alt:""}}):r._e()])])]):r._e()]),r._v(" "),l("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"Original"==r.sources,expression:"sources == 'Original'"}],attrs:{required:""}},[l("template",{slot:"label"},[r._v("\n              "+r._s(r.$t("ModelPermissions"))+"\n              "),l("span",{staticClass:"item-tips"},[r._v("("+r._s(r.$t("MultipleChoice"))+")")])]),r._v(" "),l("div",{staticClass:"checkbox-container"},[l("el-checkbox",{model:{value:r.checkboxDownload,callback:function(t){r.checkboxDownload=t},expression:"checkboxDownload"}},[r._v("\n                "+r._s(r.$t("IsModelDownload"))+"\n              ")])],1),r._v(" "),l("div",{staticClass:"checkbox-container"},[l("el-checkbox",{model:{value:r.checkboxCommercial,callback:function(t){r.checkboxCommercial=t},expression:"checkboxCommercial"}},[r._v("\n                "+r._s(r.$t("IsCommercialUse"))+"\n              ")])],1),r._v(" "),l("div",{staticClass:"checkbox-container"},[l("el-checkbox",{model:{value:r.checkboxMix,callback:function(t){r.checkboxMix=t},expression:"checkboxMix"}},[r._v("\n                "+r._s(r.$t("IsModelMerging"))+"\n              ")])],1)],2),r._v(" "),l("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"Reship"==r.sources,expression:"sources == 'Reship'"}],attrs:{label:r.$t("originalLink"),prop:"refer"}},[l("el-input",{attrs:{placeholder:r.$t("pleaseEnte")},model:{value:r.formData.refer,callback:function(t){r.$set(r.formData,"refer",t)},expression:"formData.refer"}})],1)],1)]),r._v(" "),l("el-form-item",{attrs:{prop:"cover"}},[l("template",{slot:"label"},[r._v("\n          "+r._s(r.$t(1===r.modelType?"CheckpointCover":"LORACover"))+"\n          "),l("p",{staticClass:"form-item-tips"},[r._v("\n            "+r._s(r.$t("modelCoverDesc",{modelCover:r.$t(1===r.modelType?"CheckpointCover":"LORACover")}))+"\n          ")])]),r._v(" "),l("SingleImageUpload",{attrs:{defaultImageUrl:r.formData.cover.url,maxSize:2},on:{upload:function(t){return r.updateCover(t)}}})],2)],1)],1)])}),[],!1,null,"06d2acea",null);e.default=component.exports;installComponents(component,{SingleImageUpload:n(571).default})},5799:function(t,e,n){"use strict";n.r(e);n(18),n(11),n(6),n(12),n(13),n(8);var o=n(2),r=(n(32),n(22),n(4),n(28),n(44),n(7),n(1)),l=n(9),c=n(611),d=n(828),m=n(128),v=n(56),f=n(571),h=n(610);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var C={name:"ModelEdit",components:{ModelFileUpload:c.a,ModelWorkItem:d.a,SingleImageUpload:f.default,modelExistDialog:h.a},data:function(){var t=this;return{formData:{model_id:this.$route.params.id,base_model:"",type:"Checkpoint",file_id:"",sample_ids:[],desc:"",trigger_words:[],allow_creation:1},ModelName:"",existObj:{name:"",url:"",open:!1},modelData:null,loading:!1,checkboxDisabled:!1,isNext:!1,SDList:l.w,versionId:"",fromName:"",rules:{sample_ids:[{validator:function(e,n,o){var r=n.length;(0===r||r>10)&&o(new Error(t.$t("PleaseUploadExampleImages"))),o()}}],name:[{required:!0,message:this.$t("PleaseEnterVer")},{validator:function(e,n,o){/^[a-zA-Z0-9_.-]+$/.test(n)?o():o(new Error(t.$t("ModelVerFormatWarn")))}}],base_model:[{required:!0,message:this.$t("PleaseSelectBaseModel")}],file_id:[{required:!0,message:this.$t("PleaseUploadFodelFile")}]},selectArgumentList:[{label:"computingPower",value:1},{label:"diamond",value:2,disabled:!0}]}},computed:y(y(y(y({},Object(r.e)("user",["userInfo"])),Object(r.e)("payment",["paymentInfo"])),Object(r.c)("user",["isCompanyAccount"])),{},{isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},modelType:function(){return"Checkpoint"===this.formData.type?1:2},isCommunity:{get:function(){return 1===this.formData.allow_creation},set:function(t){this.formData.allow_creation=t?1:2}}}),beforeRouteEnter:function(t,e,n){n((function(t){t.fromName=e.name}))},mounted:function(){this.$route.query.name&&(this.ModelName=this.$route.query.name),"VnAdd"==this.$route.query.VnId?this.isNext=!0:this.versionId=this.$route.query.VnId,this.getModelData()},methods:{commChange:function(t){this.isVip||t||(this.$EventBus.$emit("showBreakDialog","TrainLoraTipWeb","basic"),this.formData.allow_creation=1)},getModelData:function(){var t=this;if(!this.loading){this.loading=!0;var e=m.d,n={id:this.$route.params.id};this.$route.query.VnId&&!this.isNext&&(e=v.G,n={id:this.$route.params.id,version_id:this.$route.query.VnId}),e(n).then((function(e){if(1e4==e.status.code){var n=e.data,o=n.type,r=n.file_id,l=n.samples,c=n.base_model,desc=n.desc,d=n.version_name,m=n.trained_words,v=n.allow_creation;t.modelData=e.data,t.isNext?t.formData=y(y({},t.formData),{},{type:o}):t.formData=y(y({},t.formData),{},{type:o,name:d,file_id:r,base_model:c,desc:(desc||"").replace(/<br>/g,"\r\n"),trigger_words:m,allow_creation:v,sample_ids:l.map((function(t){return y(y({},t),{},{banner:{url:t.url}})}))}),t.$set(t,"formData",t.formData),t.$set(t,"modelData",t.modelData)}})).finally((function(){t.loading=!1}))}},submit:function(){var t=this,e=this.formData.sample_ids.length;(0===e||e>10)&&this.$message.warning(this.$t("PleaseUploadExampleImages")),this.$refs.modelForm.validate((function(e){e&&t.submiData()}))},addVer:function(){var t=this;this.$refs.modelForm.validate((function(e){if(e){if(1==t.loading)return;t.loading=!0;var n=y({},t.formData);n.file_id=n.file_id.split("/")[0],Object(v.a)(n).then((function(e){1e4==e.status.code&&(t.versionId=e.data.id,Object(v.G)({id:t.$route.params.id,version_id:t.versionId}).then((function(e){1e4==e.status.code&&(t.modelData=e.data,t.isNext=!1,t.$nextTick((function(){var e=t.$refs.sample_ids.$el.offsetTop-90;t.$refs["edit-form"].scrollBy({top:e,behavior:"smooth"})})))})).finally((function(){t.loading=!1})))}))}}))},publishModel:function(){var t=this;Object(v.v)({model_no:this.formData.model_id}).then((function(e){var n;if(1e4==e.status.code)if(null!==(n=e.data)&&void 0!==n&&n.model_id){var o=e.data,r=o.model_id,l=o.model_name,c=void 0===l?"Model":l,d=o.model_status,m=void 0===d?2:d;t.existObj.url="".concat(window.location.origin,"/")+"models/detail/"+r,t.existObj.name=c,t.existObj.open=1===m,t.$refs.modelExist.modelExistDialog=!0}else t.$message.success(t.$t("PulishSuccess")),t.closePage(!0);else e.status.code})).finally((function(){t.loading=!1}))},submiData:function(){var t=this;if(1!=this.loading){var e=y({},this.formData);e.desc=(e.desc||"").replace(/\n/g,"<br>"),this.loading=!0,e.file_id=e.file_id.split("/")[0],this.$route.query.VnId&&!this.isNext?e.id=this.versionId:delete e.id,delete e.type,e.sample_ids.forEach((function(t,n){t.id&&(e.sample_ids[n]=t.id)})),Object(v.A)(e).then((function(e){if(1e4==e.status.code){if(t.$route.query.VnId&&!t.isNext){var n;if(null!==(n=e.data)&&void 0!==n&&n.model_id){var o=e.data,r=o.model_id,l=o.model_name,c=void 0===l?"Model":l,d=o.model_status,m=void 0===d?2:d;return t.existObj.url="".concat(window.location.origin,"/")+"models/detail/"+r,t.existObj.name=c,t.existObj.open=1===m,void(t.$refs.modelExist.modelExistDialog=!0)}"ModelEdit"==t.fromName?t.publishModel():t.$message.success(t.$t("editSuccess"))}else"ModelEdit"==t.fromName?t.publishModel():t.$message.success(t.$t("CreateSuccess"));"ModelEdit"!=t.fromName&&t.closePage(!0)}})).finally((function(){"ModelEdit"!=t.fromName&&(t.loading=!1)}))}},closePage:function(t){var e=this;t?this.$router.back():this.$confirm(this.$t("ModelCancelTips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning",customClass:"custom-confirm"}).then((function(){e.$router.back()}))},getEditStatus:function(){var t=this.formData.sample_ids,e=this.modelData,n=e.name,o=e.samples,r=o.every((function(e){return t.find((function(t){return t.id===e.id}))}));return this.ModelName!=n||!(r&&o.length===t.length)},getTranslationKey:function(t){return"Checkpoint"===this.formData.type?t:t.replace("Model","LORA")}}},w=(n(4983),n(4984),n(0)),component=Object(w.a)(C,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"model-edit"},[e("i",{staticClass:"el-icon-error",on:{click:t.closePage}}),t._v(" "),e("div",{staticClass:"form-title"},[t._v("\n      "+t._s(t.$t("Versions")+t.$t("Edit"))+"\n      "),e("div",{staticClass:"btn-group"},[t.isNext?e("el-button",{staticClass:"save-btn",attrs:{type:"primary",loading:t.loading},on:{click:t.addVer}},[t._v("\n          "+t._s(t.$t("NextStep"))+"\n        ")]):"ModelEdit"==t.fromName?e("el-button",{staticClass:"save-btn",attrs:{type:"primary",loading:t.loading},on:{click:t.submit}},[t._v("\n          "+t._s(t.$t("Publish"))+"\n        ")]):e("el-button",{staticClass:"save-btn",attrs:{type:"primary",loading:t.loading},on:{click:t.submit}},[t._v("\n          "+t._s(t.$t("Save"))+"\n        ")])],1)]),t._v(" "),e("div",{ref:"edit-form",staticClass:"edit-form",attrs:{id:"editModelForm"}},[e("el-form",{ref:"modelForm",staticClass:"custom-form",attrs:{"label-position":"top",model:t.formData,rules:t.rules}},[e("div",{staticClass:"formBox"},[e("div",{staticClass:"formCnt"},[e("el-form-item",{attrs:{label:t.$t("Versions")+t.$t("trainName"),required:"",prop:"name"}},[e("div",{staticClass:"VnAddBox"},[e("el-input",{attrs:{maxlength:100,disabled:""},model:{value:t.ModelName,callback:function(e){t.ModelName=e},expression:"ModelName"}}),t._v(" "),e("el-input",{attrs:{placeholder:t.$t("pleaseEnte"),maxlength:10},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)]),t._v(" "),e("el-form-item",{attrs:{label:t.$t("BaseModel"),prop:"base_model"}},[e("el-select",{attrs:{"popper-class":"custom-select"},model:{value:t.formData.base_model,callback:function(e){t.$set(t.formData,"base_model",e)},expression:"formData.base_model"}},t._l(t.SDList,(function(t,n){return e("el-option",{key:"SD_"+n,attrs:{label:t,value:t}})})),1)],1),t._v(" "),0!=t.formData.allow_creation?e("el-form-item",[e("div",{staticClass:"isCommunityBox"},[e("span",[t._v(t._s(t.$t("sameModel")))]),t._v(" "),e("el-switch",{on:{change:t.commChange},model:{value:t.isCommunity,callback:function(e){t.isCommunity=e},expression:"isCommunity"}})],1)]):t._e(),t._v(" "),e("el-form-item",{attrs:{label:t.$t("CheckpointFile"),prop:"file_id"}},[e("model-file-upload",{ref:"modelsFileUpload",attrs:{createId:t.formData.model_id,modelType:t.modelType,disabled:!t.isNext},model:{value:t.formData.file_id,callback:function(e){t.$set(t.formData,"file_id",e)},expression:"formData.file_id"}})],1)],1),t._v(" "),e("div",{staticClass:"formCnt"},[e("el-form-item",{attrs:{prop:"trigger_words"}},[e("template",{slot:"label"},[t._v("\n                "+t._s(t.$t("TriggerWords"))+"\n              ")]),t._v(" "),e("el-select",{attrs:{multiple:"",filterable:"","popper-class":"custom-select","allow-create":"","default-first-option":"",placeholder:t.$t("pleaseEnte")},model:{value:t.formData.trigger_words,callback:function(e){t.$set(t.formData,"trigger_words",e)},expression:"formData.trigger_words"}},t._l([],(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],2),t._v(" "),e("el-form-item",{attrs:{label:t.$t("verIntroduction"),prop:"desc"}},[e("el-input",{attrs:{placeholder:t.$t("pleaseEnte"),maxlength:1e4,"show-word-limit":"",type:"textarea"},model:{value:t.formData.desc,callback:function(e){t.$set(t.formData,"desc",e)},expression:"formData.desc"}})],1)],1)]),t._v(" "),t.isNext?t._e():e("el-form-item",{ref:"sample_ids",attrs:{required:"",prop:"sample_ids"}},[e("template",{slot:"label"},[t._v("\n            "+t._s(t.$t("Versions")+t.$t("Work"))+"\n            "),e("span",{staticClass:"item-tips"},[t._v(t._s(t.$t("ModelEditWorkTips")))]),t._v(" "),e("p",{staticClass:"form-item-tips"},[t._v("\n              "+t._s(t.$t("ModelWorkTips",{modelType:t.$t(1===t.modelType?"Checkpoint":"LoRA")}))+"\n            ")])]),t._v(" "),e("model-work-item",{ref:"modelsWork",attrs:{modelData:t.modelData},model:{value:t.formData.sample_ids,callback:function(e){t.$set(t.formData,"sample_ids",e)},expression:"formData.sample_ids"}})],2)],1)],1),t._v(" "),e("modelExistDialog",{ref:"modelExist",attrs:{existObj:t.existObj}})],1)}),[],!1,null,"70622a9a",null);e.default=component.exports},5817:function(t,e,n){"use strict";n.r(e);var o=n(3),r=(n(20),{components:{ArticleDetail:n(829).a},data:function(){return{detailData:{}}},head:function(){var t=this.detailData,e=t.title,title=void 0===e?"":e,n=t.meta_desc,o=void 0===n?"":n,r=t.author,l=void 0===r?"":r,c=t.cover,d=void 0===c?"":c,m=t.create_at,v=void 0===m?0:m,f=t.update_at,h=void 0===f?0:f;return{title:title,meta:[{hid:"description",name:"description",content:o},{hid:"og:title",name:"og:title",content:title},{hid:"og:description",name:"og:description",content:o}],script:[{type:"application/ld+json",json:{"@context":"https://schema.org","@type":"NewsArticle",headline:title,image:[d],datePublished:new Date(v).toISOString(),dateModified:new Date(h).toISOString(),author:[{"@type":"Person",name:l}]}}],__dangerouslyDisableSanitizers:["script"]}},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,c,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,t.app,o=t.params,r=t.error,e.prev=1,l={seo_url:o.id,type:"aiNews"},e.next=5,n.$post("/api/v1/blog/detail",l);case 5:if(c=e.sent,data=c.data){e.next=9;break}throw new Error("获取数据失败");case 9:return e.abrupt("return",{detailData:data||{}});case 12:e.prev=12,e.t0=e.catch(1),console.log("article detail -> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))()}}),l=n(0),component=Object(l.a)(r,(function(){return(0,this._self._c)("ArticleDetail",{attrs:{type:"news",detailData:this.detailData}})}),[],!1,null,null,null);e.default=component.exports},5823:function(t,e,n){"use strict";n.r(e);n(11),n(6),n(12),n(13);var o=n(3),r=n(14),l=n(2),c=(n(20),n(8),n(4),n(7),n(26),n(1)),d=n(899),m=n(898);function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){Object(l.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h={name:"SillyTavern",components:{Loading:d.a,StCustomConfirm:m.a},data:function(){return{isReady:!1,iframeAttemptsCount:0,maxAttempts:10,iframeCheckInterval:null,nsfwUrl:""}},computed:f(f(f({},Object(c.e)("payment",["paymentInfo"])),Object(c.c)("user",["token","isCompanyAccount","userInfo"])),{},{isVip:function(){var t,e;return(null===(t=this.paymentInfo)||void 0===t?void 0:t.activeState)||(null===(e=this.paymentInfo)||void 0===e?void 0:e.liteActiveState)||this.isCompanyAccount},getIframeUrl:function(){return"https://tavern.seaart.ai"}}),methods:{handleIframeLoad:function(){console.log("iframe onload事件触发"),this.isReady=!0,this.sendInfoToIframe()},sendInfoToIframe:function(){var t,e=this,iframe=this.$el.querySelector("#sillyTavernIframe");if(iframe&&iframe.contentWindow){var n={AUTH_TOKEN:localStorage.getItem("t")||this.token,CHARACTER_DATA:this.characterData,LANGUAGE:null!==(t=this.$i18n.locale)&&void 0!==t?t:"en",USER_INFO:this.userInfo,IS_FULL_HEALTH:!0,IS_CHARACTER_CREATE:!0};Object.keys(n).forEach((function(t){e.sendDataToIframe(n[t],t)}))}else console.warn("iframe或contentWindow不存在，无法发送token")},sendDataToIframe:function(t,e){if(t){var n={type:e,data:t};this.postMsgToIframe(n)}else console.warn("发送数据到iframe失败：".concat(e," 数据不存在"))},checkForIframe:function(){var iframe=this.$refs.sillyTavernIframe||this.$el.querySelector("#sillyTavernIframe")||document.getElementById("sillyTavernIframe");this.iframeAttemptsCount++,console.log("第".concat(this.iframeAttemptsCount,"次尝试获取iframe"),iframe),iframe?(console.log("找到iframe元素"),clearInterval(this.iframeCheckInterval),this.isReady||(iframe.addEventListener("load",this.handleIframeLoad),iframe.contentDocument&&"complete"===iframe.contentDocument.readyState&&(console.log("iframe已经加载完成，手动触发处理"),this.handleIframeLoad()))):this.iframeAttemptsCount>=this.maxAttempts&&(console.error("多次尝试后仍未找到iframe元素，停止尝试"),clearInterval(this.iframeCheckInterval),this.isReady=!0)},handleSTMessage:function(data){var t;if("create"===(null===(t=this.$route)||void 0===t||null===(t=t.params)||void 0===t?void 0:t.id)){var e=data.type,n=data.info;switch(e){case"goBack":console.log("goBack, 消息发来了"),this.$router.push(this.localePath("/"));break;case"vipTip":console.log("vipTip, 消息发来了",n);var o,l={70039:["showVipComputingDialog","vipDialogComputedTit2"],70010:["showBreakDialog","VipTip","basic"],80008:this.isVip?["showVipComputingDialog"]:["showNotVipComputingDialog"]};if(n.code&&l[n.code])(o=this.$EventBus).$emit.apply(o,Object(r.a)(l[n.code]));break;case"hideLoader":this.$refs.loadingComponent.completeLoading();break;case"seeNsfw":console.log("查看nsfw资源-chat",n),(null==n?void 0:n.url)&&this.$refs.stCustomConfirm.openDialog(null==n?void 0:n.url);break;case"publish":console.log("发布操作-chat",n),this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-publish-btn",entity_type:"sillyTavern-chat-page",obj_type:76}),this.$EventBus.$emit("open-publish-dialog",n);break;case"instruction":console.log("instruction-chat",n),this.$xyLogEvent({front_operation:"click",entity_name:"sillyTavern-guide-btn",entity_type:"sillyTavern-chat-page"}),window.open(this.localePath("/tavernInstruction"),"_blank");break;case"createNewCard":console.log("ST内部创建新角色-chat",n);var c=n.status,d=void 0===c?"start":c;this.$xyLogEvent({front_operation:"click",entity_name:"start"===d?"create-new-card":"create-new-card-success",entity_type:"sillyTavern"})}}},postMsgToIframe:function(data){var t,e=this.getIframeUrl,iframe=null===(t=document.getElementById("sillyTavernIframe"))||void 0===t?void 0:t.contentWindow;iframe&&iframe.postMessage(data,e)},initPage:function(){var t,e,n=this;window.addEventListener("message",(function(t){"https://tavern.seaart.ai"===t.origin&&n.handleSTMessage(t.data)})),this.iframeCheckInterval=setInterval(this.checkForIframe,500),setTimeout((function(){n.isReady||(console.warn("iframe加载超时，强制设置isReady"),n.isReady=!0,clearInterval(n.iframeCheckInterval),n.sendInfoToIframe())}),8e3),this.$xyLogEvent({front_operation:"exposure",entity_name:"sillyTavern-show",entity_type:"sillyTavern",obj_id:"create"!==(null===(t=this.$route)||void 0===t||null===(t=t.params)||void 0===t?void 0:t.id)?null===(e=this.$route)||void 0===e||null===(e=e.params)||void 0===e?void 0:e.id:""})}},mounted:function(){this.initPage()},updated:function(){this.checkForIframe()},beforeDestroy:function(){clearInterval(this.iframeCheckInterval);var iframe=this.$el.querySelector("#sillyTavernIframe");iframe&&iframe.removeEventListener("load",this.handleIframeLoad)},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,param,c,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.$axios,o=t.params,r=t.error,l=o.id,param={id:l},e.prev=3,!l){e.next=13;break}return e.next=7,n.$post("/api/v1/tavern-pro/config",param);case 7:if(c=e.sent,data=c.data,1e4===c.status.code){e.next=12;break}return e.abrupt("return");case 12:return e.abrupt("return",{characterData:data||{}});case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),console.log("角色卡详情页面-> asyncData错误啦：",e.t0),r({statusCode:404,message:e.t0});case 19:case"end":return e.stop()}}),e,null,[[3,15]])})))()}},_=(n(5522),n(0)),component=Object(_.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-silly-tavern"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isReady,expression:"isReady"}],staticClass:"p-silly-tavern-box"},[e("client-only",[e("iframe",{ref:"sillyTavernIframe",attrs:{id:"sillyTavernIframe",src:t.getIframeUrl,width:"100%",height:"100%",frameborder:"0"},on:{load:t.handleIframeLoad}})])],1),t._v(" "),e("Loading",{ref:"loadingComponent"}),t._v(" "),e("StCustomConfirm",{ref:"stCustomConfirm"})],1)}),[],!1,null,"70b7d138",null);e.default=component.exports},610:function(t,e,n){"use strict";n(18),n(90),n(26);var o=n(10),r=n(153),l={props:{existObj:{type:Object,default:function(){return{name:"",url:"",open:!1}}}},data:function(){return{modelExistDialog:!1}},methods:{handleInitHelp:function(){window.SUHelpSupport?SUHelpSupport.show():Object(r.a)((function(){setTimeout((function(){SUHelpSupport.show()}),2e3)}))},copyLink:function(){var text=this.existObj.url;text&&Object(o.g)(text),this.$message.success(this.$t("CopySuccess"))},claimModel:function(){var t="https://aihelp.net/questionnaire/#/?formId=78dea50f5cbb426cb136748154c029aa";this.$i18n.locale.startsWith("zh")&&(t="https://aihelp.net/questionnaire/#/?formId=bffe7a2307454e859f559913e28d4f19"),window.open(t,"_blank")}}},c=n(0),component=Object(c.a)(l,(function(){var t=this,e=t._self._c;return e("el-dialog",{staticStyle:{"margin-top":"25vh !important"},attrs:{title:t.$t("Tip"),visible:t.modelExistDialog,width:"500px","modal-append-to-body":!1,"close-on-click-modal":!1,"append-to-body":!0,"custom-class":"SaDialog"},on:{"update:visible":function(e){t.modelExistDialog=e}}},[e("div",{staticClass:"flex justify-between flex-wrap",staticStyle:{margin:"20px 0"}},[e("div",{staticClass:"left",staticStyle:{"margin-top":"15px","word-break":"break-word"}},[e("i",{staticClass:"el-icon-warning",staticStyle:{color:"#f19c5c","margin-right":"15px",transform:"scale(1.5)"}}),t._v("\n      "+t._s(t.$t("newUpload_Model_1"))+"，"),t.existObj.url&&t.existObj.open?e("span",[t._v(t._s(t.$t("Upload_Model_2"))),e("a",{staticStyle:{color:"#e5af5d",cursor:"pointer"},attrs:{href:t.existObj.url,target:"_blank"}},[t._v(t._s(t.existObj.name)+"，")])]):t._e(),t._v("\n      "+t._s(t.$t("Upload_Model_3"))+"\n      "),e("span",{staticStyle:{color:"#e5af5d",cursor:"pointer"},on:{click:function(e){return e.preventDefault(),t.handleInitHelp()}}},[t._v(t._s(t.$t("Contact_customer")))])]),t._v(" "),t.existObj.url&&t.existObj.open?e("div",{staticStyle:{color:"#4784ff",cursor:"pointer","margin-top":"15px"},on:{click:t.copyLink}},[e("i",{staticClass:"iconfont icon-link",staticStyle:{"margin-right":"5px"}}),t._v("\n      "+t._s(t.$t("CopyLink"))+"\n    ")]):t._e()]),t._v(" "),e("div",{staticClass:"bntitem",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.modelExistDialog=!1}}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{on:{click:t.claimModel}},[t._v(t._s(t.$t("ClaimModel")))])],1)])}),[],!1,null,"3b9ccd14",null);e.a=component.exports},611:function(t,e,n){"use strict";n(11),n(12),n(13),n(8);var o=n(2),r=(n(6),n(16),n(22),n(31),n(49),n(18),n(24),n(65),n(4),n(7),n(26),n(413));function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d={props:["value","createId","modelType","disabled"],components:{modelExistDialog:n(610).a},data:function(){return{uploadStatusIcon:{init:"",pending:"el-icon-loading",complete:"el-icon-circle-check",fail:"el-icon-refresh-left",error:"el-icon-close"},uploadingStatus:"init",uploadConfig:"",fileChunk:[],worker:null,progress:0,errNum:3,waitUploadIndex:[],existObj:{name:"",url:"",open:!1}}},computed:{isDisabled:function(){return"pending"===this.uploadingStatus||this.disabled}},methods:{startUpload:function(t){var e=this,n=t.size,o=t.name;if(!this.isDisabled)if(this.validFileSize(n)){var l=1===this.modelType?"Model":"LORA";this.$message.warning(this.$t(l+"FileSizeError"))}else{var d={file_size:n,file_name:o,content_type:"application/octet-stream",category:1,model_type:this.modelType,create_id:this.createId};this.uploadingStatus="pending",Object(r.c)(d).then((function(r){e.uploadConfig=c(c({},r.data),{},{file_size:n,file_name:o}),e.cutFile(t,r.data.chunk_size,e.uploadConfig.presigned.length)}))}},cutFile:function(t,e,n){var o=this;this.worker=this.$worker.run((function(t,e,n){for(var o=[],r=0;r<t.size;)0===--n&&(e=t.size-r),o.push({file:t.slice(r,r+e)}),r+=e;return o.map((function(t,e){return{uploadStatus:!1,file:t,index:e,progress:0}}))}),[t,e,n]).then((function(t){o.fileChunk=t,o.$set(o,"fileChunk",t),o.uploadFile()}))},uploadFile:function(){console.log("开始上传~， 文件块总数："+this.fileChunk.length,this.fileChunk),this.waitUploadIndex=this.getWaitUplaodChunkIndex(),this.uploadChunk()},reduceQueue:function(){this.waitUploadIndex.splice(0,1),this.uploadChunk()},uploadChunk:function(){var t=this;if(0!=this.waitUploadIndex.length){var e=this.waitUploadIndex[0],n=this.fileChunk[e],o=this.uploadConfig.presigned,r=new XMLHttpRequest;r.open("PUT",o[e]),r.setRequestHeader("Content-Type","application/octet-stream"),r.onerror=function(e){if(t.errNum--,console.log("上传失败error：",e,"失败重试次数："+t.errNum),t.errNum<0)return t.uploadingStatus="fail",void console.log("this.uploadingStatus: "+t.uploadingStatus);setTimeout((function(){t.uploadChunk()}),3e3)},r.upload.onprogress=function(e){var n=e.loaded,o=e.total,r=Math.floor(n/o*1e4),l=t.fileChunk.length,c=Math.floor(1/l*1e4);t.updateProgress(c*r/1e4)},r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){if(t.errNum=3,!t.fileChunk[e])return;t.fileChunk[e].uploadStatus=!0,t.reduceQueue()}else 4===r.readyState&&200!==r.status&&0===t.errNum&&t.$message.error(t.$t("uploadError"))},r.send(n.file.file)}else this.chunkUploadCheck()},updateProgress:function(t){var e=this.fileChunk.filter((function(t){return t.uploadStatus})).length,n=this.fileChunk.length;if(n){var o=parseFloat((e/n*1e4).toFixed(2));o+=t,this.progress=parseFloat((o/100).toFixed(2))}},chunkUploadCheck:function(){var t=this,e=this.uploadConfig.file_id;console.log("开始校验"),Object(r.a)({create_id:this.createId,file_id:e}).then((function(e){if(e.data.model_id){var n=e.data,o=n.model_id,r=n.model_name,l=void 0===r?"Model":r,c=n.model_status,d=void 0===c?2:c;t.existObj.url="".concat(window.location.origin,"/")+"models/detail/"+o,t.existObj.name=l,t.existObj.open=1===d,t.$refs.modelExist.modelExistDialog=!0}var m=e.data.unconfirmed;m.length?(m.forEach((function(e){t.fileChunk[Number(e)-1].progress=0,t.fileChunk[Number(e)-1].uploadStatus=!1})),t.waitUploadIndex=m.map((function(t){return Number(t)})),t.uploadingStatus="pending",t.uploadFile()):(t.progress=100,t.uploadingStatus="complete",console.log(t.uploadConfig),t.$emit("input",t.uploadConfig.file_id+"/"+t.uploadConfig.file_size))})).catch((function(e){t.uploadingStatus="error"}))},getWaitUplaodChunkIndex:function(){return this.fileChunk.filter((function(t){return!t.uploadStatus})).map((function(t){return t.index}))},curstomUpload:function(t){this.startUpload(t.file)},refresh:function(){["fail","error"].includes(this.uploadingStatus)&&("error"!==this.uploadingStatus?(this.uploadingStatus="pending",this.errNum=3,this.uploadChunk()):this.clear())},clear:function(){this.errNum=3,this.fileChunk=[],this.uploadConfig="",this.waitUploadIndex=[],this.progress=0,this.uploadingStatus="init"},validFileSize:function(t){var e=parseFloat((t/1e9).toFixed(2));return console.log(e),1===this.modelType?e<1:e>1}}},m=(n(4865),n(0)),component=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{staticClass:"upload-file-item",attrs:{action:"/","http-request":t.curstomUpload,"show-file-list":!1,disabled:t.isDisabled,accept:".ckpt,.safetensors"}},[e("div",{staticClass:"upload-btn"},[e("div",[e("i",{staticClass:"el-icon-upload2"}),t._v(" "),e("span",{staticClass:"file-name"},[t._v(t._s(t.uploadConfig?t.uploadConfig.file_name:t.value?t.value:t.$t("PickFile")))])]),t._v(" "),e("i",{class:t.uploadStatusIcon[t.uploadingStatus],on:{click:t.refresh}})]),t._v(" "),e("el-progress",{directives:[{name:"show",rawName:"v-show",value:t.uploadConfig,expression:"uploadConfig"}],attrs:{percentage:t.progress,color:"#0d9488"}})],1),t._v(" "),e("modelExistDialog",{ref:"modelExist",attrs:{existObj:t.existObj}})],1)}),[],!1,null,"6c8833d2",null);e.a=component.exports},617:function(t,e,n){"use strict";var o={name:"StarLine",props:{scene:{type:String,default:"chat"},starStyle:{type:Boolean,default:!1}}},r=(n(3999),n(0)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{class:"".concat(t.starStyle?"star-line-box":"heartbeat-line-box")},[t.starStyle?[e("i",{staticClass:"iconfont icon-xin left-end-star"}),t._v(" "),e("span"),t._v(" "),e("span"),t._v(" "),e("span"),t._v(" "),e("i",{staticClass:"iconfont icon-xin middle-star"}),t._v(" "),e("span"),t._v(" "),e("span"),t._v(" "),e("i",{staticClass:"iconfont icon-xin right-end-star"})]:["chat"===t.scene?e("img",{staticClass:"heartbeat-img",attrs:{src:n(1522),alt:"heartbeat"}}):e("img",{staticClass:"heartbeat-img",attrs:{src:n(1521),alt:"heartbeat"}})]],2)}),[],!1,null,"661332ee",null);e.a=component.exports},618:function(t,e,n){"use strict";n(11),n(6),n(12),n(13),n(8),n(7);var o=n(2),r=(n(4),n(128)),l=n(1);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}var d={props:{modelInfo:{type:Object,default:function(){}}},data:function(){return{downLoadBoxShow:!1,downLoading:!1,isDownLoad:!1,urlData:{}}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(l.c)("user",["isLoggedIn"])),watch:{downLoadBoxShow:{handler:function(t){t||(this.urlData={})}}},methods:{onClose:function(){this.isDownLoad||this.downLoadBoxShow&&(this.downLoadBoxShow=!1)},getDownLoadUrl:function(){var t=this;this.isLoggedIn?1!=this.downLoadBoxShow?this.downLoading||(this.downLoading=!0,Object(r.e)({model_ver_no:this.modelInfo.model_ver_no}).then((function(e){if(1e4===e.status.code)t.urlData=e.data,t.urlData.url||t.urlData.backup?t.downLoadBoxShow=!0:t.$message({message:t.$t("NoDownload"),type:"warning"});else if(70001===e.status.code)t.$message({message:t.$t("downloadLimit"),type:"warning"});else{var n;t.$message({message:null==e||null===(n=e.status)||void 0===n?void 0:n.msg,type:"error"})}})).finally((function(){t.downLoading=!1}))):this.downLoadBoxShow=!1:this.$EventBus.$emit("openLoginDialog")},download:function(t,e){this.$logEvent("log_actions",{operation:"click_download_model_".concat("LORA"==this.modelInfo.type?"lora":"checkpoint"),behavior_info:this.modelInfo.id});var n=document.createElement("a");n.href=t,console.log(n.href),e&&(n.download=e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),this.downLoadBoxShow=!1}}},m=d,v=(n(4088),n(4089),n(0)),component=Object(v.a)(m,(function(){var t=this,e=t._self._c;return e("el-popover",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.onClose,expression:"onClose"}],attrs:{placement:"bottom-start",title:"",trigger:"manual","popper-class":"downPop"},model:{value:t.downLoadBoxShow,callback:function(e){t.downLoadBoxShow=e},expression:"downLoadBoxShow"}},[e("div",{staticClass:"downLoadBox",on:{mouseover:function(e){t.isDownLoad=!0},mouseout:function(e){t.isDownLoad=!1}}},[t.urlData.url?e("div",{staticClass:"item",on:{click:function(e){return t.download(t.urlData.url)}}},[e("span",[t._v(t._s(t.$t("downloadAddress"))+" 1")]),t._v(" "),e("i",{staticClass:"iconfont icon-icon-Download"})]):t._e(),t._v(" "),t.urlData.backup?e("div",{staticClass:"item",staticStyle:{"margin-top":"15px"},on:{click:function(e){return t.download(t.urlData.backup)}}},[e("span",[t._v(t._s(t.$t("downloadAddress"))+" "+t._s(t.urlData.url?2:1))]),t._v(" "),e("i",{staticClass:"iconfont icon-icon-Download"})]):t._e()]),t._v(" "),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.downLoading,expression:"downLoading"}],staticClass:"modelDownload",attrs:{slot:"reference"},on:{click:t.getDownLoadUrl},slot:"reference"},[t._t("default",(function(){return[e("i",{staticClass:"iconfont icon-icon-Download"})]}))],2)],1)}),[],!1,null,"30ff42d8",null);e.a=component.exports},783:function(t,e,n){"use strict";(function(t){n(11),n(6),n(12),n(13),n(8),n(4),n(7);var o=n(2),r=n(10),l=n(1);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.a={inject:["chatIndex"],props:{leftCollapsed:{type:Boolean,default:!1},rightCollapsed:{type:Boolean,default:!1},onlyBack:{type:Boolean,default:!1}},data:function(){return{logo:n(315),envMark:"",coins:[{name:"credit",icon:n(205),type:"calculateCoins",desc:"new_credit_desc"},{name:"stamina",icon:n(160),type:"tempCoins",desc:"new_stamina_desc"}]}},computed:d(d(d(d(d({},Object(l.c)("user",["isLoggedIn","isCompanyAccount"])),Object(l.e)("payment",["paymentInfo"])),Object(l.e)("user",["userInfo"])),Object(l.c)("character",["characterInfo","sessionId","currentTimbreObj"])),{},{isShowBackBtn:function(){return this.chatIndex.leftCollapsed},getCoinTitle:function(){var t=this;return function(e){return t.$t(e.type)+"："+t.$t("balance")+" "+(t.paymentInfo[e.type]||0)+", "+t.$t(e.desc)}}}),filters:{formatNumberForeign:r.p},methods:d(d({},Object(l.d)("character",["SET_CURRENT_TIMBRE_OBJ"])),{},{goback:function(){this.chatIndex.goBack()},toHome:function(){this.$router.push(this.localePath("/"))},openLeft:function(){this.$emit("openLeft")},openRight:function(){this.$emit("openRight")},toMall:function(t){if(this.isLoggedIn){var e=this.localePath("/mall");window.open(e+t,"_blank")}else this.$EventBus.$emit("openLoginDialog",{callBack:function(){}})},openSetting:function(){this.$emit("openSetting")},toggleMenu:function(){this.$EventBus.$emit("$_toggleLeftMenu")}}),mounted:function(){this.envMark=t.version||""}}}).call(this,n(245))},784:function(t,e,n){"use strict";(function(t){n(11),n(12),n(13),n(8);var o=n(3),r=n(2),l=(n(20),n(19),n(6),n(50),n(122),n(18),n(4),n(177),n(28),n(44),n(7),n(125)),c=n.n(l),d=n(1),m=n(211),v=n(936),f=n(368),h=n(476),_=n(84),y=n(690);function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.a={name:"ChatLeft",inject:["chatIndex"],components:{HandlePopover:v.a,ConfirmModal:f.a,AiChatEditForm:h.a},props:{isCollapsed:{type:Boolean,default:!1}},data:function(){return{envMark:"",logo:n(315),formatMsg:m.a,isRecentChatsExpanded:!0,isCharactersExpanded:!0,recentChats:[],currentChatIndex:-1,options:[{i18nKey:"Edit",type:"edit",icon:"iconfont icon-bianji1"},{i18nKey:"Delete",type:"delete",icon:"iconfont icon-postDelete"}],handleForm:{title:""},editIndex:null,curHandle:"edit",recentCharacters:[],currentCharacterName:null}},computed:w(w(w({},Object(d.c)("user",["isLoggedIn"])),Object(d.c)("tavern",["editLoading","currentCharacter","isDialogLoading","isGenerating"])),{},{groupedChats:function(){var t=this.recentChats,e=this.getLastMesTimestamp,n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime(),r=o-6048e5,l=o-2592e6,c={today:{title:this.$t("today"),items:[]},sevenDays:{title:this.$t("lastWeek"),items:[]},thirtyDays:{title:this.$t("lastMonth"),items:[]}};return t.sort((function(a,b){var t=e(a.last_mes);return e(b.last_mes)-t})).forEach((function(t){var n=e(t.last_mes);n>=o?c.today.items.push(t):n>=r?c.sevenDays.items.push(t):n>=l&&c.thirtyDays.items.push(t)})),Object.values(c).filter((function(t){return t.items.length>0}))}}),watch:{groupedChats:{handler:function(t){var e;null!==(e=t[0])&&void 0!==e&&null!==(e=e.items)&&void 0!==e&&e.length&&(this.currentChatIndex="".concat(t[0].items[0].file_name,"_").concat(t[0].items[0].last_mes))},deep:!0}},mounted:function(){this.envMark=t.version||"",this.initEvent()},beforeDestroy:function(){this.destroyEvent()},methods:w(w({},Object(d.d)("tavern",["SET_EDIT_LOADING"])),{},{getLastMesTimestamp:function(t){if(!t)return 0;var e=t.replace(/(\d)([ap]m)/i,"$1 $2");return c()(e).valueOf()},toHome:function(){this.$router.push(this.localePath("/"))},toggleCollapse:function(){this.$emit("toggle-collapse",!this.isCollapsed)},toggleRecentChats:function(){this.isRecentChatsExpanded=!this.isRecentChatsExpanded},toggleCharacters:function(){this.isCharactersExpanded=!this.isCharactersExpanded},handleNewChat:function(){this.$EventBus.$emit(_.b.ST_NEW_CHAT)},changeChat:function(t,e){this.currentChatIndex=e,this.$EventBus.$emit(_.b.ST_CHANGE_CHAT,t)},moreActions:function(t,e){var n;this.curHandle=t;var o=e.file_name,r=e.preview_message,l=e.last_mes;switch(this.editIndex=this.recentChats.findIndex((function(t){return t.file_name===o})),t){case"edit":this.handleForm.title=null===(n=o||Object(m.a)(r||"",!0)||l)||void 0===n?void 0:n.split(".jsonl")[0],this.$refs.confirmModal.show({title:this.$t("lastChatEditTitle"),customClose:!0,source:"ST"});break;case"delete":this.$refs.confirmModal.show({subTitle:this.$t("lastChatDelTitle"),mainTitle:this.$t("lastChatDelMainTitle"),handleMethods:"Del",source:"ST"})}},handleClickCharacter:function(t){this.$store.dispatch("tavern/setDialogLoading",!0),this.$EventBus.$emit(_.b.ST_CHANGE_CHARACTER,t),this.currentCharacterName=null==t?void 0:t.name},getAvatar:function(t){return"".concat("https://tavern.seaart.ai","/thumbnail?type=avatar&file=").concat(encodeURIComponent(t))},getFirstLetter:function(t){return t?t.charAt(0).toUpperCase():""},formatChatTitle:function(t){return t?t.replace(/\.jsonl$/,""):""},formatTimestampCustom:function(t){if(!t)return"";var e=new Date,n=new Date(t),o=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime(),r=o-864e5;return t>=o?n.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1}):t>=r?this.$t("yesterday"):n.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"}).replace("/","/")},hideEditChatDialog:function(){this.$refs.confirmModal.handleClose()},handleConfirmModalConfirm:function(){switch(this.curHandle){case"edit":this.SET_EDIT_LOADING(!0),this.handleEditChat();break;case"delete":this.handleDeleteChat()}},handleEditChat:function(){var t,e=null===(t=this.recentChats[this.editIndex])||void 0===t?void 0:t.file_name,data={avatar_url:this.chatIndex.characterData.st_card_id+".png",is_group:!1,original_file:e,renamed_file:this.handleForm.title+".jsonl"};this.$EventBus.$emit(_.b.ST_EDIT_CHAT,data)},handleDeleteChat:function(){var t,e=null===(t=this.recentChats[this.editIndex])||void 0===t?void 0:t.file_name,data={avatar_url:this.chatIndex.characterData.st_card_id+".png",chatfile:e};this.$EventBus.$emit(_.b.ST_DELETE_CHAT,data)},handleDeleteCharacter:function(t){var e,n=this,o=!1;(null==t?void 0:t.name)===(null===(e=this.currentCharacter)||void 0===e?void 0:e.name)&&(o=!0),this.$hyConfirm({content:this.$t("tavern1")}).then((function(){if(t&&null!=t&&t.avatar){var data={avatar:t.avatar,deleteChats:!0,updateUI:o};n.$EventBus.$emit(_.b.ST_DELETE_CHAT_CHARACTER,data),n.handleDeleteHomeCharacter(t)}else n.$message.error(n.$t("taskOperateFailed"))}))},handleDeleteHomeCharacter:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,data,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=t&&t.name){n.next=3;break}return e.$message.error(e.$t("taskOperateFailed")),n.abrupt("return");case 3:return n.prev=3,data={card_id:t.name},n.next=7,Object(y.a)(data);case 7:if(1e4!==(null==(r=n.sent)||null===(o=r.status)||void 0===o?void 0:o.code)){n.next=12;break}e.$message.success(e.$t("deleteSuccess")),n.next=13;break;case 12:throw new Error((null==r||null===(l=r.status)||void 0===l?void 0:l.message)||e.$t("taskOperateFailed"));case 13:n.next=18;break;case 15:n.prev=15,n.t0=n.catch(3),e.$message.error(n.t0.message||e.$t("taskOperateFailed"));case 18:case"end":return n.stop()}}),n,null,[[3,15]])})))()},initEvent:function(){var t=this;this.$EventBus.$on(_.b.ST_CHAT_LIST,(function(data){t.recentChats=data})),this.$EventBus.$on(_.b.ST_CHARACTER_LIST,(function(data){var e=data.sort((function(a,b){return b.date_last_chat-a.date_last_chat}));t.recentCharacters=e.filter((function(t,e,n){return e===n.findIndex((function(e){return e.name===t.name}))}))}))},destroyEvent:function(){this.$EventBus.$off(_.b.ST_CHAT_LIST),this.$EventBus.$off(_.b.ST_CHARACTER_LIST)}})}}).call(this,n(245))},828:function(t,e,n){"use strict";n(50),n(22),n(49),n(8),n(16),n(21),n(11),n(6),n(12),n(13),n(4),n(7);var o=n(2),r=(n(1121),n(47),n(682)),l=n.n(r),c=(n(19),n(10)),d={props:{type:{type:String,default:""},isCheck:{type:Boolean,default:!1},item:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{url:function(){var t,e=((null===(t=this.item)||void 0===t?void 0:t.banner)||{}).url;return Object(c.K)(e,"low")}},methods:{handleEvent:function(t){this.$emit("handle",t,this.item)}}},m=(n(4978),n(0)),v=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"work-box",class:{"check-box":"CHECK"===t.type,check:t.isCheck},on:{click:function(e){return e.stopPropagation(),t.handleEvent("CHECK")}}},[e("div",{staticClass:"img-box",style:{backgroundImage:"url("+t.url+")"}}),t._v(" "),e("span",{staticClass:"del-btn",on:{click:function(e){return e.stopPropagation(),t.handleEvent("DEL")}}},[e("i",{staticClass:"el-icon-delete-solid"})])])}),[],!1,null,"3645593b",null).exports,f=n(36),h=n(1);function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var C={components:{WorkBox:v,ElEmpty:l.a},props:["selectIds","modelData"],data:function(){return{params:{page:1,page_size:30,model_no:this.$route.params.id,model_ver_no:"",type:"my",time_to:0},list:[],loading:!1,isEnd:!1}},computed:y(y(y({},Object(h.e)("creation",["generateViewShow"])),Object(h.e)("user",["cdnHost"])),{},{emptyImgUrl:function(){return"https://".concat(this.cdnHost,"/static/upload/20230620/c72217d5-e837-483c-9d47-861edb994f70.png")},loadingText:function(){return this.isEnd?this.$t("NoMoreData"):this.loading?this.$t("Loading")+"...":""},isShowLoading:function(){return this.loading||1!==this.params.page&&this.isEnd}}),watch:{generateViewShow:function(t){t||this.refreshList()},modelData:{handler:function(t){this.params.model_ver_no=t.model_ver_no,this.getWorkList()},deep:!0}},mounted:function(){var t;this.params.model_ver_no=null===(t=this.modelData)||void 0===t?void 0:t.model_ver_no,this.addScrollEvent()},methods:{refreshList:function(){this.params.page=1,this.params.time_to=0,this.list=[],this.getWorkList()},getWorkList:function(){var t=this;this.loading=!0,Object(f.artworkList)(this.params).then((function(e){var n=e.data,o=n.items,r=n.has_more;t.list=t.list.concat(o||[]),1===t.params.page&&(t.params.time_to=e.data.time_ms),t.isEnd=!r,t.loading=!1})).catch((function(e){t.loading=!1}))},handleBox:function(t,e){"CHECK"===t&&this.$emit("change",e)},addScrollEvent:function(){var t=this,e=document.querySelector("#editModelForm");e.removeEventListener("scroll",(function(){})),e.addEventListener("scroll",(function(){!(e.scrollHeight-e.scrollTop<=e.clientHeight+250)||t.loading||t.isEnd||(console.log("已经滚动到底部了"),t.params.page++,t.getWorkList())}))}}},w=(n(4979),{components:{WorkBox:v,ModelWork:Object(m.a)(C,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"relation-work"},[e("p",{staticClass:"title flex flex-col"},[e("span",[t._v("\n      "+t._s(t.$t("RelatedWorks"))+"\n      "),e("i",{staticClass:"el-icon-refresh",class:{loading:t.loading},on:{click:t.refreshList}})]),t._v(" "),e("span",{staticClass:"form-item-tips"},[t._v(t._s(t.$t("modelWorkDesc")))])]),t._v(" "),e("div",{staticClass:"work-list"},[t._l(t.list,(function(n,i){return e("work-box",{key:"works_"+i,attrs:{type:"CHECK",item:n,isCheck:t.selectIds.includes(n.id)},on:{handle:t.handleBox}})})),t._v(" "),t.isEnd&&!t.list.length?e("el-empty",{attrs:{description:t.$t("ModelWorkEmptyText"),image:t.emptyImgUrl}}):t._e(),t._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.isShowLoading,expression:"isShowLoading"}],staticClass:"scroll-loading"},[t._v(t._s(t.loadingText))])],2)])}),[],!1,null,"59982637",null).exports},props:["value","modelData"],data:function(){return{}},computed:{selectIds:function(){return this.value.map((function(t){return t.id}))}},methods:{goToGerenate:function(){this.$EventBus.$emit("openGenerate",{action:1,data:{source:Object.assign({},this.modelData,{taskSource:3})}}),this.showMessage()},handleBox:function(t,e){var n=e.id,o=JSON.parse(JSON.stringify(this.value)),r=o.findIndex((function(t){return t.id===n}));-1!==r&&"DEL"===t&&(o.splice(r,1),this.$emit("input",o))},changeSelectList:function(t){var e=t.id,n=JSON.parse(JSON.stringify(this.value)),o=n.findIndex((function(t){return t.id===e}));if(-1===o){if(!(n.length<10))return void this.$message.warning(this.$t("SelectWorkMaxText"));n.push(t)}else n.splice(o,1);this.$emit("input",n)},showMessage:function(){this.$alert(this.$t("ModelGenerateTips"),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),customClass:"custom-confirm",type:"warning",callback:function(t){}})}}}),x=(n(4980),Object(m.a)(w,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"model-work"},[e("div",{staticClass:"work-list"},[e("div",{staticClass:"generate-box",on:{click:t.goToGerenate}},[e("i",{staticClass:"iconfont icon-play"}),t._v("\n      "+t._s(t.$t("GotoGenerate"))+"\n    ")]),t._v(" "),t._l(t.value,(function(n,i){return e("work-box",{key:"work_"+i,attrs:{item:n},on:{handle:t.handleBox}})}))],2),t._v(" "),e("model-work",{attrs:{selectIds:t.selectIds,modelData:t.modelData},on:{change:t.changeSelectList}})],1)}),[],!1,null,"1c6dc7c2",null));e.a=x.exports},831:function(t,e,n){"use strict";n(19),n(18);var o=n(14),r=(n(4902),n(47),n(1148)),l=n.n(r),c=(n(50),n(49),n(4),n(92),n(7),n(52)),d={data:function(){return{editTag:"",visible:!1}},props:["tag"],watch:{visible:function(t){t&&(this.editTag=this.tag)}},methods:{updateIntTag:function(){this.$emit("changeTag",this.editTag,this.tag)}}},m=(n(4903),n(0)),v=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e("el-popover",{attrs:{trigger:"click","popper-class":"tag-edit-popover",placement:"bottom-start"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"tag-edit-content"},[e("el-input",{attrs:{type:"textarea",size:"small",placeholder:t.$t("pleaseEnte")},model:{value:t.editTag,callback:function(e){t.editTag=e},expression:"editTag"}}),t._v(" "),e("div",{staticClass:"tag-edit-buttons"},[e("el-button",{attrs:{size:"mini"},on:{click:function(e){t.visible=!1}}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){t.updateIntTag(),t.visible=!1}}},[t._v(t._s(t.$t("Confirm")))])],1)],1),t._v(" "),e("span",{attrs:{slot:"reference"},slot:"reference"},[t._t("default")],2)])}),[],!1,null,null,null).exports,f={props:{value:{type:Array,default:function(){return[]}},isView:{type:Boolean,default:!1}},components:{SwipeableList:c.default,ElTag:l.a,EditTag:v},computed:{imgs:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},allTag:function(){var t=[];return this.value.forEach((function(e){var n;null==e||null===(n=e.tags)||void 0===n||n.forEach((function(e){var n=t.findIndex((function(t){return t.name===e}));-1===n?t.push({name:e,num:1}):t[n].num+=1}))})),t}},watch:{index:{handler:function(t){var e;this.intTag=null===(e=this.imgs[t])||void 0===e?void 0:e.tags}},dialogVisible:{handler:function(t){var e;t&&(this.intTag=null===(e=this.imgs[this.index])||void 0===e?void 0:e.tags)}}},data:function(){return{dialogVisible:!1,index:-1,intTag:[],intTagTxt:"",newTagTxt:"",itemScroll:null,itemScrollLeft:null}},methods:{show:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.index=t,this.dialogVisible=!0,this.getItemScrollLeft()},tagInputClick:function(t){t.target.closest(".el-tag")||this.$refs.intTagTxt.focus()},newTagInputClick:function(t){t.target.closest(".el-tag")||this.$refs.newTagTxt.focus()},setIntTag:function(t,e){this.intTag[e]=t;var n=Object(o.a)(this.value);n[this.index].tags=Object(o.a)(this.intTag),this.$emit("input",n)},setAllTag:function(t,e){var n=Object(o.a)(this.value);n.forEach((function(n){n.tags.forEach((function(o,i){o==e&&(n.tags[i]=t)}))})),this.$emit("input",n)},intTagDelete:function(t){var e=this;this.$confirm(this.$t(this.$t("imgDet7")),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){e.intTag.splice(t,1);var n=Object(o.a)(e.value);n[e.index].tags=e.intTag,e.$emit("input",n)})).catch((function(){}))},newTagDelete:function(t){var e=this;this.$confirm(this.$t(this.$t("imgDet7")),this.$t("Tip"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){var n=Object(o.a)(e.value);n.forEach((function(e){e.tags.forEach((function(n,i){n==t&&e.tags.splice(i,1)}))})),e.$emit("input",n)})).catch((function(){}))},tagInputChange:function(){var t=Object(o.a)(this.value);t[this.index].tags.push(this.intTagTxt),this.$emit("input",t),this.intTagTxt=""},newTagInputChange:function(){},addTag:function(t){var e=Object(o.a)(this.value),n=this.newTagTxt.trim();n&&(e.forEach((function(e){-1==e.tags.indexOf(n)&&(t?e.tags.unshift(n):e.tags.push(n))})),this.$emit("input",e),this.newTagTxt="")},carouselChange:function(t){this.index=t,this.changeScroll()},imgItemChange:function(t){this.$refs.imgCnt.setActiveItem(t),this.changeScroll()},getItemScrollLeft:function(){var t=this;this.$nextTick((function(){t.$refs.listItem&&t.$refs.listItem.forEach((function(e){var n;null!==(n=e.classList)&&void 0!==n&&n.contains("imgActivate")&&(t.itemScrollLeft=e.getBoundingClientRect().left)}))}))},changeScroll:function(){var t=this;this.$nextTick((function(){t.$refs.listItem.forEach((function(e,n){e.classList.contains("imgActivate")&&(t.itemScroll={value:e.getBoundingClientRect().left,index:n})}))}))}}},h=f,_=(n(4904),Object(m.a)(h,(function(){var t,e=this,n=e._self._c;return n("el-dialog",{attrs:{title:e.$t("imgDet1"),visible:e.dialogVisible,width:"1365px",top:"5vh","custom-class":"trainDialog"},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.dialogVisible?n("div",{staticClass:"imgDet"},[n("div",{staticClass:"imgBox",style:{width:(null===(t=e.imgs[e.index])||void 0===t||null===(t=t.tags)||void 0===t?void 0:t.length)>0?"644px":"100%"}},[n("div",{staticClass:"changeBtn leftBtn",on:{click:function(t){return e.$refs.imgCnt.prev()}}},[n("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),n("div",{staticClass:"changeBtn rightBtn",on:{click:function(t){return e.$refs.imgCnt.next()}}},[n("i",{staticClass:"el-icon-arrow-right"})]),e._v(" "),n("div",{staticClass:"imgInfo"},[n("el-carousel",{ref:"imgCnt",attrs:{autoplay:!1,arrow:"never","initial-index":e.index,"indicator-position":"none"},on:{change:function(t,n){return e.carouselChange(t)}}},e._l(e.imgs,(function(t,e){return n("el-carousel-item",{key:e},[0==t.train_model_material_type||0==t.material_type?n("img",{attrs:{src:t.url||t.cover,alt:""}}):n("video",{attrs:{src:t.url,controls:"",muted:""},domProps:{muted:!0}})])})),1)],1),e._v(" "),n("div",{staticClass:"imgList"},[n("swipeable-list",{attrs:{scrollLeftnum:e.itemScrollLeft,scrollChange:e.itemScroll,top:"0px",height:"100%",isShowIconBtn:!1}},e._l(e.imgs,(function(t,o){return n("div",{key:o,ref:"listItem",refInFor:!0,staticClass:"imgItem",class:{imgActivate:o==e.index},on:{click:function(t){return e.imgItemChange(o)}}},[0==t.train_model_material_type||0==t.material_type?n("img",{attrs:{src:t.url||t.cover,alt:""}}):n("video",{attrs:{src:t.url}}),e._v(" "),1==t.train_model_material_type||1==t.material_type?n("div",{staticClass:"videoIcon"},[n("i",{staticClass:"iconfont icon-zanting1"})]):e._e()])})),0)],1)]),e._v(" "),e.isView?e._e():n("div",{staticClass:"tagBox"},[n("div",{staticClass:"tagTip"},[n("i",{staticClass:"iconfont icon-Union"}),e._v(" "),n("span",[e._v(e._s(e.$t("imgDet5")))])]),e._v(" "),n("div",{staticClass:"tagInput newTagInput",on:{click:e.tagInputClick}},[e._l(e.intTag,(function(t,o){return[n("EditTag",{key:"tag_"+t+o,attrs:{tag:t},on:{changeTag:function(t,n){return e.setIntTag(t,o)}}},[n("el-tag",{attrs:{closable:""},on:{close:function(t){return e.intTagDelete(o)}}},[n("span",{staticClass:"tagTxt"},[e._v(e._s(t))]),e._v(" "),n("span",{staticClass:"iconfont icon-icon_jubuxiufu"})])],1)]})),e._v(" "),n("el-input",{ref:"intTagTxt",attrs:{type:"text",placeholder:e.$t("pleaseEnte"),resize:"none"},on:{change:e.tagInputChange},model:{value:e.intTagTxt,callback:function(t){e.intTagTxt=t},expression:"intTagTxt"}})],2),e._v(" "),n("div",{staticClass:"tagTip"},[n("i",{staticClass:"iconfont icon-Union"}),e._v(" "),n("span",[e._v(e._s(e.$t("imgDet6")))])]),e._v(" "),n("div",{staticClass:"tagInput newTagInput",on:{click:e.newTagInputClick}},[e._l(e.allTag,(function(t,o){return[n("EditTag",{key:"tag_"+t+o,attrs:{tag:t.name},on:{changeTag:function(t,n){return e.setAllTag(t,n)}}},[n("el-tag",{attrs:{closable:""},on:{close:function(n){return e.newTagDelete(t.name)}}},[n("span",{staticClass:"tagTxt"},[e._v(e._s(t.num>1?"".concat(t.name,"(").concat(t.num,")"):"".concat(t.name)))]),e._v(" "),n("span",{staticClass:"iconfont icon-icon_jubuxiufu"})])],1)]})),e._v(" "),n("el-input",{ref:"newTagTxt",attrs:{type:"text",placeholder:e.$t("pleaseEnte"),resize:"none"},on:{change:e.newTagInputChange},model:{value:e.newTagTxt,callback:function(t){e.newTagTxt=t},expression:"newTagTxt"}})],2),e._v(" "),n("div",{staticClass:"btnItem"},[n("div",{on:{click:function(t){return e.addTag(!0)}}},[e._v(e._s(e.$t("imgDet3")))]),e._v(" "),n("div",{on:{click:function(t){return e.addTag()}}},[e._v(e._s(e.$t("imgDet4")))])])])]):e._e()])}),[],!1,null,"51f572b6",null));e.a=_.exports;installComponents(_,{SwipeableList:n(52).default})},898:function(t,e,n){"use strict";var o={name:"StCustomConfirm",data:function(){return{dialogVisible:!1,nsfwUrl:""}},methods:{openDialog:function(t){this.nsfwUrl=t,this.dialogVisible=!0},handleClose:function(t){t()},handleCancel:function(){this.dialogVisible=!1},handleConfirm:function(){this.dialogVisible=!1,this.nsfwUrl&&window.open(this.nsfwUrl,"_blank")}}},r=(n(4026),n(0)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{"custom-class":"custom-confirm-st",visible:t.dialogVisible,"close-on-click-modal":!1,"append-to-body":!0,"close-on-press-escape":!1,width:"530px","before-close":t.handleClose,"show-close":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{staticClass:"icon",attrs:{src:n(964),alt:"Warning Icon"}}),t._v(" "),e("div",{staticClass:"message"},[e("h3",[t._v(t._s(t.$t("warnTitle")))]),t._v(" "),e("div",{staticClass:"warn-content"},[e("i18n",{attrs:{path:"warnContent1"},scopedSlots:t._u([{key:"info",fn:function(){return[e("span",{staticClass:"info-text"},[t._v(t._s(t.$t("warnInfo")))])]},proxy:!0}])})],1),t._v(" "),e("div",{staticClass:"warn-content"},[t._v(t._s(t.$t("warnContent2")))])]),t._v(" "),e("div",{staticClass:"actions"},[e("el-button",{attrs:{type:"info"},on:{click:t.handleCancel}},[t._v(t._s(t.$t("Cancel")))]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.handleConfirm}},[t._v(t._s(t.$t("warnGo")))])],1)])}),[],!1,null,"69c58428",null);e.a=component.exports},899:function(t,e,n){"use strict";n(65),n(24),n(26);var o={name:"Loading",data:function(){return{progress:0,timer:null,autoHideTimer:null,tipTimer:null,increment:1,visible:!0,isWaitingComplete:!1,tipKeys:["ST_Tips_Content01","ST_Tips_Content02","ST_Tips_Content03","ST_Tips_Content04","ST_Tips_Content05","ST_Tips_Content06","ST_Tips_Content07","ST_Tips_Content08","ST_Tips_Content09","ST_Tips_Content10"],currentTipIndex:0}},props:{autoStart:{type:Boolean,default:!0},autoHide:{type:Boolean,default:!0},autoHideTime:{type:Number,default:18e4}},methods:{init:function(){var t=this;this.autoStart&&this.startLoading(),this.autoHide&&(this.autoHideTimer=setTimeout((function(){t.completeLoading()}),this.autoHideTime)),this.switchTip()},startLoading:function(){var t=this;this.visible=!0,this.$store.dispatch("tavern/setDialogLoading",!0),this.timer=setInterval((function(){if(t.progress>=99&&!t.isWaitingComplete)t.stopLoading();else{if(t.progress>=100)return t.stopLoading(),void setTimeout((function(){t.visible=!1}),500);t.progress<70?t.increment=1:t.progress<90?t.increment=.5:t.increment=.1,t.progress=Math.min(t.isWaitingComplete?100:99,t.progress+t.increment)}}),100)},stopLoading:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},resetLoading:function(){this.stopLoading(),this.progress=0,this.isWaitingComplete=!1,this.visible=!0},completeLoading:function(){var t=this;this.stopLoading(),this.progress=100,setTimeout((function(){t.visible=!1}),500)},switchTip:function(){var t=this;this.tipTimer=setInterval((function(){t.currentTipIndex=(t.currentTipIndex+1)%t.tipKeys.length}),5e3)},getCdnImageUrl:function(t){return"https://image.cdn2.seaart.me/tavern/loading/".concat(t,".webp")}},mounted:function(){this.init()},beforeDestroy:function(){this.stopLoading(),this.autoHideTimer&&clearTimeout(this.autoHideTimer),this.tipTimer&&clearInterval(this.tipTimer)}},r=(n(4027),n(0)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"loading-box"},[e("div",{staticClass:"loading-bg"}),t._v(" "),e("div",{staticClass:"loading-content"},[e("div",{staticClass:"loading-header"},[e("img",{staticClass:"loading-header-star",attrs:{src:t.getCdnImageUrl("loading-star"),alt:"seaart"}}),t._v(" "),e("h2",[t._v("\n        "+t._s(t.$t("ST_Loading_Title01"))),t._m(0)]),t._v(" "),e("img",{staticClass:"loading-header-star-right",attrs:{src:t.getCdnImageUrl("loading-star-2"),alt:"seaart"}})]),t._v(" "),e("div",{staticClass:"loading-persons"},[e("img",{staticClass:"loading-persons-item",attrs:{src:t.getCdnImageUrl("characters-new-2"),alt:"seaart"}})]),t._v(" "),e("div",{staticClass:"tip"},[e("h3",[t._v(t._s(t.$t("ST_Tips_Name")))]),t._v(" "),e("p",[t._v(t._s(t.$t(t.tipKeys[t.currentTipIndex])))])]),t._v(" "),e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar"},[e("div",{staticClass:"progress-bar-inner",style:{width:"".concat(t.progress,"%")}},[e("img",{staticClass:"loading-progress-icon",attrs:{src:t.getCdnImageUrl("loading-progress"),alt:"seaart"}})])]),t._v(" "),e("div",{staticClass:"progress-bar-text"},[t._v(t._s(t.progress.toFixed(0))+"%")])])])]):t._e()}),[function(){var t=this,e=t._self._c;return e("span",{staticClass:"dots"},[e("span",[t._v(".")]),e("span",[t._v(".")]),e("span",[t._v(".")])])}],!1,null,"e8eef23e",null);e.a=component.exports},914:function(t,e,n){"use strict";n(16),n(24),n(525);var o=n(2);n(11),n(6),n(65),n(12),n(13),n(8),n(4),n(7);function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var c={props:{DSType:{type:Number,default:0},typeIndex:{type:String,default:""},value:{type:Object,default:function(){return{}}},config:{type:Object,default:function(){return{}}},defData:{type:Object,default:function(){return{}}},type:{type:String,default:""},isView:{type:Boolean,default:!1}},watch:{"datas.min_bucket_reso":{handler:function(t){t%this.datas.bucket_reso_steps!=0&&this.handleBucketResoChange("min_bucket_reso")}},"datas.max_bucket_reso":{handler:function(t){t%this.datas.bucket_reso_steps!=0&&this.handleBucketResoChange("max_bucket_reso")}},"datas.bucket_reso_steps":"validateBucketResolutions"},computed:{tabList:function(){var t=["trainParamete","datasetSettingsParams","sampleSetting","trainSaveSetting","learnOptimizer","network","labelingSettings","noiseSettings","AdvSet"];return 1===this.DSType?t.filter((function(t){return!["labelingSettings","noiseSettings","datasetSettingsParams"].includes(t)})):t},targetFramesValue:{get:function(){return this.datas.target_frames[0]?this.datas.target_frames[0]:1},set:function(t){this.$set(this.datas,"target_frames",[t])}},maxBatchSize:function(){var t=8;return["sd35_default"].includes(this.type)&&(t=1),["sd35L_default","sd35M_default","flux_default"].includes(this.type)&&(t=2),["illustrious_default","pony_default","sdxl_default"].includes(this.type)&&(t=4),1===this.DSType&&(t=2),t},disBatchSize:function(){return["sd35_default"].includes(this.type)},datas:{get:function(){return this.value},set:function(t){this.$emit("input",t)}},te_lr_disabled:function(){return this.datas.enable_train_unet||this.isView||"Prodigy"==this.datas.optimizer||["sd35_default"].includes(this.type)},enable_train_unet_disabled:function(){return this.datas.enable_train_text_encoder||this.isView||["sd35_default","flux_default"].includes(this.type)},videoWandHOptions:function(){return[{value:"720*720",label:"720x720"},{value:"960*544",label:"960x544"},{value:"544*960",label:"544x960"}]},gradientCheckpointingDisabled:function(){return["flux_default","sdxl_default","pony_default","illustrious_default","sd35L_default","sd35M_default"].includes(this.type)&&this.datas.train_batch_size>=2},videoResolution:function(){return this.value.text_to_img.width+"*"+this.value.text_to_img.height}},data:function(){return{intLearningRate:"",dialogVisible:!1,tabIndex:0,isOoenScroll:!1,mixed_precision_options:[{value:"no",label:"no"},{value:"fp16",label:"fp16"},{value:"bf16",label:"bf16"}],save_precision_as_options:[{value:"float",label:"float"},{value:"fp16",label:"fp16"},{value:"bf16",label:"bf16"}],time_step_sampling_options:[{value:"sigma",label:"sigma"},{value:"uniform",label:"uniform"},{value:"shift",label:"shift"}],learning_rate_options:[{value:1e-6,label:1e-6},{value:1e-5,label:1e-5},{value:5e-5,label:5e-5},{value:1e-4,label:1e-4},{value:2e-4,label:2e-4}],max_token_length_options:[{value:75,label:75},{value:150,label:150},{value:225,label:225},{value:512,label:512}],lr_scheduler_options:[],sampler_options:[],optimizer_options:[]}},created:function(){var t=this;this.isView||(this.config.sampler_name&&this.config.sampler_name.forEach((function(e){t.sampler_options.push({value:e,label:e})})),this.config.lr_schedulers&&this.config.lr_schedulers.forEach((function(e){t.lr_scheduler_options.push({value:e,label:e})})),this.config.optimizers&&this.config.optimizers.forEach((function(e){t.optimizer_options.push({value:e,label:"Prodigy"==e?"Prodigy（".concat(t.$t("newTrainPmt19"),"）"):e})})))},methods:{handleChangeBatchSize:function(t){this.handleStepValueChange("train_batch_size",1),["flux_default","sdxl_default","pony_default","illustrious_default","sd35L_default","sd35M_default"].includes(this.type)&&this.datas.train_batch_size>=2&&(this.datas.gradient_checkpointing=!0)},show:function(){this.dialogVisible=!0,this.optimizerChange({rate:this.datas.learning_rate}),this.validateBucketResolutions()},validateBucketResolutions:function(){0===this.DSType&&(this.handleBucketResoChange("min_bucket_reso"),this.handleBucketResoChange("max_bucket_reso"))},resetArg:function(t){var e,n=l({},this.value);n[t]=(null===(e=this.defData)||void 0===e?void 0:e[t])||n[t],this.$emit("input",n)},lrChange:function(t){if("down_lr_weight"==t||"up_lr_weight"==t){var e=this.datas[t].split(",");if(12!=e.length)this.$message.warning(this.$t("traindFormatTip")),this.resetArg(t);else{var n=!0;e.forEach((function(t){"-0"==t&&(n=!1),(isNaN(t)||parseFloat(t)>1||parseFloat(t)<0)&&(n=!1)})),n||(this.$message.warning(this.$t("traindFormatTip")),this.resetArg(t))}}else"mid_lr_weight"==t&&(isNaN(this.datas[t])||parseFloat(this.datas[t])>1||parseFloat(this.datas[t])<0)&&this.resetArg(t)},isUnetChange:function(t){var e,n=l({},this.value);t?n.te_lr=0:n.te_lr=(null===(e=this.defData)||void 0===e?void 0:e.te_lr)||1e-4;this.$emit("input",n)},isEncoderChange:function(t){var e,n=l({},this.value);t?n.unet_lr=0:n.unet_lr=(null===(e=this.defData)||void 0===e?void 0:e.unet_lr)||1e-4;this.$emit("input",n)},restUnetLr:function(){var t=l({},this.value);t.unet_lr<1e-6?t.unet_lr=1e-6:t.unet_lr>.001&&(t.unet_lr=.001),t.unet_lr=Number(t.unet_lr),this.$emit("input",t)},restTeLr:function(){var t=l({},this.value);t.te_lr<1e-6?t.te_lr=1e-6:t.te_lr>.001&&(t.te_lr=.001),t.te_lr=Number(t.te_lr),this.$emit("input",t)},scrollToItem:function(t){this.tabIndex=t,this.$refs.listItem[t].scrollIntoView({behavior:"smooth",block:"start"})},isElementInParentViewport:function(t){var e=t.parentElement.getBoundingClientRect(),rect=t.getBoundingClientRect();return rect.top>=e.top&&rect.bottom<=e.bottom},highlightTab:function(){if(this.isOoenScroll){for(var i=0;i<this.tabList.length;i++){var t=this.$refs.listItem[i];this.isElementInParentViewport(t)&&(this.tabIndex=i)}0==this.$refs.scrollContainer.scrollTop&&(this.tabIndex=0)}},videoResolutionChange:function(t){var e=l({},this.value);"720*720"==t?(e.text_to_img.width=720,e.text_to_img.height=720):"960*544"==t?(e.text_to_img.width=960,e.text_to_img.height=544):"544*960"==t&&(e.text_to_img.width=544,e.text_to_img.height=960),this.$emit("input",e)},resolutionChange:function(){var t=l({},this.value);parseInt(this.datas.resolutionWidth)>1024&&(this.datas.resolutionWidth=1024),parseInt(this.datas.resolutionWidth)<512&&(this.datas.resolutionWidth=512),parseInt(this.datas.resolutionHeight)>1024&&(this.datas.resolutionHeight=1024),parseInt(this.datas.resolutionHeight)<512&&(this.datas.resolutionHeight=512),t.resolutionWidth=parseInt(this.datas.resolutionWidth),t.resolutionHeight=parseInt(this.datas.resolutionHeight),t.text_to_img.width=parseInt(this.datas.resolutionWidth),t.text_to_img.height=parseInt(this.datas.resolutionHeight),this.$emit("input",t)},changeTxtToImgSeed:function(){if(!this.isView){var t=l({},this.value);t.text_to_img.seed=this.getRandomSeed(),1===this.DSType&&t.text_to_img.seed>2147483647&&(t.text_to_img.seed=2147483647),this.$emit("input",t)}},setInputSeed:function(){1===this.DSType&&this.datas.text_to_img.seed>2147483647&&(this.datas.text_to_img.seed=2147483647),this.datas.text_to_img.seed=Number(this.datas.text_to_img.seed)},changeSeed:function(){if(!this.isView){var t=l({},this.value);t.seed=this.getRandomSeed(),this.$emit("input",t)}},getRandomSeed:function(){return Math.floor(4294967294*Math.random())+1},optimizerChange:function(){var t,e,n,o,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).rate,c=l({},this.value);"Prodigy"==this.datas.optimizer?(this.learning_rate_options=[{value:1,label:"1.0（".concat(this.$t("newTrainPmt20"),"）")},{value:1.2,label:1.2},{value:.5,label:.5}],c.learning_rate=r||1,this.datas.enable_train_unet=!0,this.datas.enable_train_text_encoder=!1,c.te_lr=0,c.unet_lr=(null===(t=this.defData)||void 0===t?void 0:t.unet_lr)||1e-4):(this.learning_rate_options=[{value:1e-6,label:1e-6},{value:1e-5,label:1e-5},{value:5e-5,label:5e-5},{value:1e-4,label:1e-4},{value:2e-4,label:2e-4}],c.learning_rate=(null===(e=this.defData)||void 0===e?void 0:e.learning_rate)||1e-6,this.datas.enable_train_unet=!1,this.datas.enable_train_text_encoder=!1,c.te_lr=(null===(n=this.defData)||void 0===n?void 0:n.te_lr)||1e-4,c.unet_lr=(null===(o=this.defData)||void 0===o?void 0:o.unet_lr)||1e-4);this.$emit("input",c)},formatDuration:function(t){if(""!==t){var e=parseFloat(t);e<0&&(e=0),e>2&&(e=2),this.datas.text_to_img.duration=parseFloat(e.toFixed(1))}},formatFlowShift:function(t){if(""!==t){var e=parseFloat(t);e<0&&(e=0),e>20&&(e=20),this.datas.flow_shift=parseInt(e)}},handleStepValueChange:function(t,e){try{var n=this.datas[t];if(0!==n%e){var o=Math.floor(n/e)*e,r=l({},this.value);r[t]=o,this.$emit("input",r),this.$set(this.value,t,o),this.handleBucketResoChange("min_bucket_reso"),this.handleBucketResoChange("max_bucket_reso")}}catch(t){}},handleBucketResoChange:function(t){try{var e=this.datas.bucket_reso_steps;if(!e)return;var n=this.datas[t];0!==n%e&&(n=Math.round(n/e)*e),"min_bucket_reso"===t?(n<0&&(n=0),n>this.datas.max_bucket_reso&&(n=Math.floor(this.datas.max_bucket_reso/e)*e),this.datas.min_bucket_reso=n):"max_bucket_reso"===t&&(n>2048&&(n=Math.floor(2048/e)*e),n<this.datas.min_bucket_reso&&(n=Math.ceil(this.datas.min_bucket_reso/e)*e),this.datas.max_bucket_reso=n)}catch(t){}},viewHelpManual:function(){this.$emit("viewHelpManual")}}},d=c,m=(n(4908),n(4909),n(0)),component=Object(m.a)(d,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{visible:t.dialogVisible,width:"885px",top:"10vh","custom-class":"trainDialog"},on:{"update:visible":function(e){t.dialogVisible=e}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"title flex_m"},[t._v("\n      "+t._s(t.$t("AdvSet"))+"\n      "),e("el-tooltip",{attrs:{content:t.$t("trainingHelpManual"),placement:"right"}},[e("i",{staticClass:"iconfont icon-ruleIcon",on:{click:t.viewHelpManual}})])],1)]},proxy:!0}])},[t._v(" "),e("div",{staticClass:"TarinAdvSet"},[e("div",{staticClass:"tabs"},t._l(t.tabList,(function(n,o){return e("div",{key:o,staticClass:"tabItem",class:{activateIndex:t.tabIndex==o},on:{click:function(e){return t.scrollToItem(o)}}},[t._v("\n        "+t._s(t.$t(n))+"\n      ")])})),0),t._v(" "),e("div",{ref:"scrollContainer",staticClass:"dataList",on:{scroll:t.highlightTab,mouseover:function(e){t.isOoenScroll=!0},mouseout:function(e){t.isOoenScroll=!1}}},t._l(t.tabList,(function(o,r){return e("div",{key:r,ref:"listItem",refInFor:!0,staticClass:"dataBox"},[e("div",{staticClass:"dataTiT"},[t._v(t._s(t.$t(o)))]),t._v(" "),"trainParamete"==o?e("div",{staticClass:"dataCnt"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Repeat")]),t._v(" "),e("div",[t._v(t._s(t.$t("singleCount")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:1===t.DSType?20:50},model:{value:t.datas.repeat,callback:function(e){t.$set(t.datas,"repeat",e)},expression:"datas.repeat"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Epoch")]),t._v(" "),e("div",[t._v(t._s(t.$t("numberCycles")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:1===t.DSType?100:20},model:{value:t.datas.epoch,callback:function(e){t.$set(t.datas,"epoch",e)},expression:"datas.epoch"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Batch size")]),t._v(" "),e("div",[t._v(t._s(t.$t("batchSize")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView||t.disBatchSize,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,step:1,max:t.maxBatchSize},on:{change:t.handleChangeBatchSize},model:{value:t.datas.train_batch_size,callback:function(e){t.$set(t.datas,"train_batch_size",e)},expression:"datas.train_batch_size"}})],1)]),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Mixed precision")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainingMixedPrecision")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{disabled:t.isView||["flux_default","sd35_default"].includes(t.type),"popper-class":"custom-select"},model:{value:t.datas.mixed_precision,callback:function(e){t.$set(t.datas,"mixed_precision",e)},expression:"datas.mixed_precision"}},t._l(t.mixed_precision_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]):t._e(),t._v(" "),1==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Frame Sample")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainAdvSet_numSlices")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:20},model:{value:t.datas.frame_sample,callback:function(e){t.$set(t.datas,"frame_sample",e)},expression:"datas.frame_sample"}})],1)]):t._e(),t._v(" "),1==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Target Frames")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainAdvSet_numFrames")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:25},model:{value:t.targetFramesValue,callback:function(e){t.targetFramesValue=e},expression:"targetFramesValue"}})],1)]):t._e(),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Gradient Checkpointing")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams1")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams2_sub")))])]),t._v(" "),e("div",{staticClass:"dataRight"},[e("el-switch",{attrs:{disabled:t.isView||t.gradientCheckpointingDisabled},model:{value:t.datas.gradient_checkpointing,callback:function(e){t.$set(t.datas,"gradient_checkpointing",e)},expression:"datas.gradient_checkpointing"}})],1)]):t._e()]):t._e(),t._v(" "),"datasetSettingsParams"==o&&0==t.DSType?e("div",{staticClass:"dataCnt"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Enable Bucket")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams3")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams3_sub")))])]),t._v(" "),e("div",{staticClass:"dataRight"},[e("el-switch",{attrs:{disabled:t.isView},model:{value:t.datas.enable_bucket,callback:function(e){t.$set(t.datas,"enable_bucket",e)},expression:"datas.enable_bucket"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Bucket Reso Steps")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams4")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams4_sub")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:32,max:128,step:8},on:{change:function(e){return t.handleStepValueChange("bucket_reso_steps",8)}},model:{value:t.datas.bucket_reso_steps,callback:function(e){t.$set(t.datas,"bucket_reso_steps",e)},expression:"datas.bucket_reso_steps"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Min Bucket Reso")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams5")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams5_sub")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input-number",{attrs:{controls:!1,disabled:t.isView,min:0,max:t.datas.max_bucket_reso,step:t.datas.bucket_reso_steps},on:{change:function(e){return t.handleBucketResoChange("min_bucket_reso")}},model:{value:t.datas.min_bucket_reso,callback:function(e){t.$set(t.datas,"min_bucket_reso",e)},expression:"datas.min_bucket_reso"}})],1)])]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Max Bucket Reso")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams6")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams5_sub")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input-number",{attrs:{controls:!1,disabled:t.isView,min:t.datas.min_bucket_reso,max:2048,step:t.datas.bucket_reso_steps},on:{change:function(e){return t.handleBucketResoChange("max_bucket_reso")}},model:{value:t.datas.max_bucket_reso,callback:function(e){t.$set(t.datas,"max_bucket_reso",e)},expression:"datas.max_bucket_reso"}})],1)])]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Color Aug")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams7")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams7_sub")))])]),t._v(" "),e("div",{staticClass:"dataRight"},[e("el-switch",{attrs:{disabled:t.isView},model:{value:t.datas.color_aug,callback:function(e){t.$set(t.datas,"color_aug",e)},expression:"datas.color_aug"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Flip Aug")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams8")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams8_sub")))])]),t._v(" "),e("div",{staticClass:"dataRight"},[e("el-switch",{attrs:{disabled:t.isView},model:{value:t.datas.flip_aug,callback:function(e){t.$set(t.datas,"flip_aug",e)},expression:"datas.flip_aug"}})],1)])]):t._e(),t._v(" "),"sampleSetting"==o?e("div",{staticClass:"dataCnt"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("resolution")]),t._v(" "),e("div",[t._v(t._s(t.$t("sampleImageResolution")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[0==t.DSType?e("div",{staticClass:"resolutionBox"},[e("el-input",{attrs:{disabled:t.isView||"flux_default"===t.type},on:{change:t.resolutionChange},model:{value:t.datas.resolutionWidth,callback:function(e){t.$set(t.datas,"resolutionWidth",e)},expression:"datas.resolutionWidth"}},[e("template",{slot:"prefix"},[t._v("width")])],2),t._v(" "),e("el-input",{attrs:{disabled:t.isView||"flux_default"===t.type},on:{change:t.resolutionChange},model:{value:t.datas.resolutionHeight,callback:function(e){t.$set(t.datas,"resolutionHeight",e)},expression:"datas.resolutionHeight"}},[e("template",{slot:"prefix"},[t._v("height")])],2)],1):t._e(),t._v(" "),1==t.DSType?e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{disabled:t.isView,"popper-class":"custom-select"},on:{change:t.videoResolutionChange},model:{value:t.videoResolution,callback:function(e){t.videoResolution=e},expression:"videoResolution"}},t._l(t.videoWandHOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e()])]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Seed")]),t._v(" "),e("div",[t._v(t._s(t.$t("RandomSeed")))])]),t._v(" "),t.datas.text_to_img?e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"seedBox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.datas.text_to_img.seed,expression:"datas.text_to_img.seed"}],attrs:{type:"number",disabled:t.isView},domProps:{value:t.datas.text_to_img.seed},on:{change:t.setInputSeed,input:function(e){e.target.composing||t.$set(t.datas.text_to_img,"seed",e.target.value)}}}),t._v(" "),e("div",{on:{click:t.changeTxtToImgSeed}},[e("img",{attrs:{src:n(1069),alt:""}})])])]):t._e()]),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Sampler")]),t._v(" "),e("div",[t._v(t._s(t.$t("SamplingMethod")))])]),t._v(" "),t.datas.text_to_img?e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{disabled:t.isView,"popper-class":"custom-select"},model:{value:t.datas.text_to_img.sampler_name,callback:function(e){t.$set(t.datas.text_to_img,"sampler_name",e)},expression:"datas.text_to_img.sampler_name"}},t._l(t.sampler_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e()]):t._e(),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Prompts")]),t._v(" "),e("div",[t._v(t._s(t.$t("Prompt")))])]),t._v(" "),t.datas.text_to_img?e("div",{staticClass:"dataEntry"},[e("el-input",{attrs:{disabled:t.isView,type:"textarea",resize:"none"},model:{value:t.datas.text_to_img.prompt,callback:function(e){t.$set(t.datas.text_to_img,"prompt",e)},expression:"datas.text_to_img.prompt"}})],1):t._e()]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Negative Prompts")]),t._v(" "),e("div",[t._v(t._s(t.$t("NegativePrompts")))])]),t._v(" "),t.datas.text_to_img?e("div",{staticClass:"dataEntry"},[e("el-input",{attrs:{disabled:t.isView,type:"textarea",resize:"none"},model:{value:t.datas.text_to_img.negative_prompt,callback:function(e){t.$set(t.datas.text_to_img,"negative_prompt",e)},expression:"datas.text_to_img.negative_prompt"}})],1):t._e()]),t._v(" "),1==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Duraction")]),t._v(" "),e("div",[t._v(t._s(t.$t("Duration")))])]),t._v(" "),t.datas.text_to_img?e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input",{attrs:{disabled:t.isView,type:"number",min:"0",max:"4",step:"0.1",resize:"none"},on:{input:t.formatDuration},model:{value:t.datas.text_to_img.duration,callback:function(e){t.$set(t.datas.text_to_img,"duration",e)},expression:"datas.text_to_img.duration"}})],1)]):t._e()]):t._e()]):t._e(),t._v(" "),"trainSaveSetting"==o?e("div",{staticClass:"dataCnt"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Save every N epochs")]),t._v(" "),e("div",[t._v(t._s(t.$t("LoRAsaRounds")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:t.datas.epoch},on:{change:function(e){return t.optimizerChange()}},model:{value:t.datas.save_every_n_epochs,callback:function(e){t.$set(t.datas,"save_every_n_epochs",e)},expression:"datas.save_every_n_epochs"}})],1)]),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Save precision")]),t._v(" "),e("div",[t._v(t._s(t.$t("LoRAsaPrecision")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{"popper-class":"custom-select",disabled:t.isView||"flux_default"===t.type},model:{value:t.datas.save_precision_as,callback:function(e){t.$set(t.datas,"save_precision_as",e)},expression:"datas.save_precision_as"}},t._l(t.save_precision_as_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]):t._e()]):t._e(),t._v(" "),"learnOptimizer"==o?e("div",{staticClass:"dataCnt"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Learning Rate")]),t._v(" "),e("div",[t._v(t._s(t.$t("learningRate")))]),t._v(" "),e("div",[t._v(t._s(t.$t("trainDesc3")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{"popper-class":"custom-select",disabled:t.isView},model:{value:t.datas.learning_rate,callback:function(e){t.$set(t.datas,"learning_rate",e)},expression:"datas.learning_rate"}},t._l(t.learning_rate_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Unet lr")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainDesc4")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox",style:{opacity:t.datas.enable_train_text_encoder||t.isView||"Prodigy"==t.datas.optimizer?.2:1}},[e("el-input",{attrs:{type:"number",disabled:t.datas.enable_train_text_encoder||t.isView||"Prodigy"==t.datas.optimizer,resize:"none"},on:{change:t.restUnetLr},model:{value:t.datas.unet_lr,callback:function(e){t.$set(t.datas,"unet_lr",e)},expression:"datas.unet_lr"}})],1)])]):t._e(),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Text encoder lr")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainDesc5")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox",style:{opacity:t.datas.enable_train_unet||t.isView||"Prodigy"==t.datas.optimizer?.2:1}},[e("el-input",{attrs:{type:"number",disabled:t.te_lr_disabled,resize:"none"},on:{change:t.restTeLr},model:{value:t.datas.te_lr,callback:function(e){t.$set(t.datas,"te_lr",e)},expression:"datas.te_lr"}})],1)])]):t._e(),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Lr warm up")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt1")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1},model:{value:t.datas.lr_warmup,callback:function(e){t.$set(t.datas,"lr_warmup",e)},expression:"datas.lr_warmup"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Lr scheduler")]),t._v(" "),e("div",[t._v(t._s(t.$t("learningRateScheduler")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{"popper-class":"custom-select",disabled:t.isView},model:{value:t.datas.lr_scheduler,callback:function(e){t.$set(t.datas,"lr_scheduler",e)},expression:"datas.lr_scheduler"}},t._l(t.lr_scheduler_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Optimizer")]),t._v(" "),e("div",[t._v(t._s(t.$t("Optimizer")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{"popper-class":"custom-select",disabled:t.isView},on:{change:function(e){return t.optimizerChange()}},model:{value:t.datas.optimizer,callback:function(e){t.$set(t.datas,"optimizer",e)},expression:"datas.optimizer"}},t._l(t.optimizer_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Lr scheduler num cycles")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt2")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:5},model:{value:t.datas.lr_scheduler_num_cycles,callback:function(e){t.$set(t.datas,"lr_scheduler_num_cycles",e)},expression:"datas.lr_scheduler_num_cycles"}})],1)]),t._v(" "),t.isView||0!=t.DSType?t._e():e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Train unet only")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt3")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-switch",{attrs:{disabled:t.enable_train_unet_disabled},on:{change:t.isUnetChange},model:{value:t.datas.enable_train_unet,callback:function(e){t.$set(t.datas,"enable_train_unet",e)},expression:"datas.enable_train_unet"}})],1)]),t._v(" "),t.isView||0!=t.DSType?t._e():e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Train text encoder only")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt4")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-switch",{attrs:{disabled:t.datas.enable_train_unet||t.isView},on:{change:t.isEncoderChange},model:{value:t.datas.enable_train_text_encoder,callback:function(e){t.$set(t.datas,"enable_train_text_encoder",e)},expression:"datas.enable_train_text_encoder"}})],1)]),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Min snr gamma")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt5")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:0,max:20},model:{value:t.datas.min_snr_gamma,callback:function(e){t.$set(t.datas,"min_snr_gamma",e)},expression:"datas.min_snr_gamma"}})],1)]):t._e()]):t._e(),t._v(" "),"network"==o?e("div",{staticClass:"dataCnt"},[0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("enable block weights")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt6")))]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmtDesc1")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-switch",{attrs:{disabled:t.isView},model:{value:t.datas.enable_block_weights,callback:function(e){t.$set(t.datas,"enable_block_weights",e)},expression:"datas.enable_block_weights"}})],1)]):t._e(),t._v(" "),t.datas.enable_block_weights?e("div",{staticClass:"lr_box"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("down lr weight")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt7")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input",{attrs:{disabled:t.isView,type:"text",resize:"none"},on:{change:function(e){return t.lrChange("down_lr_weight")}},model:{value:t.datas.down_lr_weight,callback:function(e){t.$set(t.datas,"down_lr_weight",e)},expression:"datas.down_lr_weight"}})],1)])]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("mid lr weight")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt8")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input",{attrs:{disabled:t.isView,type:"text",resize:"none"},on:{change:function(e){return t.lrChange("mid_lr_weight")}},model:{value:t.datas.mid_lr_weight,callback:function(e){t.$set(t.datas,"mid_lr_weight",e)},expression:"datas.mid_lr_weight"}})],1)])]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("up lr weight")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt9")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input",{attrs:{disabled:t.isView,type:"text",resize:"none"},on:{change:function(e){return t.lrChange("up_lr_weight")}},model:{value:t.datas.up_lr_weight,callback:function(e){t.$set(t.datas,"up_lr_weight",e)},expression:"datas.up_lr_weight"}})],1)])]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("block_lr_zero_threshold")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt10")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,step:.1,min:0,max:1},model:{value:t.datas.block_lr_zero_threshold,callback:function(e){t.$set(t.datas,"block_lr_zero_threshold",e)},expression:"datas.block_lr_zero_threshold"}})],1)])]):t._e(),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Network Rank Dim")]),t._v(" "),e("div",[t._v(t._s(t.$t("networkSize")))]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmtDesc2")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:1===t.DSType?64:128},model:{value:t.datas.network_dim,callback:function(e){t.$set(t.datas,"network_dim",e)},expression:"datas.network_dim"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Network Alpha")]),t._v(" "),e("div",[t._v(t._s(t.$t("netWorkAlpha")))]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmtDesc3")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:1==t.DSType?32:["flux_default","sd35_default"].includes(t.type)?128:t.datas.network_dim},model:{value:t.datas.network_alpha,callback:function(e){t.$set(t.datas,"network_alpha",e)},expression:"datas.network_alpha"}})],1)]),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Network Dropout")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams9")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input-number",{attrs:{controls:!1,min:0,max:1,step:.01,precision:2,disabled:t.isView,"step-strictly":""},model:{value:t.datas.network_dropout,callback:function(e){t.$set(t.datas,"network_dropout",e)},expression:"datas.network_dropout"}})],1)])]):t._e(),t._v(" "),1==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Network Dropout")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainAdvSet_networkDropout")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,step:.01,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:0,max:1},model:{value:t.datas.network_dropout,callback:function(e){t.$set(t.datas,"network_dropout",e)},expression:"datas.network_dropout"}})],1)]):t._e()]):t._e(),t._v(" "),"labelingSettings"==o&&0==t.DSType?e("div",{staticClass:"dataCnt"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Shuffle caption")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt11")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-switch",{attrs:{disabled:t.isView},model:{value:t.datas.shuffle_caption,callback:function(e){t.$set(t.datas,"shuffle_caption",e)},expression:"datas.shuffle_caption"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("weighted captions")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt12")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-switch",{attrs:{disabled:t.isView},model:{value:t.datas.weighted_captions,callback:function(e){t.$set(t.datas,"weighted_captions",e)},expression:"datas.weighted_captions"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("keep n tokens")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt13")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:0,max:225},model:{value:t.datas.keep_tokens,callback:function(e){t.$set(t.datas,"keep_tokens",e)},expression:"datas.keep_tokens"}})],1)]),t._v(" "),e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Max token length")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt14")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{"popper-class":"custom-select",disabled:t.isView||"flux_default"===t.type},on:{change:function(e){return t.optimizerChange()}},model:{value:t.datas.max_token_length,callback:function(e){t.$set(t.datas,"max_token_length",e)},expression:"datas.max_token_length"}},t._l(t.max_token_length_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Caption Dropout Rate")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams10")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input-number",{attrs:{controls:!1,min:0,max:1,step:.01,precision:2,disabled:t.isView},model:{value:t.datas.caption_dropout_rate,callback:function(e){t.$set(t.datas,"caption_dropout_rate",e)},expression:"datas.caption_dropout_rate"}})],1)])]):t._e(),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Caption Dropout Every N Epochs")]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams11")))]),t._v(" "),e("div",[t._v(t._s(t.$t("datasetSettingsParams11_sub")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input-number",{attrs:{controls:!1,"step-strictly":"",min:0,step:1,max:t.datas.epoch,disabled:t.isView},model:{value:t.datas.caption_dropout_every_n_epochs,callback:function(e){t.$set(t.datas,"caption_dropout_every_n_epochs",e)},expression:"datas.caption_dropout_every_n_epochs"}})],1)])]):t._e()]):t._e(),t._v(" "),"noiseSettings"==o&&0==t.DSType?e("div",{staticClass:"dataCnt"},[e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Noise offset（0~1）")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt15")))]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmtDesc4")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView||"sdxl_default"==t.type,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:0,max:1,step:.01},model:{value:t.datas.noise_offset,callback:function(e){t.$set(t.datas,"noise_offset",e)},expression:"datas.noise_offset"}})],1)]),t._v(" "),"sdxl_default"!=t.type?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Multires noise iterations")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt16")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:0,max:64},model:{value:t.datas.multires_noise_iterations,callback:function(e){t.$set(t.datas,"multires_noise_iterations",e)},expression:"datas.multires_noise_iterations"}})],1)]):t._e(),t._v(" "),"sdxl_default"!=t.type?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Multires noise discount")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt17")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:0,max:1,step:.01},model:{value:t.datas.multires_noise_discount,callback:function(e){t.$set(t.datas,"multires_noise_discount",e)},expression:"datas.multires_noise_discount"}})],1)]):t._e()]):t._e(),t._v(" "),"AdvSet"==o?e("div",{staticClass:"dataCnt"},[0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Seed")]),t._v(" "),e("div",[t._v(t._s(t.$t("RandomSeed")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"seedBox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.datas.seed,expression:"datas.seed"}],attrs:{type:"number",disabled:t.isView},domProps:{value:t.datas.seed},on:{change:function(e){t.datas.seed=Number(t.datas.seed)},input:function(e){e.target.composing||t.$set(t.datas,"seed",e.target.value)}}}),t._v(" "),e("div",{on:{click:t.changeSeed}},[e("img",{attrs:{src:n(1069),alt:""}})])])])]):t._e(),t._v(" "),0==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("clip skip")]),t._v(" "),e("div",[t._v(t._s(t.$t("newTrainPmt18")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-slider",{attrs:{disabled:t.isView,"show-input":"","show-input-controls":!1,"show-tooltip":!1,min:1,max:2},model:{value:t.datas.clip_skip,callback:function(e){t.$set(t.datas,"clip_skip",e)},expression:"datas.clip_skip"}})],1)]):t._e(),t._v(" "),1==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Flow Shift")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainAdvSet_timeStepShift")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("div",{staticClass:"inputBox"},[e("el-input",{attrs:{disabled:t.isView,type:"number",min:"0",max:"20",resize:"none"},on:{input:t.formatFlowShift},model:{value:t.datas.flow_shift,callback:function(e){t.$set(t.datas,"flow_shift",e)},expression:"datas.flow_shift"}})],1)])]):t._e(),t._v(" "),1==t.DSType?e("div",{staticClass:"dataItem"},[e("div",{staticClass:"dataLabel"},[e("div",[t._v("Time Step Sampler")]),t._v(" "),e("div",[t._v(t._s(t.$t("trainAdvSet_timeStepSampling")))])]),t._v(" "),e("div",{staticClass:"dataEntry"},[e("el-select",{attrs:{"popper-class":"custom-select",disabled:t.isView},model:{value:t.datas.time_step_sampler,callback:function(e){t.$set(t.datas,"time_step_sampler",e)},expression:"datas.time_step_sampler"}},t._l(t.time_step_sampling_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]):t._e()]):t._e()])})),0)])])}),[],!1,null,"17ecec7c",null);e.a=component.exports},942:function(t,e,n){"use strict";n(18),n(11),n(6),n(12),n(13),n(8),n(4),n(7);var o=n(2),r=n(52),l=n(252),c=n(589);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var v={provide:function(){return{CardApp:this}},components:{ImageItem:l.default,AutoplayVideo:c.default,SwipeableList:r.default},props:{cardRunderList:{type:Array,default:function(){return[]}},isDialog:{type:Boolean,default:!1}},computed:{imgItem:function(){return function(t){return m(m({},t),{},{cover:{url:t.cover}})}}},methods:{handleClick:function(t){this.$emit("cardItemClick",t),this.$xyLogEvent({front_operation:"click",entity_type:"dataset_swiperlist",entity_name:"hot_dataset_apply",obj_desc:t.video_content?"2":"1",obj_id:t.id})}}},f=(n(4860),n(0)),component=Object(f.a)(v,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"dataSetSwiperlist"},[e("swipeable-list",t._b({attrs:{list:t.cardRunderList,listAlignItems:"flex-start",top:"0px",listGap:"16px"}},"swipeable-list",t.$attrs,!1),[t._l(t.cardRunderList,(function(n,o){return[e("div",{key:(n.id||"-")+o,staticClass:"card-item",on:{click:function(e){return t.handleClick(n)}}},[n.video_content?e("AutoplayVideo",{attrs:{item:n,posterUrl:n.cover,videoUrl:n.video_content}}):e("ImageItem",{attrs:{item:t.imgItem(n)}}),t._v(" "),e("div",{staticClass:"card-info-box"},[e("div",{staticClass:"card-info-box-title overflow-ellipsis"},[t._v(t._s(n.name))]),t._v(" "),e("div",{staticClass:"card-info-box-apply flex_c_m"},[t._v(t._s(t.$t("Apply")))])])],1)]}))],2)],1)}),[],!1,null,"4df5105b",null);e.a=component.exports;installComponents(component,{SwipeableList:n(52).default})}}]);