(window.webpackJsonp=window.webpackJsonp||[]).push([[23,44],{635:function(e,t,n){"use strict";n.r(t),n.d(t,"taskMixin",(function(){return I}));n(11),n(6),n(12),n(13);var o=n(3),r=n(2),c=(n(20),n(16),n(18),n(8),n(4),n(21),n(7),n(29)),l=n(1),d=n(35),v=n.n(d),h=n(106),m=n(9),_=n(46);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I={data:function(){return{fastOperateLoading:!1,currentTaskSource:null}},computed:k({},Object(l.c)("user",["accountSettingsData","userInfo"])),methods:{handleTaskError:function(code){var e={110005:this.$t("ChannelNotExist"),110009:this.$t("channelHasDisband"),7e4:this.$t("taskOperateFailed"),70001:this.$t("taskExceededDailyGenerationLimit"),70002:this.$t("taskQueueFull"),70003:this.$t("taskModelVersionNotSupportVariations"),70009:this.$t("taskModelForbidden"),70008:this.$t("taskArtWorkForbidden"),70024:this.$t("error_code_70024"),80008:this.$t("InsufficientBalance"),70010:this.$t("error_code_70010"),70011:this.$t("error_code_70011"),70013:this.$t("error_code_70013"),70014:this.$t("error_code_70014"),70015:this.$t("error_code_70015"),70016:this.$t("error_code_70016"),70019:this.$t("error_code_70019"),70023:this.$t("HttpErrorCode_70023")};code&&e[code]?this.$message.error(e[code]):this.$message.error(this.$t("ServerError"))},handleLogEvent:function(e){var t={2:"click_optifine",3:"click_variant",4:"click_video_generate",6:"click_creative_superscore",7:"click_remove_background",24:"click_anime_generate",9:"click_start_chat"};t[e]&&this.$logEvent("log_actions",{operation:t[e],behavior_info:"on_work_detail_page"})},fastOperateTask:function(){var e=arguments,t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var source,o,r,c,l,d,v,h,m,_,f,k,I,w,O,y,$,j,S,E,T;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.length>1&&void 0!==e[1]?e[1]:1,r=(source=e.length>0&&void 0!==e[0]?e[0]:{}).art_work_no,c=void 0===r?"":r,l=source.art_model_ver_no,d=void 0===l?"":l,v=source.type,h=void 0===v?"":v,m=source.action,_=source.prompt,f=void 0===_?"":_,k=source.removeBgUrl,t.fastOperateLoading=!0,t.handleLogEvent(m),n.next=7,t.getTaskReferInfo({art_model_ver_no:d,art_work_no:c,prompt:f});case 7:if(I=t.groupTaskOperateParams(source,o),w=[2,"2"].includes(localStorage.getItem("generateMode")||1),["",null,void 0].includes(f)||(I.source=3),2===m)try{I.meta.enable_hr=!1,delete I.meta.ad_units,delete I.meta.hr_upscaler,delete I.meta.hr_scale}catch(e){}if(O=3===m||24===m||["variation"].includes(h),y=t.checkIsStudioFlux(),$=3===m&&[7,11,"studio"].includes(I.meta.channel)&&y,(j=w&&3===m)||!O||[3,"3","midjourney"].includes(I.meta.channel)||$){n.next=20;break}return[5,"5","sdxl"].includes(I.meta.channel)&&(I.category=5,delete I.meta.channel),t.$EventBus.$emit("openGenerate",{action:m,data:I}),t.fastOperateLoading=!1,n.abrupt("return");case 20:if(I){n.next=23;break}return t.fastOperateLoading=!1,n.abrupt("return");case 23:if(7===m&&(I.meta.hi_res_arg&&delete I.meta.hi_res_arg,I.meta.remove_background={uri:k}),[3,"3","midjourney"].includes(I.meta.channel)&&(I.category=3,delete I.meta.channel),[5,"5","sdxl"].includes(I.meta.channel)&&(I.category=5,delete I.meta.channel),w||![7,11,"studio"].includes(I.meta.channel)){n.next=32;break}t.fastOperateLoading=!1;try{S=t.currentTaskSource||{},E=S.art_model,T=void 0===E?{}:E,I.art_model_no=null==T?void 0:T.id,I.art_model_ver_no=null==T?void 0:T.model_ver_no,I.speed_type=0}catch(e){}if(3!==m||!$){n.next=31;break}return n.abrupt("return",t.handleStudioVariationsTask(I));case 31:return n.abrupt("return",t.handleStudioUpscaleTask(I));case 32:if(!j){n.next=34;break}return n.abrupt("return",t.handleNewGenerateVariation(I,c));case 34:if(!w||2!==m){n.next=36;break}return n.abrupt("return",t.handleNewGenerateUpscale(I));case 36:t.handleTaskOperate(I).finally((function(){t.fastOperateLoading=!1}));case 37:case"end":return n.stop()}}),n)})))()},checkIsStudioFlux:function(){var e={};try{var t=(this.currentTaskSource||{}).art_model,n=void 0===t?{}:t;e.art_model_no=null==n?void 0:n.id,e.art_model_ver_no=null==n?void 0:n.model_ver_no,e.base_model=null==n?void 0:n.base_model,e.speed_type=0}catch(e){}return((null===m.L||void 0===m.L?void 0:m.L.sa)||[]).includes(e.base_model)},getTaskReferInfo:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.getTaskConfig)(t).then((function(t){var n=t||{},o=n.status.code,code=void 0===o?"":o,r=n.data,data=void 0===r?{}:r;return[1e4,"10000"].includes(code)&&(e.currentTaskSource=data),[1e4,"10000"].includes(code)||e.handleTaskError(code),t}))},handleNewGenerateVariation:function(){var e,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n={},o=this.currentTaskSource||{},r=o.art_model,c=void 0===r?{}:r;o.meta;n.model_no=c.id,n.model_ver_no=c.model_ver_no,n.meta=(null==source?void 0:source.meta)||{},this.fastOperateLoading=!1,console.log("===d=dd===d",n),this.$EventBus.$emit("openGenerate",{action:3,data:{init_images:null==n||null===(e=n.meta)||void 0===e?void 0:e.init_images,art_work_no:t}})},handleNewGenerateUpscale:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=this.currentTaskSource||{},o=n.art_model,r=void 0===o?{}:o;n.meta;t.model_no=r.id,t.model_ver_no=r.model_ver_no,t.meta=(null==source?void 0:source.meta)||{},Object(_.easyImageUpscale)(t).then((function(n){var o=n||{},r=o.data,data=void 0===r?{}:r,c=o.status,l=(void 0===c?{}:c).code;if([1e4,"10000"].includes(void 0===l?"":l)){var d=k({},data);d.sender_id=e.userInfo.id,d.messageInfo={},d.messageInfo.author={id:d.sender_id,name:e.userInfo.name},d.art_model_no=t.model_no||"",d.status=1,d.banner=null,d.img_uris=[],e.$EventBus.$emit("openGenerate",{action:0,data:d});try{Object(h.g)()}catch(e){}}else;})).catch((function(e){})).finally((function(){e.fastOperateLoading=!1}))},handleTaskOperate:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.createTask)(t).then((function(t){var n=t||{},o=n.data,data=void 0===o?{}:o,r=n.status.code;if([1e4,"10000"].includes(void 0===r?"":r)){e.$EventBus.$emit("openGenerate",{action:0,data:data});try{Object(h.g)()}catch(e){}}}))},groupTaskOperateParams:function(){var source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=source.action,n=void 0===t?1:t,o=source.operate_number,r=void 0===o?1:o,c={};c.action=n,c.operate_number=r,c.art_work_no=this.currentTaskSource.art_work_no,c.meta=v()(this.currentTaskSource.meta),c.meta.channel=this.currentTaskSource.channel||1;var l=["mask","mask_blur","inpainting_fill","inpainting_mask_invert","inpaint_full_res","inpaint_full_res_padding"];Object.keys(c.meta).forEach((function(e){l.includes(e)&&delete c.meta[e]}));var d=this.currentTaskSource,h=d.banner.url,m=void 0===h?"":h,_=d.img_uris,f=void 0===_?[]:_,k=null!=f&&f.length?f[r-1].url:"",I=["2",2].includes(e)?k:m;if(3===n){var w=c.meta.controlnet_units&&c.meta.controlnet_units.length?v()(c.meta.controlnet_units[0]):{},O={input_image:I,model:"canny",module:"control_sd15_canny [fef5e48e]"};w&&(w.model||w.module)?(O=Object.assign({},w,O),c.meta.controlnet_units=[O],c.meta.init_images=[],c.meta.script_args=[],c.meta.script_name="",c.meta.denoising_strength=0):(c.meta.init_images=[I],c.meta.controlnet_units=[],c.meta.script_args=[],c.meta.script_name="")}if(2===n&&(c.meta.init_images=[I],c.meta.controlnet_units=[]),6!==n)return c;this.$EventBus.$emit("openGenerate",{action:6,data:{imageUrl:I,art_work_no:this.currentTaskSource.pub_artwork_no,meta:Object.assign({},v()(this.currentTaskSource.meta),{channel:this.currentTaskSource.channel})}})},handleStudioUpscaleTask:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};["art_model_no","art_model_ver_no","channel_id","parent_task_id","meta","speed_type","source"].forEach((function(e){t[e]=source[e]})),Object(c.studioUpscaleTask)(t).then((function(n){var o=n||{},r=o.data,data=void 0===r?{}:r,c=o.status,l=(void 0===c?{}:c).code;if([1e4,"10000"].includes(void 0===l?"":l)){var d=k({},data);d.sender_id=e.userInfo.id,d.messageInfo={},d.messageInfo.author={id:d.sender_id,name:e.userInfo.name},d.art_model_no=t.art_model_no||"",d.status=1,d.type=2,d.category=11,d.banner=null,d.img_uris=[],e.$EventBus.$emit("openGenerate",{action:0,data:d});try{Object(h.g)()}catch(e){}}else;})).catch((function(e){}))},handleStudioVariationsTask:function(){var e=this,source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};["art_model_no","art_model_ver_no","channel_id","parent_task_id","meta","speed_type","source"].forEach((function(e){t[e]=source[e]})),Object(c.studioVariationTask)(t).then((function(n){var o=n||{},r=o.data,data=void 0===r?{}:r,c=o.status,l=(void 0===c?{}:c).code;if([1e4,"10000"].includes(void 0===l?"":l)){var d=k({},data);d.sender_id=e.userInfo.id,d.messageInfo={},d.messageInfo.author={id:d.sender_id,name:e.userInfo.name},d.art_model_no=t.art_model_no||"",d.status=1,d.type=3,d.category=11,d.banner=null,d.img_uris=[],e.$EventBus.$emit("openGenerate",{action:0,data:d});try{Object(h.g)()}catch(e){}}else;})).catch((function(e){}))}}}},681:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));n(11),n(6),n(12),n(13),n(8),n(4),n(7);var o=n(30),r=n(3),c=n(2),l=(n(20),n(19),n(16),n(31),n(18),n(28),n(21),n(140),n(44),n(10)),d=n(316),v=n(39),h=n(1),m=n(9);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k={data:function(){return{}},computed:f(f(f(f({},Object(h.c)("user",["userInfo","isLoggedIn","isCompanyAccount"])),Object(h.c)(["isSupportWebp"])),Object(h.e)("user",["cdnHost"])),{},{inviteCode:function(){var e;return(null===(e=this.userInfo)||void 0===e?void 0:e.invite_user_code)||""},blurImg:function(){return 1===this.activeImg.nsfw},hideLeft:function(){var e=this.activeIndex;return-1===e||0===e},hideRight:function(){var e=this.activeIndex;return-1===e||e===this.imgList.length-1},determineSelfWork:function(){var e,t,n;return(null==this||null===(e=this.activeImg)||void 0===e?void 0:e.author)&&(null==this||null===(t=this.activeImg)||void 0===t||null===(t=t.author)||void 0===t?void 0:t.id)==(null===(n=this.userInfo)||void 0===n?void 0:n.id)}}),methods:{handleImgError:function(e){"head"===e&&(this.showHead=!1)},downloadImg:function(){var e,t,path=(null===(e=this.activeImg)||void 0===e||null===(e=e.banner)||void 0===e?void 0:e.url)||(null===(t=this.activeImg)||void 0===t?void 0:t.cover),n=(this.getImageExtensionFromUrl(path),this.activeImg.id),o=(this.activeImg.author?this.activeImg.author.id:"image")+"_"+n;this.saveImg(path,o),this.$dotReport({action:"download",obj_type:this.activeImg.obj_type,obj_no:this.activeImg.id,stat:this.activeImg.stat})},getImageExtensionFromUrl:function(e){var t=e.match(/\/([^/]+)$/);return t&&t[1].includes(".")?"."+t[1].split(".").pop().toLowerCase():".jpeg"},getImagUrl:function(e,t){var o,r=n(217);return 1==(null===(o=this.activeImg)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.nsfw)?r:Object(l.K)(e,t)||e},bookmarkImg:function(){this.setCollect(this.activeImg,"artwork")},formatDate:function(e){var t=new Date(e),n=new Date;if(t.toDateString()===n.toDateString())return"Today"+t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},goToModel:function(){if(this.activeImg.model_id||this.activeImg.artwork_no){var e=this.activeImg;this.$logEvent("log_actions",{operation:"click_model",behavior_info:e.model_id}),window.open("/models/detail/".concat(e.model_id||e.artwork_no))}},getImg:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var c,param,source,l,data,v,h,m,title,_,f,k,I,w,O,y;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return param={id:e},(source=null===(c=n.$route.query)||void 0===c?void 0:c.source)&&(param.source=source),r.prev=3,r.next=6,n.$axios.post("/api/v1/artwork/detail",param);case 6:if(l=r.sent,data=l.data.data,v=l.headers,h="normal"===v["x-account-type"],title=(m=data||{}).title,_=m.local_prompt,!h){r.next=19;break}return r.next=14,Object(d.c)({id:e,titles:[title,_],enable_filter:1});case 14:f=r.sent,k=f.data.titles,I=k||[],w=Object(o.a)(I,2),O=w[0],y=w[1],data.title=O,data.local_prompt=y;case 19:n.handleImageData(data),t&&t(null==data?void 0:data.show_tags),r.next=27;break;case 23:r.prev=23,r.t0=r.catch(3),console.log("error",r.t0),n.$router.push(n.localePath("/"));case 27:case"end":return r.stop()}}),r,null,[[3,23]])})))()},handleImageData:function(data){if(this.isLoadImage=!0,data){this.activeImg.banner&&this.activeImg.banner.url?this.activeImg=Object.assign({},this.activeImg,f({},data)):(this.activeImg=data,this.$set(this,"activeImg",this.activeImg));var p=data.parent_art_work;this.parentInfo=p||{},this.showParent=!(!this.parentInfo.banner||!this.parentInfo.banner.url||1===this.parentInfo.nsfw||1===this.activeImg.nsfw),this.handleQuickOperateButtonPermissions()}},hidePopover:function(){this.popovervisible=!1,this.infovisible=!1,this.showMask=!1},moreActions:function(e){var t=this,n=e.type,o=e.id,r=e.fromPage,c=void 0===r?"":r;e.needLogin;if(this.hidePopover(),this.isLoggedIn||"play"===n){var l={obj_no:o||this.activeImg.id,obj_type:1,view_domain:"detail",category:"default",batch_id:"",negative_ids:[]};switch(n){case"copy":this.copyTextToClipboard(this.activeImg.meta.prompt);break;case"mark":this.bookmarkImg();break;case"save":this.$logEvent("log_actions",{operation:"download_image",behavior_info:"作品详情页"}),this.downloadImg();break;case"play":this.$logEvent("log_actions",{operation:"click_create_button",behavior_info:this.activeImg.id,behavior_info_sub:"work_details"}),l.action="task",l.view_domain="details_one",Object(v.i)({items:[l]}),this.infovisible=!1;var d=Object.assign({},this.activeImg);["artworkDetail","exploreDetail"].includes(c)&&(d.taskSource=4),d.logEventSource=Object(m.Y)(this.$route.name);var h={action:6==d.type?24:1,data:{source:d}};this.isAIVideo&&(h.taskVersion="v2"),this.$EventBus.$emit("openGenerate",h);break;case"flag":this.$logEvent("log_actions",{operation:"click_report_button",behavior_info:this.activeImg.id,behavior_info_sub:"work_details"}),this.reportArtwork({id:this.activeImg.id,obj_type:1});break;case"not_interested":this.$logEvent("log_actions",{operation:"click_uninterested_button",behavior_info:this.activeImg.id,behavior_info_sub:"work_details"}),Object(v.i)({items:[{action:"not_interested",obj_no:this.activeImg.id,obj_type:1,view_domain:"detail"}]}).then((function(e){var n,o;1e4==(null==e||null===(n=e.status)||void 0===n?void 0:n.code)?(t.$message({message:t.$t("OperateSuccess"),type:"success"}),t.setWaterFallDeleteLits(t.activeImg.id)):t.$message({message:(null==e||null===(o=e.status)||void 0===o?void 0:o.msg)||t.$t("ServerError"),type:"error"})}));break;default:console.log("Invalid type")}}else this.$EventBus.$emit("openLoginDialog")},share:function(){var e,t,n,o,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"work",c={work:["/explore/detail/","作品详情页"],model:["/models/detail/","模型详情页"],imgGather:["/artWorkDetail/","图集详情页"],video:["/video/","视频详情页"],palette:["/editBoard/detail/","画板详情页"]},l=c[r]?c[r][0]:"/explore/detail/",d=null===(e=this.$route)||void 0===e||null===(e=e.params)||void 0===e?void 0:e.id,v="".concat(window.location.origin).concat(l).concat(d)+(this.inviteCode?"?u_code=".concat(this.inviteCode):""),h=null===(t=this.activeImg)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.url.match(/.*\.(png|gif|bmp|tiff?|svg|ico)$/i),m="";h?m=(null===(n=this.activeImg)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.url.replace(h[1],"").slice(0,-1))+"_low.webp":m=null===(o=this.activeImg)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.url;this.$logEvent("log_actions",{operation:"forward_link",behavior_info_sub:c[r]?c[r][1]:"作品详情页"}),"imgGather"===r?this.$refs.ShareDialog.show(v,m,"","",d,4):this.$refs.inviteDialog.show(v,m)},share1:function(){var e,t,n,o,r,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"work",l={work:["/explore/detail/","作品详情页"],model:["/models/detail/","模型详情页"],imgGather:["/artWorkDetail/","图集详情页"],video:["/video/","视频详情页"],canvas:["/editBoard/detail/","画板详情页"]},d=l[c]?l[c][0]:"/explore/detail/",v=null===(e=this.$route)||void 0===e||null===(e=e.params)||void 0===e?void 0:e.id,h="".concat(window.location.origin).concat(d).concat(v,"?source=share_link")+(this.inviteCode?"&u_code=".concat(this.inviteCode):""),m=null===(t=this.activeImg)||void 0===t||null===(t=t.banner)||void 0===t?void 0:t.url.match(/.*\.(png|gif|bmp|tiff?|svg|ico)$/i),_="";m?_=(null===(n=this.activeImg)||void 0===n||null===(n=n.banner)||void 0===n?void 0:n.url.replace(m[1],"").slice(0,-1))+"_low.webp":_=(null===(o=this.activeImg)||void 0===o||null===(o=o.banner)||void 0===o?void 0:o.url)||(null===(r=this.activeImg)||void 0===r?void 0:r.cover);var f=l[c]?l[c][1]:"作品详情页";this.$logEvent("log_actions",{operation:"forward_link",behavior_info_sub:f});var k=(this.activeImg.author?this.activeImg.author.id:"image")+"_"+v;console.log("shareUrl",h,"posterImage",_,"fileName",k,"pageName",f),this.$refs.ShareDialog.show(h,_,k,c+"_detail_page")},goTagDtl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"work_detials",n=this.$route.name,path=n.includes("ModelDetail")?"/model":n.includes("ArtWorkDetail")?"/post":"";e.id&&(this.$logEvent("log_actions",{operation:"click_tags",behavior_info:e,behavior_info_sub:t}),this.$router.push(this.localePath("/tagInfo".concat(path,"/").concat(e.id))))}}}}}]);